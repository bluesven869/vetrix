
; /* Start:"a:4:{s:4:"full";s:97:"/bitrix/components/bitrix/main.interface.buttons/templates/.default/script.min.js?151859616937794";s:6:"source";s:77:"/bitrix/components/bitrix/main.interface.buttons/templates/.default/script.js";s:3:"min";s:0:"";s:3:"map";s:0:"";}"*/
BX.namespace("BX.Main");if(typeof BX.Main.interfaceButtons==="undefined"){BX.Main.interfaceButtons=function(t,e){this.classItem="main-buttons-item";this.classItemSublink="main-buttons-item-sublink";this.classItemText="main-buttons-item-text";this.classItemCounter="main-buttons-item-counter";this.classItemIcon="main-buttons-item-icon";this.classItemMore="main-buttons-item-more";this.classOnDrag="main-buttons-drag";this.classDropzone="main-buttons-submenu-dropzone";this.classSeporator="main-buttons-submenu-separator";this.classHiddenLabel="main-buttons-hidden-label";this.classSubmenuItem="main-buttons-submenu-item";this.classItemDisabled="main-buttons-disabled";this.classItemOver="over";this.classItemActive="main-buttons-item-active";this.classSubmenu="main-buttons-submenu";this.classSecret="secret";this.classItemLocked="locked";this.submenuIdPrefix="main_buttons_popup_";this.submenuWindowIdPrefix="menu-popup-";this.classSettingMenuItem="main-buttons-submenu-setting";this.classEditState="main-buttons-edit";this.classEditItemButton="main-buttons-item-edit-button";this.classDragItemButton="main-buttons-item-drag-button";this.classSettingsApplyButton="main-buttons-submenu-settings-apply";this.classSettingsResetButton="main-buttons-submenu-settings-reset";this.classSetHome="main-buttons-set-home";this.classSetHide="main-buttons-set-hide";this.classManage="main-buttons-manage";this.classContainer="main-buttons";this.classSubmenuNoHiddenItem="main-buttons-submenu-item-no-hidden";this.classDefaultSubmenuItem="menu-popup-item";this.classInner="main-buttons-inner-container";this.listContainer=null;this.pinContainer=null;this.dragItem=null;this.overItem=null;this.moreButton=null;this.messages=null;this.licenseParams=null;this.isSubmenuShown=false;this.isSubmenuShownOnDragStart=false;this.isSettingsEnabled=true;this.containerId=e.containerId;this.tmp={};this.init(t,e);return{getItemById:BX.delegate(this.getItemById,this),getAllItems:BX.delegate(this.getAllItems,this),getHiddenItems:BX.delegate(this.getHiddenItems,this),getVisibleItems:BX.delegate(this.getVisibleItems,this),getDisabledItems:BX.delegate(this.getDisabledItems,this),getMoreButton:BX.delegate(this.getMoreButton,this),adjustMoreButtonPosition:BX.delegate(this.adjustMoreButtonPosition,this),showSubmenu:BX.delegate(this.showSubmenu,this),closeSubmenu:BX.delegate(this.closeSubmenu,this),refreshSubmenu:BX.delegate(this.refreshSubmenu,this),getCurrentSettings:BX.delegate(this.getCurrentSettings,this),saveSettings:BX.delegate(this.saveSettings,this),setCounterValueByItemId:BX.delegate(this.setCounterValueByItemId,this),getCounterValueByItemId:BX.delegate(this.getCounterValueByItemId,this),updateCounter:BX.delegate(this.updateCounter,this),getActive:BX.delegate(this.getActive,this),isEditEnabled:BX.delegate(this.isEditEnabled,this),isActiveInMoreMenu:BX.delegate(this.isActiveInMoreMenu,this),isSettingsEnabled:this.isSettingsEnabled,classes:{item:this.classItem,itemText:this.classItemText,itemCounter:this.classItemCounter,itemIcon:this.classItemIcon,itemDisabled:this.classItemDisabled,itemOver:this.classItemOver,itemActive:this.classItemActive,itemLocked:this.classItemLocked,submenu:this.classSubmenu,submenuItem:this.classSubmenuItem,containerOnDrag:this.classOnDrag,classSettingMenuItem:this.classSettingMenuItem},itemsContainer:this.listContainer,itemsContainerId:this.listContainer.id}};BX.Main.interfaceButtons.prototype={init:function(t,e){this.listContainer=BX(this.getId());if(!BX.type.isPlainObject(e)){throw"BX.MainButtons: params is not Object"}if(!("containerId"in e)||!BX.type.isNotEmptyString(e.containerId)){throw"BX.MainButtons: containerId not set in params"}if(!BX.type.isDomNode(this.listContainer)){throw"BX.MainButtons: #"+e.containerId+" is not dom node"}if("classes"in e&&BX.type.isPlainObject(e.classes)){this.setCustomClasses(e.classes)}if("messages"in e&&BX.type.isPlainObject(e.messages)){this.setMessages(e.messages)}if("licenseWindow"in e&&BX.type.isPlainObject(e.licenseWindow)){this.setLicenseWindowParams(e.licenseWindow)}if("disableSettings"in e&&e.disableSettings==="true"){this.isSettingsEnabled=false;this.visibleControlMoreButton()}this.moreButton=this.getMoreButton();if(this.isSettingsEnabled){this.dragAndDropInit()}this.adjustMoreButtonPosition();this.bindOnClickOnMoreButton();this.bindOnScrollWindow();this.setContainerHeight();BX.bind(this.getContainer(),"click",BX.delegate(this._onDocumentClick,this));BX.addCustomEvent("onPullEvent-main",BX.delegate(this._onPush,this));this.updateMoreButtonCounter();if(this.isActiveInMoreMenu()){this.activateItem(this.moreButton)}var s=this.getVisibleItems();var i=BX.type.isArray(s)&&s.length>0?s[0]:null;var n=BX.Buttons.Utils.getByTag(i,"a");if(!BX.type.isDomNode(n)){return}var a=n.getAttribute("href");if(a.charAt(0)==="?"){a=n.pathname+n.search}if(!this.lastHomeLink){this.lastHomeLink=a}this.bindOnResizeFrame()},_onDocumentClick:function(t){var e=this.getItem(t);var s,i,n,a,o,u;if(this.isDragButton(t.target)){t.preventDefault();t.stopPropagation()}if(BX.type.isDomNode(e)){if(this.isSettings(e)){this.enableEdit();BX.hide(this.getSettingsButton());BX.show(this.getSettingsApplyButton());return false}if(this.isApplySettingsButton(e)){t.preventDefault();t.stopPropagation();this.disableEdit();BX.show(this.getSettingsButton());BX.hide(this.getSettingsApplyButton());return false}if(this.isResetSettingsButton(e)){this.resetSettings();return false}if(this.isLocked(e)){t.preventDefault();this.showLicenseWindow();return false}if(this.isEditButton(t.target)){var r,h;t.preventDefault();t.stopPropagation();if(this.isSubmenuItem(e)){e=this.getItemAlias(e)}try{r=JSON.parse(BX.data(e,"item"))}catch(t){}h=this.getItemEditMenu();if(h&&h.popupWindow.isShown()&&this.lastEditNode===e){h.popupWindow.close()}else{this.showItemEditMenu(r,t.target)}this.lastEditNode=e;return false}if(this.isSetHide(e)){o=this.getVisibleItems();u=BX.type.isArray(o)?o.length:null;a=this.editItemData.ID.replace(this.listContainer.id+"_","");i=this.getItemById(a);n=this.getItemAlias(i);i=this.isVisibleItem(i)?i:n;if(this.isDisabled(n)){this.enableItem(n)}else if(!this.isDisabled(n)&&u>2){this.disableItem(n)}if(u===2){BX.onCustomEvent(window,"BX.Main.InterfaceButtons:onHideLastVisibleItem",[i,this])}this.refreshSubmenu();this.saveSettings();this.adjustMoreButtonPosition();if(this.isEditEnabled()){this.enableEdit();BX.hide(this.getSettingsButton());BX.show(this.getSettingsApplyButton())}this.editMenu.popupWindow.close();return false}if(this.isSetHome(e)){a=this.editItemData.ID.replace(this.listContainer.id+"_","");i=this.getItemById(a);n=this.getItemAlias(i);if(this.isDisabled(n)){this.enableItem(n)}this.listContainer.insertBefore(i,BX.firstChild(this.listContainer));this.adjustMoreButtonPosition();this.refreshSubmenu();this.saveSettings();if(this.isEditEnabled()){this.enableEdit();BX.hide(this.getSettingsButton());BX.show(this.getSettingsApplyButton())}this.editMenu.popupWindow.close();return false}if(!this.isSublink(t.target)){s=this.dataValue(e,"onclick");if(BX.type.isNotEmptyString(s)){t.preventDefault();this.execScript(s)}}}if(this.isEditEnabled()){this.getSubmenu().popupWindow.setAutoHide(false)}},isActiveInMoreMenu:function(){var t=this.getHiddenItems();var e=this.getDisabledItems();var s=t.concat(e);return s.some(function(t){var e;try{e=JSON.parse(BX.data(t,"item"))}catch(t){}return BX.type.isPlainObject(e)&&("IS_ACTIVE"in e&&e.IS_ACTIVE===true||e.IS_ACTIVE==="true"||e.IS_ACTIVE==="Y")},this)},_onPush:function(t,e){if(t==="user_counter"&&e&&BX.message("SITE_ID")in e){var s=e[BX.message("SITE_ID")];for(var i in s){if(s.hasOwnProperty(i)){this.updateCounter(i,s[i])}}}},bindOnScrollWindow:function(){BX.bind(window,"scroll",BX.delegate(this._onScroll,this))},getActive:function(){var t=this.getAllItems();var e,s;var i=null;if(BX.type.isArray(t)){t.forEach(function(t){try{e=JSON.parse(BX.data(t,"item"))}catch(t){e=null}if(BX.type.isPlainObject(e)&&"IS_ACTIVE"in e&&(e.IS_ACTIVE===true||e.IS_ACTIVE==="true"||e.IS_ACTIVE==="Y")){i=e}},this)}if(BX.type.isPlainObject(i)){s=BX(i.ID);if(BX.type.isDomNode(s)){i.NODE=s}else{i.NODE=null}}return i},isSetHome:function(t){return BX.hasClass(t,this.classSetHome)},isSetHide:function(t){return BX.hasClass(t,this.classSetHide)},getSettingsButton:function(){return BX.Buttons.Utils.getByClass(this.getSubmenuContainer(),this.classSettingMenuItem)},getSettingsApplyButton:function(){return BX.Buttons.Utils.getByClass(this.getSubmenuContainer(),this.classSettingsApplyButton)},isApplySettingsButton:function(t){return BX.hasClass(t,this.classSettingsApplyButton)},enableEdit:function(){var t=this.getSubmenu();if(t&&"popupWindow"in t){t.popupWindow.setAutoHide(false)}BX.addClass(this.listContainer,this.classEditState);BX.addClass(this.getSubmenuContainer(),this.classEditState);this.isEditEnabledState=true},disableEdit:function(){var t=this.getSubmenu();if(t&&"popupWindow"in t){t.popupWindow.setAutoHide(true)}BX.removeClass(this.listContainer,this.classEditState);BX.removeClass(this.getSubmenuContainer(),this.classEditState);this.isEditEnabledState=false},isEditEnabled:function(){return this.isEditEnabledState},showItemEditMenu:function(t,e){if(BX.type.isPlainObject(t)&&"ID"in t){var s=[this.listContainer.id,"_edit_item"].join("");var i=BX.PopupMenu.getMenuById(s);if(i){BX.PopupMenu.destroy(s)}i=this.createItemEditMenu(t,s,e);i.popupWindow.show()}},getContainer:function(){if(!BX.type.isDomNode(this.container)){this.container=BX(this.containerId).parentNode}return this.container},getItemEditMenu:function(){return BX.PopupMenu.getMenuById([this.listContainer.id,"_edit_item"].join(""))},createItemEditMenu:function(t,e,s){var i;var n=[{text:this.message("MIB_SET_HOME"),className:"main-buttons-set-home menu-popup-no-icon"}];var a=t.ID.replace(this.listContainer.id+"_","");var o=this.getItemById(a);if(this.isDisabled(o)){n.push({text:this.message("MIB_SET_SHOW"),className:"main-buttons-set-hide menu-popup-no-icon"})}else{n.push({text:this.message("MIB_SET_HIDE"),className:"main-buttons-set-hide menu-popup-no-icon"})}var u=BX.pos(s);var r={menuId:e,anchor:s,menuItems:n,settings:{autoHide:true,offsetTop:0,offsetLeft:u.width/2,zIndex:20,angle:{position:"top",offset:u.width/2}}};i=BX.PopupMenu.create(r.menuId,r.anchor,r.menuItems,r.settings);if(this.isVisibleItem(o)){t.NODE=o}else{t.NODE=this.getItemAlias(o)}this.editItemData=t;if("menuItems"in i&&BX.type.isArray(i.menuItems)){i.menuItems.forEach(function(t){BX.bind(t.layout.item,"click",BX.delegate(this._onDocumentClick,this))},this)}BX.onCustomEvent(window,"BX.Main.InterfaceButtons:onBeforeCreateEditMenu",[i,t,this]);this.editMenu=i;return i},setHome:function(){var t=this.getVisibleItems();var e=BX.type.isArray(t)&&t.length>0?t[0]:null;var s=BX.Buttons.Utils.getByTag(e,"a");if(!BX.type.isDomNode(s)){return}var i=s.getAttribute("href");if(i.charAt(0)==="?"){i=s.pathname+s.search}if(!this.lastHomeLink){this.lastHomeLink=i}if(this.lastHomeLink!==i){BX.userOptions.save("ui",this.listContainer.id,"firstPageLink",i);BX.onCustomEvent("BX.Main.InterfaceButtons:onFirstItemChange",[i,e])}this.lastHomeLink=i},isEditButton:function(t){return BX.hasClass(t,this.classEditItemButton)},isDragButton:function(t){return BX.hasClass(t,this.classDragItemButton)},isResetSettingsButton:function(t){return BX.hasClass(t,this.classSettingsResetButton)},getContainerHeight:function(){var t=this.getAllItems().map(function(t){var e=getComputedStyle(t);return BX.height(t)+parseInt(e.marginTop)+parseInt(e.marginBottom)});return Math.max.apply(Math,t)},setContainerHeight:function(){var t=this.getContainerHeight();BX.height(this.listContainer,t)},setLicenseWindowParams:function(t){this.licenseParams=t||{}},message:function(t){var e;try{e=this.messages[t]}catch(t){e=""}return e},setCustomClasses:function(t){if(!BX.type.isPlainObject(t)){return}this.classItem=t.item||this.classItem;this.classItemSublink=t.itemSublink||this.classItemSublink;this.classItemText=t.itemText||this.classItemText;this.classItemCounter=t.itemCounter||this.classItemCounter;this.classItemIcon=t.itemIcon||this.classItemIcon;this.classItemMore=t.itemMore||this.classItemMore;this.classItemOver=t.itemOver||this.classItemOver;this.classItemActive=t.itemActive||this.classItemActive;this.classItemDisabled=t.itemDisabled||this.classItemDisabled;this.classOnDrag=t.onDrag||this.classOnDrag;this.classDropzone=t.dropzone||this.classDropzone;this.classSeporator=t.separator||this.classSeporator;this.classSubmenuItem=t.submenuItem||this.classSubmenuItem;this.classSubmenu=t.submenu||this.classSubmenu;this.classSecret=t.secret||this.classSecret;this.classItemLocked=t.itemLocked||this.classItemLocked},setMessages:function(t){if(!BX.type.isPlainObject(t)){return}this.messages=t},makeFullItemId:function(t){if(!BX.type.isNotEmptyString(t)){return}return[this.listContainer.id,t.replace("-","_")].join("_")},getItemById:function(t){var e=null;var s;if(BX.type.isNotEmptyString(t)){s=this.makeFullItemId(t);e=BX.Buttons.Utils.getBySelector(this.listContainer,"#"+s)}return e},getItemCounterObject:function(t){var e=null;if(BX.type.isDomNode(t)){e=BX.Buttons.Utils.getByClass(t,this.classItemCounter)}return e},setCounterValue:function(t,e){var s=this.getItemCounterObject(t);if(BX.type.isDomNode(s)){s.innerText=e>99?"99+":e>0?e:"";t.dataset.counter=e}this.updateMoreButtonCounter()},updateCounter:function(t,e){if(t.indexOf("crm")===0&&e<0){return}var s,i,n;var a=null;var o=this.getAllItems();if(BX.type.isArray(o)){o.forEach(function(e){try{i=JSON.parse(BX.data(e,"item"))}catch(t){i={}}if(BX.type.isPlainObject(i)&&"COUNTER_ID"in i&&i.COUNTER_ID===t){a=e}},this)}s=this.getItemCounterObject(a);if(BX.type.isDomNode(s)){a=this.getItem(s);s.innerText=e>99?"99+":e>0?e:"";a.dataset.counter=e}n=this.getItemAlias(a);if(BX.type.isDomNode(n)){s=this.getItemCounterObject(n);if(BX.type.isDomNode(s)){s.innerText=e>99?"99+":e>0?e:"";n.dataset.counter=e}}this.updateMoreButtonCounter()},setCounterValueByItemId:function(t,e){var s=e!==null?parseFloat(e):null;var i,n;if(!BX.type.isNotEmptyString(t)){throw"Bad first arg. Need string as item id"}if(s!==null&&!BX.type.isNumber(s)){throw"Bad two arg. Need number counter value - Integer, Float or string with number"}i=this.getItemById(t);if(!BX.type.isDomNode(i)){console.info("Not found node with id #"+t);return}n=this.getItemAlias(i);this.setCounterValue(i,s);this.setCounterValue(n,s)},getCounterValueByItemId:function(t){var e,s;var i=NaN;if(!BX.type.isNotEmptyString(t)){throw"Bad first arg. Need string item id"}else{e=this.getItemById(t);i=this.dataValue(e,"counter");i=parseFloat(i);if(!BX.type.isNumber(i)){s=this.getItemCounterObject(e);i=parseFloat(s.innerText)}}return i},setMoreButtonCounter:function(t){var e=this.getItemCounterObject(this.moreButton);var s=t>99?"99+":t>0?t:"";s=parseInt(s);s=BX.type.isNumber(s)?s:"";e.innerText=s},bindOnClickOnMoreButton:function(){BX.bind(this.moreButton,"click",BX.delegate(this._onClickMoreButton,this))},bindOnResizeFrame:function(){window.frames["maininterfacebuttonstmpframe-"+this.getId()].onresize=BX.throttle(this._onResizeHandler,20,this)},getId:function(){return BX.Buttons.Utils.getByClass(this.getContainer(),this.classInner).id},getAllItems:function(){return BX.Buttons.Utils.getByClass(this.listContainer,this.classItem,true)},getVisibleItems:function(){var t=this.getAllItems();var e=this;var s=[];if(t&&t.length){s=t.filter(function(t){return e.isVisibleItem(t)&&!e.isDisabled(t)})}return s},getHiddenItems:function(){var t=this.getAllItems();var e=[];var s=this;if(t&&t.length){e=t.filter(function(t){return!s.isVisibleItem(t)&&!s.isDisabled(t)})}return e},getDisabledItems:function(){return this.getAllItems().filter(function(t){return this.isDisabled(t)},this)},getMoreButton:function(){var t=null;this.getAllItems().forEach(function(e){!t&&BX.hasClass(e,this.classItemMore)&&(t=e)},this);return t},getLastVisibleItem:function(){var t=this.getVisibleItems();var e=null;if(BX.type.isArray(t)&&t.length){e=t[t.length-1]}if(!BX.type.isDomNode(e)){e=null}return e},adjustMoreButtonPosition:function(){var t=this.getLastVisibleItem();var e=this.isMoreButton(t);if(!e){this.listContainer.insertBefore(this.moreButton,t)}this.updateMoreButtonCounter()},getSubmenuId:function(t){var e="";if(BX.type.isDomNode(this.listContainer)&&BX.type.isNotEmptyString(this.listContainer.id)){e=this.submenuIdPrefix+this.listContainer.id}if(t){e=this.submenuWindowIdPrefix+e}return e},getSubmenuItemText:function(t){var e,s,i;if(!BX.type.isDomNode(t)){return null}e=this.findChildrenByClassName(t,this.classItemText);s=this.findChildrenByClassName(t,this.classItemCounter);if(BX.type.isDomNode(s)&&BX.type.isDomNode(e)){s.dataset.counter=this.dataValue(t,"counter");i=e.outerHTML+s.outerHTML}else{e=this.dataValue(t,"text");s=this.dataValue(t,"counter");i=e}return i},getLockedClass:function(t){var e="";if(BX.type.isDomNode(t)&&this.isLocked(t)){e=this.classItemLocked}return e},getSubmenuItems:function(){var t=this.getAllItems();var e=this.getHiddenItems();var s=this.getDisabledItems();var i=[];var n,a;if(t.length){t.forEach(function(t){if(e.indexOf(t)===-1&&s.indexOf(t)===-1){i.push({text:this.getSubmenuItemText(t),href:this.dataValue(t,"url"),onclick:this.dataValue(t,"onclick"),title:t.getAttribute("title"),className:[this.classSubmenuItem,this.getIconClass(t),this.classSecret,this.getAliasLink(t),this.getLockedClass(t)].join(" ")})}},this)}if(e.length){e.forEach(function(t){try{n=JSON.parse(this.dataValue(t,"item"))}catch(t){n=null}a=[this.classSubmenuItem,this.getIconClass(t),this.getAliasLink(t),this.getLockedClass(t)];if(BX.type.isPlainObject(n)&&("IS_ACTIVE"in n&&n.IS_ACTIVE===true||n.IS_ACTIVE==="true"||n.IS_ACTIVE==="Y")){a.push(this.classItemActive)}i.push({text:this.getSubmenuItemText(t),href:this.dataValue(t,"url"),onclick:this.dataValue(t,"onclick"),title:t.getAttribute("title"),className:a.join(" ")})},this)}if(this.isSettingsEnabled){i.push({text:"<span>"+this.message("MIB_HIDDEN")+"</span>",className:[this.classSeporator,this.classSubmenuItem,this.classHiddenLabel].join(" ")});if(!s.length){i.push({text:"<span>"+this.message("MIB_NO_HIDDEN")+"</span>",className:[this.classSubmenuItem,this.classSubmenuNoHiddenItem].join(" ")})}if(s.length){s.forEach(function(t){try{n=JSON.parse(this.dataValue(t,"item"))}catch(t){n=null}a=[this.classSubmenuItem,this.classItemDisabled,this.getIconClass(t),this.getAliasLink(t),this.getLockedClass(t)];if(BX.type.isPlainObject(n)&&("IS_ACTIVE"in n&&n.IS_ACTIVE===true||n.IS_ACTIVE==="true"||n.IS_ACTIVE==="Y")){a.push(this.classItemActive)}i.push({text:this.getSubmenuItemText(t),href:this.dataValue(t,"url"),onclick:this.dataValue(t,"onclick"),title:t.getAttribute("title"),className:a.join(" ")})},this)}i.push({text:"<span>"+this.message("MIB_MANAGE")+"</span>",className:[this.classSeporator,this.classSubmenuItem,this.classHiddenLabel,this.classManage].join(" ")});i.push({text:this.message("MIB_SETTING_MENU_ITEM"),className:[this.classSettingMenuItem,this.classSubmenuItem].join(" ")});i.push({text:this.message("MIB_APPLY_SETTING_MENU_ITEM"),className:[this.classSettingsApplyButton,this.classSubmenuItem].join(" ")});i.push({text:this.message("MIB_RESET_SETTINGS"),className:[this.classSettingsResetButton,this.classSubmenuItem].join(" ")})}return i},getSubmenuArgs:function(){var t=this.getSubmenuId();var e=this.moreButton;var s=BX.pos(e);var i=this.getSubmenuItems();var n={autoHide:true,offsetLeft:s.width/2-80,angle:{position:"top",offset:100},zIndex:20,events:{onPopupClose:BX.delegate(this._onSubmenuClose,this)}};return[t,e,i,n]},visibleControlMoreButton:function(){var t=this.getHiddenItems();if(!t.length||t.length===1&&this.isMoreButton(t[0])){this.getMoreButton().style.display="none"}else{this.getMoreButton().style.display=""}},createSubmenu:function(){var t=BX.PopupMenu.create.apply(BX.PopupMenu,this.getSubmenuArgs());if(this.isSettingsEnabled){this.dragAndDropInitInSubmenu()}t.menuItems.forEach(function(t){BX.bind(t.layout.item,"click",BX.delegate(this._onDocumentClick,this))},this);return t},showSubmenu:function(){var t=this.getSubmenu();if(t!==null){t.popupWindow.show()}else{this.destroySubmenu();t=this.createSubmenu();t.popupWindow.show()}this.setSubmenuShown(true);this.activateItem(this.moreButton);if(this.isEditEnabled()){t.popupWindow.setAutoHide(false)}},closeSubmenu:function(){var t=this.getSubmenu();if(t===null){return}t.popupWindow.close();if(!this.isActiveInMoreMenu()){this.deactivateItem(this.moreButton)}this.setSubmenuShown(false)},getSubmenu:function(){return BX.PopupMenu.getMenuById(this.getSubmenuId())},destroySubmenu:function(){BX.PopupMenu.destroy(this.getSubmenuId())},refreshSubmenu:function(){var t=this.getSubmenu();var e;if(t===null){return}e=this.getSubmenuArgs();if(BX.type.isArray(e)){this.destroySubmenu();this.createSubmenu();this.showSubmenu()}},setSubmenuShown:function(t){this.isSubmenuShown=false;if(BX.type.isBoolean(t)){this.isSubmenuShown=t}},activateItem:function(t){if(!BX.type.isDomNode(t)){return}if(!BX.hasClass(t,this.classItemActive)){BX.addClass(t,this.classItemActive)}},deactivateItem:function(t){if(!BX.type.isDomNode(t)){return}if(BX.hasClass(t,this.classItemActive)){BX.removeClass(t,this.classItemActive)}},getCurrentSettings:function(){var t={};this.getAllItems().forEach(function(e,s){t[e.id]={sort:s,isDisabled:this.isDisabled(e)}},this);return t},saveSettings:function(){var t=this.getCurrentSettings();var e="settings";var s;if(!BX.type.isPlainObject(t)){return}if(BX.type.isDomNode(this.listContainer)){if("id"in this.listContainer){s=this.listContainer.id;t=JSON.stringify(t);BX.userOptions.save("ui",s,e,t);this.setHome()}}},resetSettings:function(){var t=null;var e=BX.PopupWindowManager.create(this.listContainer.id+"_reset_popup",null,{content:this.message("MIB_RESET_ALERT"),autoHide:false,overlay:true,closeByEsc:true,closeIcon:true,draggable:{restrict:true},titleBar:this.message("MIB_RESET_SETTINGS"),buttons:[t=new BX.PopupWindowButton({text:this.message("MIB_RESET_BUTTON"),className:"popup-window-button-create",events:{click:function(){if(BX.hasClass(t.buttonNode,"popup-window-button-wait")){return}BX.addClass(t.buttonNode,"popup-window-button-wait");this.handleResetSettings(function(s){if(s){BX.removeClass(t.buttonNode,"popup-window-button-wait");e.setContent(s)}else{var i="settings";BX.userOptions.save("ui",this.listContainer.id,i,JSON.stringify({}));BX.userOptions.save("ui",this.listContainer.id,"firstPageLink","");window.location.reload()}}.bind(this))}.bind(this)}}),new BX.PopupWindowButtonLink({text:this.message("MIB_CANCEL_BUTTON"),className:"popup-window-button-link-cancel",events:{click:function(){this.popupWindow.close()}}})]});e.show()},handleResetSettings:function(t){var e=[];BX.onCustomEvent("BX.Main.InterfaceButtons:onBeforeResetMenu",[e,this]);var s=new BX.Promise;var i=s;for(var n=0;n<e.length;n++){s=s.then(e[n])}s.then(function(e){t(null,e)},function(e){t(e,null)});i.fulfill()},moveButtonAlias:function(t){var e,s;if(!t||!this.dragItem){return}e=this.getItemAlias(this.dragItem);s=this.getItemAlias(t);if(this.isListItem(e)){if(!s){this.listContainer.appendChild(e)}else{this.listContainer.insertBefore(e,s)}}},moveButton:function(t){var e;if(!BX.type.isDomNode(t)||!BX.type.isDomNode(this.dragItem)){return}if(this.isListItem(t)){if(this.isDisabled(this.dragItem)){this.dragItem.dataset.disabled="false"}if(BX.type.isDomNode(t)){this.listContainer.insertBefore(this.dragItem,t)}else{this.listContainer.appendChild(this.dragItem)}}if(this.isSubmenuItem(t)){if(this.isDisabled(this.dragItem)&&!this.isDisabled(t)){this.enableItem(this.dragItem)}e=this.getSubmenuContainer();e.insertBefore(this.dragItem,t)}},getSubmenuContainer:function(){var t=this.getSubmenu();var e=null;if(t!==null){e=t.itemsContainer}return e},findNextSiblingByClass:function(t,e){var s=t;for(;!!t;t=t.nextElementSibling){if(e){if(BX.hasClass(t,e)&&t!==s){return t}}else{return null}}},findParentByClassName:function(t,e){for(;t&&t!==document;t=t.parentNode){if(e){if(BX.hasClass(t,e)){return t}}else{return null}}},findChildrenByClassName:function(t,e){var s=null;if(BX.type.isDomNode(t)&&BX.type.isNotEmptyString(e)){s=BX.Buttons.Utils.getByClass(t,e)}return s},dragAndDropInit:function(){this.getAllItems().forEach(function(t,e){if(!this.isSeparator(t)&&!this.isSettings(t)&&!this.isApplySettingsButton(t)&&!this.isResetSettingsButton(t)){t.setAttribute("draggable","true");t.setAttribute("tabindex","-1");t.dataset.link="item"+e;BX.bind(t,"dragstart",BX.delegate(this._onDragStart,this));BX.bind(t,"dragend",BX.delegate(this._onDragEnd,this));BX.bind(t,"dragenter",BX.delegate(this._onDragEnter,this));BX.bind(t,"dragover",BX.delegate(this._onDragOver,this));BX.bind(t,"dragleave",BX.delegate(this._onDragLeave,this));BX.bind(t,"drop",BX.delegate(this._onDrop,this))}BX.bind(t,"mouseover",BX.delegate(this._onMouse,this));BX.bind(t,"mouseout",BX.delegate(this._onMouse,this))},this)},dragAndDropInitInSubmenu:function(){var t=this.getSubmenu();var e=t.menuItems;e.forEach(function(t){if(!this.isSeparator(t.layout.item)&&!this.isSettings(t.layout.item)&&!this.isApplySettingsButton(t.layout.item)&&!this.isResetSettingsButton(t.layout.item)){t.layout.item.draggable=true;t.layout.item.dataset.sortable=true;BX.bind(t.layout.item,"dragstart",BX.delegate(this._onDragStart,this));BX.bind(t.layout.item,"dragenter",BX.delegate(this._onDragEnter,this));BX.bind(t.layout.item,"dragover",BX.delegate(this._onDragOver,this));BX.bind(t.layout.item,"dragleave",BX.delegate(this._onDragLeave,this));BX.bind(t.layout.item,"dragend",BX.delegate(this._onDragEnd,this));BX.bind(t.layout.item,"drop",BX.delegate(this._onDrop,this))}if(BX.hasClass(t.layout.item,this.classHiddenLabel)&&!BX.hasClass(t.layout.item,this.classManage)){BX.bind(t.layout.item,"dragover",BX.delegate(this._onDragOver,this))}},this)},getItem:function(t){if(!BX.type.isDomNode(t)){if(!t||!BX.type.isDomNode(t.target)){return null}}else{t={target:t}}var e=this.findParentByClassName(t.target,this.classItem);if(!BX.type.isDomNode(e)){e=this.findParentByClassName(t.target,this.classDefaultSubmenuItem)}return e},setOpacity:function(t){if(!BX.type.isDomNode(t)){return}BX.style(t,"opacity",".1")},unsetOpacity:function(t){if(!BX.type.isDomNode(t)){return}BX.style(t,"opacity","1")},setDragStyles:function(){BX.addClass(this.listContainer,this.classOnDrag);BX.addClass(BX(this.getSubmenuId(true)),this.classOnDrag);this.setOpacity(this.dragItem)},unsetDragStyles:function(){var t=this.getSubmenu();this.getAllItems().forEach(function(t){this.unsetOpacity(t);BX.removeClass(t,"over")},this);if(t&&"menuItems"in t&&BX.type.isArray(t.menuItems)&&t.menuItems.length){t.menuItems.forEach(function(t){this.unsetOpacity(t);BX.removeClass(t.layout.item,"over")},this)}BX.removeClass(this.listContainer,this.classOnDrag);BX.removeClass(BX(this.getSubmenuId(true)),this.classOnDrag)},getIconClass:function(t){var e="";if(BX.type.isDomNode(t)&&"dataset"in t&&"class"in t.dataset&&BX.type.isNotEmptyString(t.dataset.class)){e=t.dataset.class}return e},disableItem:function(t){var e=this.getItemAlias(t);if(t&&"dataset"in t){t.dataset.disabled="true";if(e){e.dataset.disabled="true"}}},enableItem:function(t){var e;if(!BX.type.isDomNode(t)){return}if(this.isSubmenuItem(t)){BX.removeClass(t,this.classItemDisabled);e=this.getItemAlias(t);if(BX.type.isDomNode(e)){e.dataset.disabled="false"}}},getAliasLink:function(t){return this.dataValue(t,"link")||""},getItemAlias:function(t){var e=null;if(!BX.type.isDomNode(t)){return e}var s=this.getAllItems();var i=this.isSubmenuItem(t);var n=this.isListItem(t);if(!i&&!n){return e}if(i){s.forEach(function(s){BX.hasClass(t,this.getAliasLink(s))&&(e=s)},this)}if(n){e=BX.Buttons.Utils.getByClass(document,this.getAliasLink(t))}return e},hideItem:function(t){!!t&&BX.addClass(t,this.classSecret)},showItem:function(t){!!t&&BX.removeClass(t,this.classSecret)},fakeDragItem:function(){var t=null;if(!BX.type.isDomNode(this.dragItem)||!BX.type.isDomNode(this.overItem)){return}if(this.isDragToSubmenu()){t=this.getItemAlias(this.dragItem);if(t!==this.dragItem){this.listContainer.appendChild(this.dragItem);this.dragItem=t;this.showItem(this.dragItem);this.adjustMoreButtonPosition();this.updateSubmenuItems();this.tmp.moved=false;this.tmp.movetToSubmenu=true;this.setOpacity(this.dragItem)}}if(this.isDragToList()&&!this.tmp.movetToSubmenu){t=this.getItemAlias(this.dragItem);if(t!==this.dragItem){this.hideItem(this.dragItem);this.dragItem=t;this.adjustMoreButtonPosition();this.updateSubmenuItems();this.setOpacity(this.dragItem)}}this.tmp.movetToSubmenu=false},updateSubmenuItems:function(){var t=this.getHiddenItems();var e=this.getDisabledItems();var s=this;var i=[];var n,a,o;n=this.getSubmenu();if(n===null){return}a=n.menuItems;if(!BX.type.isArray(a)||!a.length){return}i=e.concat(t);a.forEach(function(t){o=[].some.call(i,function(e){return BX.hasClass(t.layout.item,s.dataValue(e,"link"))||s.isDisabled(t.layout.item)||s.isSeparator(t.layout.item)||s.isDropzone(t.layout.item)});if(o||(s.isSettings(t.layout.item)||s.isApplySettingsButton(t.layout.item)||s.isResetSettingsButton(t.layout.item)||s.isNotHiddenItem(t.layout.item)||s.isSeparator(t.layout.item)||t.layout.item===s.dragItem)&&!s.isMoreButton(t.layout.item)){s.showItem(t.layout.item)}else{s.hideItem(t.layout.item)}})},isNotHiddenItem:function(t){return BX.hasClass(t,this.classSubmenuNoHiddenItem)},getNotHidden:function(){return BX.Buttons.Utils.getByClass(this.getSubmenuContainer(),this.classSubmenuNoHiddenItem)},setOverStyles:function(t){if(BX.type.isDomNode(t)&&!BX.hasClass(t,this.classItemOver)){BX.addClass(t,this.classItemOver)}},unsetOverStyles:function(t){if(BX.type.isDomNode(t)&&BX.hasClass(t,this.classItemOver)){BX.removeClass(t,this.classItemOver)}},dataValue:function(t,e){var s="";var i;if(BX.type.isDomNode(t)){i=BX.data(t,e);if(typeof i!=="undefined"){s=i}}return s},execScript:function(script){if(BX.type.isNotEmptyString(script)){eval(script)}},showLicenseWindow:function(){var t;if(!B24.licenseInfoPopup){return}t=B24.licenseInfoPopup;t.init({B24_LICENSE_BUTTON_TEXT:this.message("MIB_LICENSE_BUY_BUTTON"),B24_TRIAL_BUTTON_TEXT:this.message("MIB_LICENSE_TRIAL_BUTTON"),IS_FULL_DEMO_EXISTS:this.licenseParams.isFullDemoExists,HOST_NAME:this.licenseParams.hostname,AJAX_URL:this.licenseParams.ajaxUrl,LICENSE_ALL_PATH:this.licenseParams.licenseAllPath,LICENSE_DEMO_PATH:this.licenseParams.licenseDemoPath,FEATURE_GROUP_NAME:this.licenseParams.featureGroupName,AJAX_ACTIONS_URL:this.licenseParams.ajaxActionsUrl,B24_FEATURE_TRIAL_SUCCESS_TEXT:this.message("MIB_LICENSE_WINDOW_TRIAL_SUCCESS_TEXT")});t.show("main-buttons",this.message("MIB_LICENSE_WINDOW_HEADER_TEXT"),this.message("MIB_LICENSE_WINDOW_TEXT"))},_onDragStart:function(t){var e=this.getVisibleItems();var s=BX.type.isArray(e)?e.length:null;this.dragItem=this.getItem(t);if(!BX.type.isDomNode(this.dragItem)){return}if(s===2&&this.isListItem(this.dragItem)){t.preventDefault();BX.onCustomEvent(window,"BX.Main.InterfaceButtons:onHideLastVisibleItem",[this.dragItem,this]);return}if(this.isMoreButton(this.dragItem)||this.isSeparator(this.dragItem)||this.isNotHiddenItem(this.dragItem)){t.preventDefault();return}this.isSubmenuShownOnDragStart=!!this.isSubmenuShown;if(this.isListItem(this.dragItem)){this.showSubmenu()}this.setDragStyles();if(!this.isEditEnabled()){this.enableEdit()}},_onDragEnd:function(t){t.preventDefault();var e=this.getItem(t);var s,i;if(!BX.type.isDomNode(e)){return}this.unsetDragStyles();if(!this.isSubmenuShownOnDragStart){this.refreshSubmenu();if(!this.isEditEnabled()){this.closeSubmenu()}}else{this.refreshSubmenu()}s=BX.findNextSibling(this.dragItem,BX.delegate(function(t){return this.isVisibleItem(t)},this));i=BX.findPreviousSibling(this.dragItem,BX.delegate(function(t){return this.isVisibleItem(t)},this));if(BX.type.isDomNode(i)&&(BX.hasClass(i,this.classHiddenLabel)||this.isDisabled(i)&&this.isSubmenuItem(i))||(BX.type.isDomNode(s)&&BX.hasClass(s,this.classManage)||this.isDisabled(s)&&this.isSubmenuItem(s))){this.disableItem(this.dragItem);this.refreshSubmenu()}if(this.isEditEnabled()){this.enableEdit();BX.show(this.getSettingsApplyButton());BX.hide(this.getSettingsButton())}else{this.disableEdit();BX.hide(this.getSettingsApplyButton());BX.show(this.getSettingsButton())}this.updateMoreButtonCounter();this.saveSettings();this.dragItem=null;this.overItem=null;this.tmp.moved=false},updateMoreButtonCounter:function(){var t,e,s,i;t=this.getHiddenItems();i=this.getDisabledItems();t=t.concat(i);e=0;if(BX.type.isArray(t)){t.forEach(function(t){e+=parseInt(this.dataValue(t,"counter"))||0},this)}if(BX.type.isNumber(e)){this.setMoreButtonCounter(e)}},_onDragEnter:function(t){var e=this.getItem(t);if(BX.type.isDomNode(e)&&this.isNotHiddenItem(e)){this.setOverStyles(e)}},_onDragOver:function(t){t.preventDefault();var e=null;this.overItem=this.getItem(t);if(!BX.type.isDomNode(this.overItem)||!BX.type.isDomNode(this.dragItem)||this.overItem===this.dragItem||this.isNotHiddenItem(this.overItem)){return}this.fakeDragItem();if(this.isNext(t)&&this.isGoodPosition(t)&&!this.isMoreButton(this.overItem)){e=this.findNextSiblingByClass(this.overItem,this.classItem);if(this.isMoreButton(e)&&!this.tmp.moved){e=e.previousElementSibling;this.tmp.moved=true}if(!BX.type.isDomNode(e)){e=this.findNextSiblingByClass(this.overItem,this.classSubmenuItem)}if(BX.type.isDomNode(e)){this.moveButton(e);this.moveButtonAlias(e);this.adjustMoreButtonPosition();this.updateSubmenuItems()}}if(!this.isNext(t)&&this.isGoodPosition(t)&&!this.isMoreButton(this.overItem)||!this.isGoodPosition(t)&&this.isMoreButton(this.overItem)&&this.getVisibleItems().length===1){this.moveButton(this.overItem);this.moveButtonAlias(this.overItem);this.adjustMoreButtonPosition();this.updateSubmenuItems()}},_onDragLeave:function(t){var e=this.getItem(t);if(BX.type.isDomNode(e)){this.unsetOverStyles(t.target)}},_onDrop:function(t){var e=this.getItem(t);if(!BX.type.isDomNode(e)){return}if(this.isNotHiddenItem(e)||this.isDisabled(e)){this.disableItem(this.dragItem);this.adjustMoreButtonPosition()}this.unsetDragStyles();t.preventDefault()},getIndex:function(t,e){return[].indexOf.call(t||[],e)},_onSubmenuClose:function(){this.setSubmenuShown(false);if(this.isEditEnabled()){this.activateItem(this.moreButton)}else{if(!this.isActiveInMoreMenu()){this.deactivateItem(this.moreButton)}}},_onResizeHandler:function(){this.adjustMoreButtonPosition();this.updateSubmenuItems();if(!this.isSettingsEnabled){this.visibleControlMoreButton()}},_onClickMoreButton:function(t){t.preventDefault();this.showSubmenu()},_onMouse:function(t){var e=this.getItem(t);if(t.type==="mouseover"&&!BX.hasClass(e,this.classItemOver)){BX.addClass(e,this.classItemOver)}if(t.type==="mouseout"&&BX.hasClass(e,this.classItemOver)){BX.removeClass(e,this.classItemOver)}},getSettingsResetButton:function(){return BX.Buttons.Utils.getByClass(this.getSubmenuContainer(),this.classSettingsResetButton)},_onScroll:function(){if(BX.style(this.pinContainer,"position")==="fixed"){this.closeSubmenu()}},isDisabled:function(t){var e=false;if(BX.type.isDomNode(t)){e=this.dataValue(t,"disabled")==="true"||BX.hasClass(t,this.classItemDisabled)}return e},isSettings:function(t){var e=false;if(BX.type.isDomNode(t)){e=BX.hasClass(t,this.classSettingMenuItem)}return e},isLocked:function(t){var e=false;if(BX.type.isDomNode(t)){e=this.dataValue(t,"locked")==="true"||BX.hasClass(t,this.classItemLocked)}return e},isDropzone:function(t){return BX.hasClass(t,this.classDropzone)},isNext:function(t){var e=this.dragItem.getBoundingClientRect();var s=this.overItem.getBoundingClientRect();var i=getComputedStyle(this.dragItem);var n=parseInt(i.marginRight.replace("px",""));var a=null;if(this.isListItem(this.overItem)){a=t.clientX>s.left-n&&t.clientX>e.right}if(this.isSubmenuItem(this.overItem)){a=t.clientY>e.top}return a},isGoodPosition:function(t){var e=this.overItem;var s,i;if(!BX.type.isDomNode(e)){return false}s=e.getBoundingClientRect();if(this.isListItem(e)){i=this.isNext(t)&&t.clientX>=s.left+s.width/2||!this.isNext(t)&&t.clientX<=s.left+s.width/2}if(this.isSubmenuItem(e)){i=this.isNext(t)&&t.clientY>=s.top+s.height/2||!this.isNext(t)&&t.clientY<=s.top+s.height/2}return i},isSubmenuItem:function(t){return BX.hasClass(t,this.classSubmenuItem)},isVisibleItem:function(t){if(!BX.type.isDomNode(t)){return false}return t.offsetTop===0},isMoreButton:function(t){var e=false;if(BX.type.isDomNode(t)&&BX.hasClass(t,this.classItemMore)){e=true}return e},isListItem:function(t){var e=false;if(BX.type.isDomNode(t)&&BX.hasClass(t,this.classItem)){e=true}return e},isSublink:function(t){var e=false;if(BX.type.isDomNode(t)){e=BX.hasClass(t,this.classItemSublink)}return e},isSeparator:function(t){var e=false;if(BX.type.isDomNode(t)){e=BX.hasClass(t,this.classSeporator)}return e},isDragToSubmenu:function(){return!this.isSubmenuItem(this.dragItem)&&this.isSubmenuItem(this.overItem)},isDragToList:function(){return this.isSubmenuItem(this.dragItem)&&!this.isSubmenuItem(this.overItem)}}}if(typeof BX.Main.interfaceButtonsManager==="undefined"){BX.Main.interfaceButtonsManager={data:{},init:function(t){var e=null;if(!BX.type.isPlainObject(t)||!("containerId"in t)){throw"BX.Main.interfaceButtonsManager: containerId not set in params Object"}e=BX(t.containerId);if(BX.type.isDomNode(e)){this.data[t.containerId]=new BX.Main.interfaceButtons(e,t)}else{BX(BX.delegate(function(){e=BX(t.containerId);if(!BX.type.isDomNode(e)){throw"BX.Main.interfaceButtonsManager: container is not dom node"}this.data[t.containerId]=new BX.Main.interfaceButtons(e,t)},this))}},getById:function(t){var e=null;if(BX.type.isString(t)&&BX.type.isNotEmptyString(t)){try{e=this.data[t]}catch(t){}}return e},getObjects:function(){return this.data}}}
/* End */
;
; /* Start:"a:4:{s:4:"full";s:94:"/bitrix/components/bitrix/main.interface.buttons/templates/.default/utils.min.js?1518596169575";s:6:"source";s:76:"/bitrix/components/bitrix/main.interface.buttons/templates/.default/utils.js";s:3:"min";s:80:"/bitrix/components/bitrix/main.interface.buttons/templates/.default/utils.min.js";s:3:"map";s:80:"/bitrix/components/bitrix/main.interface.buttons/templates/.default/utils.map.js";}"*/
(function(){"use strict";BX.namespace("BX.Buttons");BX.Buttons.Utils={getByClass:function(e,t,l){var n=[];if(t){n=(e||document.body).getElementsByClassName(t);if(!l){n=n.length?n[0]:null}else{n=[].slice.call(n)}}return n},getByTag:function(e,t,l){var n=[];if(t){n=(e||document.body).getElementsByTagName(t);if(!l){n=n.length?n[0]:null}else{n=[].slice.call(n)}}return n},getBySelector:function(e,t,l){var n=[];if(t){if(!l){n=(e||document.body).querySelector(t)}else{n=(e||document.body).querySelectorAll(t);n=[].slice.call(n)}}return n}}})();
/* End */
;
; /* Start:"a:4:{s:4:"full";s:85:"/bitrix/components/bitrix/crm.contact.menu/templates/.default/script.js?1518596183484";s:6:"source";s:71:"/bitrix/components/bitrix/crm.contact.menu/templates/.default/script.js";s:3:"min";s:0:"";s:3:"map";s:0:"";}"*/

function contact_delete(title, message, btnTitle, path)
{
	var d;
	d = new BX.CDialog({
		title: title,
		head: '',
		content: message,
		resizable: false,
		draggable: true,
		height: 70,
		width: 300
	});
	
	var _BTN = [	
		{
			title: btnTitle,
			id: 'crmOk',
			'action': function () 
			{
				window.location.href = path;
				BX.WindowManager.Get().Close();
			}
		},
		BX.CDialog.btnCancel
	];	
	d.ClearButtons();
	d.SetButtons(_BTN);
	d.Show();
}
/* End */
;
; /* Start:"a:4:{s:4:"full";s:94:"/bitrix/components/bitrix/crm.interface.toolbar/templates/slider/script.min.js?151859618212485";s:6:"source";s:74:"/bitrix/components/bitrix/crm.interface.toolbar/templates/slider/script.js";s:3:"min";s:0:"";s:3:"map";s:0:"";}"*/
if(typeof BX.InterfaceToolBar==="undefined"){BX.InterfaceToolBar=function(){this._id="";this._settings=null;this._container=null;this._menuButton=null;this._menuPopup=null;this._isMenuOpened=false};BX.InterfaceToolBar.prototype={initialize:function(t,e){this._id=t;this._settings=e?e:BX.CrmParamBag.create(null);var n=this._container=BX(this.getSetting("containerId",""));if(n){var o=this.getSetting("menuButtonClassName");if(!BX.type.isNotEmptyString(o)){o=this.getSetting("moreButtonClassName","crm-setting-btn")}if(BX.type.isNotEmptyString(o)){this._menuButton=BX.findChild(n,{className:o},true,false);if(this._menuButton){BX.bind(this._menuButton,"click",BX.delegate(this.onMenuButtonClick,this))}}}},getId:function(){return this._id},getSetting:function(t,e){return this._settings.getParam(t,e)},prepareMenuItem:function(t){var e=/return\s+false(\s*;)?\s*$/;var n=/;\s*$/;var o=typeof t["SEPARATOR"]!=="undefined"?t["SEPARATOR"]:false;if(o){return{delimiter:true}}var i=typeof t["LINK"]!=="undefined"?t["LINK"]:"";var r=typeof t["ONCLICK"]!=="undefined"?t["ONCLICK"]:"";if(i!==""){var s='window.top.location.href = "'+i+'";';r=r!==""?s+" "+r:s}if(r!==""){if(!e.test(r)){if(!n.test(r)){r+=";"}r+=" return false;"}}var a={text:typeof t["TEXT"]!=="undefined"?t["TEXT"]:""};if(r!==""){a["onclick"]=r}if(BX.type.isArray(t["MENU"])){var u=[];for(var p=0,l=t["MENU"].length;p<l;p++){u.push(this.prepareMenuItem(t["MENU"][p]))}a["items"]=u}return a},openMenu:function(t){if(this._isMenuOpened){this.closeMenu();return}var e=this.getSetting("items",null);if(!BX.type.isArray(e)){return}var n=[];for(var o=0;o<e.length;o++){n.push(this.prepareMenuItem(e[o]))}BX.onCustomEvent(window,"Crm.InterfaceToolbar.MenuBuild",[this,{items:n}]);this._menuId=this._id.toLowerCase()+"_menu";BX.PopupMenu.show(this._menuId,this._menuButton,n,{offsetTop:0,offsetLeft:0,events:{onPopupShow:BX.delegate(this.onPopupShow,this),onPopupClose:BX.delegate(this.onPopupClose,this),onPopupDestroy:BX.delegate(this.onPopupDestroy,this)}});this._menuPopup=BX.PopupMenu.currentItem},closeMenu:function(){if(this._menuPopup){if(this._menuPopup.popupWindow){this._menuPopup.popupWindow.destroy()}}},onMenuButtonClick:function(t){this.openMenu()},onPopupShow:function(){this._isMenuOpened=true},onPopupClose:function(){this.closeMenu()},onPopupDestroy:function(){this._isMenuOpened=false;this._menuPopup=null;if(typeof BX.PopupMenu.Data[this._menuId]!=="undefined"){delete BX.PopupMenu.Data[this._menuId]}},onEditorConfigReset:function(){var t=BX.Crm.EntityEditor.getDefault();if(t){t.resetConfig()}}};BX.InterfaceToolBar.create=function(t,e){var n=new BX.InterfaceToolBar;n.initialize(t,e);return n}}if(typeof BX.InterfaceToolBarCommunicationButton==="undefined"){BX.InterfaceToolBarCommunicationButton=function(){this._id="";this._settings=[];this._button=null;this._ownerInfo=null;this._isMenuOpened=false;this._menuPopup=null;this._menuId="";this._data=null;this._isEnabled=false};BX.InterfaceToolBarCommunicationButton.prototype={initialize:function(t,e){this._id=t;this._settings=e?e:{};this._button=BX.prop.getElementNode(this._settings,"button");BX.bind(this._button,"click",BX.delegate(this.onButtonClick,this));this._ownerInfo=BX.prop.getObject(this._settings,"ownerInfo");this._data=BX.prop.getObject(this._settings,"data");this._isEnabled=this.hasData();BX.addCustomEvent(window,"onCrmEntityUpdate",BX.delegate(this.onCrmEntityUpdate,this))},getOwnerInfo:function(){return{ownerID:this._ownerInfo["ENTITY_ID"],ownerType:this._ownerInfo["ENTITY_TYPE_NAME"],ownerUrl:this._ownerInfo["SHOW_URL"],ownerTitle:this._ownerInfo["TITLE"]}},getOwnerTypeName:function(){return BX.prop.getString(this._ownerInfo,"ENTITY_TYPE_NAME","")},getOwnerId:function(){return BX.prop.getInteger(this._ownerInfo,"ENTITY_ID",0)},getMultifieldTypeName:function(){return""},hasData:function(){return BX.type.isPlainObject(this._data)&&Object.keys(this._data).length>0},isEnabled:function(){return this._isEnabled},enable:function(t){t=!!t;if(this._isEnabled===t){return}this._isEnabled=t;this.doEnable(this._isEnabled)},doEnable:function(t){},onButtonClick:function(t){},prepareMenuItem:function(t){},openMenu:function(){if(this._isMenuOpened){this.closeMenu();return}var t=[];for(var e in this._data){if(!this._data.hasOwnProperty(e)){continue}var n=this._data[e];for(var o=0;o<n.length;o++){t.push(this.prepareMenuItem(e,n[o]))}}this._menuId=this._id.toLowerCase()+"_menu";BX.PopupMenu.show(this._menuId,this._button,t,{offsetTop:0,offsetLeft:0,events:{onPopupShow:BX.delegate(this.onPopupShow,this),onPopupClose:BX.delegate(this.onPopupClose,this),onPopupDestroy:BX.delegate(this.onPopupDestroy,this)}});this._menuPopup=BX.PopupMenu.currentItem},closeMenu:function(){if(this._menuPopup){if(this._menuPopup.popupWindow){this._menuPopup.popupWindow.destroy()}}},onPopupShow:function(){this._isMenuOpened=true},onPopupClose:function(){this.closeMenu()},onPopupDestroy:function(){this._isMenuOpened=false;this._menuPopup=null;if(typeof BX.PopupMenu.Data[this._menuId]!=="undefined"){delete BX.PopupMenu.Data[this._menuId]}},onCrmEntityUpdate:function(t){var e=BX.prop.getObject(t,"entityInfo",{});if(this.getOwnerTypeName()!==BX.prop.getString(e,"typeName","")||this.getOwnerId()!==BX.prop.getInteger(e,"id",0)){return}var n=BX.prop.getObject(t,"entityData",{});this._data=BX.prop.getObject(BX.prop.getObject(n,"MULTIFIELD_DATA",{}),this.getMultifieldTypeName(),{});this.enable(this.hasData());this.processDataChange()},processDataChange:function(){}}}if(typeof BX.InterfaceToolBarPhoneButton==="undefined"){BX.InterfaceToolBarPhoneButton=function(){BX.InterfaceToolBarPhoneButton.superclass.constructor.apply(this);this._menuItems=null};BX.extend(BX.InterfaceToolBarPhoneButton,BX.InterfaceToolBarCommunicationButton);BX.InterfaceToolBarPhoneButton.prototype.getMessage=function(t){var e=BX.InterfaceToolBarPhoneButton.messages;return e.hasOwnProperty(t)?e[t]:t};BX.InterfaceToolBarPhoneButton.prototype.onButtonClick=function(t){if(!this.isEnabled()){return}var e=Object.keys(this._data);if(e.length===1){var n=e[0];var o=this._data[n];if(o.length===1){var i=n.split("_");if(i.length>=2){this.addCall(n,o[0]);return}}}this._menuItems=[];this.openMenu()};BX.InterfaceToolBarPhoneButton.prototype.prepareMenuItem=function(t,e){var n;var o;if(BX.type.isPlainObject(e)){n=BX.prop.getString(e,"COMPLEX_NAME","")+": "+BX.prop.getString(e,"VALUE_FORMATTED","");o=BX.prop.getString(e,"VALUE","")}else{n=e;o=e}var i=BX.InterfaceToolBarPhoneMenuItem.create({owner:this,entityKey:t,value:o,text:n});this._menuItems.push(i);return i.createMenuItem()};BX.InterfaceToolBarPhoneButton.prototype.addCall=function(t,e){if(typeof window.top["BXIM"]==="undefined"){window.alert(this.getMessage("telephonyNotSupported"));return}var n=t.split("_");if(n.length<2){return}var o=BX.type.stringToInt(n[0]);var i=BX.type.stringToInt(n[1]);var r=BX.prop.getInteger(this._ownerInfo,"ENTITY_TYPE_ID",0);var s=BX.prop.getInteger(this._ownerInfo,"ENTITY_ID",0);var a=BX.type.isPlainObject(e)?e["VALUE"]:e;var u={ENTITY_TYPE_NAME:BX.CrmEntityType.resolveName(o),ENTITY_ID:i,AUTO_FOLD:true};if(r!==o||s!==i){u["BINDINGS"]=[{OWNER_TYPE_NAME:BX.CrmEntityType.resolveName(r),OWNER_ID:s}]}window.top["BXIM"].phoneTo(a,u)};BX.InterfaceToolBarPhoneButton.prototype.getMultifieldTypeName=function(){return"PHONE"};BX.InterfaceToolBarPhoneButton.prototype.doEnable=function(t){if(t){BX.removeClass(this._button,"crm-contact-menu-call-icon-not-available");BX.addClass(this._button,"crm-contact-menu-call-icon")}else{BX.removeClass(this._button,"crm-contact-menu-call-icon");BX.addClass(this._button,"crm-contact-menu-call-icon-not-available")}};if(typeof BX.InterfaceToolBarPhoneButton.messages==="undefined"){BX.InterfaceToolBarPhoneButton.messages={}}BX.InterfaceToolBarPhoneButton.create=function(t,e){var n=new BX.InterfaceToolBarPhoneButton;n.initialize(t,e);return n}}if(typeof BX.InterfaceToolBarPhoneMenuItem==="undefined"){BX.InterfaceToolBarPhoneMenuItem=function(){this._settings={};this._entityKey="";this._value="";this._text=""};BX.InterfaceToolBarPhoneMenuItem.prototype={initialize:function(t){this._settings=t?t:{};this._owner=BX.prop.get(this._settings,"owner");this._entityKey=BX.prop.getString(this._settings,"entityKey","");this._value=BX.prop.getString(this._settings,"value","");this._text=BX.prop.getString(this._settings,"text","")},onSelect:function(){this._owner.addCall(this._entityKey,this._value)},createMenuItem:function(){return{text:this._text,onclick:BX.delegate(this.onSelect,this)}}};BX.InterfaceToolBarPhoneMenuItem.create=function(t){var e=new BX.InterfaceToolBarPhoneMenuItem;e.initialize(t);return e}}if(typeof BX.InterfaceToolBarMessengerButton==="undefined"){BX.InterfaceToolBarMessengerButton=function(){BX.InterfaceToolBarMessengerButton.superclass.constructor.apply(this);this._menuItems=null};BX.extend(BX.InterfaceToolBarMessengerButton,BX.InterfaceToolBarCommunicationButton);BX.InterfaceToolBarMessengerButton.prototype.getMessage=function(t){var e=BX.InterfaceToolBarMessengerButton.messages;return e.hasOwnProperty(t)?e[t]:t};BX.InterfaceToolBarMessengerButton.prototype.onButtonClick=function(t){var e=Object.keys(this._data);if(e.length===1){var n=e[0];var o=this._data[n];if(o.length===1){var i=n.split("_");if(i.length>=2){this.openChat(n,o[0]);return}}}this._menuItems=[];this.openMenu()};BX.InterfaceToolBarMessengerButton.prototype.prepareMenuItem=function(t,e){var n;var o;if(BX.type.isPlainObject(e)){o=BX.prop.getString(e,"VALUE","");var i=BX.prop.getString(e,"VALUE_TYPE","");if(i==="OPENLINE"){n=BX.prop.getString(e,"COMPLEX_NAME","")}else{n=BX.prop.getString(e,"COMPLEX_NAME","")+": "+BX.prop.getString(e,"VALUE_FORMATTED","")}}else{n=e;o=e}var r=BX.InterfaceToolBarMessengerMenuItem.create({owner:this,entityKey:t,value:o,text:n});this._menuItems.push(r);return r.createMenuItem()};BX.InterfaceToolBarMessengerButton.prototype.openChat=function(t,e){if(typeof window.top["BXIM"]==="undefined"){window.alert(this.getMessage("messagingNotSupported"));return}var n=BX.type.isPlainObject(e)?e["VALUE"]:e;window.top["BXIM"].openMessenger(n)};BX.InterfaceToolBarMessengerButton.prototype.getMultifieldTypeName=function(){return"IM"};BX.InterfaceToolBarMessengerButton.prototype.doEnable=function(t){if(t){BX.removeClass(this._button,"crm-contact-menu-im-icon-not-available");BX.addClass(this._button,"crm-contact-menu-im-icon")}else{BX.removeClass(this._button,"crm-contact-menu-im-icon");BX.addClass(this._button,"crm-contact-menu-im-icon-not-available")}};if(typeof BX.InterfaceToolBarMessengerButton.messages==="undefined"){BX.InterfaceToolBarMessengerButton.messages={}}BX.InterfaceToolBarMessengerButton.create=function(t,e){var n=new BX.InterfaceToolBarMessengerButton;n.initialize(t,e);return n}}if(typeof BX.InterfaceToolBarMessengerMenuItem==="undefined"){BX.InterfaceToolBarMessengerMenuItem=function(){this._settings={};this._entityKey="";this._value="";this._text=""};BX.InterfaceToolBarMessengerMenuItem.prototype={initialize:function(t){this._settings=t?t:{};this._owner=BX.prop.get(this._settings,"owner");this._entityKey=BX.prop.getString(this._settings,"entityKey","");this._value=BX.prop.getString(this._settings,"value","");this._text=BX.prop.getString(this._settings,"text","")},onSelect:function(){this._owner.openChat(this._entityKey,this._value)},createMenuItem:function(){return{text:this._text,onclick:BX.delegate(this.onSelect,this)}}};BX.InterfaceToolBarMessengerMenuItem.create=function(t){var e=new BX.InterfaceToolBarMessengerMenuItem;e.initialize(t);return e}}if(typeof BX.InterfaceToolBarEmailButton==="undefined"){BX.InterfaceToolBarEmailButton=function(){BX.InterfaceToolBarEmailButton.superclass.constructor.apply(this)};BX.extend(BX.InterfaceToolBarEmailButton,BX.InterfaceToolBarCommunicationButton);BX.InterfaceToolBarEmailButton.prototype.onButtonClick=function(t){if(this.isEnabled()){BX.CrmActivityEditor.addEmail(this.getOwnerInfo())}};BX.InterfaceToolBarEmailButton.prototype.getMultifieldTypeName=function(){return"EMAIL"};BX.InterfaceToolBarEmailButton.prototype.doEnable=function(t){if(t){BX.removeClass(this._button,"crm-contact-menu-mail-icon-not-available");BX.addClass(this._button,"crm-contact-menu-mail-icon")}else{BX.removeClass(this._button,"crm-contact-menu-mail-icon");BX.addClass(this._button,"crm-contact-menu-mail-icon-not-available")}};BX.InterfaceToolBarEmailButton.create=function(t,e){var n=new BX.InterfaceToolBarEmailButton;n.initialize(t,e);return n}}
/* End */
;
; /* Start:"a:4:{s:4:"full";s:93:"/bitrix/components/bitrix/crm.entity.details/templates/.default/script.min.js?151859618418291";s:6:"source";s:73:"/bitrix/components/bitrix/crm.entity.details/templates/.default/script.js";s:3:"min";s:0:"";s:3:"map";s:0:"";}"*/
BX.namespace("BX.Crm");if(typeof BX.Crm.EntityEvent==="undefined"){BX.Crm.EntityEvent={names:{create:"onCrmEntityCreate",update:"onCrmEntityUpdate",delete:"onCrmEntityDelete"},fireCreate:function(t,e,i,n){this.fire(BX.Crm.EntityEvent.names.create,t,e,i,n)},fireUpdate:function(t,e,i,n){this.fire(BX.Crm.EntityEvent.names.update,t,e,i,n)},fireDelete:function(t,e,i,n){this.fire(BX.Crm.EntityEvent.names.delete,t,e,i,n)},fire:function(t,e,i,n,a){var r={entityTypeId:e,entityTypeName:BX.CrmEntityType.resolveName(e),entityId:i,context:n};if(BX.type.isPlainObject(a)){r=BX.mergeEx(r,a)}BX.localStorage.set(t,r,10)}}}if(typeof BX.Crm.EntityDetailManager==="undefined"){BX.Crm.EntityDetailManager=function(){this._id="";this._settings={};this._container=null;this._entityTypeId=0;this._entityId=0;this._serviceUrl="";this._tabManager=null;this._overlay=null;this._pageUrlCopyButton=null;this._externalEventHandler=null;this._externalRequestData=null};BX.Crm.EntityDetailManager.prototype={initialize:function(t,e){this._id=BX.type.isNotEmptyString(t)?t:BX.util.getRandomString(4);this._settings=e?e:{};this._entityTypeId=BX.prop.getInteger(this._settings,"entityTypeId",0);this._entityId=BX.prop.getInteger(this._settings,"entityId",0);this._serviceUrl=BX.prop.getString(this._settings,"serviceUrl","");this._container=BX(BX.prop.get(this._settings,"containerId"));this._tabManager=BX.Crm.EntityDetailTabManager.create(this._id,{container:BX(BX.prop.get(this._settings,"tabContainerId")),menuContainer:BX(BX.prop.get(this._settings,"tabMenuContainerId")),data:BX.prop.getArray(this._settings,"tabs")});if(this._entityId<=0){this._overlay=BX.create("div",{attrs:{className:"crm-entity-overlay"}});this._container.appendChild(this._overlay);if(typeof top.BX.Bitrix24.Slider!=="undefined"){var i=top.BX.Bitrix24.Slider.getCurrentPage();if(i){BX.addCustomEvent(i.getWindow(),"BX.Bitrix24.PageSlider:onClose",BX.delegate(this.onSliderClose,this))}}}this._pageUrlCopyButton=BX("page_url_copy_btn");if(this._pageUrlCopyButton){this._pageUrlCopyButton.title=this.getMessage("copyPageUrl");BX.bind(this._pageUrlCopyButton,"click",BX.delegate(this.onCopyCurrentPageUrl,this))}BX.addCustomEvent(window,"OpenEntityDetailTab",BX.delegate(this.onTabOpenRequest,this));this._externalRequestData={};this._externalEventHandler=BX.delegate(this.onExternalEvent,this);BX.addCustomEvent(window,"onLocalStorageSet",this._externalEventHandler);this.doInitialize()},doInitialize:function(){},getId:function(){return this._id},getMessage:function(t){return BX.prop.getString(BX.Crm.EntityDetailManager.messages,t,t)},getEntityTypeId:function(){return this._entityTypeId},getEntityTypeName:function(){return BX.CrmEntityType.resolveName(this._entityTypeId)},getEntityId:function(){return this._entityId},getCurrentPageUrl:function(){return BX.util.remove_url_param(window.location.href,["IFRAME","IFRAME_TYPE"])},getEntityCreateUrl:function(t){return BX.prop.getString(BX.Crm.EntityDetailManager.entityCreateUrls,t,"")},prepareCreationUrlParams:function(t){},onCopyCurrentPageUrl:function(t){var e=this.getCurrentPageUrl();if(!BX.clipboard.copy(e)){return}var i=new BX.PopupWindow("crm_page_url_clipboard_copy",this._pageUrlCopyButton,{content:this.getMessage("pageUrlCopied"),darkMode:true,autoHide:true,zIndex:1e3,angle:true,offsetLeft:20,bindOptions:{position:"top"}});i.show();setTimeout(function(){i.close()},1500)},onTabOpenRequest:function(t){var e=this._tabManager.findItemById(t);if(e){this._tabManager.selectItem(e)}},onSliderClose:function(t){setTimeout(function(){top.BX.Bitrix24.Slider.destroy(t.getUrl())},1e3)},processRemoval:function(){this._detetionConfirmDlgId="entity_details_deletion_confirm";var t=BX.Crm.ConfirmationDialog.get(this._detetionConfirmDlgId);if(!t){t=BX.Crm.ConfirmationDialog.create(this._detetionConfirmDlgId,{title:this.getMessage("deletionDialogTitle"),content:this.getMessage("deletionConfirmDialogContent")})}t.open().then(BX.delegate(this.onRemovalConfirm,this))},remove:function(){if(this._serviceUrl===""){throw"Crm.EntityDetailManager: The 'serviceUrl' parameter is not defined or empty."}BX.ajax({url:this._serviceUrl,method:"POST",dataType:"json",data:{ACTION:"DELETE",ACTION_ENTITY_TYPE_ID:this._entityTypeId,ACTION_ENTITY_ID:this._entityId},onsuccess:BX.delegate(this.onRemovalRequestSuccess,this)})},createEntity:function(t){var e=this.getEntityCreateUrl(t);if(e===""){return}var i=("details_"+this.getEntityTypeName()+"_"+this.getEntityId()+"_"+BX.util.getRandomString(12)).toLowerCase();var n={external_context:i};this.prepareCreationUrlParams(n);e=BX.util.add_url_param(e,n);this._externalRequestData[i]={context:i,wnd:BX.Crm.Page.open(e,{openInNewWindow:true})}},createQuote:function(){this.createEntity(BX.CrmEntityType.names.quote)},createInvoice:function(){this.createEntity(BX.CrmEntityType.names.invoice)},createDeal:function(){this.createEntity(BX.CrmEntityType.names.deal)},onRemovalConfirm:function(t){if(BX.prop.getBoolean(t,"cancel",true)){return}this.remove()},onRemovalRequestSuccess:function(t){var e=BX.prop.getString(t,"ERROR","");if(e!==""){var i=BX.Crm.NotificationDialog.create("entity_details_deletion_error",{title:this.getMessage("deletionDialogTitle"),content:e});i.open();return}BX.Crm.EntityEvent.fireDelete(this._entityTypeId,this._entityId);var n=window.top.BX.Bitrix24.Slider.getCurrentPage();if(n){n.close(true)}},onExternalEvent:function(t){var e=BX.prop.getString(t,"key","");var i=BX.prop.getObject(t,"value",{});this.processExternalEvent(e,i);if(e!=="onCrmEntityCreate"){return}var n=BX.prop.getString(i,"context","");var a=BX.prop.getObject(this._externalRequestData,n,null);if(!a){return}delete this._externalRequestData[n];var r=BX.prop.get(a,"wnd",null);if(r){r.close()}},processExternalEvent:function(t,e){return false}};BX.Crm.EntityDetailManager.items={};BX.Crm.EntityDetailManager.get=function(t){return this._items.hasOwnProperty(t)?this._items[t]:null};if(typeof BX.Crm.EntityDetailManager.entityCreateUrls==="undefined"){BX.Crm.EntityDetailManager.entityCreateUrls={}}if(typeof BX.Crm.EntityDetailManager.messages==="undefined"){BX.Crm.EntityDetailManager.messages={}}BX.Crm.EntityDetailManager.create=function(t,e){var i=new BX.Crm.EntityDetailManager;i.initialize(t,e);this.items[i.getId()]=i;return i}}if(typeof BX.Crm.LeadDetailManager==="undefined"){BX.Crm.LeadDetailManager=function(){BX.Crm.LeadDetailManager.superclass.constructor.apply(this)};BX.extend(BX.Crm.LeadDetailManager,BX.Crm.EntityDetailManager);BX.Crm.LeadDetailManager.prototype.doInitialize=function(){BX.addCustomEvent(window,"Crm.EntityConverter.Converted",BX.delegate(this.onConversionComplete,this));BX.addCustomEvent(window,"CrmCreateQuoteFromLead",BX.delegate(this.onCreateQuote,this))};BX.Crm.LeadDetailManager.prototype.processConversionCompletion=function(){window.setTimeout(function(){window.location.reload(true)},0)};BX.Crm.LeadDetailManager.prototype.processExternalEvent=function(t,e){if(t!=="onCrmEntityConvert"){return false}if(BX.prop.getInteger(e,"entityTypeId",0)!==BX.CrmEntityType.enumeration.lead||BX.prop.getInteger(e,"entityId",0)!==this.getEntityId()){return false}this.processConversionCompletion();return true};BX.Crm.LeadDetailManager.prototype.onConversionComplete=function(t,e){if(BX.prop.getInteger(e,"entityTypeId",0)!==BX.CrmEntityType.enumeration.lead||BX.prop.getInteger(e,"entityId",0)!==this.getEntityId()){return}this.processConversionCompletion()};BX.Crm.LeadDetailManager.prototype.onCreateQuote=function(){this.createQuote()};BX.Crm.LeadDetailManager.prototype.prepareCreationUrlParams=function(t){t["lead_id"]=this.getEntityId()};BX.Crm.LeadDetailManager.create=function(t,e){var i=new BX.Crm.LeadDetailManager;i.initialize(t,e);BX.Crm.EntityDetailManager.items[i.getId()]=i;return i}}if(typeof BX.Crm.ContactDetailManager==="undefined"){BX.Crm.ContactDetailManager=function(){BX.Crm.ContactDetailManager.superclass.constructor.apply(this)};BX.extend(BX.Crm.ContactDetailManager,BX.Crm.EntityDetailManager);BX.Crm.ContactDetailManager.prototype.doInitialize=function(){BX.addCustomEvent(window,"CrmCreateQuoteFromContact",BX.delegate(this.onCreateQuote,this));BX.addCustomEvent(window,"CrmCreateInvoiceFromContact",BX.delegate(this.onCreateInvoice,this));BX.addCustomEvent(window,"CrmCreateDealFromContact",BX.delegate(this.onCreateDeal,this))};BX.Crm.ContactDetailManager.prototype.onCreateQuote=function(){this.createQuote()};BX.Crm.ContactDetailManager.prototype.onCreateInvoice=function(){this.createInvoice()};BX.Crm.ContactDetailManager.prototype.onCreateDeal=function(){this.createDeal()};BX.Crm.ContactDetailManager.prototype.prepareCreationUrlParams=function(t){t["contact_id"]=this.getEntityId()};BX.Crm.ContactDetailManager.create=function(t,e){var i=new BX.Crm.ContactDetailManager;i.initialize(t,e);BX.Crm.EntityDetailManager.items[i.getId()]=i;return i}}if(typeof BX.Crm.CompanyDetailManager==="undefined"){BX.Crm.CompanyDetailManager=function(){BX.Crm.CompanyDetailManager.superclass.constructor.apply(this)};BX.extend(BX.Crm.CompanyDetailManager,BX.Crm.EntityDetailManager);BX.Crm.CompanyDetailManager.prototype.doInitialize=function(){BX.addCustomEvent(window,"CrmCreateQuoteFromCompany",BX.delegate(this.onCreateQuote,this));BX.addCustomEvent(window,"CrmCreateInvoiceFromCompany",BX.delegate(this.onCreateInvoice,this));BX.addCustomEvent(window,"CrmCreateDealFromCompany",BX.delegate(this.onCreateDeal,this))};BX.Crm.CompanyDetailManager.prototype.onCreateQuote=function(){this.createQuote()};BX.Crm.CompanyDetailManager.prototype.onCreateInvoice=function(){this.createInvoice()};BX.Crm.CompanyDetailManager.prototype.onCreateDeal=function(){this.createDeal()};BX.Crm.CompanyDetailManager.prototype.prepareCreationUrlParams=function(t){t["company_id"]=this.getEntityId()};BX.Crm.CompanyDetailManager.create=function(t,e){var i=new BX.Crm.CompanyDetailManager;i.initialize(t,e);BX.Crm.EntityDetailManager.items[i.getId()]=i;return i}}if(typeof BX.Crm.DealRecurringDetailManager==="undefined"){BX.Crm.DealRecurringDetailManager=function(){BX.Crm.DealRecurringDetailManager.superclass.constructor.apply(this)};BX.extend(BX.Crm.DealRecurringDetailManager,BX.Crm.EntityDetailManager);BX.Crm.DealRecurringDetailManager.prototype.doInitialize=function(){BX.addCustomEvent(window,"CrmDealRecurringExpose",BX.delegate(this.onExposeDeal,this))};BX.Crm.DealRecurringDetailManager.prototype.onExposeDeal=function(t,e){if(BX.prop.getInteger(e,"entityTypeId",0)!==BX.CrmEntityType.enumeration.dealrecurring||BX.prop.getInteger(e,"entityId",0)!==this.getEntityId()){return}window.setTimeout(function(){window.location.reload(true)},0)};BX.Crm.DealRecurringDetailManager.create=function(t,e){var i=new BX.Crm.DealRecurringDetailManager;i.initialize(t,e);BX.Crm.EntityDetailManager.items[i.getId()]=i;return i}}if(typeof BX.Crm.DealDetailManager==="undefined"){BX.Crm.DealDetailManager=function(){BX.Crm.DealDetailManager.superclass.constructor.apply(this)};BX.extend(BX.Crm.DealDetailManager,BX.Crm.EntityDetailManager);BX.Crm.DealDetailManager.prototype.doInitialize=function(){};BX.Crm.DealDetailManager.prototype.prepareCreationUrlParams=function(t){t["deal_id"]=this.getEntityId()};BX.Crm.DealDetailManager.create=function(t,e){var i=new BX.Crm.DealDetailManager;i.initialize(t,e);BX.Crm.EntityDetailManager.items[i.getId()]=i;return i}}if(typeof BX.Crm.EntityDetailFactory==="undefined"){BX.Crm.EntityDetailFactory={create:function(t,e){var i=BX.prop.getInteger(e,"entityTypeId",BX.CrmEntityType.enumeration.undefined);if(i===BX.CrmEntityType.enumeration.lead){return BX.Crm.LeadDetailManager.create(t,e)}else if(i===BX.CrmEntityType.enumeration.dealrecurring){return BX.Crm.DealRecurringDetailManager.create(t,e)}else if(i===BX.CrmEntityType.enumeration.deal){return BX.Crm.DealDetailManager.create(t,e)}else if(i===BX.CrmEntityType.enumeration.contact){return BX.Crm.ContactDetailManager.create(t,e)}else if(i===BX.CrmEntityType.enumeration.company){return BX.Crm.CompanyDetailManager.create(t,e)}return BX.Crm.EntityDetailManager.create(t,e)}}}if(typeof BX.Crm.EntityDetailTabManager==="undefined"){BX.Crm.EntityDetailTabManager=function(){this._id="";this._settings={};this._container=null;this._menuContainer=null;this._items=null};BX.Crm.EntityDetailTabManager.prototype={initialize:function(t,e){this._id=BX.type.isNotEmptyString(t)?t:BX.util.getRandomString(4);this._settings=e?e:{};this._container=BX.prop.getElementNode(this._settings,"container");this._menuContainer=BX.prop.getElementNode(this._settings,"menuContainer");this._items=[];var i=BX.prop.getArray(this._settings,"data");for(var n=0,a=i.length;n<a;n++){var r=i[n];var o=r["id"];var s=BX.Crm.EntityDetailTab.create(o,{manager:this,data:r,container:this._container.querySelector('[data-tab-id="'+o+'"]'),menuContainer:this._menuContainer.querySelector('[data-tab-id="'+o+'"]')});this._items.push(s)}},getId:function(){return this._id},findItemById:function(t){for(var e=0,i=this._items.length;e<i;e++){var n=this._items[e];if(n.getId()===t){return n}}return null},selectItem:function(t){for(var e=0,i=this._items.length;e<i;e++){var n=this._items[e];n.setActive(n===t)}},processItemSelect:function(t){this.selectItem(t)}};BX.Crm.EntityDetailTabManager.items={};BX.Crm.EntityDetailTabManager.create=function(t,e){var i=new BX.Crm.EntityDetailTabManager;i.initialize(t,e);this.items[i.getId()]=i;return i}}if(typeof BX.Crm.EntityDetailTab==="undefined"){BX.Crm.EntityDetailTab=function(){this._id="";this._settings={};this._data={};this._manager=null;this._container=null;this._menuContainer=null;this._onMenuClickHandler=BX.delegate(this.onMenuClick,this);this._isActive=false;this._isEnabled=false;this._loader=null};BX.Crm.EntityDetailTab.prototype={initialize:function(t,e){this._id=BX.type.isNotEmptyString(t)?t:BX.util.getRandomString(4);this._settings=e?e:{};this._data=BX.prop.getObject(this._settings,"data",{});this._manager=BX.prop.get(this._settings,"manager",null);this._container=BX.prop.getElementNode(this._settings,"container");this._menuContainer=BX.prop.getElementNode(this._settings,"menuContainer");this._isActive=BX.prop.getBoolean(this._data,"active",false);this._isEnabled=BX.prop.getBoolean(this._data,"enabled",true);var i=this._menuContainer.querySelector("a.crm-entity-section-tab-link");if(i){BX.bind(i,"click",this._onMenuClickHandler)}var n=BX.prop.getObject(this._data,"loader",null);if(n){n["tabId"]=this._id;n["container"]=this._container;this._loader=BX.Crm.EditorTabLazyLoader.create(this._id,n)}},getId:function(){return this._id},isEnabled:function(){return this._isEnabled},isActive:function(){return this._isActive},setActive:function(t){t=!!t;if(this._isActive===t){return}this._isActive=t;if(this._isActive){this.showTab()}else{this.hideTab()}},showTab:function(){BX.addClass(this._container,"crm-entity-section-tab-content-show");BX.removeClass(this._container,"crm-entity-section-tab-content-hide");BX.addClass(this._menuContainer,"crm-entity-section-tab-current");this._container.style.display="";this._container.style.position="absolute";this._container.style.top=0;this._container.style.left=0;this._container.style.width="100%";var t=new BX.easing({duration:350,start:{opacity:0,translateX:100},finish:{opacity:100,translateX:0},transition:BX.easing.makeEaseOut(BX.easing.transitions.quart),step:BX.delegate(function(t){this._container.style.opacity=t.opacity/100;this._container.style.transform="translateX("+t.translateX+"%)"},this),complete:BX.delegate(function(){BX.removeClass(this._container,"crm-entity-section-tab-content-show");this._container.style.cssText="";BX.onCustomEvent(window,"onEntityDetailsTabShow",[this])},this)});t.animate()},hideTab:function(){BX.addClass(this._container,"crm-entity-section-tab-content-hide");BX.removeClass(this._container,"crm-entity-section-tab-content-show");BX.removeClass(this._menuContainer,"crm-entity-section-tab-current");var t=new BX.easing({duration:350,start:{opacity:100},finish:{opacity:0},transition:BX.easing.makeEaseOut(BX.easing.transitions.quart),step:BX.delegate(function(t){this._container.style.opacity=t.opacity/100},this),complete:BX.delegate(function(){this._container.style.display="none";this._container.style.transform="translateX(100%)";this._container.style.opacity=0},this)});t.animate()},onMenuClick:function(t){if(!this._isEnabled){return BX.PreventDefault(t)}if(this._loader&&!this._loader.isLoaded()){this._loader.load()}this._manager.processItemSelect(this);return BX.PreventDefault(t)}};BX.Crm.EntityDetailTab.create=function(t,e){var i=new BX.Crm.EntityDetailTab;i.initialize(t,e);return i}}if(typeof BX.Crm.EditorTabLazyLoader==="undefined"){BX.Crm.EditorTabLazyLoader=function(){this._id="";this._settings={};this._container=null;this._serviceUrl="";this._tabId="";this._params={};this._isRequestRunning=false;this._isLoaded=false};BX.Crm.EditorTabLazyLoader.prototype={initialize:function(t,e){this._id=BX.type.isNotEmptyString(t)?t:"crm_lf_disp_"+Math.random().toString().substring(2);this._settings=e?e:{};this._container=BX(BX.prop.get(this._settings,"container",""));if(!this._container){throw"Error: Could not find container."}this._serviceUrl=BX.prop.getString(this._settings,"serviceUrl","");if(this._serviceUrl===""){throw"Error. Could not find service url."}this._tabId=BX.prop.getString(this._settings,"tabId","");if(this._tabId===""){throw"Error: Could not find tab id."}this._params=BX.prop.getObject(this._settings,"componentData",{})},getId:function(){return this._id},isLoaded:function(){return this._isLoaded},load:function(){if(this._isLoaded){return}var t=this._params;t["TAB_ID"]=this._tabId;this._startRequest(t)},_startRequest:function(t){if(this._isRequestRunning){return false}this._isRequestRunning=true;BX.ajax({url:this._serviceUrl,method:"POST",dataType:"html",data:{LOADER_ID:this._id,PARAMS:t},onsuccess:BX.delegate(this._onRequestSuccess,this),onfailure:BX.delegate(this._onRequestFailure,this)});return true},_onRequestSuccess:function(t){this._isRequestRunning=false;this._container.innerHTML=t;this._isLoaded=true},_onRequestFailure:function(t){this._isRequestRunning=false;this._isLoaded=true}};BX.Crm.EditorTabLazyLoader.items={};BX.Crm.EditorTabLazyLoader.create=function(t,e){var i=new BX.Crm.EditorTabLazyLoader;i.initialize(t,e);this.items[i.getId()]=i;return i}}
/* End */
;
; /* Start:"a:4:{s:4:"full";s:93:"/bitrix/components/bitrix/crm.entity.editor/templates/.default/script.min.js?1518596183320522";s:6:"source";s:72:"/bitrix/components/bitrix/crm.entity.editor/templates/.default/script.js";s:3:"min";s:0:"";s:3:"map";s:0:"";}"*/
BX.namespace("BX.Crm");if(typeof BX.Crm.EntityEditor==="undefined"){BX.Crm.EntityEditor=function(){this._id="";this._settings={};this._entityTypeId=0;this._entityId=0;this._userFieldManager=null;this._dupControlManager=null;this._bizprocManager=null;this._container=null;this._buttonContainer=null;this._createSectionButton=null;this._pageTitle=null;this._pageTitleInput=null;this._editPageTitleButton=null;this._copyPageUrlButton=null;this._formElement=null;this._ajaxForm=null;this._formSubmitHandler=BX.delegate(this.onFormSubmit,this);this._controllers=null;this._controls=null;this._activeControls=null;this._toolPanel=null;this._model=null;this._scheme=null;this._config=null;this._context=null;this._contextId="";this._externalContextId="";this._mode=BX.Crm.EntityEditorMode.intermediate;this._isNew=false;this._readOnly=false;this._enableAjaxForm=true;this._enableSectionEdit=false;this._enableSectionCreation=false;this._enableModeToggle=true;this._serviceUrl="";this._htmlEditorConfig=null;this._areAvailableSchemeElementsChanged=false;this._availableSchemeElements=null;this._dragPlaceHolder=null;this._dragContainerController=null;this._dropHandler=BX.delegate(this.onDrop,this);this._pageTitleExternalClickHandler=BX.delegate(this.onPageTitleExternalClick,this);this._pageTitleKeyPressHandler=BX.delegate(this.onPageTitleKeyPress,this);this._modeChangeNotifier=null;this._controlChangeNotifier=null;this._validators=null};BX.Crm.EntityEditor.prototype={initialize:function(t,e){this._id=BX.type.isNotEmptyString(t)?t:BX.util.getRandomString(4);this._settings=e?e:{};this._serviceUrl=BX.prop.getString(this._settings,"serviceUrl","");this._entityTypeId=BX.prop.getInteger(this._settings,"entityTypeId",0);this._entityId=BX.prop.getInteger(this._settings,"entityId",0);this._isNew=this._entityId<=0;this._container=BX(BX.prop.get(this._settings,"containerId"));this._parentContainer=BX.findParent(this._container,{className:"crm-entity-section"},false);this._buttonContainer=BX(BX.prop.get(this._settings,"buttonContainerId"));this._createSectionButton=BX(BX.prop.get(this._settings,"createSectionButtonId"));this._pageTitle=BX("pagetitle");this._editPageTitleButton=BX("pagetitle_edit");this._copyPageUrlButton=BX("page_url_copy_btn");this._formElement=BX.create("form",{});this._container.appendChild(this._formElement);this._enableAjaxForm=BX.prop.getBoolean(this._settings,"enableAjaxForm",true);if(this._enableAjaxForm){this.initializeAjaxForm()}var i=BX.prop.getObject(this._settings,"duplicateControl",{});if(this._ajaxForm){i["form"]=this._ajaxForm}this._dupControlManager=BX.Crm.EntityEditorDupManager.create(this._id.toLowerCase()+"_dup",i);this._model=BX.prop.get(this._settings,"model",null);this._scheme=BX.prop.get(this._settings,"scheme",null);this._config=BX.prop.get(this._settings,"config",null);this._context=BX.prop.getObject(this._settings,"context",{});this._contextId=BX.prop.getString(this._settings,"contextId","");this._externalContextId=BX.prop.getString(this._settings,"externalContextId","");this._readOnly=BX.prop.getBoolean(this._settings,"readOnly",false);if(this._readOnly){this._enableSectionEdit=this._enableSectionCreation=false}else{this._enableSectionEdit=BX.prop.getBoolean(this._settings,"enableSectionEdit",false);this._enableSectionCreation=BX.prop.getBoolean(this._settings,"enableSectionCreation",false)}this._userFieldManager=BX.prop.get(this._settings,"userFieldManager",null);this._bizprocManager=BX.prop.get(this._settings,"bizprocManager",null);this._bizprocManager._editor=this;this._restPlacementTabManager=BX.prop.get(this._settings,"restPlacementTabManager",null);this._restPlacementTabManager._editor=this;this._modeChangeNotifier=BX.CrmNotifier.create(this);this._controlChangeNotifier=BX.CrmNotifier.create(this);this._availableSchemeElements=this._scheme.getAvailableElements();this._controllers=[];this._controls=[];this._activeControls=[];this._htmlEditorConfig=BX.prop.getObject(this._settings,"htmlEditorConfig",{});var n=this._scheme.getElements();var r=BX.Crm.EntityEditorMode.view;if(!this._readOnly){r=BX.Crm.EntityEditorMode.parse(BX.prop.getString(this._settings,"initialMode",""))}this._mode=r!==BX.Crm.EntityEditorMode.intermediate?r:BX.Crm.EntityEditorMode.view;this._enableModeToggle=false;if(!this._readOnly){this._enableModeToggle=BX.prop.getBoolean(this._settings,"enableModeToggle",true)}if(this._isNew&&!this._readOnly){this._mode=BX.Crm.EntityEditorMode.edit}var o,s;var a=BX.prop.getArray(this._settings,"controllers",[]);for(o=0,s=a.length;o<s;o++){var l=this.createController(a[o]);if(l){this._controllers.push(l)}}var d,h;for(o=0,s=n.length;o<s;o++){d=n[o];h=this.createControl(d.getType(),d.getName(),{schemeElement:d,mode:BX.Crm.EntityEditorMode.view});if(!h){continue}this._controls.push(h)}if(this._mode===BX.Crm.EntityEditorMode.edit&&this._controls.length>0){for(o=0,s=this._controls.length;o<s;o++){h=this._controls[o];var p=h.getEditPriority();if(p===BX.Crm.EntityEditorPriority.high){h.setMode(BX.Crm.EntityEditorMode.edit,false)}}if(this.getActiveControlCount()===0){this._controls[0].setMode(BX.Crm.EntityEditorMode.edit,false)}}this._validators=[];var c=BX.prop.getArray(this._settings,"validators",[]);for(o=0,s=c.length;o<s;o++){var u=this.createValidator(c[o]);if(u){this._validators.push(u)}}this._modeChangeNotifier.notify([this]);this._toolPanel=BX.Crm.EntityEditorToolPanel.create(this._id,{container:this._formElement,editor:this,visible:false});this._dragContainerController=BX.Crm.EditorDragContainerController.create("editor_"+this.getId(),{charge:BX.Crm.EditorSectionDragContainer.create({editor:this}),node:this._formElement});this._dragContainerController.addDragFinishListener(this._dropHandler);BX.addCustomEvent(window,"Crm.InterfaceToolbar.MenuBuild",BX.delegate(this.onInterfaceToolbarMenuBuild,this));this.layout()},initializeAjaxForm:function(){if(this._ajaxForm){return}this._ajaxForm=BX.Crm.AjaxForm.create(this._id,{elementNode:this._formElement,config:{url:this._serviceUrl,method:"POST",dataType:"json",processData:true,onsuccess:BX.delegate(this.onSaveSuccess,this),data:{ACTION:"SAVE",ACTION_ENTITY_ID:this._entityId,ACTION_ENTITY_TYPE:BX.CrmEntityType.resolveAbbreviation(BX.CrmEntityType.resolveName(this._entityTypeId))}}});BX.addCustomEvent(this._ajaxForm,"onAfterSubmit",this._formSubmitHandler)},releaseAjaxForm:function(){if(!this._ajaxForm){return}BX.removeCustomEvent(this._ajaxForm,"onAfterSubmit",this._formSubmitHandler);this._ajaxForm=null},getId:function(){return this._id},getEntityTypeId:function(){return this._entityTypeId},getEntityTypeName:function(){return BX.CrmEntityType.resolveName(this._entityTypeId)},getEntityId:function(){return this._entityId},getOwnerInfo:function(){return this._model.getOwnerInfo()},getMode:function(){return this._mode},getContextId:function(){return this._contextId},getExternalContextId:function(){return this._externalContextId},getScheme:function(){return this._scheme},isSectionEditEnabled:function(){return this._enableSectionEdit},isSectionCreationEnabled:function(){return this._enableSectionCreation},isModeToggleEnabled:function(){return this._enableModeToggle},isNew:function(){return this._isNew},isReadOnly:function(){return this._readOnly},isEditInViewEnabled:function(){return this._entityId>0},getEntityCreateUrl:function(t){if(t===BX.CrmEntityType.names.contact){return BX.prop.getString(this._settings,"contactCreateUrl","")}else if(t===BX.CrmEntityType.names.company){return BX.prop.getString(this._settings,"companyCreateUrl","")}return""},getEntityRequisiteSelectUrl:function(t,e){var i="";if(t===BX.CrmEntityType.names.contact){i=BX.prop.getString(this._settings,"contactRequisiteSelectUrl","").replace(/#contact_id#/gi,e)}else if(t===BX.CrmEntityType.names.company){i=BX.prop.getString(this._settings,"companyRequisiteSelectUrl","").replace(/#company_id#/gi,e)}return i},getRequisiteEditUrl:function(t){return BX.prop.getString(this._settings,"requisiteEditUrl","").replace(/#requisite_id#/gi,t)},getUserFieldManager:function(){return this._userFieldManager},getBizprocManager:function(){return this._bizprocManager},getHtmlEditorId:function(){return BX.prop.getString(this._htmlEditorConfig,"id")},getHtmlEditor:function(){return BXHtmlEditor.Get(BX.prop.getString(this._htmlEditorConfig,"id"))},getHtmlEditorConfig:function(){return this._htmlEditorConfig},createValidator:function(t){t["editor"]=this;return BX.Crm.EntityEditorValidatorFactory.create(BX.prop.getString(t,"type",""),t)},getControlIndex:function(t){for(var e=0,i=this._controls.length;e<i;e++){if(this._controls[e]===t){return e}}return-1},getControls:function(){return this._controls},getControlCount:function(){return this._controls.length},createControl:function(t,e,i){i["serviceUrl"]=this._serviceUrl;i["container"]=this._formElement;i["model"]=this._model;i["editor"]=this;return BX.Crm.EntityEditorControlFactory.create(t,e,i)},addControlAt:function(t,e){var i={};if(e<this._controls.length){i["anchor"]=this._controls[e].getWrapper();this._controls.splice(e,0,t)}else{this._controls.push(t)}t.layout(i)},moveControl:function(t,e){var i=this._controls.length;var n=i-1;if(e<0||e>i){e=n}var r=this.getControlIndex(t);if(r<0||r===e){return false}t.clearLayout();this._controls.splice(r,1);i--;var o=e<i?this._controls[e].getWrapper():null;if(e<i){this._controls.splice(e,0,t)}else{this._controls.push(t)}if(o){t.layout({anchor:o})}else{t.layout()}this._config.moveSchemeElement(t.getSchemeElement(),e)},removeControl:function(t){var e=this.getControlIndex(t);if(e<0){return false}this.processControlRemove(t);t.clearLayout();this._controls.splice(e,1)},getControlById:function(t){for(var e=0,i=this._controls.length;e<i;e++){var n=this._controls[e];if(n.getId()===t){return n}var r=n.getChildById(t);if(r){return r}}return null},getActiveControlCount:function(){return this._activeControls.length},getActiveControlIndex:function(t){var e=this._activeControls.length;if(e===0){return-1}for(var i=0;i<e;i++){if(this._activeControls[i]===t){return i}}return-1},getActiveControlById:function(t){var e=this._activeControls.length;if(e===0){return null}for(var i=0;i<e;i++){var n=this._activeControls[i];if(n.getId()===t){return n}}return null},registerActiveControl:function(t){var e=this.getActiveControlIndex(t);if(e>=0){return}this._activeControls.push(t);t.setActive(true);if(this._mode!==BX.Crm.EntityEditorMode.edit){this._mode=BX.Crm.EntityEditorMode.edit;this._modeChangeNotifier.notify([this])}},unregisterActiveControl:function(t){var e=this.getActiveControlIndex(t);if(e<0){return}this._activeControls.splice(e,1);t.setActive(false);if(this._activeControls.length===0&&this._mode!==BX.Crm.EntityEditorMode.view){this._mode=BX.Crm.EntityEditorMode.view;this._modeChangeNotifier.notify([this])}},releaseActiveControls:function(){for(var t=0,e=this._activeControls.length;t<e;t++){var i=this._activeControls[t];i.setActive(false);i.toggleMode(false)}this._activeControls=[]},processControlModeChange:function(t){if(t.getMode()===BX.Crm.EntityEditorMode.edit){this.registerActiveControl(t)}else{this.unregisterActiveControl(t)}if(this.getActiveControlCount()>0){this.showToolPanel()}else{this.hideToolPanel()}},processControlChange:function(t,e){this.showToolPanel();this._controlChangeNotifier.notify([e])},processControlAdd:function(t){this.removeAvailableSchemeElement(t.getSchemeElement())},processControlMove:function(t){},processControlRemove:function(t){if(t instanceof BX.Crm.EntityEditorField){this.addAvailableSchemeElement(t.getSchemeElement())}else if(t instanceof BX.Crm.EntityEditorSection){var e=t.getChildren();for(var i=0,n=e.length;i<n;i++){this.addAvailableSchemeElement(e[i].getSchemeElement())}}},getAvailableSchemeElements:function(){return this._availableSchemeElements},addAvailableSchemeElement:function(t){this._availableSchemeElements.push(t);this._areAvailableSchemeElementsChanged=true;this.notifyAvailableSchemeElementsChanged()},removeAvailableSchemeElement:function(t){var e=this.getAvailableSchemeElementIndex(t);if(e<0){return}this._availableSchemeElements.splice(e,1);this._areAvailableSchemeElementsChanged=true;this.notifyAvailableSchemeElementsChanged()},getAvailableSchemeElementIndex:function(t){var e=this._availableSchemeElements;for(var i=0,n=e.length;i<n;i++){if(e[i]===t){return i}}return-1},getAvailableSchemeElementByName:function(t){var e=this._availableSchemeElements;for(var i=0,n=e.length;i<n;i++){var r=e[i];if(r.getName()===t){return r}}return null},hasAvailableSchemeElements:function(){return this._availableSchemeElements.length>0},notifyAvailableSchemeElementsChanged:function(){for(var t=0,e=this._activeControls.length;t<e;t++){this._activeControls[t].processAvailableSchemeElementsChange()}},createController:function(t){return BX.Crm.EntityEditorControllerFactory.create(BX.prop.getString(t,"type",""),BX.prop.getString(t,"name",""),{config:BX.prop.getObject(t,"config",{}),model:this._model,editor:this})},processControllerChange:function(t){this.showToolPanel()},prepareContextDataLayout:function(t,e){for(var i in t){if(!t.hasOwnProperty(i)){continue}var n=t[i];var r=i;if(BX.type.isNotEmptyString(e)){r=e+"["+r+"]"}if(BX.type.isPlainObject(n)){this.prepareContextDataLayout(n,r)}else{this._formElement.appendChild(BX.create("input",{props:{type:"hidden",name:r,value:n}}))}}},layout:function(){this.prepareContextDataLayout(this._context,"");this._toolPanel.layout();if(this.isSectionCreationEnabled()){BX.bind(this._createSectionButton,"click",BX.delegate(this.onCreateSectionButtonClick,this))}else{this._createSectionButton.style.display="none"}var t,e,i;for(t=0,e=this._controls.length;t<e;t++){i=this._controls[t];i.layout();if(i.getMode()===BX.Crm.EntityEditorMode.edit){this.registerActiveControl(i)}}if(this.getActiveControlCount()>0){this.showToolPanel()}if(this._model.isCaptionEditable()&&this._editPageTitleButton){BX.bind(this._editPageTitleButton,"click",BX.delegate(this.onPageTileButtonClick,this))}},refreshLayout:function(){for(var t=0,e=this._controls.length;t<e;t++){this._controls[t].refreshLayout()}},switchToViewMode:function(){this.rollback();this.releaseActiveControls();this.hideToolPanel()},switchTitleMode:function(t){if(t===BX.Crm.EntityEditorMode.edit){this._pageTitle.style.display="none";if(this._editPageTitleButton){this._editPageTitleButton.style.display="none"}if(this._copyPageUrlButton){this._copyPageUrlButton.style.display="none"}this._pageTitleInput=BX.create("input",{props:{type:"text",className:"pagetitle-item",value:this._model.getCaption()}});this._pageTitle.parentNode.insertBefore(this._pageTitleInput,this._editPageTitleButton);this._pageTitleInput.focus();window.setTimeout(BX.delegate(function(){BX.bind(document,"click",this._pageTitleExternalClickHandler);BX.bind(this._pageTitleInput,"keyup",this._pageTitleKeyPressHandler)},this),300)}else{if(this._pageTitleInput){this._pageTitleInput=BX.remove(this._pageTitleInput)}this._pageTitle.innerHTML=BX.util.htmlspecialchars(this._model.getCaption());this._pageTitle.style.display="";if(this._editPageTitleButton){this._editPageTitleButton.style.display=""}if(this._copyPageUrlButton){this._copyPageUrlButton.style.display=""}BX.unbind(document,"click",this._pageTitleExternalClickHandler);BX.unbind(this._pageTitleInput,"keyup",this._pageTitleKeyPressHandler)}},showToolPanel:function(){if(this._toolPanel.isVisible()){return}this._toolPanel.setVisible(true);if(this._parentContainer){this._parentContainer.style.paddingBottom="50px"}},hideToolPanel:function(){if(!this._toolPanel.isVisible()){return}this._toolPanel.setVisible(false);if(this._parentContainer){this._parentContainer.style.paddingBottom=""}},addModeChangeListener:function(t){this._modeChangeNotifier.addListener(t)},removeModeChangeListener:function(t){this._modeChangeNotifier.removeListener(t)},addControlChangeListener:function(t){this._controlChangeNotifier.addListener(t)},removeControlChangeListener:function(t){this._controlChangeNotifier.removeListener(t)},getMessage:function(t){var e=BX.Crm.EntityEditor.messages;return e.hasOwnProperty(t)?e[t]:t},getFormElement:function(){return this._formElement},savePageTitle:function(){if(!this._pageTitleInput){return}var t=BX.util.trim(BX.util.strip_tags(this._pageTitleInput.value));if(t===""){return}this._model.setCaption(t);var e={ACTION:"SAVE",ACTION_ENTITY_ID:this._entityId,ACTION_ENTITY_TYPE:BX.CrmEntityType.resolveAbbreviation(BX.CrmEntityType.resolveName(this._entityTypeId))};this._model.prepareCaptionData(e);BX.ajax({url:this._serviceUrl,method:"POST",dataType:"json",data:e,onsuccess:BX.delegate(this.onSaveSuccess,this)})},save:function(){var t=BX.Crm.EntityValidationResult.create();var e=this.getBizprocManager();this.validate(t).then(function(){return e.onBeforeSave(t)}).then(BX.delegate(function(){if(t.getStatus()){this.innerSave();e.onAfterSave()}else{var i=t.getTopmostField();if(i){i.focus()}}},this))},saveControl:function(t){if(this._entityId<=0){return}var e=BX.Crm.EntityValidationResult.create();t.validate(e);if(!e.getStatus()){return}var i={ACTION:"SAVE",ACTION_ENTITY_ID:this._entityId,ACTION_ENTITY_TYPE:BX.CrmEntityType.resolveAbbreviation(BX.CrmEntityType.resolveName(this._entityTypeId))};i=BX.mergeEx(i,this._context);t.save();t.prepareSaveData(i);BX.ajax({method:"POST",dataType:"json",url:this._serviceUrl,data:i,onsuccess:BX.delegate(this.onSaveSuccess,this)})},validate:function(t){for(var e=0,i=this._activeControls.length;e<i;e++){this._activeControls[e].validate(t)}var n=new BX.Promise;this._userFieldManager.validate(t).then(BX.delegate(function(){n.fulfill()},this));return n},innerSave:function(){var t,e;for(t=0,e=this._controllers.length;t<e;t++){this._controllers[t].onBeforeSubmit()}for(t=0,e=this._activeControls.length;t<e;t++){var i=this._activeControls[t];i.save();i.onBeforeSubmit();if(i.isSchemeChanged()){this._config.updateSchemeElement(i.getSchemeElement())}}if(this._areAvailableSchemeElementsChanged){this._scheme.setAvailableElements(this._availableSchemeElements);this._areAvailableSchemeElementsChanged=false}if(this._config.isChanged()){this._config.save(false)}var n={id:this._id,externalContext:this._externalContextId,context:this._contextId,entityTypeId:this._entityTypeId,entityId:this._entityId,model:this._model,cancel:false};BX.onCustomEvent(window,"BX.Crm.EntityEditor:onSave",[this,n]);if(n["cancel"]){return}if(this._ajaxForm){this._ajaxForm.submit()}},cancel:function(){var t={id:this._id,externalContext:this._externalContextId,context:this._contextId,entityTypeId:this._entityTypeId,entityId:this._entityId,model:this._model,cancel:false};BX.onCustomEvent(window,"BX.Crm.EntityEditor:onCancel",[this,t]);if(t["cancel"]){return}if(this._isNew){this.rollback();this.refreshLayout();if(typeof top.BX.Bitrix24.Slider!=="undefined"){var e=top.BX.Bitrix24.Slider.getCurrentPage();if(e){e.close(false)}}}else{this.switchToViewMode();this.refreshLayout()}},rollback:function(){var t,e;for(t=0,e=this._controllers.length;t<e;t++){this._controllers[t].rollback()}for(t=0,e=this._activeControls.length;t<e;t++){this._activeControls[t].rollback()}if(this._areAvailableSchemeElementsChanged){this._availableSchemeElements=this._scheme.getAvailableElements();this._areAvailableSchemeElementsChanged=false}this._mode=BX.Crm.EntityEditorMode.view;this._modeChangeNotifier.notify([this])},addSchemeElementAt:function(t,e){this._config.addSchemeElementAt(t,e)},updateSchemeElement:function(t){this._config.updateSchemeElement(t)},removeSchemeElement:function(t){this._config.removeSchemeElement(t)},isSchemeChanged:function(){return this._config.isChanged()},saveScheme:function(){return this._config.save(false)},saveSchemeChanges:function(){for(var t=0,e=this._controls.length;t<e;t++){this._controls[t].commitSchemeChanges()}return this._config.save(false)},onSaveSuccess:function(t){this._toolPanel.processSaveComplete();this._toolPanel.clearErrors();var e=BX.prop.getString(t,"ERROR","");if(e!==""){this._toolPanel.addError(e);this.releaseAjaxForm();this.initializeAjaxForm();return}var i={};var n=BX.prop.getObject(t,"ENTITY_INFO",null);if(n){i["entityInfo"]=n}var r=BX.prop.getObject(t,"ENTITY_DATA",null);if(this._isNew){this._entityId=BX.prop.getInteger(t,"ENTITY_ID",0);if(this._entityId<=0){this._toolPanel.addError(this.getMessage("couldNotFindEntityIdError"));return}BX.Crm.EntityEvent.fireCreate(this._entityTypeId,this._entityId,this._externalContextId,i);i["entityData"]=r;BX.onCustomEvent(window,BX.Crm.EntityEvent.names.create,[i]);this._isNew=false}else{BX.Crm.EntityEvent.fireUpdate(this._entityTypeId,this._entityId,this._externalContextId,i);i["entityData"]=r;BX.onCustomEvent(window,BX.Crm.EntityEvent.names.update,[i])}var o=BX.prop.getObject(t,"EVENT_PARAMS",null);if(o){var s=BX.prop.getString(o,"name","");var a=BX.prop.getObject(o,"args",null);if(s!==""&&a!==null){BX.localStorage.set(s,a,10)}}var l=BX.prop.getString(t,"REDIRECT_URL","");if(l!==""){window.location.replace(l)}else{var d=BX.prop.getObject(t,"ENTITY_DATA",null);if(BX.type.isPlainObject(d)){this._model.setData(d)}this._pageTitle.innerHTML=BX.util.htmlspecialchars(this._model.getCaption());this.releaseAjaxForm();this.initializeAjaxForm();this.switchToViewMode();this.refreshLayout()}},formatMoney:function(t,e,i){BX.ajax({url:BX.prop.getString(this._settings,"serviceUrl",""),method:"POST",dataType:"json",data:{ACTION:"GET_FORMATTED_SUM",CURRENCY_ID:e,SUM:t},onsuccess:i})},findOption:function(t,e){for(var i=0,n=e.length;i<n;i++){if(t===e[i].VALUE){return e[i].NAME}}return t},getServiceUrl:function(){return this._serviceUrl},loadCustomHtml:function(t,e,i){e["ACTION"]=t;e["ACTION_ENTITY_ID"]=this._entityId;BX.ajax({url:this._serviceUrl,method:"POST",dataType:"html",data:e,onsuccess:i})},onFormSubmit:function(t,e){this._toolPanel.processSaveBegin()},isDuplicateControlEnabled:function(){return this._dupControlManager.isEnabled()},getDuplicateManager:function(){return this._dupControlManager},onPageTileButtonClick:function(t){if(!this._readOnly){this.switchTitleMode(BX.Crm.EntityEditorMode.edit)}},onCreateSectionButtonClick:function(t){if(!this.isSectionCreationEnabled()){return}var e=this.getControlCount();var i="user_"+BX.util.getRandomString(8).toLowerCase();var n=BX.Crm.EntitySchemeElement.create({type:"section",name:i,title:this.getMessage("newSectionTitle")});this.addSchemeElementAt(n,e);var r=this.createControl("section",i,{schemeElement:n,model:this._model,container:this._formElement});this.addControlAt(r,e);this.saveScheme();r.setMode(BX.Crm.EntityEditorMode.edit);r.refreshLayout();r.setTitleMode(BX.Crm.EntityEditorMode.edit);this.registerActiveControl(r)},onPageTitleExternalClick:function(t){var e=BX.getEventTarget(t);if(e!==this._pageTitleInput){this.savePageTitle();this.switchTitleMode(BX.Crm.EntityEditorMode.view)}},onPageTitleKeyPress:function(t){var e=t.keyCode;if(e===13){this.savePageTitle();this.switchTitleMode(BX.Crm.EntityEditorMode.view)}else if(e===27){this.switchTitleMode(BX.Crm.EntityEditorMode.view)}},onInterfaceToolbarMenuBuild:function(t,e){var i=BX.prop.getArray(e,"items",null);if(!i){return}var n=BX.delegate(this.onMenuItemClick,this);i.push({delimiter:true});i.push({id:"resetConfig",text:this.getMessage("resetConfig"),onclick:n});if(BX.prop.getBoolean(this._settings,"enableSettingsForAll",false)){i.push({id:"resetConfigForAllUsers",text:this.getMessage("resetConfigForAllUsers"),onclick:n});i.push({id:"saveConfigForAllUsers",text:this.getMessage("saveConfigForAllUsers"),onclick:n})}},resetConfig:function(){this._config.reset(false).then(function(){window.location.reload()})},resetConfigForAllUsers:function(){if(BX.prop.getBoolean(this._settings,"enableSettingsForAll",false)){this._config.reset(true).then(function(){window.location.reload()})}},onMenuItemClick:function(t,e){var i=BX.prop.getString(e,"id","");if(i==="resetConfig"){this.resetConfig()}else if(i==="resetConfigForAllUsers"){this.resetConfigForAllUsers()}else if(i==="saveConfigForAllUsers"){this.saveConfigForAllUsers()}if(e.menuWindow){e.menuWindow.close()}},saveConfigForAllUsers:function(){if(BX.prop.getBoolean(this._settings,"enableSettingsForAll",false)){this._config.save(true)}},hasPlaceHolder:function(){return!!this._dragPlaceHolder},createPlaceHolder:function(t){var e=this.getControlCount();if(t<0||t>e){t=e>0?e:0}if(this._dragPlaceHolder){if(this._dragPlaceHolder.getIndex()===t){return this._dragPlaceHolder}this._dragPlaceHolder.clearLayout();this._dragPlaceHolder=null}this._dragPlaceHolder=BX.Crm.EditorDragSectionPlaceholder.create({container:this._formElement,anchor:t<e?this._controls[t].getWrapper():null,index:t});this._dragPlaceHolder.layout();return this._dragPlaceHolder},getPlaceHolder:function(){return this._dragPlaceHolder},removePlaceHolder:function(){if(this._dragPlaceHolder){this._dragPlaceHolder.clearLayout();this._dragPlaceHolder=null}},processDraggedItemDrop:function(t,e){var i=t.getCharge();if(!(i instanceof BX.Crm.EditorSectionDragContainer&&i.getEditor()===this)){return}var n=e.getContextData();var r=BX.type.isNotEmptyString(n["contextId"])?n["contextId"]:"";if(r!==BX.Crm.EditorSectionDragItem.contextId){return}var o=typeof n["charge"]!=="undefined"?n["charge"]:null;if(!(o instanceof BX.Crm.EditorSectionDragItem)){return}var s=o.getControl();if(!s){return}var a=this.getControlIndex(s);if(a<0){return}var l=this.getPlaceHolder();var d=l?l.getIndex():-1;if(d<0){return}var h=d<=a?d:d-1;if(h!==a){this.moveControl(s,h);this.saveScheme()}},onDrop:function(t,e,i,n){this.processDraggedItemDrop(t,e)}};BX.Crm.EntityEditor.defaultInstance=null;BX.Crm.EntityEditor.items={};BX.Crm.EntityEditor.get=function(t){return this._items.hasOwnProperty(t)?this._items[t]:null};if(typeof BX.Crm.EntityEditor.messages==="undefined"){BX.Crm.EntityEditor.messages={}}BX.Crm.EntityEditor.setDefault=function(t){BX.Crm.EntityEditor.defaultInstance=t};BX.Crm.EntityEditor.getDefault=function(){return BX.Crm.EntityEditor.defaultInstance};BX.Crm.EntityEditor.create=function(t,e){var i=new BX.Crm.EntityEditor;i.initialize(t,e);this.items[i.getId()]=i;return i}}if(typeof BX.Crm.EntityEditorMode==="undefined"){BX.Crm.EntityEditorMode={intermediate:0,view:1,edit:2,parse:function(t){t=t.toLowerCase();if(t==="view"){return this.view}else if(t==="edit"){return this.edit}return this.intermediate}}}if(typeof BX.Crm.EntityEditorPriority==="undefined"){BX.Crm.EntityEditorPriority={undefined:0,normal:1,high:2}}if(typeof BX.Crm.EditorDialogButtonType==="undefined"){BX.Crm.EditorDialogButtonType={undefined:0,accept:1,cancel:2}}if(typeof BX.Crm.EditorDialogButton==="undefined"){BX.Crm.EditorDialogButton=function(){this._id="";this._type=BX.Crm.EditorDialogButtonType.undefined;this._settings={};this._dialog=null};BX.Crm.EditorDialogButton.prototype={initialize:function(t,e){this._id=BX.type.isNotEmptyString(t)?t:BX.util.getRandomString(4);this._settings=e?e:{};this._type=BX.prop.getInteger(this._settings,"type",BX.Crm.EditorDialogButtonType.undefined);this._dialog=BX.prop.get(this._settings,"dialog",null)},getId:function(){return this._id},getDialog:function(){return this._dialog},prepareContent:function(){if(this._type===BX.Crm.EditorDialogButtonType.accept){return new BX.PopupWindowButton({text:BX.prop.getString(this._settings,"text",this._id),className:"popup-window-button-create",events:{click:BX.delegate(this.onClick,this)}})}else if(this._type===BX.Crm.EditorDialogButtonType.cancel){return new BX.PopupWindowButtonLink({text:BX.prop.getString(this._settings,"text",this._id),className:"webform-button-link-cancel",events:{click:BX.delegate(this.onClick,this)}})}else{return new BX.PopupWindowButton({text:BX.prop.getString(this._settings,"text",this._id),events:{click:BX.delegate(this.onClick,this)}})}},onClick:function(t){var e=BX.prop.getFunction(this._settings,"callback",null);if(e){e(this)}}};BX.Crm.EditorDialogButton.create=function(t,e){var i=new BX.Crm.EditorDialogButton;i.initialize(t,e);return i}}if(typeof BX.Crm.EditorDialog==="undefined"){BX.Crm.EditorDialog=function(){this._id="";this._settings={};this._popup=null;this._buttons=null};BX.Crm.EditorDialog.prototype={initialize:function(t,e){this._id=BX.type.isNotEmptyString(t)?t:BX.util.getRandomString(4);this._settings=e?e:{}},getSetting:function(t,e){return BX.prop.get(this._settings,t,e)},open:function(){this._popup=new BX.PopupWindow(this._id,BX.prop.getElementNode(this._settings,"anchor",null),{autoHide:false,draggable:false,closeByEsc:true,offsetLeft:0,offsetTop:0,zIndex:BX.prop.getInteger(this._settings,"zIndex",0),bindOptions:{forceBindPosition:true},titleBar:BX.prop.getString(this._settings,"title","No title"),content:BX.prop.getString(this._settings,"content",""),buttons:this.prepareButtons(),events:{}});this._popup.show()},close:function(){if(this._popup){this._popup.close()}},prepareButtons:function(){var t=[];this._buttons=[];var e=BX.prop.getArray(this._settings,"buttons",[]);for(var i=0,n=e.length;i<n;i++){var r=e[i];r["dialog"]=this;var o=BX.Crm.EditorDialogButton.create(BX.prop.getString(r,"id",""),r);this._buttons.push(o);t.push(o.prepareContent())}return t}};BX.Crm.EditorDialog.create=function(t,e){var i=new BX.Crm.EditorDialog;i.initialize(t,e);return i}}if(typeof BX.Crm.EntityValidator==="undefined"){BX.Crm.EntityValidator=function(){this._settings={};this._editor=null;this._data=null};BX.Crm.EntityValidator.prototype={initialize:function(t){this._settings=t?t:{};this._editor=BX.prop.get(this._settings,"editor",null);this._data=BX.prop.getObject(this._settings,"data",{});this.doInitialize()},doInitialize:function(){},release:function(){},getData:function(){return this._data},getDataStringParam:function(t,e){return BX.prop.getString(this._data,t,e)},getErrorMessage:function(){return BX.prop.getString(this._settings,"message","")},validate:function(t){return true},processControlChange:function(t){}}}if(typeof BX.Crm.EntityPersonValidator==="undefined"){BX.Crm.EntityPersonValidator=function(){BX.Crm.EntityPersonValidator.superclass.constructor.apply(this)};BX.extend(BX.Crm.EntityPersonValidator,BX.Crm.EntityValidator);BX.Crm.EntityPersonValidator.prototype.doInitialize=function(){this._nameField=this._editor.getControlById(this.getDataStringParam("nameField",""));if(this._nameField){this._nameField.addValidator(this)}this._lastNameField=this._editor.getControlById(this.getDataStringParam("lastNameField",""));if(this._lastNameField){this._lastNameField.addValidator(this)}};BX.Crm.EntityPersonValidator.prototype.release=function(){if(this._nameField){this._nameField.removeValidator(this)}if(this._lastNameField){this._lastNameField.removeValidator(this)}};BX.Crm.EntityPersonValidator.prototype.validate=function(t){var e=this._nameField.isActive();var i=this._lastNameField.isActive();if(!e&&!i){return true}var n=e?this._nameField.getRuntimeValue():this._nameField.getValue();var r=i?this._lastNameField.getRuntimeValue():this._lastNameField.getValue();if(n!==""||r!==""){return true}if(n===""&&e){t.addError(BX.Crm.EntityValidationError.create({field:this._nameField}));this._nameField.showError(this.getErrorMessage())}if(r===""&&i){t.addError(BX.Crm.EntityValidationError.create({field:this._lastNameField}));this._lastNameField.showError(this.getErrorMessage())}return false};BX.Crm.EntityPersonValidator.prototype.processFieldChange=function(t){if(t!==this._nameField&&t!==this._lastNameField){return}if(this._nameField){this._nameField.clearError()}if(this._lastNameField){this._lastNameField.clearError()}};BX.Crm.EntityPersonValidator.create=function(t){var e=new BX.Crm.EntityPersonValidator;e.initialize(t);return e}}if(typeof BX.Crm.EntityValidationError==="undefined"){BX.Crm.EntityValidationError=function(){this._settings={};this._field=null;this._message=""};BX.Crm.EntityValidationError.prototype={initialize:function(t){this._settings=t?t:{};this._field=BX.prop.get(this._settings,"field",null);this._message=BX.prop.getString(this._settings,"message","")},getField:function(){return this._field},getMessage:function(){return this._message}};BX.Crm.EntityValidationError.create=function(t){var e=new BX.Crm.EntityValidationError;e.initialize(t);return e}}if(typeof BX.Crm.EntityValidationResult==="undefined"){BX.Crm.EntityValidationResult=function(){this._settings={};this._errors=[]};BX.Crm.EntityValidationResult.prototype={initialize:function(t){this._settings=t?t:{}},getStatus:function(){return this._errors.length===0},addError:function(t){this._errors.push(t)},getErrors:function(){return this._errors},addResult:function(t){var e=t.getErrors();for(var i=0,n=e.length;i<n;i++){this._errors.push(e[i])}},getTopmostField:function(){var t=null;var e=null;for(var i=0,n=this._errors.length;i<n;i++){var r=this._errors[i].getField();if(!t){t=r;e=r.getPosition()["top"];continue}var o=r.getPosition();if(!o){continue}var s=r.getPosition()["top"];if(s<e){t=r;e=s}}return t}};BX.Crm.EntityValidationResult.create=function(t){var e=new BX.Crm.EntityValidationResult;e.initialize(t);return e}}if(typeof BX.Crm.EntityConfig==="undefined"){BX.Crm.EntityConfig=function(){this._id="";this._settings={};this._data={};this._items=[];this._serviceUrl="";this._isChanged=false};BX.Crm.EntityConfig.prototype={initialize:function(t,e){this._id=BX.type.isNotEmptyString(t)?t:BX.util.getRandomString(4);this._settings=e?e:{};this._data=BX.prop.getArray(this._settings,"data");this._items=[];for(var i=0,n=this._data.length;i<n;i++){var r=this._data[i];var o=BX.prop.getString(r,"type","");if(o==="section"){this._items.push(BX.Crm.EntityConfigSection.create({data:r}))}else{this._items.push(BX.Crm.EntityConfigField.create({data:r}))}}this._serviceUrl=BX.prop.getString(this._settings,"serviceUrl","")},findItemByName:function(t){for(var e=0,i=this._items.length;e<i;e++){var n=this._items[e];if(n.getName()===t){return n}}return null},findItemIndexByName:function(t){for(var e=0,i=this._items.length;e<i;e++){var n=this._items[e];if(n.getName()===t){return e}}return-1},toJSON:function(){var t=[];for(var e=0,i=this._items.length;e<i;e++){t.push(this._items[e].toJSON())}return t},addSchemeElementAt:function(t,e){var i=t.createConfigItem();var n=t.getType()==="section"?BX.Crm.EntityConfigSection.create({data:i}):BX.Crm.EntityConfigField.create({data:i});if(e>=0&&e<this._items.length){this._items.splice(e,0,n)}else{this._items.push(n)}this._isChanged=true},moveSchemeElement:function(t,e){var i=this._items.length;var n=i-1;if(e<0||e>i){e=n}var r=this.findItemIndexByName(t.getName());if(r<0||r===e){return}var o=this._items[r];this._items.splice(r,1);i--;if(e<i){this._items.splice(e,0,o)}else{this._items.push(o)}this._isChanged=true},updateSchemeElement:function(t){var e;var i=t.getParent();if(i){var n=this.findItemByName(i.getName());if(n){e=n.findFieldIndexByName(t.getName());if(e>=0){n.setField(BX.Crm.EntityConfigField.create({data:t.createConfigItem()}),e);this._isChanged=true}}}else{e=this.findItemIndexByName(t.getName());if(e>=0){if(t.getType()==="section"){this._items[e]=BX.Crm.EntityConfigSection.create({data:t.createConfigItem()})}else{this._items[e]=BX.Crm.EntityConfigField.create({data:t.createConfigItem()})}this._isChanged=true}}},removeSchemeElement:function(t){var e=this.findItemIndexByName(t.getName());if(e<0){return}this._items.splice(e,1);this._isChanged=true},isChanged:function(){return this._isChanged},registerField:function(t){var e=t.getParent();if(!e){return}var i=this.findItemByName(e.getName());if(!i){return}i.addField(BX.Crm.EntityConfigField.create({data:t.createConfigItem()}));this.save()},unregisterField:function(t){var e=t.getParent();if(!e){return}var i=this.findItemByName(e.getName());if(!i){return}var n=i.findFieldByName(t.getName());if(!n){return}i.removeFieldByIndex(n.getIndex());this.save()},save:function(t){var e=new BX.Promise;if(!this._isChanged&&!t){window.setTimeout(function(){e.fulfill()},0);return e}var i={guid:this._id,action:"saveconfig",config:this.toJSON()};if(t){i["forAllUsers"]="Y";i["delete"]="Y"}BX.ajax.post(this._serviceUrl,i,function(){e.fulfill()});this._isChanged=false;return e},reset:function(t){var e={guid:this._id,action:"resetconfig",config:this.toJSON()};if(t){e["forAllUsers"]="Y"}var i=new BX.Promise;BX.ajax.post(this._serviceUrl,e,function(){i.fulfill()});return i}};BX.Crm.EntityConfig.create=function(t,e){var i=new BX.Crm.EntityConfig;i.initialize(t,e);return i}}if(typeof BX.Crm.EntityConfigItem==="undefined"){BX.Crm.EntityConfigItem=function(){this._settings={};this._data={};this._name="";this._title=""};BX.Crm.EntityConfigItem.prototype={initialize:function(t){this._settings=t?t:{};this._data=BX.prop.getObject(this._settings,"data",[]);this._name=BX.prop.getString(this._data,"name","");this._title=BX.prop.getString(this._data,"title","");this.doInitialize()},doInitialize:function(){},getType:function(){return""},getName:function(){return this._name},getTitle:function(){return this._title},toJSON:function(){return{}}}}if(typeof BX.Crm.EntityConfigSection==="undefined"){BX.Crm.EntityConfigSection=function(){BX.Crm.EntityConfigSection.superclass.constructor.apply(this);this._fields=[]};BX.extend(BX.Crm.EntityConfigSection,BX.Crm.EntityConfigItem);BX.Crm.EntityConfigSection.prototype.doInitialize=function(){this._fields=[];var t=BX.prop.getArray(this._data,"elements",[]);for(var e=0,i=t.length;e<i;e++){var n=BX.Crm.EntityConfigField.create({data:t[e]});n.setIndex(e);this._fields.push(n)}};BX.Crm.EntityConfigSection.prototype.getType=function(){return"section"};BX.Crm.EntityConfigSection.prototype.getFields=function(){return this._fields};BX.Crm.EntityConfigSection.prototype.findFieldByName=function(t){var e=this.findFieldIndexByName(t);return e>=0?this._fields[e]:null};BX.Crm.EntityConfigSection.prototype.findFieldIndexByName=function(t){for(var e=0,i=this._fields.length;e<i;e++){var n=this._fields[e];if(n.getName()===t){return e}}return-1};BX.Crm.EntityConfigSection.prototype.addField=function(t){this._fields.push(t)};BX.Crm.EntityConfigSection.prototype.setField=function(t,e){this._fields[e]=t};BX.Crm.EntityConfigSection.prototype.removeFieldByIndex=function(t){var e=this._fields.length;if(t<0||t>=e){return false}this._fields.splice(t,1);return true};BX.Crm.EntityConfigSection.prototype.toJSON=function(){var t={name:this._name,title:this._title,type:"section",elements:[]};for(var e=0,i=this._fields.length;e<i;e++){t.elements.push(this._fields[e].toJSON())}return t};BX.Crm.EntityConfigSection.create=function(t){var e=new BX.Crm.EntityConfigSection;e.initialize(t);return e}}if(typeof BX.Crm.EntityConfigField==="undefined"){BX.Crm.EntityConfigField=function(){BX.Crm.EntityConfigField.superclass.constructor.apply(this);this._index=-1};BX.extend(BX.Crm.EntityConfigField,BX.Crm.EntityConfigItem);BX.Crm.EntityConfigField.prototype.toJSON=function(){var t={name:this._name};if(this._title!==""){t["title"]=this._title}return t};BX.Crm.EntityConfigField.prototype.getIndex=function(){return this._index};BX.Crm.EntityConfigField.prototype.setIndex=function(t){this._index=t};BX.Crm.EntityConfigField.create=function(t){var e=new BX.Crm.EntityConfigField;e.initialize(t);return e}}if(typeof BX.Crm.EntityScheme==="undefined"){BX.Crm.EntityScheme=function(){this._id="";this._settings={};this._elements=null;this._availableElements=null};BX.Crm.EntityScheme.prototype={initialize:function(t,e){this._id=BX.type.isNotEmptyString(t)?t:BX.util.getRandomString(4);this._settings=e?e:{};this._elements=[];this._availableElements=[];var i,n;var r=BX.prop.getArray(this._settings,"current",[]);for(i=0,n=r.length;i<n;i++){this._elements.push(BX.Crm.EntitySchemeElement.create(r[i]))}var o=BX.prop.getArray(this._settings,"available",[]);for(i=0,n=o.length;i<n;i++){this._availableElements.push(BX.Crm.EntitySchemeElement.create(o[i]))}},getId:function(){return this._id},getElements:function(){return[].concat(this._elements)},getAvailableElements:function(){return[].concat(this._availableElements)},setAvailableElements:function(t){this._availableElements=BX.type.isArray(t)?t:[]}};BX.Crm.EntityScheme.create=function(t,e){var i=new BX.Crm.EntityScheme;i.initialize(t,e);return i}}if(typeof BX.Crm.EntitySchemeElement==="undefined"){BX.Crm.EntitySchemeElement=function(){this._settings={};this._name="";this._type="";this._title="";this._originalTitle="";this._isEditable=true;this._isTransferable=true;this._isRequired=false;this._isRequiredConditionally=false;this._isHeading=false;this._visibilityPolicy=BX.Crm.EntityEditorVisibilityPolicy.always;this._data=null;this._elements=null;this._parent=null};BX.Crm.EntitySchemeElement.prototype={initialize:function(t){this._settings=t?t:{};this._name=BX.prop.getString(this._settings,"name","");this._type=BX.prop.getString(this._settings,"type","");this._isEditable=BX.prop.getBoolean(this._settings,"editable",true);this._isTransferable=BX.prop.getBoolean(this._settings,"transferable",true);this._isRequired=BX.prop.getBoolean(this._settings,"required",false);this._isRequiredConditionally=BX.prop.getBoolean(this._settings,"requiredConditionally",false);this._isHeading=BX.prop.getBoolean(this._settings,"isHeading",false);this._visibilityPolicy=BX.Crm.EntityEditorVisibilityPolicy.parse(BX.prop.getString(this._settings,"visibilityPolicy",""));this._data=BX.prop.getObject(this._settings,"data",{});var e=BX.prop.getString(this._settings,"title","");var i=BX.prop.getString(this._settings,"originalTitle","");if(e!==""&&i===""){i=e}else if(i!==""&&e===""){e=i}this._title=e;this._originalTitle=i;this._elements=[];var n=BX.prop.getArray(this._settings,"elements",[]);for(var r=0,o=n.length;r<o;r++){this._elements.push(BX.Crm.EntitySchemeElement.create(n[r]))}},getName:function(){return this._name},getType:function(){return this._type},getTitle:function(){return this._title},setTitle:function(t){this._title=t},getOriginalTitle:function(){return this._originalTitle},isEditable:function(){return this._isEditable},isTransferable:function(){return this._isTransferable},isRequired:function(){return this._isRequired},isRequiredConditionally:function(){return this._isRequiredConditionally},isHeading:function(){return this._isHeading},getVisibilityPolicy:function(){return this._visibilityPolicy},getData:function(){return this._data},setData:function(t){this._data=t},getDataParam:function(t,e){return BX.prop.get(this._data,t,e)},getDataStringParam:function(t,e){return BX.prop.getString(this._data,t,e)},getDataIntegerParam:function(t,e){return BX.prop.getInteger(this._data,t,e)},getDataBooleanParam:function(t,e){return BX.prop.getBoolean(this._data,t,e)},getDataObjectParam:function(t,e){return BX.prop.getObject(this._data,t,e)},getDataArrayParam:function(t,e){return BX.prop.getArray(this._data,t,e)},getElements:function(){return this._elements},setElements:function(t){this._elements=t},getAffectedFields:function(){var t=this.getDataArrayParam("affectedFields",[]);if(t.length===0){t.push(this._name)}return t},getParent:function(){return this._parent},setParent:function(t){this._parent=t instanceof BX.Crm.EntitySchemeElement?t:null},createConfigItem:function(){var t={name:this._name};if(this._type==="section"){t["type"]="section";if(this._title!==""){t["title"]=this._title}t["elements"]=[];for(var e=0,i=this._elements.length;e<i;e++){t["elements"].push(this._elements[e].createConfigItem())}}else{if(this._title!==""&&this._title!==this._originalTitle){t["title"]=this._title}}return t},clone:function(){return BX.Crm.EntitySchemeElement.create(BX.clone(this._settings))}};BX.Crm.EntitySchemeElement.create=function(t){var e=new BX.Crm.EntitySchemeElement;e.initialize(t);return e}}if(typeof BX.Crm.EntityEditorValidatorFactory==="undefined"){BX.Crm.EntityEditorValidatorFactory={create:function(t,e){if(t==="person"){return BX.Crm.EntityPersonValidator.create(e)}return null}}}if(typeof BX.Crm.EntityEditorControlFactory==="undefined"){BX.Crm.EntityEditorControlFactory={create:function(t,e,i){if(t==="section"){return BX.Crm.EntityEditorSection.create(e,i)}else if(t==="text"){return BX.Crm.EntityEditorText.create(e,i)}else if(t==="number"){return BX.Crm.EntityEditorNumber.create(e,i)}else if(t==="datetime"){return BX.Crm.EntityEditorDatetime.create(e,i)}else if(t==="boolean"){return BX.Crm.EntityEditorBoolean.create(e,i)}else if(t==="list"){return BX.Crm.EntityEditorList.create(e,i)}else if(t==="html"){return BX.Crm.EntityEditorHtml.create(e,i)}else if(t==="money"){return BX.Crm.EntityEditorMoney.create(e,i)}else if(t==="image"){return BX.Crm.EntityEditorImage.create(e,i)}else if(t==="user"){return BX.Crm.EntityEditorUser.create(e,i)}else if(t==="address"){return BX.Crm.EntityEditorAddress.create(e,i)}else if(t==="client"){return BX.Crm.EntityEditorClient.create(e,i)}else if(t==="multifield"){return BX.Crm.EntityEditorMultifield.create(e,i)}else if(t==="product_row_summary"){return BX.Crm.EntityEditorProductRowSummary.create(e,i)}else if(t==="requisite_selector"){return BX.Crm.EntityEditorRequisiteSelector.create(e,i)}else if(t==="requisite_list"){return BX.Crm.EntityEditorRequisiteList.create(e,i)}else if(t==="userField"){return BX.Crm.EntityEditorUserField.create(e,i)}else if(t==="userFieldConfig"){return BX.Crm.EntityEditorUserFieldConfigurator.create(e,i)}else if(t==="recurring"){return BX.Crm.EntityEditorRecurring.create(e,i)}return null}}}if(typeof BX.Crm.EntityEditorControllerFactory==="undefined"){BX.Crm.EntityEditorControllerFactory={create:function(t,e,i){if(t==="product_row_proxy"){return BX.Crm.EntityEditorProductRowProxy.create(e,i)}return null}}}if(typeof BX.Crm.EntityEditorModelFactory==="undefined"){BX.Crm.EntityEditorModelFactory={create:function(t,e,i){if(t===BX.CrmEntityType.enumeration.lead){return BX.Crm.LeadModel.create(e,i)}else if(t===BX.CrmEntityType.enumeration.contact){return BX.Crm.ContactModel.create(e,i)}else if(t===BX.CrmEntityType.enumeration.company){return BX.Crm.CompanyModel.create(e,i)}else if(t===BX.CrmEntityType.enumeration.deal){return BX.Crm.DealModel.create(e,i)}else if(t===BX.CrmEntityType.enumeration.dealrecurring){return BX.Crm.DealRecurringModel.create(e,i)}return BX.Crm.EntityModel.create(e,i)}}}if(typeof BX.Crm.EntityModel==="undefined"){BX.Crm.EntityModel=function(){this._id="";this._settings={};this._data=null;this._lockedFields=null;this._changeNotifier=null;this._lockNotifier=null};BX.Crm.EntityModel.prototype={initialize:function(t,e){this._id=BX.type.isNotEmptyString(t)?t:BX.util.getRandomString(4);this._settings=e?e:{};this._data=BX.prop.getObject(this._settings,"data",{});this._lockedFields={};this._changeNotifier=BX.CrmNotifier.create(this);this._lockNotifier=BX.CrmNotifier.create(this);this.doInitialize()},doInitialize:function(){},getEntityTypeId:function(){return BX.CrmEntityType.enumeration.undefined},getEntityId:function(){return BX.prop.getInteger(this._data,"ID",0)},getOwnerInfo:function(){return{ownerID:this.getEntityId(),ownerType:BX.CrmEntityType.resolveName(this.getEntityTypeId())}},getField:function(t,e){if(e===undefined){e=null}return BX.prop.get(this._data,t,e)},getStringField:function(t,e){if(e===undefined){e=null}return BX.prop.getString(this._data,t,e)},getIntegerField:function(t,e){if(e===undefined){e=null}return BX.prop.getInteger(this._data,t,e)},getNumberField:function(t,e){if(e===undefined){e=null}return BX.prop.getNumber(this._data,t,e)},setField:function(t,e,i){if(this._data.hasOwnProperty(t)&&this._data[t]===e){return}this._data[t]=e;if(!BX.type.isPlainObject(i)){i={}}if(BX.prop.getBoolean(i,"enableNotification",true)){this._changeNotifier.notify([{name:t,originator:BX.prop.get(i,"originator",null)}]);BX.onCustomEvent(window,"Crm.EntityModel.Change",[this,{entityTypeId:this.getEntityTypeId(),entityId:this.getEntityId(),fieldName:t}])}},getData:function(){return this._data},setData:function(t,e){this._data=BX.type.isPlainObject(t)?t:{};if(BX.prop.getBoolean(e,"enableNotification",true)){this._changeNotifier.notify([{forAll:true,originator:BX.prop.get(e,"originator",null)}]);BX.onCustomEvent(window,"Crm.EntityModel.Change",[this,{entityTypeId:this.getEntityTypeId(),entityId:this.getEntityId(),forAll:true}])}},getSchemeField:function(t,e,i){return this.getField(t.getDataStringParam(e,""),i)},getMappedField:function(t,e,i){var n=BX.prop.getString(t,e,"");return n!==""?this.getField(n,i):i},setMappedField:function(t,e,i){var n=BX.prop.getString(t,e,"");if(n!==""){this.setField(n,i)}},save:function(){},lockField:function(t){if(this._lockedFields.hasOwnProperty(t)){return}this._lockedFields[t]=true;this._lockNotifier.notify([{name:name,isLocked:true}])},unlockField:function(t){if(!this._lockedFields.hasOwnProperty(t)){return}delete this._lockedFields[t];this._lockNotifier.notify([{name:name,isLocked:false}])},isFieldLocked:function(t){return this._lockedFields.hasOwnProperty(t)},addChangeListener:function(t){this._changeNotifier.addListener(t)},removeChangeListener:function(t){this._changeNotifier.removeListener(t)},addLockListener:function(t){this._lockNotifier.addListener(t)},removeLockListener:function(t){this._lockNotifier.removeListener(t)},isCaptionEditable:function(){return false},getCaption:function(){return""},setCaption:function(t){},prepareCaptionData:function(t){}};BX.Crm.EntityModel.create=function(t,e){var i=new BX.Crm.EntityModel;i.initialize(t,e);return i}}if(typeof BX.Crm.LeadModel==="undefined"){BX.Crm.LeadModel=function(){BX.Crm.LeadModel.superclass.constructor.apply(this)};BX.extend(BX.Crm.LeadModel,BX.Crm.EntityModel);BX.Crm.LeadModel.prototype.doInitialize=function(){BX.addCustomEvent(window,"Crm.EntityProgress.Change",BX.delegate(this.onEntityProgressChange,this))};BX.Crm.LeadModel.prototype.onEntityProgressChange=function(t,e){if(BX.prop.getInteger(e,"entityTypeId",0)!==this.getEntityTypeId()||BX.prop.getInteger(e,"entityId",0)!==this.getEntityId()){return}var i=BX.prop.getString(e,"currentStepId","");if(i!==this.getField("STATUS_ID","")){this.setField("STATUS_ID",i)}};BX.Crm.LeadModel.prototype.getEntityTypeId=function(){return BX.CrmEntityType.enumeration.lead};BX.Crm.LeadModel.prototype.isCaptionEditable=function(){return true};BX.Crm.LeadModel.prototype.getCaption=function(){var t=this.getField("TITLE");return BX.type.isString(t)?t:""};BX.Crm.LeadModel.prototype.setCaption=function(t){this.setField("TITLE",t)};BX.Crm.LeadModel.prototype.prepareCaptionData=function(t){t["TITLE"]=this.getField("TITLE","")};BX.Crm.LeadModel.create=function(t,e){var i=new BX.Crm.LeadModel;i.initialize(t,e);return i}}if(typeof BX.Crm.ContactModel==="undefined"){BX.Crm.ContactModel=function(){BX.Crm.ContactModel.superclass.constructor.apply(this)};BX.extend(BX.Crm.ContactModel,BX.Crm.EntityModel);BX.Crm.ContactModel.prototype.getEntityTypeId=function(){return BX.CrmEntityType.enumeration.contact};BX.Crm.ContactModel.prototype.getCaption=function(){return this.getField("FORMATTED_NAME","")};BX.Crm.ContactModel.create=function(t,e){var i=new BX.Crm.ContactModel;i.initialize(t,e);return i}}if(typeof BX.Crm.CompanyModel==="undefined"){BX.Crm.CompanyModel=function(){BX.Crm.CompanyModel.superclass.constructor.apply(this)};BX.extend(BX.Crm.CompanyModel,BX.Crm.EntityModel);BX.Crm.CompanyModel.prototype.isCaptionEditable=function(){return true};BX.Crm.CompanyModel.prototype.getEntityTypeId=function(){return BX.CrmEntityType.enumeration.company};BX.Crm.CompanyModel.prototype.getCaption=function(){return this.getField("TITLE","")};BX.Crm.CompanyModel.prototype.setCaption=function(t){this.setField("TITLE",t)};BX.Crm.CompanyModel.prototype.prepareCaptionData=function(t){t["TITLE"]=this.getField("TITLE","")};BX.Crm.CompanyModel.create=function(t,e){var i=new BX.Crm.CompanyModel;i.initialize(t,e);return i}}if(typeof BX.Crm.DealModel==="undefined"){BX.Crm.DealModel=function(){BX.Crm.DealModel.superclass.constructor.apply(this)};BX.extend(BX.Crm.DealModel,BX.Crm.EntityModel);BX.Crm.DealModel.prototype.doInitialize=function(){BX.addCustomEvent(window,"Crm.EntityProgress.Change",BX.delegate(this.onEntityProgressChange,this))};BX.Crm.DealModel.prototype.onEntityProgressChange=function(t,e){if(BX.prop.getInteger(e,"entityTypeId",0)!==this.getEntityTypeId()||BX.prop.getInteger(e,"entityId",0)!==this.getEntityId()){return}var i=BX.prop.getString(e,"currentStepId","");if(i!==this.getField("STAGE_ID","")){this.setField("STAGE_ID",i)}};BX.Crm.DealModel.prototype.getEntityTypeId=function(){return BX.CrmEntityType.enumeration.deal};BX.Crm.DealModel.prototype.isCaptionEditable=function(){return true};BX.Crm.DealModel.prototype.getCaption=function(){var t=this.getField("TITLE");return BX.type.isString(t)?t:""};BX.Crm.DealModel.prototype.setCaption=function(t){this.setField("TITLE",t)};BX.Crm.DealModel.prototype.prepareCaptionData=function(t){t["TITLE"]=this.getField("TITLE","")};BX.Crm.DealModel.create=function(t,e){var i=new BX.Crm.DealModel;i.initialize(t,e);return i}}if(typeof BX.Crm.DealRecurringModel==="undefined"){BX.Crm.DealRecurringModel=function(){BX.Crm.DealRecurringModel.superclass.constructor.apply(this)};BX.extend(BX.Crm.DealRecurringModel,BX.Crm.DealModel);BX.Crm.DealRecurringModel.create=function(t,e){var i=new BX.Crm.DealRecurringModel;i.initialize(t,e);return i}}if(typeof BX.Crm.EditorDragItem==="undefined"){BX.Crm.EditorDragItem=function(){};BX.Crm.EditorDragItem.prototype={getContextId:function(){return""},createGhostNode:function(){return null},processDragStart:function(){},processDragPositionChange:function(t,e){},processDragStop:function(){}}}if(typeof BX.Crm.EditorFieldDragItem==="undefined"){BX.Crm.EditorFieldDragItem=function(){BX.Crm.EditorFieldDragItem.superclass.constructor.apply(this);this._control=null;this._contextId=""};BX.extend(BX.Crm.EditorFieldDragItem,BX.Crm.EditorDragItem);BX.Crm.EditorFieldDragItem.prototype.initialize=function(t){this._control=BX.prop.get(t,"control");if(!this._control){throw"Crm.EditorFieldDragItem: The 'control' parameter is not defined in settings or empty."}this._contextId=BX.prop.getString(t,"contextId","")};BX.Crm.EditorFieldDragItem.prototype.getControl=function(){return this._control};BX.Crm.EditorFieldDragItem.prototype.getContextId=function(){return this._contextId!==""?this._contextId:BX.Crm.EditorFieldDragItem.contextId};BX.Crm.EditorFieldDragItem.prototype.createGhostNode=function(){return this._control.createGhostNode()};BX.Crm.EditorFieldDragItem.prototype.processDragStart=function(){window.setTimeout(function(){BX.Crm.EditorDragContainerController.enable(BX.Crm.EditorFieldDragItem.contextId,true);BX.Crm.EditorDragContainerController.enable(BX.Crm.EditorSectionDragItem.contextId,false);BX.Crm.EditorDragContainerController.refreshAll()});this._control.getWrapper().style.opacity="0.2"};BX.Crm.EditorFieldDragItem.prototype.processDragPositionChange=function(t,e){var i=this._control.getParent();if(!i){return}var n=i.getPosition();if(t.y<n.top){t.y=n.top}if(t.y+e.height>n.bottom){t.y=n.bottom-e.height}if(t.x<n.left){t.x=n.left}if(t.x+e.width>n.right){t.x=n.right-e.width}};BX.Crm.EditorFieldDragItem.prototype.processDragStop=function(){window.setTimeout(function(){BX.Crm.EditorDragContainerController.enable(BX.Crm.EditorSectionDragItem.contextId,true);BX.Crm.EditorDragContainerController.refreshAll()});this._control.getWrapper().style.opacity="1"};BX.Crm.EditorFieldDragItem.contextId="editor_field";BX.Crm.EditorFieldDragItem.create=function(t){var e=new BX.Crm.EditorFieldDragItem;e.initialize(t);return e}}if(typeof BX.Crm.EditorSectionDragItem==="undefined"){BX.Crm.EditorSectionDragItem=function(){BX.Crm.EditorSectionDragItem.superclass.constructor.apply(this);this._control=null};BX.extend(BX.Crm.EditorSectionDragItem,BX.Crm.EditorDragItem);BX.Crm.EditorSectionDragItem.prototype.initialize=function(t){this._control=BX.prop.get(t,"control");if(!this._control){throw"Crm.EditorSectionDragItem: The 'control' parameter is not defined in settings or empty."}};BX.Crm.EditorSectionDragItem.prototype.getControl=function(){return this._control};BX.Crm.EditorSectionDragItem.prototype.getContextId=function(){return BX.Crm.EditorSectionDragItem.contextId};BX.Crm.EditorSectionDragItem.prototype.createGhostNode=function(){return this._control.createGhostNode()};BX.Crm.EditorSectionDragItem.prototype.processDragStart=function(){BX.addClass(document.body,"crm-entity-widgets-drag");window.setTimeout(function(){BX.Crm.EditorDragContainerController.enable(BX.Crm.EditorSectionDragItem.contextId,true);BX.Crm.EditorDragContainerController.enable(BX.Crm.EditorFieldDragItem.contextId,false);BX.Crm.EditorDragContainerController.refreshAll()});this._control.getWrapper().style.opacity="0.2"};BX.Crm.EditorSectionDragItem.prototype.processDragStop=function(){BX.removeClass(document.body,"crm-entity-widgets-drag");window.setTimeout(function(){BX.Crm.EditorDragContainerController.enable(BX.Crm.EditorFieldDragItem.contextId,true);BX.Crm.EditorDragContainerController.refreshAll()});this._control.getWrapper().style.opacity="1"};BX.Crm.EditorSectionDragItem.contextId="editor_section";BX.Crm.EditorSectionDragItem.create=function(t){var e=new BX.Crm.EditorSectionDragItem;e.initialize(t);return e}}if(typeof BX.Crm.EditorDragItemController==="undefined"){BX.Crm.EditorDragItemController=function(){BX.Crm.EditorDragItemController.superclass.constructor.apply(this);this._charge=null;this._preserveDocument=true};BX.extend(BX.Crm.EditorDragItemController,BX.CrmCustomDragItem);BX.Crm.EditorDragItemController.prototype.doInitialize=function(){this._charge=this.getSetting("charge");if(!this._charge){throw"Crm.EditorDragItemController: The 'charge' parameter is not defined in settings or empty."}this._startNotifier=BX.CrmNotifier.create(this);this._stopNotifier=BX.CrmNotifier.create(this);this._ghostOffset={x:0,y:-40}};BX.Crm.EditorDragItemController.prototype.addStartListener=function(t){this._startNotifier.addListener(t)};BX.Crm.EditorDragItemController.prototype.removeStartListener=function(t){this._startNotifier.removeListener(t)};BX.Crm.EditorDragItemController.prototype.addStopListener=function(t){this._stopNotifier.addListener(t)};BX.Crm.EditorDragItemController.prototype.removeStopListener=function(t){this._stopNotifier.removeListener(t)};BX.Crm.EditorDragItemController.prototype.getCharge=function(){return this._charge};BX.Crm.EditorDragItemController.prototype.createGhostNode=function(){if(this._ghostNode){return this._ghostNode}this._ghostNode=this._charge.createGhostNode();document.body.appendChild(this._ghostNode)};BX.Crm.EditorDragItemController.prototype.getGhostNode=function(){return this._ghostNode};BX.Crm.EditorDragItemController.prototype.removeGhostNode=function(){if(this._ghostNode){document.body.removeChild(this._ghostNode);this._ghostNode=null}};BX.Crm.EditorDragItemController.prototype.getContextId=function(){return this._charge.getContextId()};BX.Crm.EditorDragItemController.prototype.getContextData=function(){return{contextId:this._charge.getContextId(),charge:this._charge}};BX.Crm.EditorDragItemController.prototype.processDragStart=function(){BX.Crm.EditorDragItemController.current=this;this._charge.processDragStart();BX.Crm.EditorDragContainerController.refresh(this._charge.getContextId());this._startNotifier.notify([])};BX.Crm.EditorDragItemController.prototype.processDrag=function(t,e){};BX.Crm.EditorDragItemController.prototype.processDragPositionChange=function(t){this._charge.processDragPositionChange(t,BX.pos(this.getGhostNode()))};BX.Crm.EditorDragItemController.prototype.processDragStop=function(){BX.Crm.EditorDragItemController.current=null;this._charge.processDragStop();BX.Crm.EditorDragContainerController.refreshAfter(this._charge.getContextId(),300);this._stopNotifier.notify([])};BX.Crm.EditorDragItemController.current=null;BX.Crm.EditorDragItemController.create=function(t,e){var i=new BX.Crm.EditorDragItemController;i.initialize(t,e);return i}}if(typeof BX.Crm.EditorDragContainer==="undefined"){BX.Crm.EditorDragContainer=function(){};BX.Crm.EditorDragContainer.prototype={getContextId:function(){return""},getPriority:function(){return 100},hasPlaceHolder:function(){return false},createPlaceHolder:function(t){return null},getPlaceHolder:function(){return null},removePlaceHolder:function(){},getChildNodes:function(){return[]},getChildNodeCount:function(){return 0}}}if(typeof BX.Crm.EditorFieldDragContainer==="undefined"){BX.Crm.EditorFieldDragContainer=function(){BX.Crm.EditorFieldDragContainer.superclass.constructor.apply(this);this._section=null;this._context=""};BX.extend(BX.Crm.EditorFieldDragContainer,BX.Crm.EditorDragContainer);BX.Crm.EditorFieldDragContainer.prototype.initialize=function(t){this._section=BX.prop.get(t,"section");if(!this._section){throw"Crm.EditorSectionDragContainer: The 'section' parameter is not defined in settings or empty."}this._context=BX.prop.getString(t,"context","")};BX.Crm.EditorFieldDragContainer.prototype.getSection=function(){return this._section};BX.Crm.EditorFieldDragContainer.prototype.getContextId=function(){return this._context!==""?this._context:BX.Crm.EditorFieldDragItem.contextId};BX.Crm.EditorFieldDragContainer.prototype.getPriority=function(){return 10};BX.Crm.EditorFieldDragContainer.prototype.hasPlaceHolder=function(){return this._section.hasPlaceHolder()};BX.Crm.EditorFieldDragContainer.prototype.createPlaceHolder=function(t){return this._section.createPlaceHolder(t)};BX.Crm.EditorFieldDragContainer.prototype.getPlaceHolder=function(){return this._section.getPlaceHolder()};BX.Crm.EditorFieldDragContainer.prototype.removePlaceHolder=function(){this._section.removePlaceHolder()};BX.Crm.EditorFieldDragContainer.prototype.getChildNodes=function(){var t=[];var e=this._section.getChildren();for(var i=0,n=e.length;i<n;i++){t.push(e[i].getWrapper())}return t};BX.Crm.EditorFieldDragContainer.prototype.getChildNodeCount=function(){return this._section.getChildCount()};BX.Crm.EditorFieldDragContainer.create=function(t){var e=new BX.Crm.EditorFieldDragContainer;e.initialize(t);return e}}if(typeof BX.Crm.EditorSectionDragContainer==="undefined"){BX.Crm.EditorSectionDragContainer=function(){BX.Crm.EditorSectionDragContainer.superclass.constructor.apply(this);this._editor=null};BX.extend(BX.Crm.EditorSectionDragContainer,BX.Crm.EditorDragContainer);BX.Crm.EditorSectionDragContainer.prototype.initialize=function(t){this._editor=BX.prop.get(t,"editor");if(!this._editor){throw"Crm.EditorSectionDragContainer: The 'editor' parameter is not defined in settings or empty."}};BX.Crm.EditorSectionDragContainer.prototype.getEditor=function(){return this._editor};BX.Crm.EditorSectionDragContainer.prototype.getContextId=function(){return BX.Crm.EditorSectionDragItem.contextId};BX.Crm.EditorSectionDragContainer.prototype.getPriority=function(){return 20};BX.Crm.EditorSectionDragContainer.prototype.hasPlaceHolder=function(){return this._editor.hasPlaceHolder()};BX.Crm.EditorSectionDragContainer.prototype.createPlaceHolder=function(t){return this._editor.createPlaceHolder(t)};BX.Crm.EditorSectionDragContainer.prototype.getPlaceHolder=function(){return this._editor.getPlaceHolder()};BX.Crm.EditorSectionDragContainer.prototype.removePlaceHolder=function(){this._editor.removePlaceHolder()};BX.Crm.EditorSectionDragContainer.prototype.getChildNodes=function(){var t=[];var e=this._editor.getControls();for(var i=0,n=e.length;i<n;i++){t.push(e[i].getWrapper())}return t};BX.Crm.EditorSectionDragContainer.prototype.getChildNodeCount=function(){return this._editor.getControlCount()};BX.Crm.EditorSectionDragContainer.create=function(t){var e=new BX.Crm.EditorSectionDragContainer;e.initialize(t);return e}}if(typeof BX.Crm.EditorDragContainerController==="undefined"){BX.Crm.EditorDragContainerController=function(){BX.Crm.EditorDragContainerController.superclass.constructor.apply(this);this._charge=null};BX.extend(BX.Crm.EditorDragContainerController,BX.CrmCustomDragContainer);BX.Crm.EditorDragContainerController.prototype.doInitialize=function(){this._charge=this.getSetting("charge");if(!this._charge){throw"Crm.EditorDragContainerController: The 'charge' parameter is not defined in settings or empty."}};BX.Crm.EditorDragContainerController.prototype.getCharge=function(){return this._charge};BX.Crm.EditorDragContainerController.prototype.createPlaceHolder=function(t){var e=BX.pos(BX.Crm.EditorDragItemController.current.getGhostNode());var i=e.top,n=e.top+40;var r=Math.floor((i+n)/2);var o,s;var a=this._charge.getPlaceHolder();if(a){o=a.getPosition();s=Math.floor((o.top+o.bottom)/2);if(i<=o.bottom&&i>=o.top||n>=o.top&&n<=o.bottom||Math.abs(r-s)<=8){if(!a.isActive()){a.setActive(true)}return}}var l=this._charge.getChildNodes();for(var d=0;d<l.length;d++){o=BX.pos(l[d]);s=Math.floor((o.top+o.bottom)/2);if(i<=o.bottom&&i>=o.top||n>=o.top&&n<=o.bottom||Math.abs(r-s)<=8){this._charge.createPlaceHolder(r-s<=0?d:d+1).setActive(true);return}}this._charge.createPlaceHolder(-1).setActive(true);this.refresh()};BX.Crm.EditorDragContainerController.prototype.removePlaceHolder=function(){if(!this._charge.hasPlaceHolder()){return}if(this._charge.getChildNodeCount()>0){this._charge.removePlaceHolder()}else{this._charge.getPlaceHolder().setActive(false)}this.refresh()};BX.Crm.EditorDragContainerController.prototype.getContextId=function(){return this._charge.getContextId()};BX.Crm.EditorDragContainerController.prototype.getPriority=function(){return this._charge.getPriority()};BX.Crm.EditorDragContainerController.prototype.isAllowedContext=function(t){return t===this._charge.getContextId()};BX.Crm.EditorDragContainerController.refresh=function(t){for(var e in this.items){if(!this.items.hasOwnProperty(e)){continue}var i=this.items[e];if(i.getContextId()===t){i.refresh()}}};BX.Crm.EditorDragContainerController.refreshAfter=function(t,e){e=parseInt(e);if(e>0){window.setTimeout(function(){BX.Crm.EditorDragContainerController.refresh(t)},e)}else{this.refresh(t)}};BX.Crm.EditorDragContainerController.refreshAll=function(){for(var t in this.items){if(!this.items.hasOwnProperty(t)){continue}this.items[t].refresh()}};BX.Crm.EditorDragContainerController.enable=function(t,e){for(var i in this.items){if(!this.items.hasOwnProperty(i)){continue}var n=this.items[i];if(n.getContextId()===t){n.enable(e)}}};BX.Crm.EditorDragContainerController.items={};BX.Crm.EditorDragContainerController.create=function(t,e){var i=new BX.Crm.EditorDragContainerController;i.initialize(t,e);this.items[i.getId()]=i;return i}}if(typeof BX.Crm.EditorDragPlaceholder==="undefined"){BX.Crm.EditorDragPlaceholder=function(){this._settings=null;this._container=null;this._node=null;this._isDragOver=false;this._isActive=false;this._index=-1;this._timeoutId=null};BX.Crm.EditorDragPlaceholder.prototype={initialize:function(t){this._settings=t?t:{};this._container=this.getSetting("container",null);this._isActive=this.getSetting("isActive",false);this._index=parseInt(this.getSetting("index",-1))},getSetting:function(t,e){return this._settings.hasOwnProperty(t)?this._settings[t]:e},getContainer:function(){return this._container},setContainer:function(t){this._container=t},isDragOver:function(){return this._isDragOver},isActive:function(){return this._isActive},setActive:function(t,e){if(this._timeoutId!==null){window.clearTimeout(this._timeoutId);this._timeoutId=null}e=parseInt(e);if(e>0){var i=this;window.setTimeout(function(){if(i._timeoutId===null)return;i._timeoutId=null;i.setActive(t,0)},e);return}t=!!t;if(this._isActive===t){return}this._isActive=t;if(this._node){}},getIndex:function(){return this._index},prepareNode:function(){return null},layout:function(){this._node=this.prepareNode();var t=this.getSetting("anchor",null);if(t){this._container.insertBefore(this._node,t)}else{this._container.appendChild(this._node)}BX.bind(this._node,"dragover",BX.delegate(this._onDragOver,this));BX.bind(this._node,"dragleave",BX.delegate(this._onDragLeave,this))},clearLayout:function(){if(this._node){this._node.style.height=0;setTimeout(BX.proxy(function(){this._node=BX.remove(this._node)},this),100)}},getPosition:function(){return BX.pos(this._node)},_onDragOver:function(t){t=t||window.event;this._isDragOver=true;return BX.eventReturnFalse(t)},_onDragLeave:function(t){t=t||window.event;this._isDragOver=false;return BX.eventReturnFalse(t)}}}if(typeof BX.Crm.EditorDragFieldPlaceholder==="undefined"){BX.Crm.EditorDragFieldPlaceholder=function(){};BX.extend(BX.Crm.EditorDragFieldPlaceholder,BX.Crm.EditorDragPlaceholder);BX.Crm.EditorDragFieldPlaceholder.prototype.prepareNode=function(){return BX.create("div",{attrs:{className:"crm-entity-widget-content-block-place"}})};BX.Crm.EditorDragFieldPlaceholder.create=function(t){var e=new BX.Crm.EditorDragFieldPlaceholder;e.initialize(t);return e}}if(typeof BX.Crm.EditorDragSectionPlaceholder==="undefined"){BX.Crm.EditorDragSectionPlaceholder=function(){};BX.extend(BX.Crm.EditorDragSectionPlaceholder,BX.Crm.EditorDragPlaceholder);BX.Crm.EditorDragSectionPlaceholder.prototype.prepareNode=function(){return BX.create("div",{attrs:{className:"crm-entity-card-widget crm-entity-card-widget-place"}})};BX.Crm.EditorDragSectionPlaceholder.create=function(t){var e=new BX.Crm.EditorDragSectionPlaceholder;e.initialize(t);return e}}if(typeof BX.Crm.EntityUserFieldType==="undefined"){BX.Crm.EntityUserFieldType={string:"string",integer:"integer",double:"double",boolean:"boolean",money:"money",date:"date",datetime:"datetime",enumeration:"enumeration",file:"file",url:"url"}}if(typeof BX.Crm.EntityUserFieldManager==="undefined"){BX.Crm.EntityUserFieldManager=function(){this._id="";this._settings={};this._entityId=0;this._fieldEntityId="";this._enableCreation=false;this._creationSignature="";this._creationUrl="";this._activeFields={};this._validationResult=null;this._validationPromise=null};BX.Crm.EntityUserFieldManager.prototype={initialize:function(t,e){this._id=BX.type.isNotEmptyString(t)?t:BX.util.getRandomString(4);this._settings=e?e:{};this._entityId=BX.prop.getInteger(this._settings,"entityId",0);this._fieldEntityId=BX.prop.getString(this._settings,"fieldEntityId","");this._enableCreation=BX.prop.getBoolean(this._settings,"enableCreation",false);this._creationSignature=BX.prop.getString(this._settings,"creationSignature","");this._creationPageUrl=BX.prop.getString(this._settings,"creationPageUrl","")},isCreationEnabled:function(){return this._enableCreation},isModificationEnabled:function(){return this._enableCreation},getDefaultFieldLabel:function(t){if(t==="string"){return this.getMessage("stringLabel")}else if(t==="double"){return this.getMessage("doubleLabel")}else if(t==="money"){return this.getMessage("moneyLabel")}else if(t==="datetime"){return this.getMessage("datetimeLabel")}else if(t==="enumeration"){return this.getMessage("enumerationLabel")}else if(t==="file"){return this.getMessage("fileLabel")}return this.getMessage("label")},getMessage:function(t){var e=BX.Crm.EntityUserFieldManager.messages;return e.hasOwnProperty(t)?e[t]:t},getAdditionalTypeList:function(){return BX.Crm.EntityUserFieldManager.additionalTypeList},getTypeInfos:function(){var t=[];t.push({name:"string",title:this.getMessage("stringTitle"),legend:this.getMessage("stringLegend")});t.push({name:"double",title:this.getMessage("doubleTitle"),legend:this.getMessage("doubleLegend")});t.push({name:"boolean",title:this.getMessage("booleanTitle"),legend:this.getMessage("booleanLegend")});t.push({name:"datetime",title:this.getMessage("datetimeTitle"),legend:this.getMessage("datetimeLegend")});t.push({name:"money",title:this.getMessage("moneyTitle"),legend:this.getMessage("moneyLegend")});t.push({name:"url",title:this.getMessage("urlTitle"),legend:this.getMessage("urlLegend")});t.push({name:"address",title:this.getMessage("addressTitle"),legend:this.getMessage("addressLegend")});t.push({name:"enumeration",title:this.getMessage("enumerationTitle"),legend:this.getMessage("enumerationLegend")});t.push({name:"file",title:this.getMessage("fileTitle"),legend:this.getMessage("fileLegend")});var e=this.getAdditionalTypeList();for(var i=0;i<e.length;i++){t.push({name:e[i].USER_TYPE_ID,title:e[i].TITLE,legend:e[i].LEGEND})}t.push({name:"custom",title:this.getMessage("customTitle"),legend:this.getMessage("customLegend")});return t},getCreationPageUrl:function(){return this._creationPageUrl},createField:function(t,e){if(!this._enableCreation){return}var i=BX.prop.getString(t,"USER_TYPE_ID","");if(i===""){i=BX.Crm.EntityUserFieldType.string}if(!BX.type.isNotEmptyString(t["EDIT_FORM_LABEL"])){t["EDIT_FORM_LABEL"]=this.getDefaultFieldLabel(i)}if(!BX.type.isNotEmptyString(t["LIST_COLUMN_LABEL"])){t["LIST_COLUMN_LABEL"]=t["EDIT_FORM_LABEL"]}this.addFieldLabel("EDIT_FORM_LABEL",t["EDIT_FORM_LABEL"],t);this.addFieldLabel("LIST_COLUMN_LABEL",t["LIST_COLUMN_LABEL"],t);var n=new BX.Promise;var r=function(t){n.fulfill(t)};if(!BX.type.isNotEmptyString(t["FIELD"])){t["FIELD"]="UF_CRM_"+(new Date).getTime().toString()}t["ENTITY_ID"]=this._fieldEntityId;t["SIGNATURE"]=this._creationSignature;if(!BX.type.isNotEmptyString(t["MULTIPLE"])){t["MULTIPLE"]="N"}if(!BX.type.isNotEmptyString(t["MANDATORY"])){t["MANDATORY"]="N"}if(i===BX.Crm.EntityUserFieldType.file){t["SHOW_FILTER"]="N";t["SHOW_IN_LIST"]="N"}else{t["SHOW_FILTER"]="Y";t["SHOW_IN_LIST"]="Y"}if(i===BX.Crm.EntityUserFieldType.enumeration){if(!t.hasOwnProperty("SETTINGS")){t["SETTINGS"]={}}t["SETTINGS"]["DISPLAY"]="UI"}if(i===BX.Crm.EntityUserFieldType.boolean){if(!t.hasOwnProperty("SETTINGS")){t["SETTINGS"]={}}t["SETTINGS"]["LABEL_CHECKBOX"]=t["EDIT_FORM_LABEL"]}if(i===BX.Crm.EntityUserFieldType.double){if(!t.hasOwnProperty("SETTINGS")){t["SETTINGS"]={}}t["SETTINGS"]["PRECISION"]=2}if(e===BX.Crm.EntityEditorMode.view){BX.Main.UF.ViewManager.add({FIELDS:[t]},r)}else{BX.Main.UF.EditManager.add({FIELDS:[t]},r)}return n},updateField:function(t,e){t["ENTITY_ID"]=this._fieldEntityId;t["SIGNATURE"]=this._creationSignature;var i=new BX.Promise;var n=function(t){i.fulfill(t)};if(e===BX.Crm.EntityEditorMode.view){BX.Main.UF.ViewManager.update({FIELDS:[t]},n)}else{BX.Main.UF.EditManager.update({FIELDS:[t]},n)}return i},resolveFieldName:function(t){return BX.prop.getString(t,"FIELD","")},addFieldLabel:function(t,e,i){var n=BX.prop.getArray(this._settings,"languages",[]);if(n.length===0){i[t]=e;return}i[t]={};for(var r=0,o=n.length;r<o;r++){var s=n[r];i[t][s["LID"]]=e}},prepareSchemeElementSettings:function(t){var e=BX.prop.getString(t,"FIELD","");if(e===""){return null}if(BX.prop.getString(t,"USER_TYPE_ID","")===""){t["USER_TYPE_ID"]="string"}if(BX.prop.getString(t,"ENTITY_ID","")===""){t["ENTITY_ID"]=this._fieldEntityId}if(BX.prop.getInteger(t,"ENTITY_VALUE_ID",0)<=0){t["ENTITY_VALUE_ID"]=this._entityId}return{name:e,originalTitle:BX.prop.getString(t,"EDIT_FORM_LABEL",e),title:BX.prop.getString(t,"EDIT_FORM_LABEL",e),type:"userField",required:BX.prop.getString(t,"MANDATORY","N")==="Y",data:{fieldInfo:t}}},createSchemeElement:function(t){return BX.Crm.EntitySchemeElement.create(this.prepareSchemeElementSettings(t))},updateSchemeElement:function(t,e){var i=this.prepareSchemeElementSettings(e);i["title"]=t.getTitle();t.initialize(i)},registerActiveField:function(t){var e=t.getName();this._activeFields[e]=t;BX.Main.UF.EditManager.registerField(e,t.getFieldInfo(),t.getFieldNode())},unregisterActiveField:function(t){var e=t.getName();if(this._activeFields.hasOwnProperty(e)){delete this._activeFields[e]}BX.Main.UF.EditManager.unRegisterField(e)},validate:function(t){var e=[];for(var i in this._activeFields){if(this._activeFields.hasOwnProperty(i)){e.push(i)}}if(e.length>0){this._validationResult=t;BX.Main.UF.EditManager.validate(e,BX.delegate(this.onValidationComplete,this))}else{window.setTimeout(BX.delegate(function(){if(this._validationPromise){this._validationPromise.fulfill();this._validationPromise=null}},this),0)}this._validationPromise=new BX.Promise;return this._validationPromise},onValidationComplete:function(t){var e;for(e in this._activeFields){if(this._activeFields.hasOwnProperty(e)){this._activeFields[e].clearError()}}for(e in t){if(!t.hasOwnProperty(e)){continue}if(this._activeFields.hasOwnProperty(e)){var i=this._activeFields[e];i.showError(t[e]);this._validationResult.addError(BX.Crm.EntityValidationError.create({field:i}))}}if(this._validationPromise){this._validationPromise.fulfill()}this._validationResult=null;this._validationPromise=null}};if(typeof BX.Crm.EntityUserFieldManager.messages==="undefined"){BX.Crm.EntityUserFieldManager.messages={}}BX.Crm.EntityUserFieldManager.items={};BX.Crm.EntityUserFieldManager.create=function(t,e){var i=new BX.Crm.EntityUserFieldManager;i.initialize(t,e);this.items[t]=i;return i}}if(typeof BX.Crm.EntityUserFieldLayoutLoader==="undefined"){BX.Crm.EntityUserFieldLayoutLoader=function(){this._id="";this._settings={};this._mode=BX.Crm.EntityEditorMode.view;this._enableBatchMode=true;this._items=[]};BX.Crm.EntityUserFieldLayoutLoader.prototype={initialize:function(t,e){this._id=BX.type.isNotEmptyString(t)?t:BX.util.getRandomString(4);this._settings=e?e:{};this._mode=BX.prop.getInteger(this._settings,"mode",BX.Crm.EntityEditorMode.view);this._enableBatchMode=BX.prop.getBoolean(this._settings,"enableBatchMode",true)},addItem:function(t){this._items.push(t)},run:function(){if(!this._enableBatchMode){this.startRequest()}},runBatch:function(){if(this._enableBatchMode){this.startRequest()}},startRequest:function(){if(this._items.length===0){return}var t=[];for(var e=0,i=this._items.length;e<i;e++){if(BX.prop.getString(this._items[e],"name","")!==""){t.push(BX.prop.getObject(this._items[e],"field",{}))}}if(t.length===0){return}var n={FIELDS:t,FORM:this._id,CONTEXT:"CRM_EDITOR"};if(this._mode===BX.Crm.EntityEditorMode.view){BX.Main.UF.Manager.getView(n,BX.delegate(this.onRequestComplete,this))}else{BX.Main.UF.Manager.getEdit(n,BX.delegate(this.onRequestComplete,this))}},onRequestComplete:function(t){for(var e=0,i=this._items.length;e<i;e++){var n=this._items[e];var r=BX.prop.getString(n,"name","");var o=BX.prop.getFunction(n,"callback",null);if(r!==""&&o!==null){o(BX.prop.getObject(t,r,{}))}}}};BX.Crm.EntityUserFieldLayoutLoader.create=function(t,e){var i=new BX.Crm.EntityUserFieldLayoutLoader;i.initialize(t,e);return i}}if(typeof BX.Crm.EntityEditorDupManager==="undefined"){BX.Crm.EntityEditorDupManager=function(){this._id="";this._settings=null;this._groupInfos=null;this._isEnabled=false;this._serviceUrl="";this._entityTypeName="";this._form=null;this._controller=null};BX.Crm.EntityEditorDupManager.prototype={initialize:function(t,e){this._id=BX.type.isNotEmptyString(t)?t:BX.util.getRandomString(4);this._settings=e?e:{};this._isEnabled=BX.prop.getBoolean(this._settings,"enabled","");if(!this._isEnabled){return}this._groupInfos=BX.prop.getObject(this._settings,"groups",{});this._serviceUrl=BX.prop.getString(this._settings,"serviceUrl","");this._entityTypeName=BX.prop.getString(this._settings,"entityTypeName","");this._form=BX.prop.get(this._settings,"form",null);this._controller=BX.CrmDupController.create(this._id,{serviceUrl:this._serviceUrl,entityTypeName:this._entityTypeName,form:this._form,searcSummaryPosition:"right"})},isEnabled:function(){return this._isEnabled},getGroupInfo:function(t){return this._groupInfos.hasOwnProperty(t)?this._groupInfos[t]:null},getGroup:function(t){return this._isEnabled?this._controller.getGroup(t):null},ensureGroupRegistered:function(t){if(!this._isEnabled){return null}var e=this.getGroup(t);if(!e){e=this._controller.registerGroup(t,this.getGroupInfo(t))}return e},registerField:function(t){if(!this._isEnabled){return null}var e=BX.prop.getString(t,"groupId","");var i=BX.prop.getObject(t,"field",null);if(e===""||!i){return null}var n=this.ensureGroupRegistered(e);if(!n){return null}return n.registerField(i)},unregisterField:function(t){if(!this._isEnabled){return}var e=BX.prop.getString(t,"groupId","");var i=BX.prop.getObject(t,"field",null);if(e===""||!i){return}var n=this.getGroup(e);if(!n){return}n.unregisterField(i)}};BX.Crm.EntityEditorDupManager.create=function(t,e){var i=new BX.Crm.EntityEditorDupManager;i.initialize(t,e);return i}}if(typeof BX.Crm.EntityEditorVisibilityPolicy==="undefined"){BX.Crm.EntityEditorVisibilityPolicy={always:0,view:1,edit:2,parse:function(t){t=t.toLowerCase();if(t==="view"){return this.view}else if(t==="edit"){return this.edit}return this.always},checkVisibility:function(t){var e=t.getMode();var i=t.getVisibilityPolicy();if(i===this.view){return e===BX.Crm.EntityEditorMode.view}else if(i===this.edit){return e===BX.Crm.EntityEditorMode.edit}return true}}}if(typeof BX.Crm.EntityEditorControl==="undefined"){BX.Crm.EntityEditorControl=function(){this._id="";this._settings={};this._editor=null;this._parent=null;this._mode=BX.Crm.EntityEditorMode.intermediate;this._model=null;this._schemeElement=null;this._container=null;this._wrapper=null;this._dragButton=null;this._dragItem=null;this._hasLayout=false;this._isValidLayout=false;this._isVisible=true;this._isActive=false;this._isChanged=false;this._isSchemeChanged=false;this._changeHandler=BX.delegate(this.onChange,this);this._contextMenuButton=null;this._isContextMenuOpened=false;this._draggableContextId=""};BX.Crm.EntityEditorControl.prototype={initialize:function(t,e){this._id=BX.type.isNotEmptyString(t)?t:BX.util.getRandomString(4);this._settings=e?e:{};this._editor=BX.prop.get(this._settings,"editor",null);this._parent=BX.prop.get(this._settings,"parent",null);this._model=BX.prop.get(this._settings,"model",null);this._schemeElement=BX.prop.get(this._settings,"schemeElement",null);this._container=BX.prop.getElementNode(this._settings,"container",null);var i=BX.prop.getInteger(this._settings,"mode",BX.Crm.EntityEditorMode.view);if(i===BX.Crm.EntityEditorMode.edit&&this._schemeElement&&!this._schemeElement.isEditable()){i=BX.Crm.EntityEditorMode.view}this._mode=i;this.doInitialize();this.bindModel()},doInitialize:function(){},bindModel:function(){},unbindModel:function(){},getMessage:function(t){var e=BX.Crm.EntityEditorControl.messages;return e.hasOwnProperty(t)?e[t]:t},getId:function(){return this._id},getEditor:function(){return this._editor},setEditor:function(t){this._editor=t},getParent:function(){return this._parent},setParent:function(t){this._parent=t},getChildCount:function(){return 0},getChildById:function(t){return null},editChild:function(t){},removeChild:function(t){},getChildren:function(){return[]},editChildConfiguration:function(t){},getType:function(){return this._schemeElement?this._schemeElement.getType():""},getName:function(){return this._schemeElement?this._schemeElement.getName():""},getTitle:function(){if(!this._schemeElement){return""}var t=this._schemeElement.getTitle();if(t===""){t=this._schemeElement.getName()}return t},setTitle:function(t){if(!this._schemeElement){return}this._schemeElement.setTitle(t);this.refreshTitleLayout()},getData:function(){return this._schemeElement?this._schemeElement.getData():{}},isVisible:function(){return this._isVisible&&BX.Crm.EntityEditorVisibilityPolicy.checkVisibility(this)},setVisible:function(t){t=!!t;if(this._isVisible===t){return}this._isVisible=t;if(this._hasLayout){this._wrapper.style.display=this._isVisible?"":"none"}},isActive:function(){return this._isActive},setActive:function(t){t=!!t;if(this._isActive===t){return}this._isActive=t;this.doSetActive()},doSetActive:function(){},isEditable:function(){return this._schemeElement&&this._schemeElement.isEditable()},isRequired:function(){return this._schemeElement&&this._schemeElement.isRequired()},isRequiredConditionally:function(){return this._schemeElement&&this._schemeElement.isRequiredConditionally()},isHeading:function(){return this._schemeElement&&this._schemeElement.isHeading()},isReadOnly:function(){return this._editor&&this._editor.isReadOnly()},getVisibilityPolicy:function(){return this._schemeElement&&this._schemeElement.getVisibilityPolicy()},getEditPriority:function(){return BX.Crm.EntityEditorPriority.normal},getPosition:function(){return BX.pos(this._wrapper)},focus:function(){},save:function(){},validate:function(t){return true},rollback:function(){},isDragEnabled:function(){return this._parent?this._parent.isDragEnabled():this._mode===BX.Crm.EntityEditorMode.edit},isContextMenuEnabled:function(){return this._parent?this._parent.isContextMenuEnabled():this._mode===BX.Crm.EntityEditorMode.edit},getMode:function(){return this._mode},setMode:function(t,e){if(this._mode===t||!this.canChangeMode(t)){return}this.onBeforeModeChange();this._mode=t;this.doSetMode(this._mode);this.onAfterModeChange();e=!!e;if(e){if(this._parent){this._parent.processChildControlModeChange(this)}else if(this._editor){this._editor.processControlModeChange(this)}}this._isSchemeChanged=false;this._isChanged=false;if(this._hasLayout){this._isValidLayout=false}},onBeforeModeChange:function(){},doSetMode:function(t){},onAfterModeChange:function(){},canChangeMode:function(t){if(t===BX.Crm.EntityEditorMode.edit){return this.isEditable()}return true},isModeToggleEnabled:function(){return this._editor.isModeToggleEnabled()},toggleMode:function(t){if(!this.isModeToggleEnabled()){return false}this.setMode(this._mode===BX.Crm.EntityEditorMode.view?BX.Crm.EntityEditorMode.edit:BX.Crm.EntityEditorMode.view,t);this.refreshLayout();return true},isEditInViewEnabled:function(){return this._editor&&this._editor.isEditInViewEnabled()&&this._schemeElement&&this._schemeElement.getDataBooleanParam("enableEditInView",false)},getContextId:function(){return this._editor?this._editor.getContextId():""},getExternalContextId:function(){return this._editor?this._editor.getExternalContextId():""},processAvailableSchemeElementsChange:function(){},processChildControlModeChange:function(t){},processChildControlChange:function(t,e){},isChanged:function(){return this._isChanged},markAsChanged:function(t){if(this._isChanged||this._mode===BX.Crm.EntityEditorMode.view){return}this._isChanged=true;if(typeof t==="undefined"){t={}}this.notifyChanged(t)},isSchemeChanged:function(){return this._isSchemeChanged},markSchemeAsChanged:function(){if(this._isSchemeChanged){return}this._isSchemeChanged=true},saveScheme:function(){if(!this._isSchemeChanged){return}this.commitSchemeChanges();return this._editor.saveScheme()},commitSchemeChanges:function(){if(!this._isSchemeChanged){return}this._editor.updateSchemeElement(this._schemeElement);this._isSchemeChanged=false},getContainer:function(){return this._container},setContainer:function(t){this._container=t;if(this._hasLayout){this._hasLayout=false}},getWrapper:function(){return this._wrapper},getModel:function(){return this._model},getSchemeElement:function(){return this._schemeElement},hasScheme:function(){return!!this._schemeElement},layout:function(t){},registerLayout:function(t){if(!this._wrapper){return}this._wrapper.setAttribute("data-cid",this.getId());if(typeof t==="undefined"){t={}}if(!BX.prop.getBoolean(t,"preservePosision",false)){var e=BX.prop.getElementNode(t,"anchor",null);if(e){BX.addClass(this._wrapper,"crm-entity-widget-content-hide");this._container.insertBefore(this._wrapper,e);setTimeout(BX.delegate(function(){BX.removeClass(this._wrapper,"crm-entity-widget-content-hide");BX.addClass(this._wrapper,"crm-entity-widget-content-show")},this),1);setTimeout(BX.delegate(function(){BX.removeClass(this._wrapper,"crm-entity-widget-content-show")},this),310)}else{this._container.appendChild(this._wrapper)}}if(!this.isVisible()){this._wrapper.style.display="none"}this._isValidLayout=true},refreshLayout:function(t){if(!this._hasLayout){return}this.clearLayout({preservePosision:true});if(!BX.type.isPlainObject(t)){t={}}t["preservePosision"]=true;this.layout(t)},clearLayout:function(t){},refreshTitleLayout:function(){},release:function(){},hide:function(){if(this.isRequired()||this.isRequiredConditionally()){return}if(this._parent){BX.addClass(this._wrapper,"crm-entity-widget-content-hide");setTimeout(BX.delegate(function(){this._parent.removeChild(this)},this),350)}else{this.clearLayout()}},prepareSaveData:function(t){},onBeforeSubmit:function(){},onHideButtonClick:function(t){this.hide()},onContextButtonCliick:function(t){if(!this._isContextMenuOpened){this.openContextMenu()}else{this.closeContextMenu()}},openContextMenu:function(){if(this._isContextMenuOpened){return}var t=this.prepareContextMenuItems();if(BX.type.isArray(t)&&t.length>0){var e=BX.delegate(this.onContextMenuItemSelect,this);for(var i=0,n=t.length;i<n;i++){if(typeof t[i]["onclick"]==="undefined"){t[i]["onclick"]=e}}BX.PopupMenu.show(this._id,this._contextMenuButton,t,{angle:false,events:{onPopupShow:BX.delegate(this.onContextMenuShow,this),onPopupClose:BX.delegate(this.onContextMenuClose,this)}})}},prepareContextMenuItems:function(){return[]},processContextMenuCommand:function(t){},closeContextMenu:function(){var t=BX.PopupMenu.getMenuById(this._id);if(t){t.popupWindow.close()}},onContextMenuShow:function(){this._isContextMenuOpened=true},onContextMenuClose:function(){BX.PopupMenu.destroy(this._id);this._isContextMenuOpened=false},onContextMenuItemSelect:function(t,e){this.processContextMenuCommand(BX.prop.getString(e,"value"));this.closeContextMenu()},onChange:function(t){this.markAsChanged()},notifyChanged:function(t){if(typeof t==="undefined"){t={}}if(this._parent){this._parent.processChildControlChange(this,t)}else if(this._editor){this._editor.processControlChange(this,t)}},getDraggableContextId:function(){return this._draggableContextId},setDraggableContextId:function(t){this._draggableContextId=t},createDragButton:function(){return this._dragButton},createHideButton:function(){var t=!this.isRequired()&&!this.isRequiredConditionally();var e=BX.create("div",{props:{className:"crm-entity-widget-content-block-hide-btn",title:this.getHideButtonHint(t)}});if(t){BX.bind(e,"click",BX.delegate(this.onHideButtonClick,this))}return e},createContextMenuButton:function(){this._contextMenuButton=BX.create("div",{props:{className:"crm-entity-widget-content-block-context-menu"},events:{click:BX.delegate(this.onContextButtonCliick,this)}});return this._contextMenuButton},createGhostNode:function(){return null},getHideButtonHint:function(t){return""}};if(typeof BX.Crm.EntityEditorControl.messages==="undefined"){BX.Crm.EntityEditorControl.messages={}}}if(typeof BX.Crm.EntityEditorField==="undefined"){BX.Crm.EntityEditorField=function(){BX.Crm.EntityEditorField.superclass.constructor.apply(this);this._viewDoubleClickHandler=BX.delegate(this.onViewDoubleClick,this);this._titleWrapper=null;this._validators=null;this._hasError=false;this._errorContainer=null};BX.extend(BX.Crm.EntityEditorField,BX.Crm.EntityEditorControl);BX.Crm.EntityEditorField.prototype.configure=function(){if(this._parent){this._parent.editChildConfiguration(this)}};BX.Crm.EntityEditorField.prototype.getDuplicateControlConfig=function(){return this._schemeElement?this._schemeElement.getDataObjectParam("duplicateControl",null):null};BX.Crm.EntityEditorField.prototype.markAsChanged=function(t){BX.Crm.EntityEditorField.superclass.markAsChanged.apply(this,arguments);if(this.hasError()){this.clearError()}var e=this.getValidators();for(var i=0,n=e.length;i<n;i++){e[i].processFieldChange(this)}};BX.Crm.EntityEditorField.prototype.bindModel=function(){this._model.addChangeListener(BX.delegate(this.onModelChange,this));this._model.addLockListener(BX.delegate(this.onModelLock,this))};BX.Crm.EntityEditorField.prototype.onModelChange=function(t,e){this.processModelChange(e)};BX.Crm.EntityEditorField.prototype.onModelLock=function(t,e){this.processModelLock(e)};BX.Crm.EntityEditorField.prototype.processModelChange=function(t){};BX.Crm.EntityEditorField.prototype.processModelLock=function(t){};BX.Crm.EntityEditorField.prototype.getMessage=function(t){var e=BX.Crm.EntityEditorField.messages;return e.hasOwnProperty(t)?e[t]:BX.Crm.EntityEditorField.superclass.getMessage.apply(this,arguments)};BX.Crm.EntityEditorField.prototype.getHideButtonHint=function(t){return this.getMessage(t?"hideButtonHint":"hideButtonDisabledHint")};BX.Crm.EntityEditorField.prototype.createTitleNode=function(t){this._titleWrapper=BX.create("div",{attrs:{className:"crm-entity-widget-content-block-title"}});if(!BX.type.isNotEmptyString(t)){t=this.getTitle()}this._titleWrapper.appendChild(document.createTextNode(t));var e=this.createTitleMarker();if(e){this._titleWrapper.appendChild(e)}return this._titleWrapper};BX.Crm.EntityEditorField.prototype.refreshTitleLayout=function(){if(!this._titleWrapper){return}BX.cleanNode(this._titleWrapper);this._titleWrapper.appendChild(document.createTextNode(this.getTitle()));var t=this.createTitleMarker();if(t){this._titleWrapper.appendChild(t)}};BX.Crm.EntityEditorField.prototype.createTitleMarker=function(){if(this._mode===BX.Crm.EntityEditorMode.edit){if(this.isRequired()){return BX.create("span",{style:{color:"#f00"},text:"*"})}else if(this.isRequiredConditionally()){return BX.create("span",{text:"*"})}}return null};BX.Crm.EntityEditorField.prototype.createDragButton=function(){if(!this._dragButton){this._dragButton=BX.create("div",{props:{className:"crm-entity-widget-content-block-draggable-btn-container"},children:[BX.create("div",{props:{className:"crm-entity-widget-content-block-draggable-btn"}})]})}return this._dragButton};BX.Crm.EntityEditorField.prototype.createGhostNode=function(){if(!this._wrapper){return null}var t=BX.pos(this._wrapper);var e=this._wrapper.cloneNode(true);BX.addClass(e,"crm-entity-widget-content-block-drag");e.style.width=t.width+"px";e.style.height=t.height+"px";return e};BX.Crm.EntityEditorField.prototype.clearLayout=function(t){if(!this._hasLayout){return}BX.Crm.EntityEditorField.superclass.clearLayout.apply(this,arguments);if(!BX.type.isPlainObject(t)){t={}}this.releaseDragDropAbilities();if(BX.prop.getBoolean(t,"preservePosision",false)){this._wrapper=BX.cleanNode(this._wrapper);if(this.hasError()){this.clearError()}}else{this._wrapper=BX.remove(this._wrapper)}this.doClearLayout(t);this._hasLayout=false};BX.Crm.EntityEditorField.prototype.doClearLayout=function(t){};BX.Crm.EntityEditorField.prototype.registerLayout=function(t){if(this._mode===BX.Crm.EntityEditorMode.view){BX.addClass(this._wrapper,"crm-entity-widget-content-block-click-editable");BX.bind(this._wrapper,"dblclick",this._viewDoubleClickHandler)}BX.Crm.EntityEditorField.superclass.registerLayout.apply(this,arguments)};BX.Crm.EntityEditorField.prototype.getEditPriority=function(){return!this.hasValue()&&(this.isRequired()||this.isRequiredConditionally())?BX.Crm.EntityEditorPriority.high:BX.Crm.EntityEditorPriority.normal};BX.Crm.EntityEditorField.prototype.checkIfNotEmpty=function(t){return BX.util.trim(t)!==""};BX.Crm.EntityEditorField.prototype.hasValue=function(){return this.checkIfNotEmpty(this.getValue())};BX.Crm.EntityEditorField.prototype.getValue=function(t){if(!this._model){return""}return this._model.getField(this.getName(),t!==undefined?t:"")};BX.Crm.EntityEditorField.prototype.getStringValue=function(t){return this._model?this._model.getStringField(this.getName(),t):""};BX.Crm.EntityEditorField.prototype.getRuntimeValue=function(){return""};BX.Crm.EntityEditorField.prototype.prepareSaveData=function(t){t[this.getName()]=this.getValue()};BX.Crm.EntityEditorField.prototype.findValidatorIndex=function(t){if(!this._validators){return-1}for(var e=0,i=this._validators.length;e<i;e++){if(this._validators[e]===t){return e}}return-1};BX.Crm.EntityEditorField.prototype.addValidator=function(t){if(t&&this.findValidatorIndex(t)<0){if(!this._validators){this._validators=[]}this._validators.push(t)}};BX.Crm.EntityEditorField.prototype.removeValidator=function(t){if(!this._validators||!t){return}var e=this.findValidatorIndex(t);if(e>=0){this._validators.splice(e,1)}};BX.Crm.EntityEditorField.prototype.getValidators=function(){return this._validators?this._validators:[]};BX.Crm.EntityEditorField.prototype.hasValidators=function(){return this._validators&&this._validators.length>0};BX.Crm.EntityEditorField.prototype.executeValidators=function(t){if(!this._validators){return true}var e=true;for(var i=0,n=this._validators.length;i<n;i++){if(!this._validators[i].validate(t)){e=false}}return e};BX.Crm.EntityEditorField.prototype.hasError=function(){return this._hasError};BX.Crm.EntityEditorField.prototype.showError=function(t,e){if(!this._errorContainer){this._errorContainer=BX.create("div",{attrs:{className:"crm-entity-widget-content-error-text"}})}this._errorContainer.innerHTML=t;this._wrapper.appendChild(this._errorContainer);BX.addClass(this._wrapper,"crm-entity-widget-content-error");this._hasError=true};BX.Crm.EntityEditorField.prototype.showRequiredFieldError=function(t){this.showError(this.getMessage("requiredFieldError"),t)};BX.Crm.EntityEditorField.prototype.clearError=function(){if(!this._hasError){return}if(this._errorContainer&&this._errorContainer.parentNode){this._errorContainer.parentNode.removeChild(this._errorContainer)}BX.removeClass(this._wrapper,"crm-entity-widget-content-error");this._hasError=false};BX.Crm.EntityEditorField.prototype.scrollAnimate=function(){var t=this._wrapper;window.setTimeout(function(){new BX.easing({duration:300,start:{position:document.body.scrollTop},finish:{position:BX.pos(t).top-10},step:function(t){document.body.scrollTop=t.position}}).animate()},0)};BX.Crm.EntityEditorField.prototype.initializeDragDropAbilities=function(){if(this._dragItem){return}this._dragItem=BX.Crm.EditorDragItemController.create("field_"+this.getId(),{charge:BX.Crm.EditorFieldDragItem.create({control:this,contextId:this._draggableContextId}),node:this.createDragButton(),showControlInDragMode:false,ghostOffset:{x:0,y:0}})};BX.Crm.EntityEditorField.prototype.releaseDragDropAbilities=function(){if(this._dragItem){this._dragItem.release();this._dragItem=null}};BX.Crm.EntityEditorField.prototype.onViewDoubleClick=function(t){if(this._parent){this._parent.editChild(this)}};BX.Crm.EntityEditorField.prototype.prepareContextMenuItems=function(){var t=[];if(!this.isRequired()&&!this.isRequiredConditionally()){t.push({text:this.getMessage("hide"),value:"hide"})}t.push({text:this.getMessage("configure"),value:"configure"});return t};BX.Crm.EntityEditorField.prototype.processContextMenuCommand=function(t){if(t==="hide"){this.hide()}else if(t==="configure"){this.configure()}};if(typeof BX.Crm.EntityEditorField.messages==="undefined"){BX.Crm.EntityEditorField.messages={}}}if(typeof BX.Crm.EntityEditorSection==="undefined"){BX.Crm.EntityEditorSection=function(){BX.Crm.EntityEditorSection.superclass.constructor.apply(this);this._fields=null;this._fieldConfigurator=null;this._userFieldConfigurator=null;this._titleEditButton=null;this._titleEditHandler=BX.delegate(this.onTitleEditButtonClick,this);this._titleView=null;this._titleInput=null;this._titleMode=BX.Crm.EntityEditorMode.intermediate;this._titleInputKeyHandler=BX.delegate(this.onTitleInputKeyPress,this);this._documentClickHandler=BX.delegate(this.onExternalClick,this);this._deleteButtonHandler=BX.delegate(this.onDeleteSectionBtnClick,this);this._detetionConfirmDlgId="section_deletion_confirm";this._enableToggling=true;this._toggleButton=null;this._addChildButton=null;this._childSelectMenu=null;this._buttonPanelWrapper=null;this._fieldTypeSelectMenu=null;this._deleteButton=null;this._dragContainerController=null;this._dragPlaceHolder=null;this._dropHandler=BX.delegate(this.onDrop,this);this._fieldSelector=null};BX.extend(BX.Crm.EntityEditorSection,BX.Crm.EntityEditorControl);BX.Crm.EntityEditorSection.prototype.doSetActive=function(){for(var t=0,e=this._fields.length;t<e;t++){this._fields[t].setActive(this._isActive)}};BX.Crm.EntityEditorSection.prototype.initialize=function(t,e){BX.Crm.EntityEditorSection.superclass.initialize.call(this,t,e);this.initializeFromModel();this._draggableContextId=BX.Crm.EditorFieldDragItem.contextId+"_"+this.getId()};BX.Crm.EntityEditorSection.prototype.initializeFromModel=function(){var t,e;if(this._fields){for(t=0,e=this._fields.length;t<e;t++){this._fields[t].release()}}this._fields=[];var i=this._schemeElement.getElements();for(t=0,e=i.length;t<e;t++){var n=i[t];var r=this._editor.createControl(n.getType(),n.getName(),{schemeElement:n,model:this._model,parent:this});if(!r){continue}n.setParent(this._schemeElement);r.setMode(this._mode,false);this._fields.push(r)}};BX.Crm.EntityEditorSection.prototype.createDragButton=function(){if(!this._dragButton){this._dragButton=BX.create("div",{props:{className:"crm-entity-card-widget-draggable-btn-container"},children:[BX.create("div",{props:{className:"crm-entity-card-widget-draggable-btn"}})]})}return this._dragButton};BX.Crm.EntityEditorSection.prototype.adjustDeleteButton=function(){if(this._deleteButton){if(!this.isRequired()&&!this.isRequiredConditionally()){BX.bind(this._deleteButton,"click",this._deleteButtonHandler);this._deleteButton.style.display=""}else{BX.unbind(this._deleteButton,"click",this._deleteButtonHandler);this._deleteButton.style.display="none"}}};BX.Crm.EntityEditorSection.prototype.createGhostNode=function(){if(!this._wrapper){return null}var t=BX.pos(this._wrapper);var e=BX.create("div",{props:{className:"crm-entity-card-widget-edit"},children:[BX.create("div",{props:{className:"crm-entity-card-widget-draggable-btn-container"},children:[BX.create("div",{props:{className:"crm-entity-card-widget-draggable-btn"},children:[BX.create("div",{props:{className:"crm-entity-card-widget-draggable-btn-inner"}})]})]}),BX.create("div",{props:{className:"crm-entity-card-widget-title"},children:[BX.create("span",{props:{className:"crm-entity-card-widget-title-text"},text:this._schemeElement.getTitle()})]})]});BX.addClass(e,"crm-entity-widget-card-drag");e.style.width=t.width+"px";return e};BX.Crm.EntityEditorSection.prototype.getEditPriority=function(){for(var t=0,e=this._fields.length;t<e;t++){if(this._fields[t].getEditPriority()===BX.Crm.EntityEditorPriority.high){return BX.Crm.EntityEditorPriority.high}}return BX.Crm.EntityEditorPriority.normal};BX.Crm.EntityEditorSection.prototype.layout=function(t){var e=this._schemeElement.getTitle();this._contentContainer=BX.create("div",{props:{className:"crm-entity-widget-content"}});var i=this._mode===BX.Crm.EntityEditorMode.view;var n=i?"crm-entity-card-widget":"crm-entity-card-widget-edit";this._enableToggling=this.isModeToggleEnabled();this._toggleButton=BX.create("span",{attrs:{className:"crm-entity-widget-hide-btn"},events:{click:BX.delegate(this.onToggleBtnClick,this)},text:this.getMessage(i?"change":"cancel")});if(!this._enableToggling){this._toggleButton.style.display="none"}this._titleMode=BX.Crm.EntityEditorMode.view;this._titleEditButton=BX.create("span",{props:{className:"crm-entity-card-widget-title-edit-icon"},events:{click:this._titleEditHandler}});if(!this._editor.isSectionEditEnabled()){this._titleEditButton.style.display="none"}this._titleView=BX.create("span",{props:{className:"crm-entity-card-widget-title-text"},text:e});this._titleInput=BX.create("input",{props:{className:"crm-entity-card-widget-title-text"},style:{display:"none"}});this._wrapper=BX.create("div",{props:{className:n}});this._wrapper.appendChild(this.createDragButton());this._wrapper.appendChild(BX.create("div",{props:{className:"crm-entity-card-widget-title"},children:[this._titleView,this._titleInput,this._titleEditButton,BX.create("div",{props:{className:"crm-entity-widget-actions-block"},children:[this._toggleButton]})]}));this._wrapper.appendChild(this._contentContainer);if(!BX.type.isPlainObject(t)){t={}}var r=BX.prop.getElementNode(t,"anchor",null);if(r){this._container.insertBefore(this._wrapper,r)}else{this._container.appendChild(this._wrapper)}var o=BX.Crm.EntityUserFieldLayoutLoader.create(this._id,{mode:this._mode,enableBatchMode:true});for(var s=0,a=this._fields.length;s<a;s++){var l=this._fields[s];l.setContainer(this._contentContainer);l.setDraggableContextId(this._draggableContextId);l.layout({userFieldLoader:o});if(!i&&l.isHeading()){l.focus()}}o.runBatch();this._addChildButton=this._createChildButton=null;if(!i){this._buttonPanelWrapper=BX.create("div",{props:{className:"crm-entity-widget-content-block"}});this._addChildButton=BX.create("span",{props:{className:"crm-entity-widget-content-block-edit-action-btn"},text:this.getMessage("selectField"),events:{click:BX.delegate(this.onAddChildBtnClick,this)}});if(!this._editor.hasAvailableSchemeElements()){this._addChildButton.style.display="none"}this._buttonPanelWrapper.appendChild(this._addChildButton);if(this._editor.getUserFieldManager().isCreationEnabled()){this._createChildButton=BX.create("span",{props:{className:"crm-entity-widget-content-block-edit-action-btn"},text:this.getMessage("createField"),events:{click:BX.delegate(this.onCreateUserFieldBtnClick,this)}});this._buttonPanelWrapper.appendChild(this._createChildButton)}this._deleteButton=BX.create("span",{props:{className:"crm-entity-widget-content-block-edit-remove-btn"},text:this.getMessage("deleteSection")});this._buttonPanelWrapper.appendChild(this._deleteButton);this.adjustDeleteButton();this._contentContainer.appendChild(this._buttonPanelWrapper)}this._dragContainerController=BX.Crm.EditorDragContainerController.create("section_"+this.getId(),{charge:BX.Crm.EditorFieldDragContainer.create({section:this,context:this._draggableContextId}),node:this._wrapper});this._dragContainerController.addDragFinishListener(this._dropHandler);this.initializeDragDropAbilities();this._hasLayout=true};BX.Crm.EntityEditorSection.prototype.clearLayout=function(){if(!this._hasLayout){return}this.releaseDragDropAbilities();for(var t=0,e=this._fields.length;t<e;t++){var i=this._fields[t];i.clearLayout();i.setContainer(null);i.setDraggableContextId("")}this._addChildButton=BX.remove(this._addChildButton);this._buttonPanelWrapper=BX.remove(this._buttonPanelWrapper);this._deleteButton=null;this._wrapper=BX.remove(this._wrapper);this._hasLayout=false};BX.Crm.EntityEditorSection.prototype.refreshLayout=function(t){var e=this._wrapper;var i={};if(e&&e.nextSibling){i["anchor"]=e.nextSibling}e.style.height=e.offsetHeight+"px";this.layout(i);var n=this._wrapper;n.style.position="absolute";n.style.top=e.offsetTop+"px";n.style.width=e.offsetWidth+"px";n.style.left=0;n.style.right=0;n.style.zIndex=10;n.style.opacity=0;var r=new BX.easing({duration:250,start:{opacity:0},finish:{opacity:100},transition:BX.easing.transitions.quart,step:BX.proxy(function(t){n.style.opacity=t.opacity/100},this),complete:BX.proxy(function(){n.style.opacity="";n.style.height="";n.style.width="";n.style.position="";n.style.top="";n.style.left="";n.style.right="";n.style.zIndex="";e.remove();if(BX.type.isFunction(t)){t()}},this)});var o=new BX.easing({duration:100,start:{height:e.offsetHeight},finish:{height:n.offsetHeight},transition:BX.easing.transitions.quart,step:BX.proxy(function(t){e.style.height=t.height+"px"},this),complete:BX.proxy(function(){r.animate()},this)});var s=new BX.easing({duration:250,start:{opacity:100},finish:{opacity:0},transition:BX.easing.transitions.quart,step:BX.proxy(function(t){e.style.opacity=t.opacity/100},this),complete:BX.proxy(function(){o.animate()},this)});s.animate()};BX.Crm.EntityEditorSection.prototype.setTitleMode=function(t){if(this._titleMode===t){return}this._titleMode=t;if(this._titleMode===BX.Crm.EntityEditorMode.view){this._titleView.style.display="";this._titleInput.style.display="none";this._titleEditButton.style.display="";var e=this._titleInput.value;this._titleView.innerHTML=BX.util.htmlspecialchars(e);this._schemeElement.setTitle(e);this.markSchemeAsChanged();this.saveScheme();BX.unbind(this._titleInput,"keyup",this._titleInputKeyHandler);BX.unbind(window.document,"click",this._documentClickHandler)}else{this._titleView.style.display="none";this._titleInput.style.display="";this._titleEditButton.style.display="none";this._titleInput.value=this._schemeElement.getTitle();BX.bind(this._titleInput,"keyup",this._titleInputKeyHandler);this._titleInput.focus();window.setTimeout(BX.delegate(function(){BX.bind(window.document,"click",this._documentClickHandler)},this),100)}};BX.Crm.EntityEditorSection.prototype.toggleTitleMode=function(){this.setTitleMode(this._titleMode===BX.Crm.EntityEditorMode.view?BX.Crm.EntityEditorMode.edit:BX.Crm.EntityEditorMode.view)};BX.Crm.EntityEditorSection.prototype.onTitleEditButtonClick=function(t){if(this._editor.isSectionEditEnabled()){this.toggleTitleMode()}};BX.Crm.EntityEditorSection.prototype.onTitleInputKeyPress=function(t){if(!t){t=window.event}if(t.keyCode===13){this.toggleTitleMode()}};BX.Crm.EntityEditorSection.prototype.onExternalClick=function(t){if(!t){t=window.event}if(this._titleInput!==BX.getEventTarget(t)){this.toggleTitleMode()}};BX.Crm.EntityEditorSection.prototype.enableToggling=function(t){this._enableToggling=!!t;if(this._hasLayout){this._toggleButton.style.display=this._enableToggling?"":"none"}};BX.Crm.EntityEditorSection.prototype.onToggleBtnClick=function(t){if(this._enableToggling){this.toggleMode(true)}};BX.Crm.EntityEditorSection.prototype.onBeforeModeChange=function(){this.removeFieldConfigurator();this.removeUserFieldConfigurator()};BX.Crm.EntityEditorSection.prototype.doSetMode=function(t){if(this._titleMode===BX.Crm.EntityEditorMode.edit){this.toggleTitleMode()}for(var e=0,i=this._fields.length;e<i;e++){this._fields[e].setMode(t,false)}};BX.Crm.EntityEditorSection.prototype.processAvailableSchemeElementsChange=function(){if(this._hasLayout){this._addChildButton.style.display=this._editor.hasAvailableSchemeElements()?"":"none"}};BX.Crm.EntityEditorSection.prototype.validate=function(t){if(this._mode!==BX.Crm.EntityEditorMode.edit){return true}var e=BX.Crm.EntityValidationResult.create();for(var i=0,n=this._fields.length;i<n;i++){var r=this._fields[i];if(r.getMode()!==BX.Crm.EntityEditorMode.edit){continue}r.validate(e)}t.addResult(e);return e.getStatus()};BX.Crm.EntityEditorSection.prototype.commitSchemeChanges=function(){if(this._isSchemeChanged){var t=[];for(var e=0,i=this._fields.length;e<i;e++){var n=this._fields[e].getSchemeElement();if(n){t.push(n)}}this._schemeElement.setElements(t)}return BX.Crm.EntityEditorSection.superclass.commitSchemeChanges.call(this)};BX.Crm.EntityEditorSection.prototype.save=function(){for(var t=0,e=this._fields.length;t<e;t++){this._fields[t].save()}};BX.Crm.EntityEditorSection.prototype.rollback=function(){for(var t=0,e=this._fields.length;t<e;t++){this._fields[t].rollback()}if(this.isChanged()){this.initializeFromModel()}};BX.Crm.EntityEditorSection.prototype.onBeforeSubmit=function(){for(var t=0,e=this._fields.length;t<e;t++){this._fields[t].onBeforeSubmit()}};BX.Crm.EntityEditorSection.prototype.getChildIndex=function(t){for(var e=0,i=this._fields.length;e<i;e++){if(this._fields[e]===t){return e}}return-1};BX.Crm.EntityEditorSection.prototype.addChild=function(t,e){if(!BX.type.isPlainObject(e)){e={}}var i=BX.prop.get(e,"related",null);this._fields.push(t);if(t.hasScheme()){t.getSchemeElement().setParent(this._schemeElement)}t.setActive(this._isActive);if(this._hasLayout){t.setContainer(this._contentContainer);t.setDraggableContextId(this._draggableContextId);var n=BX.prop.getObject(e,"layout",{});if(i){n["anchor"]=i.getWrapper()}else{n["anchor"]=this._buttonPanelWrapper}t.layout(n)}if(t.hasScheme()){this._editor.processControlAdd(t);this.markSchemeAsChanged();if(BX.prop.getBoolean(e,"enableSaving",true)){this.saveScheme()}}this.adjustDeleteButton()};BX.Crm.EntityEditorSection.prototype.removeChild=function(t,e){if(!BX.type.isPlainObject(e)){e={}}var i=this.getChildIndex(t);if(i<0){return}if(t.isActive()){t.setActive(false)}this._fields.splice(i,1);var n=t.hasScheme();if(n){t.getSchemeElement().setParent(null)}if(this._hasLayout){t.clearLayout();t.setContainer(null);t.setDraggableContextId("")}if(n){this._editor.processControlRemove(t);this.markSchemeAsChanged();if(BX.prop.getBoolean(e,"enableSaving",true)){this.saveScheme()}}this.adjustDeleteButton()};BX.Crm.EntityEditorSection.prototype.moveChild=function(t,e){var i=this.getChildCount();var n=i-1;if(e<0||e>i){e=n}var r=this.getChildIndex(t);if(r<0||r===e){return false}if(this._hasLayout){t.clearLayout()}this._fields.splice(r,1);i--;var o=null;if(this._hasLayout){o=e<i?this._fields[e].getWrapper():this._buttonPanelWrapper}if(e<i){this._fields.splice(e,0,t)}else{this._fields.push(t)}if(this._hasLayout){if(o){t.layout({anchor:o})}else{t.layout()}}this._editor.processControlMove(t);this.markSchemeAsChanged();this.saveScheme();return true};BX.Crm.EntityEditorSection.prototype.editChild=function(t){if(this._mode===BX.Crm.EntityEditorMode.edit){t.focus()}else if(!this.isReadOnly()){this.setMode(BX.Crm.EntityEditorMode.edit,true);this.refreshLayout(function(){t.focus()})}};BX.Crm.EntityEditorSection.prototype.getChildById=function(t){for(var e=0,i=this._fields.length;e<i;e++){var n=this._fields[e];if(n.getId()===t){return n}}return null};BX.Crm.EntityEditorSection.prototype.getChildCount=function(){return this._fields.length};BX.Crm.EntityEditorSection.prototype.getChildren=function(){return this._fields};BX.Crm.EntityEditorSection.prototype.processChildControlChange=function(t,e){if(this._isChanged){return}this.markAsChanged(e);this.enableToggling(false)};BX.Crm.EntityEditorSection.prototype.openAddChildMenu=function(){var t=this._editor.getAvailableSchemeElements();var e=t.length;if(e===0){return}var i=[];for(var n=0;n<e;n++){var r=t[n];i.push({text:r.getTitle(),value:r.getName()})}i.push({delimiter:true});i.push({text:this.getMessage("selectFieldFromOtherSection"),value:"ACTION.TRANSFER"});if(this._childSelectMenu){this._childSelectMenu.setupItems(i)}else{this._childSelectMenu=BX.CmrSelectorMenu.create(this._id,{items:i});this._childSelectMenu.addOnSelectListener(BX.delegate(this.onChildSelect,this))}this._childSelectMenu.open(this._addChildButton)};BX.Crm.EntityEditorSection.prototype.onAddChildBtnClick=function(t){this.openAddChildMenu()};BX.Crm.EntityEditorSection.prototype.openTransferDialog=function(){if(!this._fieldSelector){this._fieldSelector=BX.Crm.EntityEditorFieldSelector.create(this._id,{scheme:this._editor.getScheme(),excludedNames:[this.getSchemeElement().getName()],title:this.getMessage("transferDialogTitle")});this._fieldSelector.addClosingListener(BX.delegate(this.onTranferFieldSelect,this))}this._fieldSelector.open()};BX.Crm.EntityEditorSection.prototype.onTranferFieldSelect=function(t,e){if(BX.prop.getBoolean(e,"isCanceled")){return}var i=BX.prop.getArray(e,"items");if(i.length===0){return}for(var n=0,r=i.length;n<r;n++){var o=i[n];var s=BX.prop.getString(o,"sectionName","");var a=BX.prop.getString(o,"fieldName","");var l=this._editor.getControlById(s);if(!l){continue}var d=l.getChildById(a);if(!d){continue}var h=d.getSchemeElement();l.removeChild(d,{enableSaving:false});var p=this._editor.createControl(h.getType(),h.getName(),{schemeElement:h,model:this._model,parent:this,mode:this._mode});this.addChild(p,{enableSaving:false})}this._editor.saveSchemeChanges()};BX.Crm.EntityEditorSection.prototype.onChildSelect=function(t,e){var i=e.getValue();if(i==="ACTION.TRANSFER"){this.openTransferDialog();return}var n=this._editor.getAvailableSchemeElementByName(i);if(!n){return}var r=this._editor.createControl(n.getType(),n.getName(),{schemeElement:n,model:this._model,parent:this,mode:this._mode});if(r){this.addChild(r)}};BX.Crm.EntityEditorSection.prototype.onCreateUserFieldBtnClick=function(t){if(!this._fieldTypeSelectMenu){var e=this._editor.getUserFieldManager().getTypeInfos();var i=[];for(var n=0,r=e.length;n<r;n++){var o=e[n];i.push({value:o.name,text:o.title,legend:o.legend})}this._fieldTypeSelectMenu=BX.Crm.UserFieldTypeMenu.create(this._id,{items:i,callback:BX.delegate(this.onUserFieldTypeSelect,this)})}this._fieldTypeSelectMenu.open(this._createChildButton)};BX.Crm.EntityEditorSection.prototype.onUserFieldTypeSelect=function(t,e){this._fieldTypeSelectMenu.close();var i=e.getValue();if(i===""){return}if(i==="custom"){window.open(this._editor.getUserFieldManager().getCreationPageUrl())}else{this.removeFieldConfigurator();this.removeUserFieldConfigurator();this.createUserFieldConfigurator({typeId:i})}};BX.Crm.EntityEditorSection.prototype.createUserFieldConfigurator=function(t){if(!BX.type.isPlainObject(t)){throw"EntityEditorSection: The 'params' argument must be object."}var e="";var i=BX.prop.get(t,"field",null);if(i){if(!(i instanceof BX.Crm.EntityEditorUserField)){throw"EntityEditorSection: The 'field' param must be EntityEditorUserField."}e=i.getFieldType();i.setVisible(false)}else{e=BX.prop.get(t,"typeId",BX.Crm.EntityUserFieldType.string)}this._userFieldConfigurator=BX.Crm.EntityEditorUserFieldConfigurator.create("",{editor:this._editor,schemeElement:null,model:this._model,mode:BX.Crm.EntityEditorMode.edit,parent:this,typeId:e,field:i});this.addChild(this._userFieldConfigurator,{related:i});BX.addCustomEvent(this._userFieldConfigurator,"onSave",BX.delegate(this.onUserFieldConfigurationSave,this));BX.addCustomEvent(this._userFieldConfigurator,"onCancel",BX.delegate(this.onUserFieldConfigurationCancel,this))};BX.Crm.EntityEditorSection.prototype.removeUserFieldConfigurator=function(){if(this._userFieldConfigurator){var t=this._userFieldConfigurator.getField();if(t){t.setVisible(true)}this.removeChild(this._userFieldConfigurator);this._userFieldConfigurator=null}};BX.Crm.EntityEditorSection.prototype.onUserFieldConfigurationSave=function(t,e){if(t!==this._userFieldConfigurator){return}this._userFieldConfigurator.setLocked(true);var i=BX.prop.getString(e,"typeId");if(i===BX.Crm.EntityUserFieldType.datetime&&!BX.prop.getBoolean(e,"enableTime",false)){i=BX.Crm.EntityUserFieldType.date}var n={USER_TYPE_ID:i};var r=BX.prop.get(e,"field",null);if(r){var o=BX.prop.getString(e,"label","");if(o!==""){r.setTitle(o);this.markSchemeAsChanged();this.saveScheme()}n["FIELD"]=r.getName();n["ENTITY_VALUE_ID"]=r.getEntityValueId();n["MANDATORY"]=BX.prop.getBoolean(e,"mandatory",false)?"Y":"N";n["VALUE"]=r.getFieldValue();if(i===BX.Crm.EntityUserFieldType.enumeration){n["ENUM"]=BX.prop.getArray(e,"enumeration",[])}r.adjustFieldParams(n);this._editor.getUserFieldManager().updateField(n,this._mode).then(BX.delegate(this.onUserFieldUpdate,this))}else{n["EDIT_FORM_LABEL"]=BX.prop.getString(e,"label");n["MANDATORY"]=BX.prop.getBoolean(e,"mandatory",false)?"Y":"N";n["MULTIPLE"]=BX.prop.getBoolean(e,"multiple",false)?"Y":"N";if(i===BX.Crm.EntityUserFieldType.enumeration){n["ENUM"]=BX.prop.getArray(e,"enumeration",[])}this._editor.getUserFieldManager().createField(n,this._mode).then(BX.delegate(this.onUserFieldCreate,this))}};BX.Crm.EntityEditorSection.prototype.onUserFieldConfigurationCancel=function(t,e){if(t!==this._userFieldConfigurator){return}this.removeUserFieldConfigurator()};BX.Crm.EntityEditorSection.prototype.onUserFieldCreate=function(t){if(!BX.type.isPlainObject(t)){return}this.removeUserFieldConfigurator();var e=this._editor.getUserFieldManager();for(var i in t){if(!t.hasOwnProperty(i)){continue}var n=t[i];var r=BX.prop.getObject(n,"FIELD",null);if(!r){continue}var o=e.createSchemeElement(r);if(!o){continue}this._model.setField(o.getName(),{VALUE:"",SIGNATURE:BX.prop.getString(r,"SIGNATURE","")});var s=this._editor.createControl(o.getType(),o.getName(),{schemeElement:o,model:this._model,parent:this,mode:this._mode});this.addChild(s,{layout:{html:BX.prop.getString(n,"HTML","")}})}};BX.Crm.EntityEditorSection.prototype.onUserFieldUpdate=function(t){if(!BX.type.isPlainObject(t)){return}this.removeUserFieldConfigurator();var e=this._editor.getUserFieldManager();for(var i in t){if(!t.hasOwnProperty(i)){continue}var n=t[i];var r=BX.prop.getObject(n,"FIELD",null);if(!r){continue}var o=this.getChildById(i);if(!o){continue}var s=o.getSchemeElement();if(!s){continue}e.updateSchemeElement(s,r);var a={};var l=BX.prop.getString(n,"HTML","");if(l!==""){a["html"]=l}o.refreshLayout(a)}};BX.Crm.EntityEditorSection.prototype.editChildConfiguration=function(t){this.removeFieldConfigurator();this.removeUserFieldConfigurator();if(t.getType()==="userField"&&this._editor.getUserFieldManager().isModificationEnabled()){this.createUserFieldConfigurator({field:t})}else{this.createFieldConfigurator(t)}};BX.Crm.EntityEditorSection.prototype.createFieldConfigurator=function(t){t.setVisible(false);this._fieldConfigurator=BX.Crm.EntityEditorFieldConfigurator.create("",{editor:this._editor,schemeElement:null,model:this._model,mode:BX.Crm.EntityEditorMode.edit,parent:this,field:t});this.addChild(this._fieldConfigurator,{related:t});BX.addCustomEvent(this._fieldConfigurator,"onSave",BX.delegate(this.onFieldConfigurationSave,this));BX.addCustomEvent(this._fieldConfigurator,"onCancel",BX.delegate(this.onFieldConfigurationCancel,this))};BX.Crm.EntityEditorSection.prototype.removeFieldConfigurator=function(){if(this._fieldConfigurator){var t=this._fieldConfigurator.getField();if(t){t.setVisible(true)}this.removeChild(this._fieldConfigurator);this._fieldConfigurator=null}};BX.Crm.EntityEditorSection.prototype.onFieldConfigurationSave=function(t,e){if(t!==this._fieldConfigurator){return}var i=BX.prop.get(e,"field",null);if(!i){throw"EntityEditorSection. Could not find target field."}var n=BX.prop.getString(e,"label","");if(n===""){this.removeFieldConfigurator();return}this._fieldConfigurator.setLocked(true);i.setTitle(n);this.markSchemeAsChanged();this.saveScheme().then(BX.delegate(function(){this.removeFieldConfigurator()},this))};BX.Crm.EntityEditorSection.prototype.onFieldConfigurationCancel=function(t,e){if(t!==this._fieldConfigurator){return}var i=BX.prop.get(e,"field",null);if(!i){throw"EntityEditorSection. Could not find target field."}this.removeFieldConfigurator()};BX.Crm.EntityEditorSection.prototype.onDeleteConfirm=function(t){if(BX.prop.getBoolean(t,"cancel",true)){return}this._editor.removeSchemeElement(this.getSchemeElement());this._editor.removeControl(this);this._editor.saveScheme()};BX.Crm.EntityEditorSection.prototype.onDeleteSectionBtnClick=function(t){if(this.isRequired()||this.isRequiredConditionally()){return}var e=BX.Crm.ConfirmationDialog.get(this._detetionConfirmDlgId);if(!e){e=BX.Crm.ConfirmationDialog.create(this._detetionConfirmDlgId,{title:this.getMessage("deleteSection"),content:this.getMessage("deleteSectionConfirm")})}e.open().then(BX.delegate(this.onDeleteConfirm,this))};BX.Crm.EntityEditorSection.prototype.hasPlaceHolder=function(){return!!this._dragPlaceHolder};BX.Crm.EntityEditorSection.prototype.createPlaceHolder=function(t){var e=this.getChildCount();if(t<0||t>e){t=e>0?e:0}if(this._dragPlaceHolder){if(this._dragPlaceHolder.getIndex()===t){return this._dragPlaceHolder}this._dragPlaceHolder.clearLayout();this._dragPlaceHolder=null}this._dragPlaceHolder=BX.Crm.EditorDragFieldPlaceholder.create({container:this._contentContainer,anchor:t<e?this._fields[t].getWrapper():this._buttonPanelWrapper,index:t});this._dragPlaceHolder.layout();return this._dragPlaceHolder};BX.Crm.EntityEditorSection.prototype.getPlaceHolder=function(){return this._dragPlaceHolder};BX.Crm.EntityEditorSection.prototype.removePlaceHolder=function(){if(this._dragPlaceHolder){this._dragPlaceHolder.clearLayout();this._dragPlaceHolder=null}};BX.Crm.EntityEditorSection.prototype.processDraggedItemDrop=function(t,e){var i=t.getCharge();if(!(i instanceof BX.Crm.EditorFieldDragContainer&&i.getSection()===this)){return}var n=e.getContextData();var r=BX.type.isNotEmptyString(n["contextId"])?n["contextId"]:"";if(r!==this.getDraggableContextId()){return}var o=typeof n["charge"]!=="undefined"?n["charge"]:null;if(!(o instanceof BX.Crm.EditorFieldDragItem)){return}var s=o.getControl();if(!s){return}var a=this.getChildIndex(s);if(a<0){return}var l=this.getPlaceHolder();var d=l?l.getIndex():-1;if(d<0){return}var h=d<=a?d:d-1;if(h!==a){this.moveChild(s,h)}};BX.Crm.EntityEditorSection.prototype.onDrop=function(t,e,i,n){this.processDraggedItemDrop(t,e)};BX.Crm.EntityEditorSection.prototype.initializeDragDropAbilities=function(){if(this._dragItem){return}this._dragItem=BX.Crm.EditorDragItemController.create("section_"+this.getId(),{charge:BX.Crm.EditorSectionDragItem.create({control:this}),node:this.createDragButton(),showControlInDragMode:false,ghostOffset:{x:0,y:0}})};BX.Crm.EntityEditorSection.prototype.releaseDragDropAbilities=function(){if(this._dragItem){this._dragItem.release();this._dragItem=null}};BX.Crm.EntityEditorSection.prototype.isRequired=function(){for(var t=0,e=this._fields.length;t<e;t++){if(this._fields[t].isRequired()){return true}}return false};BX.Crm.EntityEditorSection.prototype.isRequiredConditionally=function(){for(var t=0,e=this._fields.length;t<e;t++){if(this._fields[t].isRequiredConditionally()){return true}}return false};BX.Crm.EntityEditorSection.prototype.getMessage=function(t){var e=BX.Crm.EntityEditorSection.messages;return e.hasOwnProperty(t)?e[t]:t};if(typeof BX.Crm.EntityEditorSection.messages==="undefined"){BX.Crm.EntityEditorSection.messages={}}BX.Crm.EntityEditorSection.create=function(t,e){var i=new BX.Crm.EntityEditorSection;i.initialize(t,e);return i}}if(typeof BX.Crm.EntityEditorText==="undefined"){BX.Crm.EntityEditorText=function(){BX.Crm.EntityEditorText.superclass.constructor.apply(this);this._input=null;this._view=null};BX.extend(BX.Crm.EntityEditorText,BX.Crm.EntityEditorField);BX.Crm.EntityEditorText.prototype.focus=function(){if(this._mode===BX.Crm.EntityEditorMode.edit){this._input.focus();this.scrollAnimate()}};BX.Crm.EntityEditorText.prototype.getLineCount=function(){return this._schemeElement.getDataIntegerParam("lineCount",1)};BX.Crm.EntityEditorText.prototype.layout=function(t){if(this._hasLayout){return}var e=this.getName();var i=this.getTitle();var n=this.getValue();this._wrapper=BX.create("div",{props:{className:"crm-entity-widget-content-block crm-entity-widget-content-block-field-text"}});this._input=null;this._view=null;var r=this.isDragEnabled();if(r){this._wrapper.appendChild(this.createDragButton())}var o=this.isContextMenuEnabled();if(this._mode===BX.Crm.EntityEditorMode.edit){this._wrapper.appendChild(this.createTitleNode(i));var s=this.getLineCount();if(s>1){this._input=BX.create("textarea",{props:{className:"crm-entity-widget-content-textarea",name:e,rows:s,value:n}})}else{this._input=BX.create("input",{attrs:{name:e,className:"crm-entity-widget-content-input",type:"text",value:n}})}BX.bind(this._input,"input",this._changeHandler);if(s>1){this._wrapper.appendChild(BX.create("div",{props:{className:"crm-entity-widget-content-block-field-container crm-entity-widget-content-block-textarea"},children:[this._input]}))}else{this._wrapper.appendChild(BX.create("div",{props:{className:"crm-entity-widget-content-block-inner"},children:[this._input]}))}if(this._editor.isDuplicateControlEnabled()){var a=this.getDuplicateControlConfig();if(a){if(!BX.type.isPlainObject(a["field"])){a["field"]={}}a["field"]["id"]=this.getId();a["field"]["element"]=this._input;this._editor.getDuplicateManager().registerField(a)}}}else if(this._mode===BX.Crm.EntityEditorMode.view&&this.checkIfNotEmpty(n)){this._wrapper.appendChild(this.createTitleNode(i));this._view=null;if(this.getLineCount()>1){this._view=BX.create("div",{props:{className:"crm-entity-widget-content-block-inner"},html:BX.util.nl2br(BX.util.htmlspecialchars(n))})}else{this._view=BX.create("div",{props:{className:"crm-entity-widget-content-block-inner"},text:n});if(o||r){BX.addClass(this._wrapper,"crm-entity-widget-content-block-field-small")}}this._wrapper.appendChild(this._view)}if(o){this._wrapper.appendChild(this.createContextMenuButton())}if(r){this.initializeDragDropAbilities()}this.registerLayout(t);this._hasLayout=true};BX.Crm.EntityEditorText.prototype.clearLayout=function(){if(!this._hasLayout){return}if(this._editor.isDuplicateControlEnabled()){var t=this.getDuplicateControlConfig();if(t){if(!BX.type.isPlainObject(t["field"])){t["field"]={}}t["field"]["id"]=this.getId();this._editor.getDuplicateManager().unregisterField(t)}}this.releaseDragDropAbilities();this._wrapper=BX.remove(this._wrapper);this._input=null;this._view=null;this._hasLayout=false};BX.Crm.EntityEditorText.prototype.refreshLayout=function(){if(!this._hasLayout){return}if(this._mode===BX.Crm.EntityEditorMode.edit&&this._input){this._input.value=this.getValue()}else if(this._mode===BX.Crm.EntityEditorMode.view&&this._view){this._view.innerHTML=BX.util.htmlspecialchars(this.getValue())}};BX.Crm.EntityEditorText.prototype.getRuntimeValue=function(){return this._mode===BX.Crm.EntityEditorMode.edit&&this._input?BX.util.trim(this._input.value):""};BX.Crm.EntityEditorText.prototype.validate=function(t){if(!(this._mode===BX.Crm.EntityEditorMode.edit&&this._input)){throw"BX.Crm.EntityEditorText. Invalid validation context"}this.clearError();if(this.hasValidators()){return this.executeValidators(t)}var e=!this.isRequired()||BX.util.trim(this._input.value)!=="";if(!e){t.addError(BX.Crm.EntityValidationError.create({field:this}));this.showRequiredFieldError(this._input)}return e};BX.Crm.EntityEditorText.prototype.showError=function(t,e){BX.Crm.EntityEditorText.superclass.showError.apply(this,arguments);if(this._input){BX.addClass(this._input,"crm-entity-widget-content-error")}};BX.Crm.EntityEditorText.prototype.clearError=function(){BX.Crm.EntityEditorText.superclass.clearError.apply(this);if(this._input){BX.removeClass(this._input,"crm-entity-widget-content-error")}};BX.Crm.EntityEditorText.prototype.save=function(){if(this._input){this._model.setField(this.getName(),this._input.value,{originator:this})}};BX.Crm.EntityEditorText.prototype.processModelChange=function(t){if(BX.prop.get(t,"originator",null)===this){return}if(!BX.prop.getBoolean(t,"forAll",false)&&BX.prop.getString(t,"name","")!==this.getName()){return}this.refreshLayout()};BX.Crm.EntityEditorText.create=function(t,e){var i=new BX.Crm.EntityEditorText;i.initialize(t,e);return i}}if(typeof BX.Crm.EntityEditorNumber==="undefined"){BX.Crm.EntityEditorNumber=function(){BX.Crm.EntityEditorNumber.superclass.constructor.apply(this);this._input=null};BX.extend(BX.Crm.EntityEditorNumber,BX.Crm.EntityEditorField);BX.Crm.EntityEditorNumber.prototype.focus=function(){if(this._mode===BX.Crm.EntityEditorMode.edit){this.scrollAnimate();this._input.focus()}};BX.Crm.EntityEditorNumber.prototype.layout=function(t){if(this._hasLayout){return}var e=this.getName();var i=this.getTitle();var n=this.getValue();this._wrapper=BX.create("div",{props:{className:"crm-entity-widget-content-block crm-entity-widget-content-block-field-number"}});this._input=null;if(this._mode===BX.Crm.EntityEditorMode.edit){this._input=BX.create("input",{attrs:{name:e,className:"crm-entity-widget-content-input",type:"text",value:n}});BX.bind(this._input,"input",this._changeHandler);this._wrapper.appendChild(this.createDragButton());this._wrapper.appendChild(this.createTitleNode(i));this._wrapper.appendChild(BX.create("div",{props:{className:"crm-entity-widget-content-block-inner"},children:[this._input]}));this._wrapper.appendChild(this.createContextMenuButton());this.initializeDragDropAbilities()}else if(this._mode===BX.Crm.EntityEditorMode.view&&this.checkIfNotEmpty(n)){this._wrapper.appendChild(this.createTitleNode(i));this._wrapper.appendChild(BX.create("div",{props:{className:"crm-entity-widget-content-block-inner"},text:n}))}this.registerLayout(t);this._hasLayout=true};BX.Crm.EntityEditorNumber.prototype.clearLayout=function(){if(!this._hasLayout){return}this.releaseDragDropAbilities();this._wrapper=BX.remove(this._wrapper);this._input=null;this._hasLayout=false};BX.Crm.EntityEditorNumber.prototype.validate=function(t){if(!(this._mode===BX.Crm.EntityEditorMode.edit&&this._input)){throw"BX.Crm.EntityEditorNumber. Invalid validation context"}this.clearError();if(this.hasValidators()){return this.executeValidators(t)}var e=!this.isRequired()||BX.util.trim(this._input.value)!=="";if(!e){t.addError(BX.Crm.EntityValidationError.create({field:this}));this.showRequiredFieldError(this._input)}return e};BX.Crm.EntityEditorNumber.prototype.showError=function(t,e){BX.Crm.EntityEditorNumber.superclass.showError.apply(this,arguments);if(this._input){BX.addClass(this._input,"crm-entity-widget-content-error")}};BX.Crm.EntityEditorNumber.prototype.clearError=function(){BX.Crm.EntityEditorNumber.superclass.clearError.apply(this);if(this._input){BX.removeClass(this._input,"crm-entity-widget-content-error")}};BX.Crm.EntityEditorNumber.prototype.save=function(){if(this._input){this._model.setField(this.getName(),this._input.value)}};BX.Crm.EntityEditorNumber.create=function(t,e){var i=new BX.Crm.EntityEditorNumber;i.initialize(t,e);return i}}if(typeof BX.Crm.EntityEditorDatetime==="undefined"){BX.Crm.EntityEditorDatetime=function(){BX.Crm.EntityEditorDatetime.superclass.constructor.apply(this);this._input=null;this._inputClickHandler=BX.delegate(this.onInputClick,this)};BX.extend(BX.Crm.EntityEditorDatetime,BX.Crm.EntityEditorField);BX.Crm.EntityEditorDatetime.prototype.focus=function(){if(this._mode===BX.Crm.EntityEditorMode.edit){this.scrollAnimate();this._input.focus()}};BX.Crm.EntityEditorDatetime.prototype.layout=function(t){if(this._hasLayout){return}var e=this.getName();var i=this.getTitle();var n=this.getValue();this._wrapper=BX.create("div",{props:{className:"crm-entity-widget-content-block crm-entity-widget-content-block-field-date"}});this._input=null;if(this._mode===BX.Crm.EntityEditorMode.edit){this._input=BX.create("input",{attrs:{name:e,className:"crm-entity-widget-content-input",type:"text",value:n}});BX.bind(this._input,"click",this._inputClickHandler);BX.bind(this._input,"change",this._changeHandler);BX.bind(this._input,"input",this._changeHandler);this._wrapper.appendChild(this.createDragButton());this._wrapper.appendChild(this.createTitleNode(i));this._wrapper.appendChild(BX.create("div",{props:{className:"crm-entity-widget-content-block-inner crm-entity-widget-content-block-field-half-width"},children:[this._input]}));this._wrapper.appendChild(this.createContextMenuButton());this.initializeDragDropAbilities()}else if(this._mode===BX.Crm.EntityEditorMode.view&&this.checkIfNotEmpty(n)){n=BX.date.format("j F Y",BX.parseDate(n));this._wrapper.appendChild(this.createTitleNode(i));this._wrapper.appendChild(BX.create("div",{props:{className:"crm-entity-widget-content-block-inner"},text:n}))}this.registerLayout(t);this._hasLayout=true};BX.Crm.EntityEditorDatetime.prototype.clearLayout=function(){if(!this._hasLayout){return}this.releaseDragDropAbilities();this._wrapper=BX.remove(this._wrapper);this._input=null;this._hasLayout=false};BX.Crm.EntityEditorDatetime.prototype.onInputClick=function(t){BX.calendar({node:this._input,field:this._input,bTime:false,bSetFocus:false})};BX.Crm.EntityEditorDatetime.prototype.validate=function(t){if(!(this._mode===BX.Crm.EntityEditorMode.edit&&this._input)){throw"BX.Crm.EntityEditorDatetime. Invalid validation context"}this.clearError();if(this.hasValidators()){return this.executeValidators(t)}var e=!this.isRequired()||BX.util.trim(this._input.value)!=="";if(!e){t.addError(BX.Crm.EntityValidationError.create({field:this}));this.showRequiredFieldError(this._input)}return e};BX.Crm.EntityEditorDatetime.prototype.showError=function(t,e){BX.Crm.EntityEditorDatetime.superclass.showError.apply(this,arguments);if(this._input){BX.addClass(this._input,"crm-entity-widget-content-error")}};BX.Crm.EntityEditorDatetime.prototype.clearError=function(){BX.Crm.EntityEditorDatetime.superclass.clearError.apply(this);if(this._input){BX.removeClass(this._input,"crm-entity-widget-content-error")}};BX.Crm.EntityEditorDatetime.prototype.save=function(){if(this._input){this._model.setField(this.getName(),this._input.value)}};BX.Crm.EntityEditorDatetime.create=function(t,e){var i=new BX.Crm.EntityEditorDatetime;i.initialize(t,e);return i}}if(typeof BX.Crm.EntityEditorBoolean==="undefined"){BX.Crm.EntityEditorBoolean=function(){BX.Crm.EntityEditorBoolean.superclass.constructor.apply(this);this._input=null};BX.extend(BX.Crm.EntityEditorBoolean,BX.Crm.EntityEditorField);BX.Crm.EntityEditorBoolean.prototype.doInitialize=function(){BX.Crm.EntityEditorBoolean.superclass.doInitialize.apply(this);this._selectedValue=this._model.getField(this._schemeElement.getName())};BX.Crm.EntityEditorBoolean.prototype.hasValue=function(){return BX.util.trim(this.getValue())!==""};BX.Crm.EntityEditorBoolean.prototype.getValue=function(t){if(!this._model){return""}if(t===undefined){t="N"}var e=this._model.getStringField(this.getName(),t);if(e!=="Y"&&e!=="N"){e="N"}return e};BX.Crm.EntityEditorBoolean.prototype.layout=function(t){if(this._hasLayout){return}var e=this.getName();var i=this.getTitle();var n=this.getValue();this._wrapper=BX.create("div",{props:{className:"crm-entity-widget-content-block crm-entity-widget-content-block-field-checkbox"}});this._input=null;if(this._mode===BX.Crm.EntityEditorMode.edit){this._wrapper.appendChild(this.createDragButton());this._wrapper.appendChild(BX.create("input",{attrs:{name:e,type:"hidden",value:"N"}}));this._input=BX.create("input",{attrs:{className:"crm-entity-widget-content-checkbox",name:e,type:"checkbox",value:"Y",checked:n==="Y"}});BX.bind(this._input,"change",this._changeHandler);this._wrapper.appendChild(BX.create("div",{attrs:{className:"crm-entity-widget-content-block-inner"},children:[BX.create("label",{attrs:{className:"crm-entity-widget-content-block-checkbox-label"},children:[this._input,BX.create("span",{props:{className:"crm-entity-widget-content-block-checkbox-description"},text:i})]})]}));this.initializeDragDropAbilities();this._wrapper.appendChild(this.createContextMenuButton())}else{this._wrapper.appendChild(BX.create("div",{props:{className:"crm-entity-widget-content-block-title"},text:i}));this._wrapper.appendChild(BX.create("div",{props:{className:"crm-entity-widget-content-block-inner"},text:this.getMessage(n==="Y"?"yes":"no")}))}this.registerLayout(t);this._hasLayout=true};BX.Crm.EntityEditorBoolean.prototype.clearLayout=function(){if(!this._hasLayout){return}this.releaseDragDropAbilities();this._wrapper=BX.remove(this._wrapper);this._input=null;this._hasLayout=false};BX.Crm.EntityEditorBoolean.prototype.validate=function(t){if(!(this._mode===BX.Crm.EntityEditorMode.edit&&this._input)){throw"BX.Crm.EntityEditorBoolean. Invalid validation context"}if(this.hasValidators()){return this.executeValidators(t)}var e=!this.isRequired()||BX.util.trim(this._input.value)!=="";if(!e){t.addError(BX.Crm.EntityValidationError.create({field:this}));BX.addClass(this._input,"crm-entity-widget-content-error");this.showRequiredFieldError(this._input)}else{BX.removeClass(this._input,"crm-entity-widget-content-error");this.clearError()}return e};BX.Crm.EntityEditorBoolean.prototype.showError=function(t,e){BX.Crm.EntityEditorBoolean.superclass.showError.apply(this,arguments);if(this._input){BX.addClass(this._input,"crm-entity-widget-content-error")}};BX.Crm.EntityEditorBoolean.prototype.clearError=function(){BX.Crm.EntityEditorBoolean.superclass.clearError.apply(this);if(this._input){BX.removeClass(this._input,"crm-entity-widget-content-error")}};BX.Crm.EntityEditorBoolean.prototype.save=function(){if(this._input){this._model.setField(this.getName(),this._input.checked?"Y":"N",{originator:this})}};BX.Crm.EntityEditorBoolean.prototype.getMessage=function(t){var e=BX.Crm.EntityEditorBoolean.messages;return e.hasOwnProperty(t)?e[t]:BX.Crm.EntityEditorUser.superclass.getMessage.apply(this,arguments)};if(typeof BX.Crm.EntityEditorBoolean.messages==="undefined"){BX.Crm.EntityEditorBoolean.messages={}}BX.Crm.EntityEditorBoolean.create=function(t,e){var i=new BX.Crm.EntityEditorBoolean;i.initialize(t,e);return i}}if(typeof BX.Crm.EntityEditorList==="undefined"){BX.Crm.EntityEditorList=function(){BX.Crm.EntityEditorList.superclass.constructor.apply(this);this._items=null;this._input=null;this._selectContainer=null;this._selectedValue="";this._selectorClickHandler=BX.delegate(this.onSelectorClick,this);this._view=null;this._isOpened=false};BX.extend(BX.Crm.EntityEditorList,BX.Crm.EntityEditorField);BX.Crm.EntityEditorList.prototype.checkIfNotEmpty=function(t){return t!==""&&t!=="0"};BX.Crm.EntityEditorList.prototype.layout=function(t){if(this._hasLayout){return}var e=this.getName();var i=this.getTitle();var n=this.getValue();var r=this.getItemByValue(n);if(!r){r=this.getFirstItem();if(r){n=r["VALUE"]}}this._selectedValue=n;this._wrapper=BX.create("div",{props:{className:"crm-entity-widget-content-block crm-entity-widget-content-block-field-select"}});this._selectContainer=null;this._input=null;this._view=null;if(this._mode===BX.Crm.EntityEditorMode.edit){this._input=BX.create("input",{attrs:{name:e,type:"hidden",value:n}});this._wrapper.appendChild(this._input);this._selectContainer=BX.create("div",{props:{className:"crm-entity-widget-content-select"},text:r?r["NAME"]:n});BX.bind(this._selectContainer,"click",this._selectorClickHandler);this._wrapper.appendChild(this.createDragButton());this._wrapper.appendChild(this.createTitleNode(i));this._wrapper.appendChild(BX.create("div",{props:{className:"crm-entity-widget-content-block-inner crm-entity-widget-content-block-select"},children:[this._selectContainer]}));this._wrapper.appendChild(this.createContextMenuButton());this.initializeDragDropAbilities()}else if(this._mode===BX.Crm.EntityEditorMode.view&&this.checkIfNotEmpty(n)){this._wrapper.appendChild(this.createTitleNode(i));this._view=BX.create("div",{props:{className:"crm-entity-widget-content-block-inner"},text:r?r["NAME"]:n});this._wrapper.appendChild(this._view)}this.registerLayout(t);this._hasLayout=true};BX.Crm.EntityEditorList.prototype.clearLayout=function(){if(!this._hasLayout){return}this.releaseDragDropAbilities();this._wrapper=BX.remove(this._wrapper);this._input=null;this._selectContainer=null;this._hasLayout=false};BX.Crm.EntityEditorList.prototype.refreshLayout=function(){if(!this._hasLayout){return}var t=this.getValue();var e=this.getItemByValue(t);var i=e?BX.prop.getString(e,"NAME",t):t;if(this._mode===BX.Crm.EntityEditorMode.edit){this._selectedValue=t;if(this._input){this._input.value=t}if(this._selectContainer){this._selectContainer.innerHTML=BX.util.htmlspecialchars(i)}}else if(this._mode===BX.Crm.EntityEditorMode.view&&this._view){this._view.innerHTML=BX.util.htmlspecialchars(i)}};BX.Crm.EntityEditorList.prototype.validate=function(t){if(this._mode!==BX.Crm.EntityEditorMode.edit){throw"BX.Crm.EntityEditorList. Invalid validation context"}if(!this.isEditable()){return true}this.clearError();if(this.hasValidators()){return this.executeValidators(t)}var e=!this.isRequired()||BX.util.trim(this._input.value)!=="";if(!e){t.addError(BX.Crm.EntityValidationError.create({field:this}));this.showRequiredFieldError(this._input)}return e};BX.Crm.EntityEditorList.prototype.showError=function(t,e){BX.Crm.EntityEditorList.superclass.showError.apply(this,arguments);if(this._input){BX.addClass(this._input,"crm-entity-widget-content-error")}};BX.Crm.EntityEditorList.prototype.clearError=function(){BX.Crm.EntityEditorList.superclass.clearError.apply(this);if(this._input){BX.removeClass(this._input,"crm-entity-widget-content-error")}};BX.Crm.EntityEditorList.prototype.onSelectorClick=function(t){if(!this._isOpened){this.openMenu()}else{this.closeMenu()}};BX.Crm.EntityEditorList.prototype.openMenu=function(){if(this._isOpened){return}var t=[];var e=this.getItems();for(var i=0,n=e.length;i<n;i++){var r=e[i];if(!BX.prop.getBoolean(r,"IS_EDITABLE",true)){continue}var o=BX.prop.getString(r,"VALUE",i);var s=BX.prop.getString(r,"NAME",o);t.push({text:s,value:o,onclick:BX.delegate(this.onItemSelect,this)})}BX.PopupMenu.show(this._id,this._selectContainer,t,{angle:false,width:this._selectContainer.offsetWidth+"px",events:{onPopupShow:BX.delegate(this.onMenuShow,this),onPopupClose:BX.delegate(this.onMenuClose,this)}});BX.PopupMenu.currentItem.popupWindow.setWidth(BX.pos(this._selectContainer)["width"])};BX.Crm.EntityEditorList.prototype.closeMenu=function(){var t=BX.PopupMenu.getMenuById(this._id);if(t){t.popupWindow.close()}};BX.Crm.EntityEditorList.prototype.onMenuShow=function(){BX.addClass(this._selectContainer,"active");this._isOpened=true};BX.Crm.EntityEditorList.prototype.onMenuClose=function(){BX.PopupMenu.destroy(this._id);BX.removeClass(this._selectContainer,"active");this._isOpened=false};BX.Crm.EntityEditorList.prototype.onItemSelect=function(t,e){this.closeMenu();this._selectedValue=this._input.value=e.value;this._selectContainer.innerHTML=BX.util.htmlspecialchars(e.text);this.markAsChanged();BX.PopupMenu.destroy(this._id)};BX.Crm.EntityEditorList.prototype.getItems=function(){if(!this._items){this._items=BX.prop.getArray(this._schemeElement.getData(),"items")}return this._items};BX.Crm.EntityEditorList.prototype.getItemByValue=function(t){var e=this.getItems();for(var i=0,n=e.length;i<n;i++){var r=e[i];if(t===BX.prop.getString(r,"VALUE","")){return r}}return null};BX.Crm.EntityEditorList.prototype.getFirstItem=function(){var t=this.getItems();return t.length>0?t[0]:null};BX.Crm.EntityEditorList.prototype.save=function(){if(!this.isEditable()){return}this._model.setField(this.getName(),this._selectedValue)};BX.Crm.EntityEditorList.prototype.processModelChange=function(t){if(BX.prop.get(t,"originator",null)===this){return}if(!BX.prop.getBoolean(t,"forAll",false)&&BX.prop.getString(t,"name","")!==this.getName()){return}this.refreshLayout()};BX.Crm.EntityEditorList.create=function(t,e){var i=new BX.Crm.EntityEditorList;i.initialize(t,e);return i}}if(typeof BX.Crm.EntityEditorHtml==="undefined"){BX.Crm.EntityEditorHtml=function(){BX.Crm.EntityEditorHtml.superclass.constructor.apply(this);this._htmlEditorContainer=null;this._htmlEditor=null;this._input=null;this._editorInitializationHandler=BX.delegate(this.onEditorInitialized,this);this._viewClickHandler=BX.delegate(this.onViewClick,this)};BX.extend(BX.Crm.EntityEditorHtml,BX.Crm.EntityEditorField);BX.Crm.EntityEditorHtml.prototype.checkIfNotEmpty=function(t){return BX.Crm.EntityEditorHtml.isNotEmptyValue(t)};BX.Crm.EntityEditorHtml.prototype.layout=function(t){if(this._hasLayout){return}this.release();var e=this.getName();var i=this.getTitle();var n=this.getValue();this._wrapper=BX.create("div",{props:{className:"crm-entity-widget-content-block crm-entity-widget-content-block-field-html"}});this._input=null;if(this._mode===BX.Crm.EntityEditorMode.edit){if(!this._editor){throw"BX.Crm.EntityEditorHtml: Editor instance is required for create layout."}var r=this._editor.getHtmlEditorConfig();if(!r){throw"BX.Crm.EntityEditorHtml: Could not find HTML editor config."}this._htmlEditorContainer=BX(BX.prop.getString(r,"containerId"));if(!BX.type.isElementNode(this._htmlEditorContainer)){throw"BX.Crm.EntityEditorHtml: Could not find HTML editor container."}this._htmlEditor=BXHtmlEditor.Get(BX.prop.getString(r,"id"));if(!this._htmlEditor){throw"BX.Crm.EntityEditorHtml: Could not find HTML editor instance."}this._input=BX.create("input",{attrs:{name:e,type:"hidden",value:n}});this._wrapper.appendChild(this._input);this._wrapper.appendChild(this.createDragButton());this._wrapper.appendChild(this.createTitleNode(i));this._wrapper.appendChild(BX.create("div",{props:{className:"crm-entity-widget-content-block-inner"},children:[this._htmlEditorContainer]}));this._wrapper.appendChild(this.createContextMenuButton())}else if(this._mode===BX.Crm.EntityEditorMode.view&&this.checkIfNotEmpty(n)){this._wrapper.appendChild(this.createTitleNode(i));this._wrapper.appendChild(BX.create("div",{props:{className:"crm-entity-widget-content-block-inner"},html:n}));BX.bindDelegate(this._wrapper,"mousedown",BX.delegate(this._filterViewNode,this),this._viewClickHandler)}this.registerLayout(t);if(this._mode===BX.Crm.EntityEditorMode.edit){if(!!this._htmlEditor.inited){this.prepareEditor()}else{BX.addCustomEvent(this._htmlEditor,"OnCreateIframeAfter",this._editorInitializationHandler);this._htmlEditor.Init()}window.top.setTimeout(BX.delegate(this.bindChangeEvent,this),1e3);this.initializeDragDropAbilities()}this._hasLayout=true};BX.Crm.EntityEditorHtml.prototype._filterViewNode=function(t){return true};BX.Crm.EntityEditorHtml.prototype.onViewClick=function(t){var e=null;var i=BX.getEventTarget(t);if(i.tagName==="A"){e=i}else{e=BX.findParent(i,{tagName:"a"},this._wrapper)}if(e&&e.target!=="_blank"){e.target="_blank"}};BX.Crm.EntityEditorHtml.prototype.onEditorInitialized=function(){BX.removeCustomEvent(this._htmlEditor,"OnCreateIframeAfter",this._editorInitializationHandler);this.prepareEditor()};BX.Crm.EntityEditorHtml.prototype.prepareEditor=function(){this._htmlEditorContainer.style.display="";this._htmlEditor.CheckAndReInit();this._htmlEditor.ResizeSceleton("100%",200);this._htmlEditor.SetContent(this.getStringValue(""),true)};BX.Crm.EntityEditorHtml.prototype.clearLayout=function(){if(!this._hasLayout){return}this.releaseDragDropAbilities();this.release();this._wrapper=BX.remove(this._wrapper);this._htmlEditorWrapper=null;this._input=null;this._hasLayout=false};BX.Crm.EntityEditorHtml.prototype.release=function(){if(this._htmlEditorContainer){var t=this._htmlEditorContainer.parentNode;var e=BX.create("div",{style:{height:this._htmlEditorContainer.offsetHeight+"px",border:"1px solid #bbc4cd",boxSizing:"border-box"}});t.insertBefore(e,this._htmlEditorContainer);document.body.appendChild(this._htmlEditorContainer);this._htmlEditorContainer.style.display="none";this._htmlEditorContainer=null}if(this._htmlEditor){this.unbindChangeEvent();this._htmlEditor.SetContent("");this._htmlEditor=null}};BX.Crm.EntityEditorHtml.prototype.bindChangeEvent=function(){if(this._htmlEditor){BX.addCustomEvent(this._htmlEditor,"OnContentChanged",this._changeHandler)}};BX.Crm.EntityEditorHtml.prototype.unbindChangeEvent=function(){if(this._htmlEditor){BX.removeCustomEvent(this._htmlEditor,"OnContentChanged",this._changeHandler)}};BX.Crm.EntityEditorHtml.prototype.validate=function(t){if(!(this._mode===BX.Crm.EntityEditorMode.edit&&this._htmlEditor)){throw"BX.Crm.EntityEditorHtml. Invalid validation context"}this.clearError();if(this.hasValidators()){return this.executeValidators(t)}var e=!this.isRequired()||BX.Crm.EntityEditorHtml.isNotEmptyValue(this._htmlEditor.GetContent());if(!e){t.addError(BX.Crm.EntityValidationError.create({field:this}));this.showRequiredFieldError(this._htmlEditorContainer)}return e};BX.Crm.EntityEditorHtml.prototype.showError=function(t,e){BX.Crm.EntityEditorHtml.superclass.showError.apply(this,arguments);if(this._htmlEditorContainer){BX.addClass(this._htmlEditorContainer,"crm-entity-widget-content-error")}};BX.Crm.EntityEditorHtml.prototype.clearError=function(){BX.Crm.EntityEditorHtml.superclass.clearError.apply(this);if(this._htmlEditorContainer){BX.removeClass(this._htmlEditorContainer,"crm-entity-widget-content-error")}};BX.Crm.EntityEditorHtml.prototype.save=function(){if(this._htmlEditor){var t=this._input.value=this._htmlEditor.GetContent();this._model.setField(this.getName(),t)}};BX.Crm.EntityEditorHtml.isNotEmptyValue=function(t){return BX.util.trim(t.replace(/<br\/?>|&nbsp;/gi,""))!==""};BX.Crm.EntityEditorHtml.create=function(t,e){var i=new BX.Crm.EntityEditorHtml;i.initialize(t,e);return i}}if(typeof BX.Crm.EntityEditorMoney==="undefined"){BX.Crm.EntityEditorMoney=function(){BX.Crm.EntityEditorMoney.superclass.constructor.apply(this);this._currencyEditor=null;this._amountInput=null;this._currencyInput=null;this._sumElement=null;this._selectContainer=null;this._inputWrapper=null;this._selectedCurrencyValue="";this._selectorClickHandler=BX.delegate(this.onSelectorClick,this);this._isCurrencyMenuOpened=false};BX.extend(BX.Crm.EntityEditorMoney,BX.Crm.EntityEditorField);BX.Crm.EntityEditorMoney.prototype.focus=function(){if(this._mode===BX.Crm.EntityEditorMode.edit){this.scrollAnimate();this._amountInput.focus()}};BX.Crm.EntityEditorMoney.prototype.getValue=function(t){if(!this._model){return""}return this._model.getStringField(this.getAmountFieldName(),t!==undefined?t:"")};BX.Crm.EntityEditorMoney.prototype.layout=function(t){if(this._hasLayout){return}var e=this.getName();var i=this.getTitle();var n=this.getData();var r=BX.prop.getString(n,"amount");var o=BX.prop.getString(BX.prop.getObject(n,"currency"),"name");var s=this._model.getField(BX.prop.getString(BX.prop.getObject(n,"currency"),"name",""));if(!BX.type.isNotEmptyString(s)){s=BX.Currency.Editor.getBaseCurrencyId()}this._selectedCurrencyValue=s;var a=this._editor.findOption(s,BX.prop.getArray(BX.prop.getObject(n,"currency"),"items"));var l=this.getAmountFieldName();var d=this._model.getField(l,"");var h=this._model.getField(BX.prop.getString(n,"formatted"),"");var p=this._model.getField(BX.prop.getString(n,"formattedWithCurrency"),"");this._wrapper=BX.create("div",{props:{className:"crm-entity-widget-content-block crm-entity-widget-content-block-field-money"}});this._amountValue=null;this._amountInput=null;this._currencyInput=null;this._selectContainer=null;if(this._mode===BX.Crm.EntityEditorMode.edit){this._amountValue=BX.create("input",{attrs:{name:r,type:"hidden",value:d}});this._amountInput=BX.create("input",{attrs:{className:"crm-entity-widget-content-input",type:"text",value:d}});BX.bind(this._amountInput,"input",this._changeHandler);if(this._model.isFieldLocked(l)){this._amountInput.disabled=true}this._currencyInput=BX.create("input",{attrs:{name:o,type:"hidden",value:s}});this._selectContainer=BX.create("div",{props:{className:"crm-entity-widget-content-select"},text:a});BX.bind(this._selectContainer,"click",this._selectorClickHandler);this._wrapper.appendChild(this.createDragButton());this._wrapper.appendChild(this.createTitleNode(i));this._inputWrapper=BX.create("div",{props:{className:"crm-entity-widget-content-block-input-wrapper"},children:[this._amountValue,this._amountInput,this._currencyInput,BX.create("div",{props:{className:"crm-entity-widget-content-block-select"},children:[this._selectContainer]})]});this._wrapper.appendChild(BX.create("div",{props:{className:"crm-entity-widget-content-block-inner crm-entity-widget-content-block-colums-input"},children:[this._inputWrapper]}));this._currencyEditor=new BX.Currency.Editor({input:this._amountInput,currency:s,callback:BX.delegate(this.onAmountValueChange,this)});this._currencyEditor.changeValue();this._wrapper.appendChild(this.createContextMenuButton());this.initializeDragDropAbilities()}else{this._sumElement=BX.create("span",{attrs:{className:"crm-entity-widget-content-block-wallet"}});this._sumElement.innerHTML=this.renderMoney();this._wrapper.appendChild(this.createTitleNode(i));this._wrapper.appendChild(BX.create("div",{props:{className:"crm-entity-widget-content-block-inner"},children:[BX.create("div",{props:{className:"crm-entity-widget-content-block-colums-block"},children:[BX.create("span",{props:{className:"crm-entity-widget-content-block-colums"},children:[this._sumElement]})]})]}))}this.registerLayout(t);this._hasLayout=true};BX.Crm.EntityEditorMoney.prototype.clearLayout=function(){if(!this._hasLayout){return}this.releaseDragDropAbilities();BX.PopupMenu.destroy(this._id);if(this._currencyEditor){this._currencyEditor.clean();this._currencyEditor=null}this._wrapper=BX.remove(this._wrapper);this._amountValue=null;this._amountInput=null;this._currencyInput=null;this._sumElement=null;this._selectContainer=null;this._inputWrapper=null;this._hasLayout=false};BX.Crm.EntityEditorMoney.prototype.refreshLayout=function(){if(!(this._hasLayout&&this._isValidLayout)){return}var t;if(this._mode===BX.Crm.EntityEditorMode.edit&&this._amountInput){t=this.getAmountFieldName();this._amountInput.value=this._model.getField(t,"");this._amountInput.disabled=this._model.isFieldLocked(t)}else if(this._mode===BX.Crm.EntityEditorMode.view&&this._sumElement){this._sumElement.innerHTML=this.renderMoney()}};BX.Crm.EntityEditorMoney.prototype.onAmountValueChange=function(t){if(this._amountValue){this._amountValue.value=t}};BX.Crm.EntityEditorMoney.prototype.getAmountFieldName=function(){return this._schemeElement.getDataStringParam("amount","")};BX.Crm.EntityEditorMoney.prototype.getCurrencyFieldName=function(){return BX.prop.getString(this._schemeElement.getDataObjectParam("currency",{}),"name","")};BX.Crm.EntityEditorMoney.prototype.onSelectorClick=function(t){this.openCurrencyMenu()};BX.Crm.EntityEditorMoney.prototype.openCurrencyMenu=function(){if(this._isCurrencyMenuOpened){return}var t=this._schemeElement.getData();var e=BX.prop.getArray(BX.prop.getObject(t,"currency"),"items");var i=0;var n=[];while(i<e.length){n.push({text:e[i]["NAME"],value:e[i]["VALUE"],onclick:BX.delegate(this.onCurrencySelect,this)});i++}BX.PopupMenu.show(this._id,this._selectContainer,n,{angle:false,width:this._selectContainer.offsetWidth+"px",events:{onPopupShow:BX.delegate(this.onCurrencyMenuOpen,this),onPopupClose:BX.delegate(this.onCurrencyMenuClose,this)}});BX.PopupMenu.currentItem.popupWindow.setWidth(BX.pos(this._selectContainer)["width"])};BX.Crm.EntityEditorMoney.prototype.closeCurrencyMenu=function(){if(!this._isCurrencyMenuOpened){return}var t=BX.PopupMenu.getMenuById(this._id);if(t){t.popupWindow.close()}};BX.Crm.EntityEditorMoney.prototype.onCurrencyMenuOpen=function(){BX.addClass(this._selectContainer,"active");this._isCurrencyMenuOpened=true};BX.Crm.EntityEditorMoney.prototype.onCurrencyMenuClose=function(){BX.PopupMenu.destroy(this._id);BX.removeClass(this._selectContainer,"active");this._isCurrencyMenuOpened=false};BX.Crm.EntityEditorMoney.prototype.onCurrencySelect=function(t,e){this.closeCurrencyMenu();this._selectedCurrencyValue=this._currencyInput.value=e.value;this._selectContainer.innerHTML=BX.util.htmlspecialchars(e.text);if(this._currencyEditor){this._currencyEditor.setCurrency(this._selectedCurrencyValue)}this.markAsChanged({fieldName:this.getCurrencyFieldName(),fieldValue:this._selectedCurrencyValue})};BX.Crm.EntityEditorMoney.prototype.processModelChange=function(t){if(BX.prop.get(t,"originator",null)===this){return}if(!BX.prop.getBoolean(t,"forAll",false)&&BX.prop.getString(t,"name","")!==this.this.getAmountFieldName()){return}this.refreshLayout()};BX.Crm.EntityEditorMoney.prototype.processModelLock=function(t){var e=BX.prop.getString(t,"name","");if(this.getAmountFieldName()===e){this.refreshLayout()}};BX.Crm.EntityEditorMoney.prototype.validate=function(t){if(!(this._mode===BX.Crm.EntityEditorMode.edit&&this._amountInput&&this._amountValue)){throw"BX.Crm.EntityEditorMoney. Invalid validation context"}this.clearError();if(this.hasValidators()){return this.executeValidators(t)}var e=!this.isRequired()||BX.util.trim(this._amountValue.value)!=="";if(!e){t.addError(BX.Crm.EntityValidationError.create({field:this}));this.showRequiredFieldError(this._inputWrapper)}return e};BX.Crm.EntityEditorMoney.prototype.showError=function(t,e){BX.Crm.EntityEditorMoney.superclass.showError.apply(this,arguments);if(this._amountInput){BX.addClass(this._amountInput,"crm-entity-widget-content-error")}};BX.Crm.EntityEditorMoney.prototype.clearError=function(){BX.Crm.EntityEditorMoney.superclass.clearError.apply(this);if(this._amountInput){BX.removeClass(this._amountInput,"crm-entity-widget-content-error")}};BX.Crm.EntityEditorMoney.prototype.save=function(){var t=this._schemeElement.getData();this._model.setField(BX.prop.getString(BX.prop.getObject(t,"currency"),"name"),this._selectedCurrencyValue);if(this._amountValue){this._model.setField(BX.prop.getString(t,"amount"),this._amountValue.value);this._model.setField(BX.prop.getString(t,"formatted"),this._amountValue.value);this._editor.formatMoney(this._amountValue.value,this._selectedCurrencyValue,BX.delegate(this.onMoneyFormatRequestSuccess,this))}};BX.Crm.EntityEditorMoney.prototype.onMoneyFormatRequestSuccess=function(t){var e=this._schemeElement.getData();var i=BX.type.isNotEmptyString(t["FORMATTED_SUM_WITH_CURRENCY"])?t["FORMATTED_SUM_WITH_CURRENCY"]:"";this._model.setField(BX.prop.getString(e,"formattedWithCurrency"),i);var n=BX.type.isNotEmptyString(t["FORMATTED_SUM"])?t["FORMATTED_SUM"]:"";this._model.setField(BX.prop.getString(e,"formatted"),n);if(this._sumElement){while(this._sumElement.firstChild){this._sumElement.removeChild(this._sumElement.firstChild)}this._sumElement.innerHTML=this.renderMoney()}};BX.Crm.EntityEditorMoney.prototype.renderMoney=function(){var t=this._schemeElement.getData();var e=this._model.getField(BX.prop.getString(t,"formattedWithCurrency"),"");var i=this._model.getField(BX.prop.getString(t,"formatted"),"");var n=BX.Currency.Editor.trimTrailingZeros(i,this._selectedCurrencyValue);return e.replace(i,'<span class="crm-entity-widget-content-block-colums-right">'+n+"</span>")};BX.Crm.EntityEditorMoney.create=function(t,e){var i=new BX.Crm.EntityEditorMoney;i.initialize(t,e);return i}}if(typeof BX.Crm.EntityEditorImage==="undefined"){BX.Crm.EntityEditorImage=function(){BX.Crm.EntityEditorImage.superclass.constructor.apply(this);this._innerWrapper=null};BX.extend(BX.Crm.EntityEditorImage,BX.Crm.EntityEditorField);BX.Crm.EntityEditorImage.prototype.layout=function(t){if(this._hasLayout){return}var e=this._mode===BX.Crm.EntityEditorMode.view;var i=this.getName();var n=this.getTitle();var r=this._model.getMappedField(this.getData(),"showUrl","");this._wrapper=BX.create("div",{props:{className:"crm-entity-widget-content-block crm-entity-widget-content-block-field-file"}});this._fileInput=null;if(!e){this._wrapper.appendChild(this.createDragButton());this._wrapper.appendChild(this.createTitleNode(n));this._fileInput=BX.create("input",{props:{type:"file",name:i}});this._innerWrapper=BX.create("div",{props:{className:"crm-entity-widget-content-block-inner"}});this._wrapper.appendChild(this._innerWrapper);this._editor.loadCustomHtml("RENDER_IMAGE_INPUT",{FIELD_NAME:i},BX.delegate(this.onEditorHtmlLoad,this));this._wrapper.appendChild(this.createContextMenuButton());this.initializeDragDropAbilities()}else if(r!==""){this._wrapper.appendChild(this.createTitleNode(n));this._innerWrapper=BX.create("div",{props:{className:"crm-entity-widget-content-block-inner"}});this._wrapper.appendChild(this._innerWrapper);this._innerWrapper.appendChild(BX.create("img",{props:{className:"crm-entity-widget-content-block-photo",src:r}}))}this.registerLayout(t);this._hasLayout=true};BX.Crm.EntityEditorImage.prototype.onEditorHtmlLoad=function(t){if(this._mode===BX.Crm.EntityEditorMode.edit&&this._innerWrapper){this._innerWrapper.innerHTML=t}};BX.Crm.EntityEditorImage.prototype.clearLayout=function(){if(!this._hasLayout){return}this.releaseDragDropAbilities();this._innerWrapper=null;this._wrapper=BX.remove(this._wrapper);this._hasLayout=false};BX.Crm.EntityEditorImage.create=function(t,e){var i=new BX.Crm.EntityEditorImage;i.initialize(t,e);return i}}if(typeof BX.Crm.EntityEditorUser==="undefined"){BX.Crm.EntityEditorUser=function(){BX.Crm.EntityEditorUser.superclass.constructor.apply(this);this._input=null;this._editButton=null;this._photoElement=null;this._nameElement=null;this._positionElement=null;this._userSelector=null;this._selectedData={};this._editButtonClickHandler=BX.delegate(this.onEditBtnClick,this)};BX.extend(BX.Crm.EntityEditorUser,BX.Crm.EntityEditorField);BX.Crm.EntityEditorUser.prototype.layout=function(t){if(this._hasLayout){return}var e=this._schemeElement.getName();var i=this._schemeElement.getTitle();var n=this._model.getField(e);var r=this._model.getSchemeField(this._schemeElement,"formated","");var o=this._model.getSchemeField(this._schemeElement,"position","");var s=this._model.getSchemeField(this._schemeElement,"showUrl","","");var a=this._model.getSchemeField(this._schemeElement,"photoUrl","");var l=this._mode===BX.Crm.EntityEditorMode.view;var d=this.isEditInViewEnabled()&&!this.isReadOnly();this._photoElement=BX.create("a",{props:{className:"crm-widget-employee-avatar-container",href:s,target:"_blank"},style:{backgroundImage:a!==""?"url('"+a+"')":"",backgroundSize:a!==""?"30px":""}});this._nameElement=BX.create("a",{props:{className:"crm-widget-employee-name",href:s,target:"_blank"},text:r});this._positionElement=BX.create("SPAN",{props:{className:"crm-widget-employee-position"},text:o});this._wrapper=BX.create("div",{props:{className:"crm-entity-widget-content-block"}});if(!l){this._wrapper.appendChild(this.createDragButton())}this._wrapper.appendChild(this.createTitleNode(i));this.registerLayout(t);var h=BX.create("div",{props:{className:"crm-widget-employee-container"}});this._editButton=null;this._input=null;if(!l||d){this._input=BX.create("input",{attrs:{name:e,type:"hidden",value:n}});this._wrapper.appendChild(this._input);this._editButton=BX.create("span",{props:{className:"crm-widget-employee-change"},text:this.getMessage("change")});BX.bind(this._editButton,"click",this._editButtonClickHandler);h.appendChild(this._editButton)}h.appendChild(this._photoElement);h.appendChild(BX.create("span",{props:{className:"crm-widget-employee-info"},children:[this._nameElement,this._positionElement]}));this._wrapper.appendChild(BX.create("div",{props:{className:"crm-entity-widget-content-block-text"},children:[h]}));if(!l){this._wrapper.appendChild(this.createContextMenuButton());this.initializeDragDropAbilities()}this._hasLayout=true};BX.Crm.EntityEditorUser.prototype.clearLayout=function(){if(!this._hasLayout){return}this.releaseDragDropAbilities();this._wrapper=BX.remove(this._wrapper);this._input=null;this._editButton=null;this._photoElement=null;this._nameElement=null;this._positionElement=null;this._hasLayout=false};BX.Crm.EntityEditorUser.prototype.onEditBtnClick=function(t){if(!this._userSelector){this._userSelector=BX.Crm.EntityEditorUserSelector.create(this._id,{callback:BX.delegate(this.processItemSelect,this)})}this._userSelector.open(this._editButton)};BX.Crm.EntityEditorUser.prototype.processItemSelect=function(t,e){var i=this._mode===BX.Crm.EntityEditorMode.view;var n=this.isEditInViewEnabled();if(i&&!n){return}this._selectedData={id:BX.prop.getInteger(e,"entityId",0),photoUrl:BX.prop.getString(e,"avatar",""),formattedNameHtml:BX.prop.getString(e,"name",""),positionHtml:BX.prop.getString(e,"desc","")};this._input.value=this._selectedData["id"];this._photoElement.style.backgroundImage=this._selectedData["photoUrl"]!==""?"url('"+this._selectedData["photoUrl"]+"')":"";this._photoElement.style.backgroundSize=this._selectedData["photoUrl"]!==""?"30px":"";this._nameElement.innerHTML=this._selectedData["formattedNameHtml"];this._positionElement.innerHTML=this._selectedData["positionHtml"];this._userSelector.close();if(!i){this.markAsChanged()}else{this._editor.saveControl(this)}};BX.Crm.EntityEditorUser.prototype.save=function(){var t=this._schemeElement.getData();if(this._selectedData["id"]>0){var e=this._selectedData["id"];this._model.setField(this.getName(),e);this._model.setField(BX.prop.getString(t,"formated"),BX.util.htmlspecialcharsback(this._selectedData["formattedNameHtml"]));this._model.setField(BX.prop.getString(t,"position"),this._selectedData["positionHtml"]!=="&nbsp;"?BX.util.htmlspecialcharsback(this._selectedData["positionHtml"]):"");this._model.setField(BX.prop.getString(t,"showUrl"),BX.prop.getString(t,"pathToProfile").replace(/#user_id#/gi,e));this._model.setField(BX.prop.getString(t,"photoUrl"),this._selectedData["photoUrl"])}};BX.Crm.EntityEditorUser.prototype.getMessage=function(t){var e=BX.Crm.EntityEditorUser.messages;return e.hasOwnProperty(t)?e[t]:BX.Crm.EntityEditorUser.superclass.getMessage.apply(this,arguments)};if(typeof BX.Crm.EntityEditorUser.messages==="undefined"){BX.Crm.EntityEditorUser.messages={}}BX.Crm.EntityEditorUser.create=function(t,e){var i=new BX.Crm.EntityEditorUser;i.initialize(t,e);return i}}if(typeof BX.Crm.EntityEditorAddress==="undefined"){BX.Crm.EntityEditorAddress=function(){BX.Crm.EntityEditorAddress.superclass.constructor.apply(this)};BX.extend(BX.Crm.EntityEditorAddress,BX.Crm.EntityEditorField);BX.Crm.EntityEditorAddress.prototype.layout=function(t){if(this._hasLayout){return}var e=this._mode===BX.Crm.EntityEditorMode.view;var i=this._schemeElement.getName();var n=this.getTitle();var r=this._schemeElement.getDataObjectParam("fields",{});var o=this._schemeElement.getDataObjectParam("labels",{});this._wrapper=BX.create("div",{attrs:{className:"crm-entity-widget-content-block"}});if(!e){this._wrapper.appendChild(this.createDragButton());this._wrapper.appendChild(this.createTitleNode(n));var s=BX.create("div",{attrs:{className:"crm-entity-widget-content-block-inner crm-entity-widget-content-block-inner-address"}});this._wrapper.appendChild(s);for(var a in r){if(!r.hasOwnProperty(a)){return}var l=r[a];var d=BX.prop.getString(o,a,a);this.layoutField(a,l,d,s)}this._wrapper.appendChild(this.createContextMenuButton());this.initializeDragDropAbilities()}else{var h=this._schemeElement.getDataStringParam("view","");if(h===""){h=i+"_HML"}var p=this._model.getStringField(h,"");if(p!==""){this._wrapper.appendChild(this.createTitleNode(n));this._wrapper.appendChild(BX.create("div",{attrs:{className:"crm-entity-widget-content-block-inner"},html:p}))}}this.registerLayout(t);this._hasLayout=true};BX.Crm.EntityEditorAddress.prototype.layoutField=function(t,e,i,n){var r=BX.prop.getString(e,"NAME",t);var o=this._model.getStringField(r,"");n.appendChild(BX.create("div",{props:{className:"crm-entity-widget-content-block-title"},text:i}));if(BX.prop.getBoolean(e,"IS_MULTILINE",false)){n.appendChild(BX.create("textarea",{props:{className:"crm-entity-widget-content-input",name:r,type:"text",value:o}}))}else{n.appendChild(BX.create("input",{props:{className:"crm-entity-widget-content-input",name:r,type:"text",value:o}}))}};BX.Crm.EntityEditorAddress.prototype.clearLayout=function(){if(!this._hasLayout){return}this.releaseDragDropAbilities();this._wrapper=BX.remove(this._wrapper);this._hasLayout=false};BX.Crm.EntityEditorAddress.create=function(t,e){var i=new BX.Crm.EntityEditorAddress;i.initialize(t,e);return i}}if(typeof BX.Crm.EntityEditorMultifieldItem==="undefined"){BX.Crm.EntityEditorMultifieldItem=function(){this._id="";this._settings={};this._parent=null;this._editor=null;this._mode=BX.Crm.EntityEditorMode.view;this._data=null;this._typeId="";this._valueTypeItems=null;this._container=null;this._wrapper=null;this._valueInput=null;this._valueTypeInput=null;this._valueTypeSelector=null;this._hasLayout=false};BX.Crm.EntityEditorMultifieldItem.prototype={initialize:function(t,e){this._id=BX.type.isNotEmptyString(t)?t:BX.util.getRandomString(4);this._settings=e?e:{};this._parent=BX.prop.get(this._settings,"parent",null);this._editor=this._parent.getEditor();this._mode=BX.prop.getInteger(this._settings,"mode",BX.Crm.EntityEditorMode.view);this._typeId=BX.prop.getString(this._settings,"typeId","");this._data=BX.prop.getObject(this._settings,"data",{});this._valueTypeItems=BX.prop.getArray(this._settings,"valueTypeItems",[]);this._container=BX.prop.getElementNode(this._settings,"container",null)},getId:function(){return this._id},isEmpty:function(){return BX.util.trim(this.getValue())===""},getTypeId:function(){return this._typeId},getValue:function(){return BX.prop.getString(this._data,"VALUE","")},getValueId:function(){return BX.prop.getString(this._data,"ID","")},getValueTypeId:function(){var t=BX.prop.getString(this._data,"VALUE_TYPE","");return t!==""?t:this.getDefaultValueTypeId()},getDefaultValueTypeId:function(){return this._valueTypeItems.length>0?BX.prop.getString(this._valueTypeItems[0],"VALUE"):""},getViewData:function(){return BX.prop.getObject(this._data,"VIEW_DATA",{})},resolveValueTypeName:function(t){if(t===""){return""}for(var e=0,i=this._valueTypeItems.length;e<i;e++){var n=this._valueTypeItems[e];if(t===BX.prop.getString(n,"VALUE","")){return BX.prop.getString(n,"NAME",t)}}return t},prepareControlName:function(t){return this.getTypeId()+"["+this.getValueId()+"]"+"["+t+"]"},getMode:function(){return this._mode},setMode:function(t){this._mode=t},getContainer:function(){return this._container},setContainer:function(t){this._container=t;if(this._hasLayout){this.clearLayout()}},layout:function(){if(this._hasLayout){return}this._valueInput=null;this._valueTypeInput=null;this._valueTypeSelector=null;var t=this.getValueTypeId();var e=this.getValue();this._wrapper=BX.create("div",{props:{className:"crm-entity-widget-content-block-inner crm-entity-widget-content-block-colums-input"}});this._container.appendChild(this._wrapper);if(this._mode===BX.Crm.EntityEditorMode.edit){this._valueInput=BX.create("input",{attrs:{className:"crm-entity-widget-content-input",name:this.prepareControlName("VALUE"),type:"text",value:e}});BX.bind(this._valueInput,"input",BX.delegate(this.onValueChange,this));this._wrapper.appendChild(this._valueInput);this._valueTypeInput=BX.create("input",{attrs:{name:this.prepareControlName("VALUE_TYPE"),type:"hidden",value:t}});this._wrapper.appendChild(this._valueTypeInput);this._valueTypeSelector=BX.create("div",{props:{className:"crm-entity-widget-content-select"},text:this.resolveValueTypeName(t),events:{click:BX.delegate(this.onValueTypeSelectorClick,this)}});this._wrapper.appendChild(BX.create("div",{attrs:{className:"crm-entity-widget-content-block-select"},children:[this._valueTypeSelector]}));if(this._editor.isDuplicateControlEnabled()){var i=this._parent.getDuplicateControlConfig();if(i){if(!BX.type.isPlainObject(i["field"])){i["field"]={}}i["field"]["id"]=this.getValueId();i["field"]["element"]=this._valueInput;this._editor.getDuplicateManager().registerField(i)}}}else if(this._mode===BX.Crm.EntityEditorMode.view){var n=this.getViewData();var r=BX.prop.getString(n,"value","");if(r===""){r=BX.util.htmlspecialchars(e)}this._wrapper.appendChild(BX.create("span",{attrs:{className:"crm-entity-widget-content-block-mutlifield-type"},text:this.resolveValueTypeName(t)}));var o=BX.create("span",{attrs:{className:"crm-entity-widget-content-block-mutlifield-value"},html:r});this._wrapper.appendChild(o);if(this._parent.getMultifieldType()==="EMAIL"){var s=o.querySelector("a.crm-entity-email");if(s){BX.bind(s,"click",BX.delegate(this.onEmailClick,this))}}}this._hasLayout=true},clearLayout:function(){if(!this._hasLayout){return}if(this._editor.isDuplicateControlEnabled()){var t=this._parent.getDuplicateControlConfig();if(t){if(!BX.type.isPlainObject(t["field"])){t["field"]={}}t["field"]["id"]=this.getValueId();this._editor.getDuplicateManager().unregisterField(t)}}this._wrapper=BX.remove(this._wrapper);this._hasLayout=false},onValueChange:function(t){this._parent.processItemChange(this)},onValueTypeSelectorClick:function(t){var e=[];for(var i=0,n=this._valueTypeItems.length;i<n;i++){var r=this._valueTypeItems[i];e.push({text:r["NAME"],value:r["VALUE"],onclick:BX.delegate(this.onValueTypeSelect,this)})}BX.addClass(this._valueTypeSelector,"active");BX.PopupMenu.destroy(this._id);BX.PopupMenu.show(this._id,this._valueTypeSelector,e,{angle:false,width:this._valueTypeSelector.offsetWidth+"px",events:{onPopupClose:BX.delegate(this.onValuTypeMenuClose,this)}});BX.PopupMenu.currentItem.popupWindow.setWidth(BX.pos(this._valueTypeSelector)["width"])},onValuTypeMenuClose:function(t){BX.removeClass(this._valueTypeSelector,"active")},onValueTypeSelect:function(t,e){BX.removeClass(this._valueTypeSelector,"active");this._valueTypeInput.value=e.value;this._valueTypeSelector.innerHTML=BX.util.htmlspecialchars(e.text);this._parent.processItemChange(this);BX.PopupMenu.destroy(this._id)},onEmailClick:function(t){if(BX.CrmActivityEditor){var e=this._editor.getOwnerInfo();var i={ownerType:e["ownerType"],ownerID:e["ownerID"],communications:[{entityType:e["ownerType"],entityId:e["ownerID"],type:"EMAIL",value:this.getValue()}]};BX.CrmActivityEditor.addEmail(i)}return BX.PreventDefault(t)}};BX.Crm.EntityEditorMultifieldItem.create=function(t,e){var i=new BX.Crm.EntityEditorMultifieldItem;i.initialize(t,e);return i}}if(typeof BX.Crm.EntityEditorMultifieldItemPhone==="undefined"){BX.Crm.EntityEditorMultifieldItemPhone=function(){this._maskedPhone=null;this._maskedValueInput=null;this._countryFlagNode=null};BX.extend(BX.Crm.EntityEditorMultifieldItemPhone,BX.Crm.EntityEditorMultifieldItem);BX.Crm.EntityEditorMultifieldItemPhone.prototype.layout=function(){var t=this;if(this._hasLayout){return}this._valueInput=null;this._valueTypeInput=null;this._valueTypeSelector=null;var e=this.getValueTypeId();var i=this.getValue();this._wrapper=BX.create("div",{props:{className:"crm-entity-widget-content-block-inner crm-entity-widget-content-block-colums-input"}});this._container.appendChild(this._wrapper);if(this._mode===BX.Crm.EntityEditorMode.edit){this._valueInput=BX.create("input",{attrs:{name:this.prepareControlName("VALUE"),type:"hidden",value:i}});this._wrapper.appendChild(this._valueInput);this._wrapper.appendChild(BX.create("div",{props:{className:"crm-entity-widget-content-input-phone-wrapper"},children:[this._countryFlagNode=BX.create("span",{props:{className:"crm-entity-widget-content-country-flag"}}),this._maskedValueInput=BX.create("input",{attrs:{className:"crm-entity-widget-content-input crm-entity-widget-content-input-phone",type:"text",value:i}})]}));this._maskedPhone=new BX.PhoneNumber.Input({node:this._maskedValueInput,flagNode:this._countryFlagNode,flagSize:24,onChange:function(e){t._valueInput.value=e.value;t.onValueChange()}});this._valueTypeInput=BX.create("input",{attrs:{name:this.prepareControlName("VALUE_TYPE"),type:"hidden",value:e}});this._wrapper.appendChild(this._valueTypeInput);this._valueTypeSelector=BX.create("div",{props:{className:"crm-entity-widget-content-select"},text:this.resolveValueTypeName(e),events:{click:BX.delegate(this.onValueTypeSelectorClick,this)}});this._wrapper.appendChild(BX.create("div",{attrs:{className:"crm-entity-widget-content-block-select"},children:[this._valueTypeSelector]}));if(this._editor.isDuplicateControlEnabled()){var n=this._parent.getDuplicateControlConfig();if(n){if(!BX.type.isPlainObject(n["field"])){n["field"]={}}n["field"]["id"]=this.getValueId();n["field"]["element"]=this._maskedValueInput;this._editor.getDuplicateManager().registerField(n)}}}else if(this._mode===BX.Crm.EntityEditorMode.view){var r=this.getViewData();var o=BX.prop.getString(r,"value","");if(o===""){o=BX.util.htmlspecialchars(i)}this._wrapper.appendChild(BX.create("span",{attrs:{className:"crm-entity-widget-content-block-mutlifield-type"},text:this.resolveValueTypeName(e)}));this._wrapper.appendChild(BX.create("span",{attrs:{className:"crm-entity-widget-content-block-mutlifield-value"},html:o}))}this._hasLayout=true};BX.Crm.EntityEditorMultifieldItemPhone.create=function(t,e){var i=new BX.Crm.EntityEditorMultifieldItemPhone;i.initialize(t,e);return i}}if(typeof BX.Crm.EntityEditorMultifield==="undefined"){BX.Crm.EntityEditorMultifield=function(){BX.Crm.EntityEditorMultifield.superclass.constructor.apply(this);this._items=null;this._itemWrapper=null};BX.extend(BX.Crm.EntityEditorMultifield,BX.Crm.EntityEditorField);BX.Crm.EntityEditorMultifield.prototype.doInitialize=function(){this.initializeItems()};BX.Crm.EntityEditorMultifield.prototype.initializeItems=function(){var t=this.getName();var e=this._model.getField(t,[]);if(e.length===0){e.push({ID:"n0"})}for(var i=0,n=e.length;i<n;i++){this.addItem(e[i])}};BX.Crm.EntityEditorMultifield.prototype.resetItems=function(){if(this._hasLayout){for(var t=0,e=this._items.length;t<e;t++){this._items[t].clearLayout()}}this._items=[]};BX.Crm.EntityEditorMultifield.prototype.hasValue=function(){var t=this._items.length;if(t===0){return false}for(var e=0;e<t;e++){if(!this._items[e].isEmpty()){return true}}return false};BX.Crm.EntityEditorMultifield.prototype.processModelChange=function(t){if(BX.prop.get(t,"originator",null)===this){return}if(!BX.prop.getBoolean(t,"forAll",false)&&BX.prop.getString(t,"name","")!==this.getName()){return}this.refreshLayout()};BX.Crm.EntityEditorMultifield.prototype.prepareItemsLayout=function(){for(var t=0,e=this._items.length;t<e;t++){var i=this._items[t];i.setMode(this._mode);i.setContainer(this._itemWrapper);i.layout()}};BX.Crm.EntityEditorMultifield.prototype.refreshLayout=function(){if(!this._hasLayout){return}this.resetItems();this.initializeItems();this.prepareItemsLayout()};BX.Crm.EntityEditorMultifield.prototype.layout=function(t){if(this._hasLayout){return}var e=this._schemeElement.getTitle();this._wrapper=BX.create("div",{attrs:{className:"crm-entity-widget-content-block crm-entity-widget-content-block-field-multifield"}});if(this._mode===BX.Crm.EntityEditorMode.edit){this._wrapper.appendChild(this.createDragButton())}if(this._mode===BX.Crm.EntityEditorMode.edit){this._wrapper.appendChild(this.createTitleNode(e));this._itemWrapper=BX.create("div",{});this._wrapper.appendChild(this._itemWrapper);this.prepareItemsLayout();this._wrapper.appendChild(BX.create("div",{attrs:{className:"crm-entity-widget-content-block-add-field"},children:[BX.create("span",{attrs:{className:"crm-entity-widget-content-add-field"},text:this.getMessage("add"),events:{click:BX.delegate(this.onAddButtonClick,this)}})]}));this._wrapper.appendChild(this.createContextMenuButton());this.initializeDragDropAbilities()}else if(this._mode===BX.Crm.EntityEditorMode.view&&this.hasValue()){this._wrapper.appendChild(this.createTitleNode(e));this._itemWrapper=BX.create("div",{});this._wrapper.appendChild(this._itemWrapper);this.prepareItemsLayout()}this.registerLayout(t);this._hasLayout=true};BX.Crm.EntityEditorMultifield.prototype.clearLayout=function(){if(!this._hasLayout){return}this.releaseDragDropAbilities();for(var t=0,e=this._items.length;t<e;t++){var i=this._items[t];i.clearLayout();i.setContainer(null)}this._wrapper=BX.remove(this._wrapper);this._hasLayout=false};BX.Crm.EntityEditorMultifield.prototype.getMultifieldType=function(){return this._schemeElement.getDataStringParam("type","")};BX.Crm.EntityEditorMultifield.prototype.addItem=function(t){var e;var i=this._schemeElement.getName();if(i==="PHONE"){e=BX.Crm.EntityEditorMultifieldItemPhone.create("",{parent:this,typeId:this._schemeElement.getName(),valueTypeItems:this._schemeElement.getDataArrayParam("items",[]),data:t})}else{e=BX.Crm.EntityEditorMultifieldItem.create("",{parent:this,typeId:this._schemeElement.getName(),valueTypeItems:this._schemeElement.getDataArrayParam("items",[]),data:t})}if(this._items===null){this._items=[]}this._items.push(e);if(this._hasLayout){e.setMode(this._mode);e.setContainer(this._itemWrapper);e.layout()}return e};BX.Crm.EntityEditorMultifield.prototype.onAddButtonClick=function(t){this.addItem({ID:"n"+this._items.length.toString()})};BX.Crm.EntityEditorMultifield.prototype.processItemChange=function(t){this.markAsChanged()};BX.Crm.EntityEditorMultifield.create=function(t,e){var i=new BX.Crm.EntityEditorMultifield;i.initialize(t,e);return i}}if(typeof BX.Crm.EntityEditorClient==="undefined"){BX.Crm.EntityEditorClient=function(){BX.Crm.EntityEditorClient.superclass.constructor.apply(this);this._info=null;this._enablePrimaryEntity=true;this._primaryEntityTypeName="";this._primaryEntityInfo=null;this._primaryEntityBindingInfos=null;this._primaryEntityEditor=null;this._secondaryEntityTypeName="";this._secondaryEntityInfos=null;this._secondaryEntityEditor=null;this._dataElements=null;this._map=null;this._bindingTracker=null};BX.extend(BX.Crm.EntityEditorClient,BX.Crm.EntityEditorField);BX.Crm.EntityEditorClient.prototype.doInitialize=function(){BX.Crm.EntityEditorClient.superclass.doInitialize.apply(this);this._map=this._schemeElement.getDataObjectParam("map",{});this.initializeFromModel()};BX.Crm.EntityEditorClient.prototype.initializeFromModel=function(){this._info=this._model.getSchemeField(this._schemeElement,"info",{});this._enablePrimaryEntity=this._schemeElement.getDataBooleanParam("enablePrimaryEntity",true);if(this._enablePrimaryEntity){var t=BX.prop.getObject(this._info,"PRIMARY_ENTITY_DATA",null);var e=t?BX.CrmEntityInfo.create(t):null;if(e){this.setPrimaryEntity(e)}else{this.setPrimaryEntityTypeName(this._schemeElement.getDataStringParam("primaryEntityTypeName",BX.CrmEntityType.names.company))}}this.setSecondaryEntityTypeName(this._schemeElement.getDataStringParam("secondaryEntityTypeName",BX.CrmEntityType.names.contact));var i=null;var n=this._schemeElement.getDataStringParam("secondaryEntityInfo","");if(n!==""){i=this._model.getField(n,[])}else{i=BX.prop.getArray(this._info,"SECONDARY_ENTITY_DATA",[])}this._secondaryEntityInfos=BX.Collection.create();this._primaryEntityBindingInfos=BX.Collection.create();var r=e&&e.getTypeName()===BX.CrmEntityType.names.company?e.getId():0;var o,s,a;for(o=0,s=i.length;o<s;o++){a=BX.CrmEntityInfo.create(i[o]);if(a.getId()<=0){continue}if(r>0&&a.checkEntityBinding(BX.CrmEntityType.names.company,r)){this._primaryEntityBindingInfos.add(a)}else{this._secondaryEntityInfos.add(a)}}this._bindingTracker=BX.Crm.EntityBindingTracker.create()};BX.Crm.EntityEditorClient.prototype.getEntityCreateUrl=function(t){return this._editor.getEntityCreateUrl(t)};BX.Crm.EntityEditorClient.prototype.getEntityRequisiteSelectUrl=function(t,e){return this._editor.getEntityRequisiteSelectUrl(t,e)};BX.Crm.EntityEditorClient.prototype.rollback=function(){if(this.isChanged()){this.initializeFromModel()}};BX.Crm.EntityEditorClient.prototype.doSetMode=function(t){this.rollback()};BX.Crm.EntityEditorClient.prototype.createDataElement=function(t,e){var i=BX.prop.getString(this._map,t,"");if(i===""){return}var n=BX.create("input",{attrs:{name:i,type:"hidden",value:e}});if(!this._dataElements){this._dataElements={}}this._dataElements[t]=n;if(this._wrapper){this._wrapper.appendChild(n)}};BX.Crm.EntityEditorClient.prototype.layout=function(t){if(this._hasLayout){return}var e=this._schemeElement.getTitle();var i=this._mode===BX.Crm.EntityEditorMode.view;this._wrapper=BX.create("div",{props:{className:"crm-entity-widget-content-block"}});if(!i){this._wrapper.appendChild(this.createDragButton())}else if(!this._primaryEntityInfo&&this._secondaryEntityInfos.length()===0){this.registerLayout(t);this._hasLayout=true;return}var n=BX.create("div",{props:{className:"crm-entity-widget-clients-block"}});this._wrapper.appendChild(n);n.appendChild(this.createTitleNode(e));this._dataElements={};if(!i){if(this._enablePrimaryEntity){this.createDataElement("primaryEntityType",this.getPrimaryEntityTypeName());this.createDataElement("primaryEntityId",this.getPrimaryEntityId());this.createDataElement("unboundSecondaryEntityIds","");this.createDataElement("boundSecondaryEntityIds","")}this.createDataElement("secondaryEntityType",this.getSecondaryEntityTypeName());this.createDataElement("secondaryEntityIds",this.getAllSecondaryEntityIds().join(","))}var r=BX.create("div",{props:{className:!i?"crm-entity-widget-content-block-clients":""}});n.appendChild(r);var o=BX.create("div",{});r.appendChild(o);var s=this._schemeElement.getDataObjectParam("loaders",{});var a=BX.prop.getObject(s,"primary",{});var l=BX.prop.getObject(s,"secondary",{});if(this._enablePrimaryEntity){this._primaryEntityEditor=BX.Crm.PrimaryClientEditor.create(this._id+"_PRIMARY",{entityInfo:this._primaryEntityInfo,entityTypeName:this._primaryEntityTypeName,loaderConfig:a,requisiteBinding:this._model.getField("REQUISITE_BINDING",{}),editor:this,mode:this._mode,onChange:BX.delegate(this.onPrimaryEntityChange,this),onDelete:BX.delegate(this.onPrimaryEntityDelete,this),onBindingAdd:BX.delegate(this.onPrimaryEntityBindingAdd,this),onBindingDelete:BX.delegate(this.onPrimaryEntityBindingDelete,this),onBindingRelease:BX.delegate(this.onPrimaryEntityBindingRelease,this),container:r,achor:o});this._primaryEntityEditor.layout()}var d=BX.create("div",{props:{className:"crm-entity-widget-participants-container"}});r.appendChild(d);this._secondaryEntityEditor=BX.Crm.SecondaryClientEditor.create(this._id+"_SECONDARY",{entityInfos:this._secondaryEntityInfos.getItems(),entityTypeName:this._secondaryEntityTypeName,entityLegend:this._schemeElement.getDataStringParam("secondaryEntityLegend",""),primaryLoader:a,secondaryLoader:l,mode:this._mode,onAdd:BX.delegate(this.onSecondaryEntityAdd,this),onDelete:BX.delegate(this.onSecondaryEntityDelete,this),onBeforeAdd:BX.delegate(this.onSecondaryEntityBeforeAdd,this),editor:this,container:d});this._secondaryEntityEditor.layout();if(!i){this._wrapper.appendChild(this.createContextMenuButton());this.initializeDragDropAbilities()}this.registerLayout(t);this._hasLayout=true};BX.Crm.EntityEditorClient.prototype.clearLayout=function(){if(!this._hasLayout){return}this.releaseDragDropAbilities();if(this._primaryEntityEditor){this._primaryEntityEditor.clearLayout();this._primaryEntityEditor=null}this._secondaryEntityEditor.clearLayout();this._secondaryEntityEditor=null;for(var t in this._dataElements){if(this._dataElements.hasOwnProperty(t)){BX.remove(this._dataElements[t])}}this._dataElements=null;this._wrapper=BX.remove(this._wrapper);this._hasLayout=false};BX.Crm.EntityEditorClient.prototype.getOwnerTypeName=function(){return this._editor.getEntityTypeName()};BX.Crm.EntityEditorClient.prototype.getOwnerTypeId=function(){return this._editor.getEntityTypeId()};BX.Crm.EntityEditorClient.prototype.getOwnerId=function(){return this._editor.getEntityId()};BX.Crm.EntityEditorClient.prototype.getPrimaryEntityTypeName=function(){return this._primaryEntityTypeName};BX.Crm.EntityEditorClient.prototype.setPrimaryEntityTypeName=function(t){if(this._primaryEntityTypeName!==t){this._primaryEntityTypeName=t}};BX.Crm.EntityEditorClient.prototype.getPrimaryEntityId=function(){return this._primaryEntityInfo?this._primaryEntityInfo.getId():0};BX.Crm.EntityEditorClient.prototype.getPrimaryEntity=function(){return this._primaryEntityInfo};BX.Crm.EntityEditorClient.prototype.setPrimaryEntity=function(t){if(t instanceof BX.CrmEntityInfo){this._primaryEntityInfo=t;this.setPrimaryEntityTypeName(t.getTypeName())}else{this._primaryEntityInfo=null}this.markAsChanged()};BX.Crm.EntityEditorClient.prototype.getSecondaryEntityTypeName=function(){return this._secondaryEntityTypeName};BX.Crm.EntityEditorClient.prototype.setSecondaryEntityTypeName=function(t){if(this._secondaryEntityTypeName!==t){this._secondaryEntityTypeName=t}};BX.Crm.EntityEditorClient.prototype.getSecondaryEntities=function(){return this._secondaryEntityInfos.getItems()};BX.Crm.EntityEditorClient.prototype.getSecondaryEntityById=function(t){if(!this._secondaryEntityInfos){return null}return this._secondaryEntityInfos.search(function(e){return e.getId()===t})};BX.Crm.EntityEditorClient.prototype.removeSecondaryEntity=function(t){if(this._secondaryEntityInfos){this._secondaryEntityInfos.remove(t);this.markAsChanged()}};BX.Crm.EntityEditorClient.prototype.addSecondaryEntity=function(t){if(this._secondaryEntityInfos){this._secondaryEntityInfos.add(t);this.markAsChanged()}};BX.Crm.EntityEditorClient.prototype.onSecondaryEntityDelete=function(t,e){this.removeSecondaryEntity(e);if(this._primaryEntityEditor){this._primaryEntityEditor.adjustLayout()}};BX.Crm.EntityEditorClient.prototype.onSecondaryEntityBeforeAdd=function(t,e,i){if(this._primaryEntityEditor&&this._primaryEntityInfo&&this._primaryEntityInfo.getTypeName()===BX.CrmEntityType.names.company){var n=this._primaryEntityInfo.getId();if(e.checkEntityBinding(BX.CrmEntityType.names.company,n)&&!this._bindingTracker.isUnbound(e)){this._primaryEntityEditor.addBinding(this._primaryEntityEditor.createBinding(e));i["cancel"]=true}}};BX.Crm.EntityEditorClient.prototype.onSecondaryEntityAdd=function(t,e){this.addSecondaryEntity(e);if(this._primaryEntityEditor){this._primaryEntityEditor.adjustLayout()}};BX.Crm.EntityEditorClient.prototype.onSecondaryEntityBind=function(t,e){this._secondaryEntityEditor.removeItem(this._secondaryEntityEditor.getItemById(e.getId()));if(this._primaryEntityEditor){this._primaryEntityEditor.addBinding(this._primaryEntityEditor.createBinding(e))}this._bindingTracker.bind(e)};BX.Crm.EntityEditorClient.prototype.getAllSecondaryEntityIds=function(){var t=this.getAllSecondaryEntityInfos();var e=[];for(var i=0,n=t.length;i<n;i++){e.push(t[i].getId())}return e};BX.Crm.EntityEditorClient.prototype.getAllSecondaryEntityInfos=function(){return[].concat(this._primaryEntityBindingInfos.getItems(),this._secondaryEntityInfos.getItems())};BX.Crm.EntityEditorClient.prototype.getPrimaryEntityBindings=function(){return this._primaryEntityBindingInfos.getItems()};BX.Crm.EntityEditorClient.prototype.getPrimaryEntityBindingById=function(t){if(!this._primaryEntityBindingInfos){return null}return this._primaryEntityBindingInfos.search(function(e){return e.getId()===t})};BX.Crm.EntityEditorClient.prototype.addPrimaryEntityBinding=function(t){if(this._primaryEntityBindingInfos){this._primaryEntityBindingInfos.add(t);this.markAsChanged()}};BX.Crm.EntityEditorClient.prototype.removePrimaryEntityBinding=function(t){if(this._primaryEntityBindingInfos){this._primaryEntityBindingInfos.remove(t);this.markAsChanged()}};BX.Crm.EntityEditorClient.prototype.onPrimaryEntityBindingAdd=function(t,e){this.addPrimaryEntityBinding(e)};BX.Crm.EntityEditorClient.prototype.onPrimaryEntityBindingDelete=function(t,e){this.removePrimaryEntityBinding(e)};BX.Crm.EntityEditorClient.prototype.onPrimaryEntityBindingRelease=function(t,e){this._bindingTracker.unbind(e);this._secondaryEntityEditor.addItem(this._secondaryEntityEditor.createItem(e))};BX.Crm.EntityEditorClient.prototype.onPrimaryEntityDelete=function(t,e){var i=[].concat(this._primaryEntityBindingInfos.getItems(),this._secondaryEntityInfos.getItems());this._secondaryEntityInfos=BX.Collection.create();this._primaryEntityBindingInfos=BX.Collection.create();var n=null;if(i.length>0){n=i.shift()}this.setPrimaryEntity(n);this._primaryEntityEditor.setEntity(n);this._secondaryEntityEditor.setEntities(i)};BX.Crm.EntityEditorClient.prototype.onPrimaryEntityChange=function(t,e){this.setPrimaryEntity(e);if(this._primaryEntityTypeName===BX.CrmEntityType.names.company){this._bindingTracker.reset();this._primaryEntityBindingInfos=BX.Collection.create();this._secondaryEntityInfos=BX.Collection.create();this._secondaryEntityEditor.clearItems();this._secondaryEntityEditor.reloadEntities()}};BX.Crm.EntityEditorClient.prototype.save=function(){var t,e,i;var n=this._schemeElement.getDataObjectParam("map",{});if(this._enablePrimaryEntity){this._model.setMappedField(n,"primaryEntityType",this._primaryEntityTypeName);var r=this._primaryEntityInfo?this._primaryEntityInfo.getId():0;this._model.setMappedField(n,"primaryEntityId",r);if(this._primaryEntityInfo){this._info["PRIMARY_ENTITY_DATA"]=this._primaryEntityInfo.getSettings()}else{delete this._info["PRIMARY_ENTITY_DATA"]}if(r>0){var o=this._bindingTracker.getUnboundEntities();var s=[];for(t=0,e=o.length;t<e;t++){s.push(o[t].getId())}if(s.length>0){for(t=0,e=s.length;t<e;t++){i=this.getSecondaryEntityById(s[t]);if(i){i.removeEntityBinding(this._primaryEntityTypeName,r)}}}this._model.setMappedField(n,"unboundSecondaryEntityIds",s.join(","));var a=this._bindingTracker.getBoundEntities();var l=[];for(t=0,e=a.length;t<e;t++){l.push(a[t].getId())}if(l.length>0){for(t=0,e=l.length;t<e;t++){i=this.getPrimaryEntityBindingById(l[t]);if(i){i.addEntityBinding(this._primaryEntityTypeName,r)}}}this._model.setMappedField(n,"boundSecondaryEntityIds",l.join(","));this._bindingTracker.reset()}}this._model.setMappedField(n,"secondaryEntityType",this._secondaryEntityTypeName);var d=this.getAllSecondaryEntityInfos();var h=[];var p=[];for(t=0,e=d.length;t<e;t++){i=d[t];h.push(i.getSettings());p.push(i.getId())}this._model.setMappedField(n,"secondaryEntityIds",p.join(","));this._info["SECONDARY_ENTITY_DATA"]=h};BX.Crm.EntityEditorClient.prototype.onBeforeSubmit=function(){if(!this._dataElements){return}for(var t in this._dataElements){if(!this._dataElements.hasOwnProperty(t)){continue}var e=BX.prop.getString(this._map,t,"");if(e!==""){this._dataElements[t].value=this._model.getField(e,"")}}};BX.Crm.EntityEditorClient.create=function(t,e){var i=new BX.Crm.EntityEditorClient;i.initialize(t,e);return i}}if(typeof BX.Crm.PrimaryClientEditor==="undefined"){BX.Crm.PrimaryClientEditor=function(){this._id="";this._settings={};this._editor=null;this._mode=BX.Crm.EntityEditorMode.intermediate;this._entityInfo=null;this._entityTypeName="";this._container=null;this._wrapper=null;this._actionWrapper=null;this._bindingWrapper=null;this._entityTypeSelectButton=null;this._entitySelectButton=null;this._entityBindButton=null;this._entityTypeSelectClickHandler=BX.delegate(this.onEntityTypeSelectClick,this);this._entityTypeSelectHandler=BX.delegate(this.onEntityTypeSelect,this);this._entitySelectClickHandler=BX.delegate(this.onEntitySelectClick,this);this._entityBindClickHandler=BX.delegate(this.onEntityBindClick,this);this._entityBindingSelectHandler=BX.delegate(this.onEntityBindingSelect,this);this._entityCreateButtonHandler=BX.delegate(this.onEntityCreateButtonClick,this);this._externalEventHandler=null;this._externalContext=null;this._entityTypeMenu=null;this._entitySelector=null;this._entityBindSelector=null;this._item=null;this._itemBindings=null;this._skeleton=null;this._loaderConfig=null;this._hasLayout=false};BX.Crm.PrimaryClientEditor.prototype={initialize:function(t,e){this._id=BX.type.isNotEmptyString(t)?t:BX.util.getRandomString(4);this._settings=e?e:{};this._editor=BX.prop.get(this._settings,"editor");this._mode=BX.prop.getInteger(this._settings,"mode",0);this._container=BX.prop.getElementNode(this._settings,"container",null);this._entityInfo=BX.prop.get(this._settings,"entityInfo",null);if(this._entityInfo){this.setEntity(this._entityInfo)}else{this._entityTypeName=BX.prop.getString(this._settings,"entityTypeName","")}this._loaderConfig=BX.prop.getObject(this._settings,"loaderConfig",{})},layout:function(){var t=this._mode===BX.Crm.EntityEditorMode.view;this._wrapper=BX.create("div",{props:{className:"crm-entity-widget-clients-container"}});this._actionWrapper=null;this._bindingWrapper=null;this._entitySelectButton=null;this._entityTypeSelectButton=null;this._entityBindButton=null;if(!t){this._entityTypeSelectButton=BX.create("span",{attrs:{className:"crm-entity-widget-actions-client-type"},text:BX.CrmEntityType.getCaptionByName(this._entityTypeName),events:{click:this._entityTypeSelectClickHandler}});this._entitySelectButton=BX.create("span",{props:{className:"crm-entity-widget-actions-btn-select"},text:this.getMessage("select"),events:{click:this._entitySelectClickHandler}});this._entityBindButton=BX.create("span",{props:{className:"crm-entity-widget-client-connect-btn"},style:{display:"none"},events:{click:this._entityBindClickHandler},text:this.getMessage("bind")});this._entityCreateButton=BX.create("span",{props:{className:"crm-entity-widget-actions-btn-create"},text:this.getMessage("create"),events:{click:this._entityCreateButtonHandler}});this._actionWrapper=BX.create("div",{props:{className:"crm-entity-widget-clients-actions-block"},children:[this._entityTypeSelectButton,this._entitySelectButton,this._entityCreateButton,this._entityBindButton]});this._wrapper.appendChild(this._actionWrapper)}this._wrapper.appendChild(BX.create("div",{style:{clear:"both"}}));if(this._item){this._item.setContainer(this._wrapper);this._item.layout();this._bindingWrapper=BX.create("div",{props:{className:"crm-entity-widget-client-block-children"}});this._wrapper.appendChild(this._bindingWrapper);var e=this._editor.getPrimaryEntityBindings();this._itemBindings=[];var i,n;for(i=0,n=e.length;i<n;i++){var r=e[i];var o=BX.Crm.ClientEditorEntityBindingPanel.create(this._id+"_"+r.getId().toString(),{entityInfo:r,editor:this._editor,mode:this._mode,container:this._bindingWrapper,onChange:BX.delegate(this.onItemBindingChange,this)});o.layout();this._itemBindings.push(o)}this.adjustLayout()}var s=BX.prop.getElementNode(this._settings,"achor",null);if(s){this._container.insertBefore(this._wrapper,s)}else{this._container.appendChild(this._wrapper)}this._hasLayout=true},clearLayout:function(){if(this._item){this._item.clearLayout()}if(this._itemBindings){for(var t=0,e=this._itemBindings.length;t<e;t++){this._itemBindings[t].clearLayout()}this._itemBindings=null}this._wrapper=BX.remove(this._wrapper);this._actionWrapper=null;this._bindingWrapper=null;this._entitySelectButton=null;this._entityTypeSelectButton=null;this._entityCreateButton=null;this._entityBindButton=null;this._hasLayout=false},adjustLayout:function(){if(this._entityBindButton&&this._entityInfo&&this._entityInfo.getTypeId()===BX.CrmEntityType.enumeration.company){this._entityBindButton.style.display=BX.util.array_diff(this._editor.getSecondaryEntities(),this.getBindingEntities(),BX.CrmEntityInfo.getHashCode).length>0?"":"none"}},getEntityTypeName:function(){return this._entityTypeName},setEntityTypeName:function(t){if(this._entityTypeName===t){return}this._entityTypeName=t;if(this._hasLayout){this._entityTypeSelectButton.innerHTML=BX.util.htmlspecialchars(BX.CrmEntityType.getCaptionByName(this._entityTypeName))}if(this._entitySelector){this._entitySelector=null}},setEntity:function(t){if(this._item){if(this._hasLayout){this._item.clearLayout()}this._item=null}if(!(t instanceof BX.CrmEntityInfo)){this._entityInfo=null}else{this._entityInfo=t;this.setEntityTypeName(this._entityInfo.getTypeName());this._item=BX.Crm.ClientEditorEntityPanel.create(this._id+"_"+this._entityInfo.getId().toString(),{editor:this._editor,entityInfo:this._entityInfo,enableEntityTypeCaption:true,enableRequisite:true,requisiteBinding:BX.prop.getObject(this._settings,"requisiteBinding",{}),mode:this._mode,onDelete:BX.delegate(this.onItemDelete,this)});if(this._hasLayout){this._item.setContainer(this._wrapper);this._item.layout()}}if(this._itemBindings){for(var e=0,i=this._itemBindings.length;e<i;e++){this._itemBindings[e].clearLayout()}this._itemBindings=null}},setupEntity:function(t){if(this._entityInfo&&this._entityInfo.getId()===t){return}this.setEntity(null);var e=BX.prop.getFunction(this._settings,"onChange");if(e){e(this,this._entityInfo)}var i=BX.prop.getObject(this._loaderConfig,this._entityTypeName,null);if(i){this.showSkeleton();BX.CrmDataLoader.create(this._id,{serviceUrl:i["url"],action:i["action"],params:{ENTITY_TYPE_NAME:this._entityTypeName,ENTITY_ID:t}}).load(BX.delegate(this.onEntityInfoLoad,this))}},showSkeleton:function(){if(!this._skeleton){this._skeleton=BX.Crm.ClientEditorEntitySkeleton.create(this._id,{container:this._wrapper})}this._skeleton.layout()},hideSkeleton:function(){if(this._skeleton){this._skeleton.clearLayout()}},onEntityTypeSelectClick:function(t){if(this._entityTypeMenu&&this._entityTypeMenu.isOpened()){this._entityTypeMenu.close();return}if(!this._entityTypeMenu){this._entityTypeMenu=BX.CmrSelectorMenu.create(this._id,{items:[{text:BX.CrmEntityType.getCaption(BX.CrmEntityType.enumeration.company),value:BX.CrmEntityType.names.company},{text:BX.CrmEntityType.getCaption(BX.CrmEntityType.enumeration.contact),value:BX.CrmEntityType.names.contact}]});this._entityTypeMenu.addOnSelectListener(this._entityTypeSelectHandler)}if(!this._entityTypeMenu.isOpened()){this._entityTypeMenu.open(this._entityTypeSelectButton)}},onEntityTypeSelect:function(t,e){this.setEntityTypeName(e.getValue());if(this._entityTypeMenu.isOpened()){this._entityTypeMenu.close()}},onEntitySelectClick:function(t){if(this._entitySelector&&this._entitySelector.isOpened()){this._entitySelector.close();return}if(!this._entitySelector){this._entitySelector=BX.Crm.EntityEditorCrmSelector.create(this._id,{entityTypeIds:[BX.CrmEntityType.resolveId(this._entityTypeName)],callback:BX.delegate(this.onEntitySelect,this)})}this._entitySelector.open(this._entitySelectButton)},onEntitySelect:function(t,e){var i=BX.prop.getInteger(e,"entityId",0);if(this._entityInfo&&this._entityInfo.getId()===i){return}this._entitySelector.close();this.setupEntity(i)},onEntityInfoLoad:function(t,e){var i=BX.prop.getObject(e,"DATA",null);if(i){var n=this._hasLayout;if(n){this.clearLayout()}this.hideSkeleton();var r=BX.CrmEntityInfo.create(i);this.setEntity(r);var o=BX.prop.getFunction(this._settings,"onChange");if(o){o(this,this._entityInfo)}if(n){this.layout()}}},onEntityBindClick:function(t){if(this._entityBindSelector&&this._entityBindSelector.isOpened()){this._entityBindSelector.close();return}if(!this._entityBindSelector){this._entityBindSelector=BX.CmrSelectorMenu.create(this._id,{items:[]});this._entityBindSelector.addOnSelectListener(this._entityBindingSelectHandler)}var e=[];var i,n;for(i=0,n=this._itemBindings.length;i<n;i++){e.push(this._itemBindings[i].getEntity())}var r=BX.util.array_diff(this._editor.getSecondaryEntities(),e,BX.CrmEntityInfo.getHashCode);var o=[];for(i=0,n=r.length;i<n;i++){var s=r[i];o.push({text:s.getTitle(),value:s.getId()})}this._entityBindSelector.setupItems(o);this._entityBindSelector.open(this._entityBindButton)},onEntityBindingSelect:function(t,e){this._editor.onSecondaryEntityBind(this,this._editor.getSecondaryEntityById(e.getValue()))},getEntityCreateUrl:function(t){return this._editor.getEntityCreateUrl(t)},onEntityCreateButtonClick:function(){var t=this.getEntityCreateUrl(this.getEntityTypeName());if(t===""){return""}var e=this._editor.getContextId();t=BX.util.add_url_param(t,{external_context_id:e});if(!this._externalEventHandler){this._externalEventHandler=BX.delegate(this.onExternalEvent,this);BX.addCustomEvent(window,"onLocalStorageSet",this._externalEventHandler)}if(!this._externalContext){this._externalContext={}}this._externalContext[e]=t;BX.Crm.Page.open(t)},onExternalEvent:function(t){var e=BX.type.isNotEmptyString(t["key"])?t["key"]:"";var i=BX.type.isPlainObject(t["value"])?t["value"]:{};var n=i["entityTypeName"];var r=i["entityId"];var o=i["context"];if(e==="onCrmEntityCreate"&&n===this.getEntityTypeName()&&this._externalContext&&typeof this._externalContext[o]!=="undefined"){this.setupEntity(r);BX.Crm.Page.close(this._externalContext[o]);delete this._externalContext[o]}},onItemBindingChange:function(t,e){if(e==="unbind"){var i=BX.prop.getFunction(this._settings,"onBindingRelease");if(i){i(this,t.getEntity())}this.removeBinding(t)}else if(e==="delete"){this.removeBinding(t)}},onItemDelete:function(t){var e=this._entityInfo;var i=this._hasLayout;if(i){this.clearLayout()}this.setEntity(null);if(i){this.layout()}var n=BX.prop.getFunction(this._settings,"onDelete");if(n){n(this,e)}},createBinding:function(t){return BX.Crm.ClientEditorEntityBindingPanel.create(this._id+"_"+t.getId().toString(),{entityInfo:t,editor:this._editor,mode:this._mode,onChange:BX.delegate(this.onItemBindingChange,this)})},finfBindingById:function(t){for(var e=0,i=this._itemBindings.length;e<i;e++){var n=this._itemBindings[e];if(n.getEntity().getId()===t){return n}}return null},getBindingIndex:function(t){for(var e=0,i=this._itemBindings.length;e<i;e++){if(this._itemBindings[e]===t){return e}}return-1},addBinding:function(t){this._itemBindings.push(t);if(this._hasLayout){t.setContainer(this._bindingWrapper);t.layout()}var e=BX.prop.getFunction(this._settings,"onBindingAdd");if(e){e(this,t.getEntity())}},removeBinding:function(t){var e=this.getBindingIndex(t);if(e<0){return}t.clearLayout();this._itemBindings.splice(e,1);var i=BX.prop.getFunction(this._settings,"onBindingDelete");if(i){i(this,t.getEntity())}},getBindingEntities:function(){var t=[];if(this._itemBindings){for(var e=0,i=this._itemBindings.length;e<i;e++){t.push(this._itemBindings[e].getEntity())}}return t}};BX.Crm.PrimaryClientEditor.prototype.getMessage=function(t){var e=BX.Crm.PrimaryClientEditor.messages;return e.hasOwnProperty(t)?e[t]:t};if(typeof BX.Crm.PrimaryClientEditor.messages==="undefined"){BX.Crm.PrimaryClientEditor.messages={}}BX.Crm.PrimaryClientEditor.create=function(t,e){var i=new BX.Crm.PrimaryClientEditor;i.initialize(t,e);return i}}if(typeof BX.Crm.SecondaryClientEditor==="undefined"){BX.Crm.SecondaryClientEditor=function(){this._id="";this._settings={};this._mode=BX.Crm.EntityEditorMode.intermediate;this._container=null;this._wrapper=null;this._entityTypeName="";this._entityInfos=null;this._items=null;this._entitySelectClickHandler=BX.delegate(this.onEntitySelectClick,this);this._entitySelectButton=null;this._entitySelector=null;this._entityCreateButtonHandler=BX.delegate(this.onEntityCreateButtonClick,this);this._entityCreateButton=null;this._externalEventHandler=null;this._externalContext=null;this._isMultiple=true;this._primaryLoaderConfig=null;this._secondaryLoaderConfig=null;this._editor=null;this._hasLayout=false};BX.Crm.SecondaryClientEditor.prototype={initialize:function(t,e){this._id=BX.type.isNotEmptyString(t)?t:BX.util.getRandomString(4);this._settings=e?e:{};this._mode=BX.prop.getInteger(this._settings,"mode",0);this._editor=BX.prop.get(this._settings,"editor",null);this._container=BX.prop.getElementNode(this._settings,"container",null);this._entityTypeName=BX.prop.getString(this._settings,"entityTypeName","");this._entityInfos=BX.prop.getArray(this._settings,"entityInfos","");this._isMultiple=BX.prop.getBoolean(this._settings,"isMultiple",true);this._items=[];var i=this._entityInfos.length;if(!this._isMultiple&&i>1){i=1}for(var n=0;n<i;n++){var r=this.createItem(this._entityInfos[n]);this._items.push(r)}this._primaryLoaderConfig=BX.prop.getObject(this._settings,"primaryLoader",{});this._secondaryLoaderConfig=BX.prop.getObject(this._settings,"secondaryLoader",{})},getEntityTypeName:function(){return this._entityTypeName},getEntities:function(){return this._entityInfos},setEntities:function(t){this._entityInfos=t;this.clearItems();var e=this._entityInfos.length;if(!this._isMultiple&&e>1){e=1}for(var i=0;i<e;i++){this.addItem(this.createItem(this._entityInfos[i]))}},findItemIndex:function(t){for(var e=0,i=this._items.length;e<i;e++){if(this._items[e]===t){return e}}return-1},getFirstItem:function(){return this._items.length>0?this._items[0]:null},getItemById:function(t){for(var e=0,i=this._items.length;e<i;e++){var n=this._items[e];if(n.getEntity().getId()===t){return n}}return null},getItems:function(){return this._items},getItemCount:function(){return this._items.length},createItem:function(t){return BX.Crm.ClientEditorEntityPanel.create(this._id+"_"+t.getId().toString(),{editor:this._editor,entityInfo:t,mode:this._mode,onDelete:BX.delegate(this.onItemDelete,this)})},clearItems:function(){for(var t=0,e=this._items.length;t<e;t++){var i=this._items[t];i.clearLayout();i.setContainer(null)}this._items=[]},addItemById:function(t){var e=BX.prop.getObject(this._primaryLoaderConfig,this._entityTypeName,null);if(!e){return}BX.CrmDataLoader.create(this._id,{serviceUrl:e["url"],action:e["action"],params:{ENTITY_TYPE_NAME:this._entityTypeName,ENTITY_ID:t}}).load(BX.delegate(this.onEntityInfoLoad,this))},addItem:function(t){var e=BX.prop.getFunction(this._settings,"onBeforeAdd");if(e){var i={cancel:false};e(this,t.getEntity(),i);if(i["cancel"]){return false}}if(!this._isMultiple){this.clearItems()}this._items.push(t);if(this._hasLayout){t.setContainer(this._wrapper);t.layout()}var n=BX.prop.getFunction(this._settings,"onAdd");if(n){n(this,t.getEntity())}return true},removeItem:function(t){var e=this.findItemIndex(t);if(e<0){return}this._items.splice(e,1);if(this._hasLayout){t.clearLayout();t.setContainer(null)}var i=BX.prop.getFunction(this._settings,"onDelete");if(i){i(this,t.getEntity())}},reloadEntities:function(){if(!this._editor){return}var t=this._editor.getPrimaryEntity();if(!t){return}var e=BX.prop.getObject(this._secondaryLoaderConfig,t.getTypeName(),null);if(e){BX.CrmDataLoader.create(this._id,{serviceUrl:e["url"],action:e["action"],params:{PRIMARY_TYPE_NAME:t.getTypeName(),PRIMARY_ID:t.getId(),SECONDARY_TYPE_NAME:this._entityTypeName,OWNER_TYPE_NAME:this._editor.getOwnerTypeName()}}).load(BX.delegate(this.onEntityInfosReload,this))}},layout:function(){var t=this._mode===BX.Crm.EntityEditorMode.view;this._wrapper=BX.create("div",{});this._container.appendChild(this._wrapper);var e=BX.prop.getString(this._settings,"entityLegend","");this._entitySelectButton=null;if(t){this._wrapper.appendChild(BX.create("div",{props:{className:"crm-entity-widget-content-block-title"},text:e}))}else{this._entitySelectButton=BX.create("span",{props:{className:"crm-entity-widget-actions-btn-select"},text:this.getMessage("select"),events:{click:this._entitySelectClickHandler}});this._entityCreateButton=BX.create("span",{props:{className:"crm-entity-widget-actions-btn-create"},text:this.getMessage("create"),events:{click:this._entityCreateButtonHandler}});this._wrapper.appendChild(BX.create("div",{props:{className:"crm-entity-widget-participants-title"},children:[BX.create("div",{props:{className:"crm-entity-widget-clients-actions-block"},children:[BX.create("span",{props:{className:"crm-entity-widget-actions-btn-participants"},children:[BX.create("span",{props:{className:"crm-entity-widget-participants-title-text"},text:e})]}),this._entitySelectButton,this._entityCreateButton]})]}))}for(var i=0,n=this._items.length;i<n;i++){this._items[i].setContainer(this._wrapper);this._items[i].layout()}this._hasLayout=true},clearLayout:function(){for(var t=0,e=this._items.length;t<e;t++){this._items[t].clearLayout();this._items[t].setContainer(null)}this._entitySelectButton=null;this._entityCreateButton=null;this._wrapper=BX.remove(this._wrapper);this._hasLayout=false},onEntitySelectClick:function(t){this.openEntitySelector()},openEntitySelector:function(){if(!this._entitySelector){this._entitySelector=BX.Crm.EntityEditorCrmSelector.create(this._id,{entityTypeIds:[BX.CrmEntityType.resolveId(this._entityTypeName)],callback:BX.delegate(this.onEntitySelect,this)})}this._entitySelector.open(this._entitySelectButton)},onEntitySelect:function(t,e){var i=BX.prop.getInteger(e,"entityId",0);this._entitySelector.close();this.addItemById(i)},onEntityInfoLoad:function(t,e){var i=BX.prop.getObject(e,"DATA",null);if(!i){return}var n=BX.CrmEntityInfo.create(i);if(this.getItemById(n.getId())!==null){return}this.addItem(this.createItem(n))},onEntityInfosReload:function(t,e){var i=BX.type.isArray(e["ENTITY_INFOS"])?e["ENTITY_INFOS"]:[];var n=[];for(var r=0;r<i.length;r++){n.push(BX.CrmEntityInfo.create(i[r]))}this.setEntities(n)},onItemDelete:function(t){this.removeItem(t)},getEntityCreateUrl:function(t){return this._editor.getEntityCreateUrl(t)},onEntityCreateButtonClick:function(){var t=this.getEntityCreateUrl(this.getEntityTypeName());if(t===""){return""}var e=this._editor.getContextId();t=BX.util.add_url_param(t,{external_context_id:e});if(!this._externalEventHandler){this._externalEventHandler=BX.delegate(this.onExternalEvent,this);BX.addCustomEvent(window,"onLocalStorageSet",this._externalEventHandler)}if(!this._externalContext){this._externalContext={}}this._externalContext[e]=t;BX.Crm.Page.open(t)},onExternalEvent:function(t){if(!this._externalContext){return}var e=BX.type.isNotEmptyString(t["key"])?t["key"]:"";if(e!=="onCrmEntityCreate"){return}var i=BX.prop.getObject(t,"value",{});if(BX.prop.getString(i,"entityTypeName","")!==this.getEntityTypeName()){return}var n=BX.prop.getInteger(i,"entityId",0);var r=BX.prop.getString(i,"context","");if(typeof this._externalContext[r]!=="undefined"){this.addItemById(n);BX.Crm.Page.close(this._externalContext[r]);delete this._externalContext[r]}}};BX.Crm.SecondaryClientEditor.prototype.getMessage=function(t){var e=BX.Crm.SecondaryClientEditor.messages;return e.hasOwnProperty(t)?e[t]:t};if(typeof BX.Crm.SecondaryClientEditor.messages==="undefined"){BX.Crm.SecondaryClientEditor.messages={}}BX.Crm.SecondaryClientEditor.create=function(t,e){var i=new BX.Crm.SecondaryClientEditor;i.initialize(t,e);return i}}if(typeof BX.Crm.EntityEditorFieldConfigurator==="undefined"){BX.Crm.EntityEditorFieldConfigurator=function(){BX.Crm.EntityEditorFieldConfigurator.superclass.constructor.apply(this);this._field=null;this._name=null;this._isLocked=false;this._labelInput=null;this._saveButton=null;this._cancelButton=null};BX.extend(BX.Crm.EntityEditorFieldConfigurator,BX.Crm.EntityEditorControl);BX.Crm.EntityEditorFieldConfigurator.prototype.doInitialize=function(){BX.Crm.EntityEditorFieldConfigurator.superclass.doInitialize.apply(this);this._field=BX.prop.get(this._settings,"field",null);this._name=BX.prop.getString(this._fieldData,"name","")};BX.Crm.EntityEditorFieldConfigurator.prototype.getMessage=function(t){var e=BX.Crm.EntityEditorFieldConfigurator.messages;return e.hasOwnProperty(t)?e[t]:t};BX.Crm.EntityEditorFieldConfigurator.prototype.layout=function(t){if(this._hasLayout){return}if(this._mode===BX.Crm.EntityEditorMode.view){throw"EntityEditorFieldConfigurator. View mode is not supported by this control type."}this._wrapper=BX.create("div",{props:{className:"crm-entity-widget-content-block-new-fields"}});this._labelInput=BX.create("input",{attrs:{className:"crm-entity-widget-content-input",type:"text",value:this._field.getTitle()}});this._saveButton=BX.create("span",{props:{className:"webform-small-button webform-small-button-blue"},text:BX.message("CRM_EDITOR_SAVE"),events:{click:BX.delegate(this.onSaveButtonClick,this)}});this._cancelButton=BX.create("span",{props:{className:"webform-small-button webform-small-button-transparent"},text:BX.message("CRM_EDITOR_CANCEL"),events:{click:BX.delegate(this.onCancelButtonClick,this)}});this._wrapper.appendChild(BX.create("div",{props:{className:"crm-entity-widget-content-block"},children:[BX.create("div",{props:{className:"crm-entity-widget-content-block-title"},text:this.getMessage("labelField")}),BX.create("div",{props:{className:"crm-entity-widget-content-block-inner"},children:[this._labelInput]})]}));this._wrapper.appendChild(BX.create("div",{children:[this._saveButton,this._cancelButton]}));this.registerLayout(t);this._hasLayout=true};BX.Crm.EntityEditorFieldConfigurator.prototype.clearLayout=function(){if(!this._hasLayout){return}this._wrapper=BX.remove(this._wrapper);this._labelInput=null;this._saveButton=null;this._cancelButton=null;this._hasLayout=false};BX.Crm.EntityEditorFieldConfigurator.prototype.onSaveButtonClick=function(t){if(this._isLocked){return}var e={field:this._field,label:this._labelInput.value};BX.onCustomEvent(this,"onSave",[this,e])};BX.Crm.EntityEditorFieldConfigurator.prototype.onCancelButtonClick=function(t){if(this._isLocked){return}var e={field:this._field};BX.onCustomEvent(this,"onCancel",[this,e])};BX.Crm.EntityEditorFieldConfigurator.prototype.setLocked=function(t){t=!!t;if(this._isLocked===t){return}this._isLocked=t;if(this._isLocked){BX.addClass(this._saveButton,"webform-small-button-wait")}else{BX.removeClass(this._saveButton,"webform-small-button-wait")}};BX.Crm.EntityEditorFieldConfigurator.prototype.getField=function(){return this._field};if(typeof BX.Crm.EntityEditorFieldConfigurator.messages==="undefined"){BX.Crm.EntityEditorFieldConfigurator.messages={}}BX.Crm.EntityEditorFieldConfigurator.create=function(t,e){var i=new BX.Crm.EntityEditorFieldConfigurator;i.initialize(t,e);return i}}if(typeof BX.Crm.EntityEditorUserFieldConfigurator==="undefined"){BX.Crm.EntityEditorUserFieldConfigurator=function(){BX.Crm.EntityEditorUserFieldConfigurator.superclass.constructor.apply(this);this._field=null;this._typeId="";this._isLocked=false;this._labelInput=null;this._saveButton=null;this._cancelButton=null;this._isTimeEnabledCheckBox=null;this._isRequiredCheckBox=null;this._isMultipleCheckBox=null;this._enumItemWrapper=null;this._enumButtonWrapper=null;this._enumItems=null};BX.extend(BX.Crm.EntityEditorUserFieldConfigurator,BX.Crm.EntityEditorControl);BX.Crm.EntityEditorUserFieldConfigurator.prototype.doInitialize=function(){BX.Crm.EntityEditorUserFieldConfigurator.superclass.doInitialize.apply(this);this._field=BX.prop.get(this._settings,"field",null);if(this._field&&!(this._field instanceof BX.Crm.EntityEditorUserField)){throw"EntityEditorUserFieldConfigurator. The 'field' param must be EntityEditorUserField."}this._typeId=BX.prop.getString(this._settings,"typeId","");this._enumItems=[]};BX.Crm.EntityEditorUserFieldConfigurator.prototype.getMessage=function(t){var e=BX.Crm.EntityEditorUserFieldConfigurator.messages;return e.hasOwnProperty(t)?e[t]:t};BX.Crm.EntityEditorUserFieldConfigurator.prototype.layout=function(t){if(this._hasLayout){return}if(this._mode===BX.Crm.EntityEditorMode.view){throw"EntityEditorUserFieldConfigurator. View mode is not supported by this control type."}var e=this._field===null;var i=this.getMessage("labelField");var n=this._editor.getUserFieldManager();var r=this._field?this._field.getTitle():n.getDefaultFieldLabel(this._typeId);this._wrapper=BX.create("div",{props:{className:"crm-entity-widget-content-block-new-fields"}});this._labelInput=BX.create("input",{attrs:{className:"crm-entity-widget-content-input",type:"text",value:r}});this._saveButton=BX.create("span",{props:{className:"webform-small-button webform-small-button-blue"},text:BX.message("CRM_EDITOR_SAVE"),events:{click:BX.delegate(this.onSaveButtonClick,this)}});this._cancelButton=BX.create("span",{props:{className:"webform-small-button webform-small-button-transparent"},text:BX.message("CRM_EDITOR_CANCEL"),events:{click:BX.delegate(this.onCancelButtonClick,this)}});this._wrapper.appendChild(BX.create("div",{props:{className:"crm-entity-widget-content-block"},children:[BX.create("div",{props:{className:"crm-entity-widget-content-block-title"},text:i}),BX.create("div",{props:{className:"crm-entity-widget-content-block-inner"},children:[this._labelInput]})]}));if(this._typeId==="enumeration"){this._wrapper.appendChild(BX.create("hr",{props:{className:"crm-entity-widget-hr"}}));this._enumItemWrapper=BX.create("div",{props:{className:"crm-entity-widget-content-block"}});this._wrapper.appendChild(this._enumItemWrapper);this._enumItemWrapper.appendChild(BX.create("div",{props:{className:"crm-entity-widget-content-block-title"},text:this.getMessage("enumItems")}));this._enumButtonWrapper=BX.create("div",{props:{className:"crm-entity-widget-content-block-add-field"}});this._enumItemWrapper.appendChild(this._enumButtonWrapper);this._enumButtonWrapper.appendChild(BX.create("span",{props:{className:"crm-entity-widget-content-add-field"},events:{click:BX.delegate(this.onEnumerationItemAddButtonClick,this)},text:this.getMessage("add")}));if(this._field){var o=this._field.getFieldInfo();var s=BX.prop.getArray(o,"ENUM",[]);for(var a=0,l=s.length;a<l;a++){this.createEnumerationItem(s[a])}}this.createEnumerationItem()}var d=BX.create("div",{props:{className:"crm-entity-widget-content-block-field-container crm-entity-widget-content-block-checkbox"}});this._wrapper.appendChild(BX.create("div",{props:{className:"crm-entity-widget-content-block"},children:[d]}));var h=0;if(e&&(this._typeId==="datetime"||this._typeId==="date")){this._isTimeEnabledCheckBox=BX.create("input",{props:{type:"checkbox"}});d.appendChild(BX.create("label",{children:[this._isTimeEnabledCheckBox,BX.create("span",{text:this.getMessage("enableTime")})]}));h++}if(this._typeId!=="boolean"){this._isRequiredCheckBox=BX.create("input",{props:{type:"checkbox",checked:this._field&&this._field.isRequired()}});this._isMultipleCheckBox=BX.create("input",{props:{type:"checkbox"}});if(h>0){d.appendChild(BX.create("br"))}d.appendChild(BX.create("label",{children:[this._isRequiredCheckBox,BX.create("span",{text:this.getMessage("isRequiredField")})]}));h++;if(e){d.appendChild(BX.create("br"));d.appendChild(BX.create("label",{children:[this._isMultipleCheckBox,BX.create("span",{text:this.getMessage("isMultipleField")})]}));h++}}if(h>0){this._wrapper.appendChild(BX.create("hr",{props:{className:"crm-entity-widget-hr"}}))}this._wrapper.appendChild(BX.create("div",{children:[this._saveButton,this._cancelButton]}));this.registerLayout(t);this._hasLayout=true};BX.Crm.EntityEditorUserFieldConfigurator.prototype.clearLayout=function(){if(!this._hasLayout){return}this._wrapper=BX.remove(this._wrapper);this._labelInput=null;this._saveButton=null;this._cancelButton=null;this._isTimeEnabledCheckBox=null;this._isRequiredCheckBox=null;this._isMultipleCheckBox=null;this._enumItemWrapper=null;this._enumButtonWrapper=null;this._enumItems=[];this._hasLayout=false};BX.Crm.EntityEditorUserFieldConfigurator.prototype.onEnumerationItemAddButtonClick=function(t){this.createEnumerationItem().focus()};BX.Crm.EntityEditorUserFieldConfigurator.prototype.createEnumerationItem=function(t){var e=BX.Crm.EntityEditorUserFieldListItem.create("",{configurator:this,container:this._enumItemWrapper,anchor:this._enumButtonWrapper,data:t});this._enumItems.push(e);e.layout();return e};BX.Crm.EntityEditorUserFieldConfigurator.prototype.removeEnumerationItem=function(t){for(var e=0,i=this._enumItems.length;e<i;e++){if(this._enumItems[e]===t){this._enumItems[e].clearLayout();this._enumItems.splice(e,1);break}}};BX.Crm.EntityEditorUserFieldConfigurator.prototype.onSaveButtonClick=function(t){if(this._isLocked){return}var e={typeId:this._typeId,label:this._labelInput.value};if(this._field){e["field"]=this._field;if(this._typeId!=="boolean"){e["mandatory"]=this._isRequiredCheckBox.checked}}else{if(this._typeId==="boolean"){e["multiple"]=false}else{e["multiple"]=this._isMultipleCheckBox.checked;e["mandatory"]=this._isRequiredCheckBox.checked}if(this._typeId==="datetime"){e["enableTime"]=this._isTimeEnabledCheckBox.checked}}if(this._typeId==="enumeration"){e["enumeration"]=[];var i=[];for(var n=0,r=this._enumItems.length;n<r;n++){var o=this._enumItems[n].prepareData();if(!o){continue}var s=BX.util.hashCode(o["VALUE"]);if(BX.util.in_array(s,i)){continue}i.push(s);o["SORT"]=(e["enumeration"].length+1)*100;e["enumeration"].push(o)}}BX.onCustomEvent(this,"onSave",[this,e])};BX.Crm.EntityEditorUserFieldConfigurator.prototype.onCancelButtonClick=function(t){if(this._isLocked){return}var e={typeId:this._typeId};if(this._field){e["field"]=this._field}BX.onCustomEvent(this,"onCancel",[this,e])};BX.Crm.EntityEditorUserFieldConfigurator.prototype.setLocked=function(t){t=!!t;if(this._isLocked===t){return}this._isLocked=t;if(this._isLocked){BX.addClass(this._saveButton,"webform-small-button-wait")}else{BX.removeClass(this._saveButton,"webform-small-button-wait")}};BX.Crm.EntityEditorUserFieldConfigurator.prototype.getField=function(){return this._field};if(typeof BX.Crm.EntityEditorUserFieldConfigurator.messages==="undefined"){BX.Crm.EntityEditorUserFieldConfigurator.messages={}}BX.Crm.EntityEditorUserFieldConfigurator.create=function(t,e){var i=new BX.Crm.EntityEditorUserFieldConfigurator;i.initialize(t,e);return i}}if(typeof BX.Crm.EntityEditorUserFieldListItem==="undefined"){BX.Crm.EntityEditorUserFieldListItem=function(){this._id="";this._settings=null;this._data=null;this._configurator=null;this._container=null;this._labelInput=null;this._hasLayout=false};BX.Crm.EntityEditorUserFieldListItem.prototype={initialize:function(t,e){this._id=BX.type.isNotEmptyString(t)?t:BX.util.getRandomString(4);this._settings=BX.type.isPlainObject(e)?e:{};this._data=BX.prop.getObject(this._settings,"data",{});this._configurator=BX.prop.get(this._settings,"configurator");this._container=BX.prop.getElementNode(this._settings,"container")},layout:function(){if(this._hasLayout){return}this._wrapper=BX.create("div",{props:{className:"crm-entity-widget-content-block-inner"}});this._labelInput=BX.create("input",{props:{className:"crm-entity-widget-content-input",type:"input",value:BX.prop.getString(this._data,"VALUE","")}});this._wrapper.appendChild(this._labelInput);this._wrapper.appendChild(BX.create("div",{props:{className:"crm-entity-widget-content-remove-block"},events:{click:BX.delegate(this.onDeleteButtonClick,this)}}));var t=BX.prop.getElementNode(this._settings,"anchor");if(t){this._container.insertBefore(this._wrapper,t)}else{this._container.appendChild(this._wrapper)}this._hasLayout=true},clearLayout:function(){if(!this._hasLayout){return}this._wrapper=BX.remove(this._wrapper);this._hasLayout=false},focus:function(){if(this._labelInput){this._labelInput.focus()}},prepareData:function(){var t=this._labelInput?BX.util.trim(this._labelInput.value):"";if(t===""){return null}var e={VALUE:t};var i=BX.prop.getInteger(this._data,"ID",0);if(i>0){e["ID"]=i}var n=BX.prop.getString(this._data,"XML_ID","");if(i>0){e["XML_ID"]=n}return e},onDeleteButtonClick:function(t){this._configurator.removeEnumerationItem(this)}};BX.Crm.EntityEditorUserFieldListItem.create=function(t,e){var i=new BX.Crm.EntityEditorUserFieldListItem;i.initialize(t,e);return i}}if(typeof BX.Crm.EntityEditorUserField==="undefined"){BX.Crm.EntityEditorUserField=function(){BX.Crm.EntityEditorUserField.superclass.constructor.apply(this);this._loader=null;this._innerWrapper=null};BX.extend(BX.Crm.EntityEditorUserField,BX.Crm.EntityEditorField);BX.Crm.EntityEditorUserField.prototype.doInitialize=function(){BX.Crm.EntityEditorUserField.superclass.doInitialize.apply(this);this._manager=this._editor.getUserFieldManager()};BX.Crm.EntityEditorUserField.prototype.getFieldInfo=function(){return this._schemeElement.getDataParam("fieldInfo",{})};BX.Crm.EntityEditorUserField.prototype.getFieldType=function(){return BX.prop.getString(this.getFieldInfo(),"USER_TYPE_ID","")};BX.Crm.EntityEditorUserField.prototype.getFieldSettings=function(){return BX.prop.getObject(this.getFieldInfo(),"SETTINGS",{})};BX.Crm.EntityEditorUserField.prototype.isMultiple=function(){return BX.prop.getString(this.getFieldInfo(),"MULTIPLE","N")==="Y"};BX.Crm.EntityEditorUserField.prototype.getEntityValueId=function(){return BX.prop.getString(this.getFieldInfo(),"ENTITY_VALUE_ID","")};BX.Crm.EntityEditorUserField.prototype.getFieldValue=function(){var t=this.getValue();var e=BX.prop.getArray(t,"VALUE",null);if(e===null){e=BX.prop.getString(t,"VALUE","")}return e};BX.Crm.EntityEditorUserField.prototype.getFieldSignature=function(){return BX.prop.getString(this.getValue(),"SIGNATURE","")};BX.Crm.EntityEditorUserField.prototype.isTitleEnabled=function(){var t=this.getFieldInfo();var e=BX.prop.getString(t,"USER_TYPE_ID","");if(e!=="boolean"){return true}return BX.prop.getString(BX.prop.getObject(t,"SETTINGS",{}),"DISPLAY","")!=="CHECKBOX"};BX.Crm.EntityEditorUserField.prototype.getFieldNode=function(){return this._innerWrapper};BX.Crm.EntityEditorUserField.prototype.checkIfNotEmpty=function(t){var e=BX.prop.getArray(t,"VALUE",null);if(e===null){e=BX.prop.getString(t,"VALUE","")}return BX.type.isArray(e)?e.length>0:e!==""};BX.Crm.EntityEditorUserField.prototype.getValue=function(t){if(t===undefined){t=null}if(!this._model){return t}return this._model.getField(this.getName(),t)};BX.Crm.EntityEditorUserField.prototype.layout=function(t){if(this._hasLayout){return}var e=this.getName();var i=this.getTitle();var n=this.getFieldInfo();var r=this.getValue();var o=BX.prop.getArray(r,"VALUE",null);if(o===null){o=BX.prop.getString(r,"VALUE","")}var s=this.checkIfNotEmpty(r);var a=BX.prop.getString(r,"SIGNATURE","");if(this._wrapper){this._wrapper=BX.cleanNode(this._wrapper)}else{this._wrapper=BX.create("div",{props:{className:"crm-entity-widget-content-block"}})}var l=this.getFieldType();if(l===BX.Crm.EntityUserFieldType.string){BX.addClass(this._wrapper,"crm-entity-widget-content-block-field-custom-text")}else if(l===BX.Crm.EntityUserFieldType.integer||l===BX.Crm.EntityUserFieldType.double){BX.addClass(this._wrapper,"crm-entity-widget-content-block-field-custom-number")}else if(l===BX.Crm.EntityUserFieldType.money){BX.addClass(this._wrapper,"crm-entity-widget-content-block-field-custom-money")}else if(l===BX.Crm.EntityUserFieldType.date||l===BX.Crm.EntityUserFieldType.datetime){BX.addClass(this._wrapper,"crm-entity-widget-content-block-field-custom-date")}else if(l===BX.Crm.EntityUserFieldType.boolean){BX.addClass(this._wrapper,"crm-entity-widget-content-block-field-custom-checkbox");s=o!==""&&o!=="0"}else if(l===BX.Crm.EntityUserFieldType.enumeration){BX.addClass(this._wrapper,this.isMultiple()?"crm-entity-widget-content-block-field-custom-multiselect":"crm-entity-widget-content-block-field-custom-select")}else if(l===BX.Crm.EntityUserFieldType.file){BX.addClass(this._wrapper,"crm-entity-widget-content-block-field-custom-file")}else if(l===BX.Crm.EntityUserFieldType.url){BX.addClass(this._wrapper,"crm-entity-widget-content-block-field-custom-link")}this._innerWrapper=null;if(this._mode===BX.Crm.EntityEditorMode.edit){this._wrapper.appendChild(this.createDragButton());if(this.isTitleEnabled()){this._wrapper.appendChild(this.createTitleNode(i))}this._innerWrapper=BX.create("div",{props:{className:"crm-entity-widget-content-block-inner"}});this._wrapper.appendChild(this._innerWrapper);this._wrapper.appendChild(this.createContextMenuButton());this.initializeDragDropAbilities()}else if(this._mode===BX.Crm.EntityEditorMode.view&&s){this._wrapper.appendChild(this.createTitleNode(i));this._innerWrapper=BX.create("div",{props:{className:"crm-entity-widget-content-block-inner"}});this._wrapper.appendChild(this._innerWrapper)}this.registerLayout(t);if(this._innerWrapper){var d=BX.prop.getString(t,"html","");if(d!==""){this.setupContentHtml(d)}else{var h=this._loader;if(!h){h=BX.prop.get(t,"userFieldLoader",null);if(!h){h=BX.Crm.EntityUserFieldLayoutLoader.create(this._id,{mode:this._mode,enableBatchMode:false})}}var p=BX.clone(n);p["SIGNATURE"]=a;if(s){p["VALUE"]=o}this.adjustFieldParams(p);h.addItem({name:e,field:p,callback:BX.delegate(this.onLayoutLoaded,this)});h.run()}}this._hasLayout=true};BX.Crm.EntityEditorUserField.prototype.adjustFieldParams=function(t){var e=this.getFieldType();if(e===BX.Crm.EntityUserFieldType.boolean){if(!BX.type.isPlainObject(t["SETTINGS"])){t["SETTINGS"]={}}t["SETTINGS"]["LABEL_CHECKBOX"]=this.getTitle()}if(typeof t["VALUE"]!=="undefined"&&this._mode===BX.Crm.EntityEditorMode.edit&&BX.prop.getInteger(t,"ENTITY_VALUE_ID")<=0){if(this._mode===BX.Crm.EntityEditorMode.edit&&BX.prop.getInteger(t,"ENTITY_VALUE_ID")<=0){t["ENTITY_VALUE_ID"]=1}}};BX.Crm.EntityEditorUserField.prototype.doClearLayout=function(t){this._innerWrapper=null};BX.Crm.EntityEditorUserField.prototype.validate=function(){return true};BX.Crm.EntityEditorUserField.prototype.save=function(){};BX.Crm.EntityEditorUserField.prototype.focus=function(){if(this._mode===BX.Crm.EntityEditorMode.edit){this.scrollAnimate();BX.Main.UF.Factory.focus(this.getName())}};BX.Crm.EntityEditorUserField.prototype.setLayoutLoader=function(t){this._loader=t};BX.Crm.EntityEditorUserField.prototype.getLayoutLoader=function(){return this._loader};BX.Crm.EntityEditorUserField.prototype.setupContentHtml=function(t){if(this._innerWrapper){BX.html(this._innerWrapper,t).then(BX.delegate(this.onLayoutSuccess,this))}};BX.Crm.EntityEditorUserField.prototype.doSetActive=function(){if(!this._isActive){this._manager.unregisterActiveField(this)}};BX.Crm.EntityEditorUserField.prototype.rollback=function(){this._manager.unregisterActiveField(this)};BX.Crm.EntityEditorUserField.prototype.onLayoutSuccess=function(){if(this._isActive){this._manager.registerActiveField(this)}BX.bindDelegate(this._innerWrapper,"bxchange",{tag:["input","select","textarea"]},this._changeHandler);if(!this._hasLayout){this._hasLayout=true}};BX.Crm.EntityEditorUserField.prototype.onLayoutLoaded=function(t){var e=BX.prop.getString(t,"HTML","");if(e!==""){this.setupContentHtml(e)}};BX.Crm.EntityEditorUserField.create=function(t,e){var i=new BX.Crm.EntityEditorUserField;i.initialize(t,e);return i}}if(typeof BX.Crm.EntityEditorProductRowSummary==="undefined"){BX.Crm.EntityEditorProductRowSummary=function(){BX.Crm.EntityEditorProductRowSummary.superclass.constructor.apply(this);this._loader=null;this._table=null;this._itemCount=0;this._totalCount=0;this._moreButton=null;this._moreButtonRow=null;this._moreButtonClickHandler=BX.delegate(this._onMoreButtonClick,this)};BX.extend(BX.Crm.EntityEditorProductRowSummary,BX.Crm.EntityEditorField);BX.Crm.EntityEditorProductRowSummary.prototype.getMessage=function(t){var e=BX.Crm.EntityEditorProductRowSummary.messages;return e.hasOwnProperty(t)?e[t]:t};BX.Crm.EntityEditorProductRowSummary.prototype.layout=function(t){if(this._hasLayout){return}var e=this.getValue();if(!BX.type.isPlainObject(e)){return}var i=BX.prop.getArray(e,"items",[]);this._totalCount=BX.prop.getInteger(e,"count",0);this._wrapper=BX.create("div",{props:{className:"crm-entity-widget-content-block"}});this._table=BX.create("table",{props:{className:"crm-entity-widget-content-block-products-list"}});var n=this._itemCount=i.length;var r=0;if(n>5){r=this._totalCount-5;n=5}for(var o=0;o<n;o++){this.addProductRow(i[o],-1)}var s,a;this._moreButton=null;if(r>0){s=this._moreButtonRow=this._table.insertRow(-1);s.className="crm-entity-widget-content-block-products-item";a=s.insertCell(-1);a.className="crm-entity-widget-content-block-products-item-name";this._moreButton=BX.create("span",{attrs:{className:"crm-entity-widget-content-block-products-show-more"},events:{click:this._moreButtonClickHandler},text:this.getMessage("notShown").replace(/#COUNT#/gi,r.toString())});a.appendChild(this._moreButton);a=s.insertCell(-1);a.className="crm-entity-widget-content-block-products-price"}s=this._table.insertRow(-1);s.className="crm-entity-widget-content-block-products-item";a=s.insertCell(-1);a.className="crm-entity-widget-content-block-products-item-name";a.innerHTML=this.getMessage("total");a=s.insertCell(-1);a.className="crm-entity-widget-content-block-products-price";a.appendChild(BX.create("div",{attrs:{className:"crm-entity-widget-content-block-products-price-value"},html:e["total"]}));this._wrapper.appendChild(BX.create("div",{props:{className:"crm-entity-widget-content-block-products"},children:[this._table]}));this.registerLayout(t);this._hasLayout=true};BX.Crm.EntityEditorProductRowSummary.prototype._onMoreButtonClick=function(t){if(this._totalCount>10){BX.onCustomEvent(window,"OpenEntityDetailTab",["tab_products"]);return}this._moreButtonRow.style.display="none";var e=this.getValue();var i=BX.prop.getArray(e,"items",[]);for(var n=5;n<this._itemCount;n++){this.addProductRow(i[n],n)}};BX.Crm.EntityEditorProductRowSummary.prototype.clearLayout=function(){if(!this._hasLayout){return}this._table=null;this._moreButton=null;this._moreButtonRow=null;this._wrapper=BX.remove(this._wrapper);this._hasLayout=false};BX.Crm.EntityEditorProductRowSummary.prototype.addProductRow=function(t,e){if(typeof e==="undefined"){e=-1}var i,n;i=this._table.insertRow(e);i.className="crm-entity-widget-content-block-products-item";n=i.insertCell(-1);n.className="crm-entity-widget-content-block-products-item-name";var r=BX.prop.getString(t,"URL","");if(r!==""){n.appendChild(BX.create("a",{attrs:{target:"_blank",href:r},text:t["PRODUCT_NAME"]}))}else{n.innerHTML=BX.util.htmlspecialchars(t["PRODUCT_NAME"])}n=i.insertCell(-1);n.className="crm-entity-widget-content-block-products-price";n.appendChild(BX.create("div",{attrs:{className:"crm-entity-widget-content-block-products-price-value"},html:t["SUM"]}))};if(typeof BX.Crm.EntityEditorProductRowSummary.messages==="undefined"){BX.Crm.EntityEditorProductRowSummary.messages={}}BX.Crm.EntityEditorProductRowSummary.create=function(t,e){var i=new BX.Crm.EntityEditorProductRowSummary;i.initialize(t,e);return i}}if(typeof BX.Crm.EntityEditorRequisiteSelector==="undefined"){BX.Crm.EntityEditorRequisiteSelector=function(){BX.Crm.EntityEditorRequisiteSelector.superclass.constructor.apply(this);this._requisiteId=0;this._bankDetailId=0;this._itemWrappers={};this._itemButtons={};this._itemBankDetailButtons={}};BX.extend(BX.Crm.EntityEditorRequisiteSelector,BX.Crm.EntityEditorField);BX.Crm.EntityEditorRequisiteSelector.prototype.doInitialize=function(){this._requisiteId=this._model.getIntegerField("REQUISITE_ID",0);this._bankDetailId=this._model.getIntegerField("BANK_DETAIL_ID",0)};BX.Crm.EntityEditorRequisiteSelector.prototype.getMessage=function(t){var e=BX.Crm.EntityEditorRequisiteSelector.messages;return e.hasOwnProperty(t)?e[t]:t};BX.Crm.EntityEditorRequisiteSelector.prototype.getPrefix=function(){return this._id.toLowerCase()+"_"};BX.Crm.EntityEditorRequisiteSelector.prototype.layout=function(t){if(this._hasLayout){return}var e=this.getData();this._requisiteInfo=BX.CrmEntityRequisiteInfo.create({requisiteId:this._requisiteId,bankDetailId:this._bankDetailId,data:BX.prop.getArray(e,"data",{})});var i=this._requisiteInfo.getItems();this._wrapper=BX.create("div",{props:{className:"crm-entity-requisites-slider-wrapper"}});var n=BX.create("div",{props:{className:"crm-entity-requisites-slider-content"}});this._wrapper.appendChild(n);var r=BX.create("div",{props:{className:"crm-entity-requisites-slider-widget-content"}});n.appendChild(r);var o=BX.create("div",{props:{className:"crm-entity-requisites-select-container"}});r.appendChild(o);for(var s=0,a=i.length;s<a;s++){o.appendChild(this.prepareItemLayout(i[s]))}this.registerLayout(t);this._hasLayout=true};BX.Crm.EntityEditorRequisiteSelector.prototype.getItemData=function(t){var e=this._requisiteInfo.getItems();for(var i=0,n=e.length;i<n;i++){var r=e[i];if(t===BX.prop.getInteger(r,"requisiteId",0)){return r}}return null};BX.Crm.EntityEditorRequisiteSelector.prototype.prepareItemLayout=function(t){var e=BX.prop.getObject(t,"viewData",null);if(!e){return}var i=BX.prop.getBoolean(t,"selected",false);var n=this.getPrefix();var r=BX.prop.getInteger(t,"requisiteId",0);var o=BX.create("label",{props:{className:"crm-entity-requisites-select-item"}});o.appendChild(BX.create("strong",{text:BX.prop.getString(e,"title","")}));if(i){BX.addClass(o,"crm-entity-requisites-select-item-selected")}this._itemWrappers[r]=o;var s,a;var l=BX.prop.getArray(e,"fields",[]);for(s=0,a=l.length;s<a;s++){var d=l[s];var h=BX.prop.getString(d,"title","");var p=BX.prop.getString(d,"textValue","");if(h!==""&&p!==""){o.appendChild(BX.create("br"));o.appendChild(BX.create("span",{text:h+": "+p}))}}var c=BX.create("input",{props:{type:"radio",name:n+"requisite",checked:i,className:"crm-entity-requisites-select-item-field"},attrs:{"data-requisiteid":r}});o.appendChild(c);this._itemButtons[r]=c;BX.bind(c,"change",BX.delegate(this.onItemChange,this));var u=BX.prop.getArray(t,"bankDetailViewDataList",[]);if(u.length>0){var m=BX.create("span",{props:{className:"crm-entity-requisites-select-item-bank-requisites-container"}});o.appendChild(m);m.appendChild(BX.create("span",{props:{className:"crm-entity-requisites-select-item-bank-requisites-title"},html:this.getMessage("bankDetails")}));var g=BX.create("span",{props:{className:"crm-entity-requisites-select-item-bank-requisites-field-container"}});m.appendChild(g);this._itemBankDetailButtons[r]={};for(s=0,a=u.length;s<a;s++){var y=u[s];var _=BX.prop.getInteger(y,"pseudoId",0);var f=BX.prop.getObject(y,"viewData",null);if(!f){continue}var E=i&&BX.prop.getBoolean(y,"selected",false);var B=BX.create("label",{props:{className:"crm-entity-requisites-select-item-bank-requisites-field-item"}});g.appendChild(B);var C=BX.create("input",{props:{type:"radio",name:n+"bankrequisite"+r,checked:E,className:"crm-entity-requisites-select-item-bank-requisites-field"},attrs:{"data-requisiteid":r,"data-bankdetailid":_}});B.appendChild(C);BX.bind(C,"change",BX.delegate(this.onItemBankDetailChange,this));this._itemBankDetailButtons[r][_]=C;B.appendChild(document.createTextNode(BX.prop.getString(f,"title","")))}o.appendChild(BX.create("span",{style:{display:"block",clear:"both"}}))}return o};BX.Crm.EntityEditorRequisiteSelector.prototype.clearLayout=function(){if(!this._hasLayout){return}this._wrapper=BX.remove(this._wrapper);this._itemWrappers={};this._itemButtons={};this._itemBankDetailButtons={};this._hasLayout=false};BX.Crm.EntityEditorRequisiteSelector.prototype.save=function(){this._model.setField("REQUISITE_ID",this._requisiteId,{originator:this});this._model.setField("BANK_DETAIL_ID",this._bankDetailId,{originator:this})};BX.Crm.EntityEditorRequisiteSelector.prototype.onItemChange=function(t){var e=BX.getEventTarget(t);if(!e.checked){return}var i=parseInt(e.getAttribute("data-requisiteid"));if(isNaN(i)||i<=0){return}this._requisiteId=i;this._bankDetailId=0;var n=this.getItemData(this._requisiteId);var r=BX.prop.getArray(n,"bankDetailViewDataList",[]);for(var o=0,s=r.length;o<s;o++){var a=r[o];var l=BX.prop.getInteger(a,"pseudoId",0);if(l>0&&BX.prop.getBoolean(a,"selected",false)){this._bankDetailId=l;break}}for(var d in this._itemWrappers){if(!this._itemWrappers.hasOwnProperty(d)){continue}var h=this._itemWrappers[d];var p=this._requisiteId===parseInt(d);if(p){BX.addClass(h,"crm-entity-requisites-select-item-selected")}else{BX.removeClass(h,"crm-entity-requisites-select-item-selected")}if(this._itemButtons.hasOwnProperty(d)){var c=this._itemButtons[d];if(c.checked!==p){c.checked=p}}if(this._itemBankDetailButtons.hasOwnProperty(d)){var u=this._itemBankDetailButtons[d];for(var m in u){if(!u.hasOwnProperty(m)){continue}var g=p&&this._bankDetailId===parseInt(m);var y=u[m];if(y.checked!==g){y.checked=g}}}}};BX.Crm.EntityEditorRequisiteSelector.prototype.onItemBankDetailChange=function(t){var e=BX.getEventTarget(t);if(!e.checked){return}var i=parseInt(e.getAttribute("data-requisiteid"));if(isNaN(i)||i<=0){return}if(this._requisiteId!==i){return}var n=parseInt(e.getAttribute("data-bankdetailid"));if(isNaN(n)||n<=0){return}this._bankDetailId=n};if(typeof BX.Crm.EntityEditorRequisiteSelector.messages==="undefined"){BX.Crm.EntityEditorRequisiteSelector.messages={}}BX.Crm.EntityEditorRequisiteSelector.create=function(t,e){var i=new BX.Crm.EntityEditorRequisiteSelector;i.initialize(t,e);return i}}if(typeof BX.Crm.EntityEditorRequisiteListItem==="undefined"){BX.Crm.EntityEditorRequisiteListItem=function(){this._id="";this._settings=null;this._owner=null;this._mode=BX.Crm.EntityEditorMode.intermediate;this._data=null;this._requisiteId=0;this._container=null;this._wrapper=null;this._innerWrapper=null;this._editButton=null;this._deleteButton=null;this._hasLayout=false};BX.Crm.EntityEditorRequisiteListItem.prototype={initialize:function(t,e){this._id=BX.type.isNotEmptyString(t)?t:BX.util.getRandomString(4);this._settings=BX.type.isPlainObject(e)?e:{};this._owner=BX.prop.get(this._settings,"owner",null);this._mode=BX.prop.getInteger(this._settings,"mode",BX.Crm.EntityEditorMode.intermediate);this._data=BX.prop.getObject(this._settings,"data",{});this._requisiteId=BX.prop.getInteger(this._data,"requisiteId",0);this._container=BX.prop.getElementNode(this._settings,"container")},getId:function(){return this._id},getMessage:function(t){return BX.prop.getString(BX.Crm.EntityEditorRequisiteListItem.messages,t,t)},getRequisiteId:function(){return this._requisiteId},getData:function(){return this._data},setData:function(t){this._data=t},layout:function(t){if(this._hasLayout){return}var e=BX.prop.getObject(this._data,"viewData",null);if(!e){e={}}var i=this._mode===BX.Crm.EntityEditorMode.view;this._wrapper=BX.create("div",{props:{className:"crm-entity-widget-client-requisites-container crm-entity-widget-client-requisites-container-opened"}});this._innerWrapper=BX.create("dl",{props:{className:"crm-entity-widget-client-requisites-list"}});this.prepareViewLayout(e,["RQ_ADDR"]);this.prepareFieldViewLayout(e,"RQ_ADDR");var n=BX.prop.getArray(this._data,"bankDetailViewDataList",[]);for(var r=0,o=n.length;r<o;r++){var s=n[r];if(!BX.prop.getBoolean(s,"isDeleted",false)){this.prepareViewLayout(BX.prop.getObject(s,"viewData",null),[])}}if(!i){this._deleteButton=BX.create("span",{props:{className:"crm-entity-widget-client-requisites-remove-icon"},events:{click:BX.delegate(this.onRemoveButtonClick,this)}});this._editButton=BX.create("span",{props:{className:"crm-entity-widget-client-requisites-edit-icon"},events:{click:BX.delegate(this.onEditButtonClick,this)}})}this._wrapper.appendChild(BX.create("div",{props:{className:"crm-entity-widget-client-requisites-inner-container"},children:[this._deleteButton,this._editButton,this._innerWrapper]}));var a=BX.prop.getElementNode(t,"anchor",null);if(a){this._container.insertBefore(this._wrapper,a)}else{this._container.appendChild(this._wrapper)}this._hasLayout=true},prepareViewLayout:function(t,e){if(!t){return}var i=BX.prop.getString(t,"title","");if(i!==""){this._innerWrapper.appendChild(BX.create("dt",{props:{className:"crm-entity-widget-client-requisites-name"},text:i}))}var n,r;var o={};if(BX.type.isArray(e)){for(n=0,r=e.length;n<r;n++){o[e[n]]=true}}var s=[];var a=BX.prop.getArray(t,"fields",[]);for(n=0,r=a.length;n<r;n++){var l=a[n];var d=BX.prop.getString(l,"name","");if(o.hasOwnProperty(d)){continue}var h=BX.prop.getString(l,"title","");var p=BX.prop.getString(l,"textValue","");if(h!==""&&p!==""){s.push(h+": "+p)}}this._innerWrapper.appendChild(BX.create("dd",{props:{className:"crm-entity-widget-client-requisites-value"},text:s.join(", ")}))},prepareFieldViewLayout:function(t,e){if(!t){return}var i=BX.prop.getArray(t,"fields",[]);for(var n=0,r=i.length;n<r;n++){var o=i[n];var s=BX.prop.getString(o,"name","");if(s!==e){continue}var a=BX.prop.getString(o,"title","");var l=BX.prop.getString(o,"textValue","");if(a===""||l===""){continue}this._innerWrapper.appendChild(BX.create("dt",{props:{className:"crm-entity-widget-client-requisites-name"},text:a}));this._innerWrapper.appendChild(BX.create("dd",{props:{className:"crm-entity-widget-client-requisites-value"},text:l}))}},clearLayout:function(){if(!this._hasLayout){return}this._wrapper=BX.remove(this._wrapper);this._innerWrapper=null;this._editButton=null;this._deleteButton=null;this._hasLayout=false},getContainer:function(){return this._container},setContainer:function(t){this._container=t},getWrapper:function(){return this._wrapper},prepareData:function(){var t=this._labelInput?BX.util.trim(this._labelInput.value):"";if(t===""){return null}var e={VALUE:t};var i=BX.prop.getInteger(this._data,"ID",0);if(i>0){e["ID"]=i}var n=BX.prop.getString(this._data,"XML_ID","");if(i>0){e["XML_ID"]=n}return e},onEditButtonClick:function(t){this._owner.processItemEditing(this)},onRemoveButtonClick:function(t){var e=BX.Crm.EditorDialog.create(this._id,{title:this.getMessage("deleteTitle"),content:this.getMessage("deleteConfirm"),buttons:[{id:"accept",type:BX.Crm.EditorDialogButtonType.accept,text:BX.message("CRM_EDITOR_DELETE"),callback:BX.delegate(this.onRemovalConfirmationDialogButtonClick,this)},{id:"cancel",type:BX.Crm.EditorDialogButtonType.cancel,text:BX.message("CRM_EDITOR_CANCEL"),callback:BX.delegate(this.onRemovalConfirmationDialogButtonClick,this)}]});e.open()}};BX.Crm.EntityEditorRequisiteListItem.prototype.onRemovalConfirmationDialogButtonClick=function(t){var e=t.getDialog();if(t.getId()==="accept"){this._owner.processItemRemoval(this)}e.close()};if(typeof BX.Crm.EntityEditorRequisiteListItem.messages==="undefined"){BX.Crm.EntityEditorRequisiteListItem.messages={}}BX.Crm.EntityEditorRequisiteListItem.create=function(t,e){var i=new BX.Crm.EntityEditorRequisiteListItem;i.initialize(t,e);return i}}if(typeof BX.Crm.EntityEditorRequisiteList==="undefined"){BX.Crm.EntityEditorRequisiteList=function(){BX.Crm.EntityEditorRequisiteList.superclass.constructor.apply(this);this._items=null;this._data=null;this._externalContext=null;this._externalEventHandler=null;this._createButton=null;this._dataInputs={};this._dataSignInputs={};this._itemWrapper=null;this._dataWrapper=null;this._isPresetMenuOpened=false;this._newItemIndex=-1;this._sliderUrls={}};BX.extend(BX.Crm.EntityEditorRequisiteList,BX.Crm.EntityEditorField);BX.Crm.EntityEditorRequisiteList.prototype.doInitialize=function(){this.initializeFromModel()};BX.Crm.EntityEditorRequisiteList.prototype.initializeFromModel=function(){var t=this.getValue();this._data=BX.type.isArray(t)?BX.clone(t,true):[];for(var e=0,i=this._data.length;e<i;e++){this.prepareRequisiteData(this._data[e])}this._requisiteInfo=BX.CrmEntityRequisiteInfo.create({requisiteId:0,bankDetailId:0,data:this._data})};BX.Crm.EntityEditorRequisiteList.prototype.processModelChange=function(t){if(BX.prop.get(t,"originator",null)===this){return}if(!BX.prop.getBoolean(t,"forAll",false)&&BX.prop.getString(t,"name","")!==this.getName()){return}this.initializeFromModel();this.refreshLayout()};BX.Crm.EntityEditorRequisiteList.prototype.rollback=function(){if(this.isChanged()){this.initializeFromModel()}for(var t in this._sliderUrls){if(this._sliderUrls.hasOwnProperty(t)){BX.Crm.Page.closeSlider(this._sliderUrls[t])}}this._sliderUrls={}};BX.Crm.EntityEditorRequisiteList.prototype.doSetMode=function(t){this.rollback()};BX.Crm.EntityEditorRequisiteList.prototype.getMessage=function(t){var e=BX.Crm.EntityEditorRequisiteList.messages;return e.hasOwnProperty(t)?e[t]:BX.Crm.EntityEditorRequisiteList.superclass.getMessage.apply(this,arguments)};BX.Crm.EntityEditorRequisiteList.prototype.prepareDataInputName=function(t,e){return this.getName()+"["+t.toString()+"]"+"["+e+"]"};BX.Crm.EntityEditorRequisiteList.prototype.prepareRequisiteData=function(t){var e=BX.prop.getInteger(t,"requisiteId",0);var i=BX.prop.getString(t,"pseudoId","");if(e>0){t["key"]=e.toString();t["isNew"]=false;t["isChanged"]=BX.prop.getBoolean(t,"isChanged",false)}else{t["key"]=i;t["isNew"]=true;t["isChanged"]=BX.prop.getBoolean(t,"isChanged",true)}t["isDeleted"]=false};BX.Crm.EntityEditorRequisiteList.prototype.findRequisiteDataIndexByKey=function(t){for(var e=0,i=this._data.length;e<i;e++){if(BX.prop.getString(this._data[e],"key",0)===t){return e}}return-1};BX.Crm.EntityEditorRequisiteList.prototype.getRequisiteDataByKey=function(t){var e=this.findRequisiteDataIndexByKey(t);return e>=0?this._data[e]:null};BX.Crm.EntityEditorRequisiteList.prototype.setupRequisiteData=function(t){var e=BX.prop.getString(t,"key","");if(e===""){return}var i=this.findRequisiteDataIndexByKey(e);if(i>=0){this._data[i]=t}else{this._data.push(t)}this._requisiteInfo=BX.CrmEntityRequisiteInfo.create({requisiteId:0,bankDetailId:0,data:this._data})};BX.Crm.EntityEditorRequisiteList.prototype.refreshRequisiteDataInputs=function(){if(!this._hasLayout){return}BX.cleanNode(this._dataWrapper);for(var t=0,e=this._data.length;t<e;t++){var i=this._data[t];var n=BX.prop.getString(i,"key","");if(n===""){continue}var r=BX.prop.getBoolean(i,"isChanged",false);var o=BX.prop.getBoolean(i,"isDeleted",false);if(!r&&!o){continue}if(o){this._dataWrapper.appendChild(BX.create("input",{props:{type:"hidden",name:this.prepareDataInputName(n,"DELETED"),value:"Y"}}))}else{var s=BX.prop.getString(i,"requisiteDataSign","");if(s!==""){this._dataWrapper.appendChild(BX.create("input",{props:{type:"hidden",name:this.prepareDataInputName(n,"SIGN"),value:s}}))}var a=BX.prop.getString(i,"requisiteData","");if(a!==""){this._dataWrapper.appendChild(BX.create("input",{props:{type:"hidden",name:this.prepareDataInputName(n,"DATA"),value:a}}))}}}};BX.Crm.EntityEditorRequisiteList.prototype.layout=function(t){if(this._hasLayout){return}var e,i;this._items=[];var n=this._requisiteInfo.getItems();for(e=0,i=n.length;e<i;e++){var r=n[e];var o=BX.Crm.EntityEditorRequisiteListItem.create(BX.prop.getString(r,"key",""),{owner:this,mode:this._mode,data:r});this._items.push(o)}this._wrapper=BX.create("div",{props:{className:"crm-entity-widget-content-block"}});var s=this._mode===BX.Crm.EntityEditorMode.view;if(!s){this._dataWrapper=BX.create("div");this._wrapper.appendChild(this._dataWrapper);this._wrapper.appendChild(this.createDragButton())}if(!s){this._wrapper.appendChild(this.createTitleNode(this.getTitle()));this._itemWrapper=BX.create("div",{props:{className:"crm-entity-widget-content-block-inner crm-entity-widget-content-block-requisites"}});this._wrapper.appendChild(this._itemWrapper);for(e=0,i=this._items.length;e<i;e++){this._items[e].setContainer(this._itemWrapper);this._items[e].layout()}this._createButton=BX.create("span",{props:{className:"crm-entity-widget-client-requisites-add-btn"},text:BX.message("CRM_EDITOR_ADD")});this._itemWrapper.appendChild(this._createButton);BX.bind(this._createButton,"click",BX.delegate(this.onCreateButtonClick,this));this._wrapper.appendChild(this.createContextMenuButton());this.initializeDragDropAbilities()}else if(this._items.length>0){this._wrapper.appendChild(this.createTitleNode(this.getTitle()));this._itemWrapper=BX.create("div",{props:{className:"crm-entity-widget-content-block-colums-block"}});this._wrapper.appendChild(BX.create("div",{props:{className:"crm-entity-widget-content-block-inner"},children:[this._itemWrapper]}));this._wrapper.appendChild(this._itemWrapper);for(e=0,i=this._items.length;e<i;e++){this._items[e].setContainer(this._itemWrapper);this._items[e].layout()}}this.registerLayout(t);this._hasLayout=true};BX.Crm.EntityEditorRequisiteList.prototype.clearLayout=function(){for(var t=0,e=this._items.length;t<e;t++){this._items[t].clearLayout()}this._items=[];this._itemWrapper=null;this._createButton=null;this._wrapper=BX.remove(this._wrapper);this._hasLayout=false};BX.Crm.EntityEditorRequisiteList.prototype.getItemByIndex=function(t){return t>=0&&t<=this._items.length-1?this._items[t]:null};BX.Crm.EntityEditorRequisiteList.prototype.getItemById=function(t){for(var e=0,i=this._items.length;e<i;e++){var n=this._items[e];if(n.getId()===t){return n}}return null};BX.Crm.EntityEditorRequisiteList.prototype.getItemCount=function(){return this._items.length};BX.Crm.EntityEditorRequisiteList.prototype.getItemIndex=function(t){for(var e=0,i=this._items.length;e<i;e++){if(this._items[e]===t){return e}}return-1};BX.Crm.EntityEditorRequisiteList.prototype.removeItemByIndex=function(t){if(t<this._items.length){this._items.splice(t,1)}};BX.Crm.EntityEditorRequisiteList.prototype.removeItem=function(t){var e=this.getItemIndex(t);if(e<0){return}var i=this.getRequisiteDataByKey(t.getId());if(i){i["isDeleted"]=true}t.clearLayout();this.removeItemByIndex(e);this.refreshRequisiteDataInputs();this.markAsChanged()};BX.Crm.EntityEditorRequisiteList.prototype.openEditor=function(t){var e=BX.prop.getInteger(t,"requisiteId",0);var i=this._editor.getContextId();var n={etype:this._editor.getEntityTypeId(),eid:this._editor.getEntityId(),external_context_id:i};var r=BX.prop.getInteger(t,"presetId",0);if(r>0){n["pid"]=r}var o="";if(e<=0){this._newItemIndex++;o="n"+this._newItemIndex.toString();n["pseudo_id"]=o}var s=BX.util.add_url_param(this._editor.getRequisiteEditUrl(e),n);if(!this._externalEventHandler){this._externalEventHandler=BX.delegate(this.onExternalEvent,this);BX.addCustomEvent(window,"onLocalStorageSet",this._externalEventHandler)}if(!this._externalContext){this._externalContext={}}if(e>0){this._externalContext[e]={requisiteId:e,url:s}}else{this._externalContext[o]={pseudoId:o,url:s}}if(e>0){this._sliderUrls[e]=s}BX.Crm.Page.openSlider(s,{width:950})};BX.Crm.EntityEditorRequisiteList.prototype.processItemEditing=function(t){this.openEditor({requisiteId:t.getRequisiteId()})};BX.Crm.EntityEditorRequisiteList.prototype.processItemRemoval=function(t){this.removeItem(t)};BX.Crm.EntityEditorRequisiteList.prototype.onExternalEvent=function(t){var e=BX.type.isNotEmptyString(t["key"])?t["key"]:"";if(e!=="BX.Crm.RequisiteSliderEditor:onSave"){return}var i=BX.type.isPlainObject(t["value"])?t["value"]:{};var n=BX.prop.getString(i,"context","");if(n!==this._editor.getContextId()){return}var r=BX.prop.getInteger(i,"presetId",0);var o=BX.prop.getString(i,"pseudoId","");var s=BX.prop.getInteger(i,"requisiteId",0);var a=BX.prop.getString(i,"requisiteDataSign","");var l=BX.prop.getString(i,"requisiteData","");var d={entityTypeId:this._editor.getEntityTypeId(),entityId:this._editor.getEntityId(),presetId:r,pseudoId:o,requisiteId:s,requisiteData:l,requisiteDataSign:a,isChanged:true};this.prepareRequisiteData(d);this.setupRequisiteData(d);this.refreshRequisiteDataInputs();this.markAsChanged();var h=BX.prop.getString(d,"key","");var p=BX.prop.getObject(this._externalContext,h,null);if(!p){return}var c=this.getItemById(h);var u;if(c){c.setData(d);c.clearLayout();u={};var m=this.getItemIndex(c);if(m<this.getItemCount()-1){u["anchor"]=this.getItemByIndex(m+1).getWrapper()}else if(this._createButton){u["anchor"]=this._createButton}c.layout(u)}else{c=BX.Crm.EntityEditorRequisiteListItem.create(h,{owner:this,mode:this._mode,data:d,container:this._itemWrapper});this._items.push(c);u={};if(this._createButton){u["anchor"]=this._createButton}c.layout(u)}var g=BX.prop.getString(p,"url","");if(g!==""){BX.Crm.Page.closeSlider(g,true)}delete this._externalContext[s]};BX.Crm.EntityEditorRequisiteList.prototype.onCreateButtonClick=function(t){this.togglePresetMenu()};BX.Crm.EntityEditorRequisiteList.prototype.togglePresetMenu=function(){if(this._isPresetMenuOpened){this.closePresetMenu()}else{this.openPresetMenu()}};BX.Crm.EntityEditorRequisiteList.prototype.openPresetMenu=function(){if(this._isPresetMenuOpened){return}var t=[];var e=BX.prop.getArray(this._schemeElement.getData(),"presets");for(var i=0,n=e.length;i<n;i++){var r=e[i];var o=BX.prop.getString(r,"VALUE",i);var s=BX.prop.getString(r,"NAME",o);t.push({text:s,value:o,onclick:BX.delegate(this.onPresetSelect,this)})}BX.PopupMenu.show(this._id,this._createButton,t,{angle:false,events:{onPopupShow:BX.delegate(this.onPresetMenuShow,this),onPopupClose:BX.delegate(this.onPresetMenuClose,this)}})};BX.Crm.EntityEditorRequisiteList.prototype.closePresetMenu=function(){if(!this._isPresetMenuOpened){return}var t=BX.PopupMenu.getMenuById(this._id);if(t){t.popupWindow.close()}};BX.Crm.EntityEditorRequisiteList.prototype.onPresetMenuShow=function(){this._isPresetMenuOpened=true};BX.Crm.EntityEditorRequisiteList.prototype.onPresetMenuClose=function(){BX.PopupMenu.destroy(this._id);this._isPresetMenuOpened=false};BX.Crm.EntityEditorRequisiteList.prototype.onPresetSelect=function(t,e){this.openEditor({presetId:e.value});this.closePresetMenu()};BX.Crm.EntityEditorRequisiteList.prototype.save=function(){};if(typeof BX.Crm.EntityEditorRequisiteList.messages==="undefined"){BX.Crm.EntityEditorRequisiteList.messages={}}BX.Crm.EntityEditorRequisiteList.create=function(t,e){var i=new BX.Crm.EntityEditorRequisiteList;i.initialize(t,e);return i}}if(typeof BX.Crm.ClientEditorEntityRequisitePanel==="undefined"){BX.Crm.ClientEditorEntityRequisitePanel=function(){this._id="";this._settings={};this._editor=null;this._entityInfo=null;this._requisiteInfo=null;this._mode=BX.Crm.EntityEditorMode.intermediate;this._selectedRequisiteId=0;this._selectedBankDetailId=0;this._container=null;this._wrapper=null;this._contentWrapper=null;this._requisiteInput=null;this._bankDetailInput=null;this._toggleButton=null;this._editButton=null;this._toggleButtonHandler=BX.delegate(this.onToggleButtonClick,this);this._editButtonHandler=BX.delegate(this.onEditButtonClick,this);this._isExpanded=false;this._hasLayout=false;this._externalEventHandler=BX.delegate(this.onExternalEvent,this)};BX.Crm.ClientEditorEntityRequisitePanel.prototype={initialize:function(t,e){this._id=BX.type.isNotEmptyString(t)?t:BX.util.getRandomString(4);this._settings=e?e:{};this._editor=BX.prop.get(this._settings,"editor");this._container=BX.prop.getElementNode(this._settings,"container",null);this._mode=BX.prop.getInteger(this._settings,"mode",0);this._entityInfo=BX.prop.get(this._settings,"entityInfo",null);this._requisiteInfo=BX.prop.get(this._settings,"requisiteInfo",null);this._selectedRequisiteId=this._requisiteInfo.getRequisiteId();this._selectedBankDetailId=this._requisiteInfo.getBankDetailId();if(BX.Crm.ClientEditorEntityRequisitePanel.options.hasOwnProperty(this._id)){this._isExpanded=BX.prop.getBoolean(BX.Crm.ClientEditorEntityRequisitePanel.options[this._id],"expanded",false)}},getMessage:function(t){var e=BX.Crm.ClientEditorEntityRequisitePanel.messages;return e.hasOwnProperty(t)?e[t]:t},getContainer:function(){return this._container},setContainer:function(t){this._container=t},isExpanded:function(){return this._isExpanded},setExpanded:function(t){t=!!t;if(this._isExpanded===t){return}this._isExpanded=t;if(!BX.Crm.ClientEditorEntityRequisitePanel.options.hasOwnProperty(this._id)){BX.Crm.ClientEditorEntityRequisitePanel.options[this._id]={}}BX.Crm.ClientEditorEntityRequisitePanel.options[this._id]["expanded"]=this._isExpanded;if(t){BX.addClass(this._wrapper,"crm-entity-widget-client-requisites-container-opened")}else{BX.removeClass(this._wrapper,"crm-entity-widget-client-requisites-container-opened")}},toggle:function(){this.setExpanded(!this._isExpanded)},layout:function(){if(this._hasLayout){return}var t=null;var e=null;var i=this._selectedRequisiteId;var n=this._selectedBankDetailId;if(i>0){t=this._requisiteInfo.getItemById(i)}if(!t){t=this._requisiteInfo.getSelectedItem()}if(!t){t=this._requisiteInfo.getFirstItem()}if(t){if(n>0){e=this._requisiteInfo.getItemBankDetailById(i,n)}if(!e){e=this._requisiteInfo.getSelectedItemBankDetail(i)}if(!e){e=this._requisiteInfo.getFirstItemBankDetail(i)}}var r=this._mode===BX.Crm.EntityEditorMode.view;this._wrapper=BX.create("div",{props:{className:"crm-entity-widget-client-requisites-container"}});this._container.appendChild(this._wrapper);if(this._isExpanded){BX.addClass(this._wrapper,"crm-entity-widget-client-requisites-container-opened")}if(!r){this._requisiteInput=BX.create("input",{props:{type:"hidden",name:"REQUISITE_ID",value:i}});this._wrapper.appendChild(this._requisiteInput);this._bankDetailInput=BX.create("input",{props:{type:"hidden",name:"BANK_DETAIL_ID",value:n}});this._wrapper.appendChild(this._bankDetailInput)}if(t){this._toggleButton=BX.create("span",{props:{className:"crm-entity-widget-client-requisites-show-btn"},text:this.getMessage("toggle").toLowerCase()});this._wrapper.appendChild(this._toggleButton);BX.bind(this._toggleButton,"click",this._toggleButtonHandler);var o=BX.create("div",{props:{className:"crm-entity-widget-client-requisites-inner-container"}});this._wrapper.appendChild(o);if(!r){this._editButton=BX.create("span",{props:{className:"crm-entity-widget-client-requisites-edit-icon"}});o.appendChild(this._editButton);BX.bind(this._editButton,"click",this._editButtonHandler)}this._contentWrapper=BX.create("dl",{props:{className:"crm-entity-widget-client-requisites-list"}});o.appendChild(this._contentWrapper);var s=BX.prop.getObject(t,"viewData",null);this.prepareItemView(s,["RQ_ADDR"]);this.prepareItemFieldView(s,"RQ_ADDR");if(e){this.prepareItemView(BX.prop.getObject(e,"viewData",null))}}this._hasLayout=true},prepareItemView:function(t,e){if(!t){return}var i=BX.prop.getString(t,"title","");if(i!==""){this._contentWrapper.appendChild(BX.create("dt",{props:{className:"crm-entity-widget-client-requisites-name"},text:i}))}var n,r;var o={};if(BX.type.isArray(e)){for(n=0,r=e.length;n<r;n++){o[e[n]]=true}}var s=[];var a=BX.prop.getArray(t,"fields",[]);for(n=0,r=a.length;n<r;n++){var l=a[n];var d=BX.prop.getString(l,"name","");if(o.hasOwnProperty(d)){continue}var h=BX.prop.getString(l,"title","");var p=BX.prop.getString(l,"textValue","");if(h!==""&&p!==""){s.push(h+": "+p)}}this._contentWrapper.appendChild(BX.create("dd",{props:{className:"crm-entity-widget-client-requisites-value"},text:s.join(", ")}))},prepareItemFieldView:function(t,e){if(!t){return}var i=BX.prop.getArray(t,"fields",[]);for(var n=0,r=i.length;n<r;n++){var o=i[n];var s=BX.prop.getString(o,"name","");if(s!==e){continue}var a=BX.prop.getString(o,"title","");var l=BX.prop.getString(o,"textValue","");if(a===""||l===""){continue}this._contentWrapper.appendChild(BX.create("dt",{props:{className:"crm-entity-widget-client-requisites-name"},text:a}));this._contentWrapper.appendChild(BX.create("dd",{props:{className:"crm-entity-widget-client-requisites-value"},text:l}))}},clearLayout:function(){if(!this._hasLayout){return}if(this._toggleButton){BX.unbind(this._toggleButton,"click",this._toggleButtonHandler);this._toggleButton=null}if(this._editButton){BX.unbind(this._editButton,"click",this._editButtonHandler);this._editButton=null}this._isExpanded=false;this._requisiteInput=null;this._bankDetailInput=null;this._contentWrapper=null;this._wrapper=BX.remove(this._wrapper);this._hasLayout=false},refreshLayout:function(){var t=this.isExpanded();this.clearLayout();this.layout();this.setExpanded(t)},onToggleButtonClick:function(t){this.toggle()},onEditButtonClick:function(t){if(!this._editor){return}var e=this._editor.getEntityRequisiteSelectUrl(this._entityInfo.getTypeName(),this._entityInfo.getId());if(e===""){return}e=BX.util.add_url_param(e,{external_context_id:this._editor.getContextId(),requisite_id:this._selectedRequisiteId,bank_detail_id:this._selectedBankDetailId});BX.Crm.Page.openSlider(e);BX.addCustomEvent(window,"onLocalStorageSet",this._externalEventHandler)},onExternalEvent:function(t){if(this._mode===BX.Crm.EntityEditorMode.view){return}var e=BX.type.isNotEmptyString(t["key"])?t["key"]:"";var i=BX.type.isPlainObject(t["value"])?t["value"]:{};if(!(this._editor&&this._editor.getContextId()===BX.prop.getString(i,"context"))){return}if(e==="BX.Crm.EntityRequisiteSelector:onCancel"){BX.removeCustomEvent(window,"onLocalStorageSet",this._externalEventHandler)}else if(e==="BX.Crm.EntityRequisiteSelector:onSave"){BX.removeCustomEvent(window,"onLocalStorageSet",this._externalEventHandler);var n=BX.prop.getInteger(i,"requisiteId");if(n>0){this._selectedRequisiteId=n;if(this._requisiteInput){this._requisiteInput.value=this._selectedRequisiteId}}var r=BX.prop.getInteger(i,"bankDetailId");if(r){this._selectedBankDetailId=r;if(this._bankDetailInput){this._bankDetailInput.value=this._selectedBankDetailId}}this.refreshLayout()}}};if(typeof BX.Crm.ClientEditorEntityRequisitePanel.messages==="undefined"){BX.Crm.ClientEditorEntityRequisitePanel.messages={}}BX.Crm.ClientEditorEntityRequisitePanel.options={};BX.Crm.ClientEditorEntityRequisitePanel.create=function(t,e){var i=new BX.Crm.ClientEditorEntityRequisitePanel;i.initialize(t,e);return i}}if(typeof BX.Crm.EntityBindingTracker==="undefined"){BX.Crm.EntityBindingTracker=function(){this._id="";this._settings={};this._boundEntityInfos=null;this._unboundEntityInfos=null};BX.Crm.EntityBindingTracker.prototype={initialize:function(){this._boundEntityInfos=[];this._unboundEntityInfos=[]},bind:function(t){if(this.findIndex(t,this._boundEntityInfos)>=0){return}var e=this.findIndex(t,this._unboundEntityInfos);if(e>=0){this._unboundEntityInfos.splice(e,1)}else{this._boundEntityInfos.push(t)}},unbind:function(t){if(this.findIndex(t,this._unboundEntityInfos)>=0){return}var e=this.findIndex(t,this._boundEntityInfos);if(e>=0){this._boundEntityInfos.splice(e,1)}else{this._unboundEntityInfos.push(t)}},getBoundEntities:function(){return this._boundEntityInfos},getUnboundEntities:function(){return this._unboundEntityInfos},isBound:function(t){return this.findIndex(t,this._boundEntityInfos)>=0},isUnbound:function(t){return this.findIndex(t,this._unboundEntityInfos)>=0},reset:function(){this._boundEntityInfos=[];this._unboundEntityInfos=[]},findIndex:function(t,e){var i=t.getId();for(var n=0,r=e.length;n<r;n++){if(i===e[n].getId()){return n}}return-1}};BX.Crm.EntityBindingTracker.create=function(){var t=new BX.Crm.EntityBindingTracker;t.initialize();return t}}if(typeof BX.Crm.ClientEditorEntitySkeleton==="undefined"){BX.Crm.ClientEditorEntitySkeleton=function(){this._id="";this._settings={};this._container=null;this._wrapper=null;this._hasLayout=false};BX.Crm.ClientEditorEntitySkeleton.prototype={initialize:function(t,e){this._id=BX.type.isNotEmptyString(t)?t:BX.util.getRandomString(4);this._settings=e?e:{};this._container=BX.prop.getElementNode(this._settings,"container",null)},layout:function(){this._wrapper=BX.create("div",{props:{className:"crm-entity-widget-client-block crm-entity-widget-client-block-skeleton"},children:[BX.create("div",{props:{className:"crm-entity-widget-client-box"}})]});this._container.appendChild(this._wrapper);this._hasLayout=true},clearLayout:function(){this._wrapper=BX.remove(this._wrapper);this._hasLayout=false}};BX.Crm.ClientEditorEntitySkeleton.create=function(t,e){var i=new BX.Crm.ClientEditorEntitySkeleton;i.initialize(t,e);return i}}if(typeof BX.Crm.ClientEditorEntityPanel==="undefined"){BX.Crm.ClientEditorEntityPanel=function(){this._id="";this._settings={};this._editor=null;this._entityInfo=null;this._requisiteInfo=null;this._requisitePanel=null;this._mode=BX.Crm.EntityEditorMode.intermediate;this._communicationButtons=null;this._deleteButton=null;this._container=null;this._wrapper=null;this._deleteButtonHandler=BX.delegate(this.onDeleteButtonClick,this);this._hasLayout=false};BX.Crm.ClientEditorEntityPanel.prototype={initialize:function(t,e){this._id=BX.type.isNotEmptyString(t)?t:BX.util.getRandomString(4);this._settings=e?e:{};this._container=BX.prop.getElementNode(this._settings,"container",null);this._editor=BX.prop.get(this._settings,"editor");this._entityInfo=BX.prop.get(this._settings,"entityInfo",null);this._mode=BX.prop.getInteger(this._settings,"mode",0)},getContainer:function(){return this._container},setContainer:function(t){this._container=t},getEntity:function(){return this._entityInfo},layout:function(){var t=this._mode===BX.Crm.EntityEditorMode.view;this._wrapper=BX.create("div",{props:{className:"crm-entity-widget-client-block"}});this._container.appendChild(this._wrapper);var e=BX.create("div",{props:{className:"crm-entity-widget-client-box"}});this._wrapper.appendChild(e);if(BX.prop.getBoolean(this._settings,"enableEntityTypeCaption",false)){e.appendChild(BX.create("div",{props:{className:"crm-entity-widget-client-box-type"},text:this._entityInfo.getTypeCaption()}))}this._deleteButton=null;if(!t){this._deleteButton=BX.create("div",{props:{className:"crm-entity-widget-client-block-remove"},events:{click:this._deleteButtonHandler}});e.appendChild(this._deleteButton)}var i=BX.create("div",{props:{className:"crm-entity-widget-client-box-name-container"}});e.appendChild(i);i.appendChild(BX.create("a",{props:{className:"crm-entity-widget-client-box-name",href:this._entityInfo.getShowUrl()},text:this._entityInfo.getTitle()}));var n=BX.create("div",{props:{className:"crm-entity-widget-client-actions-container"}});i.appendChild(n);this._communicationButtons=[];var r=["PHONE","EMAIL","IM"];for(var o=0,s=r.length;o<s;o++){var a=r[o];var l=BX.Crm.ClientEditorCommunicationButton.create(this._id+"_"+a,{entityInfo:this._entityInfo,type:a,ownerTypeId:this._editor.getOwnerTypeId(),ownerId:this._editor.getOwnerId(),container:n});l.layout();this._communicationButtons.push(l)}e.appendChild(BX.create("div",{props:{className:"crm-entity-widget-client-box-position"},text:this._entityInfo.getDescription()}));if(BX.prop.getBoolean(this._settings,"enableRequisite",false)){var d=BX.prop.getObject(this._settings,"requisiteBinding",{});this._requisiteInfo=BX.CrmEntityRequisiteInfo.create({requisiteId:BX.prop.getInteger(d,"REQUISITE_ID",0),bankDetailId:BX.prop.getInteger(d,"BANK_DETAIL_ID",0),data:this._entityInfo.getRequisites()});this._requisitePanel=BX.Crm.ClientEditorEntityRequisitePanel.create(this._id,{editor:this._editor,entityInfo:this._entityInfo,requisiteInfo:this._requisiteInfo,container:e,mode:this._mode});this._requisitePanel.layout()}var h=BX.prop.getFunction(this._settings,"onLayout",null);if(h){h(this,this._wrapper)}this._hasLayout=true},clearLayout:function(){if(this._requisitePanel){this._requisitePanel.clearLayout();this._requisitePanel=null}this._wrapper=BX.remove(this._wrapper);this._hasLayout=false},onDeleteButtonClick:function(t){var e=BX.prop.getFunction(this._settings,"onDelete");if(e){e(this)}}};BX.Crm.ClientEditorEntityPanel.create=function(t,e){var i=new BX.Crm.ClientEditorEntityPanel;i.initialize(t,e);return i}}if(typeof BX.Crm.ClientEditorEntityBindingPanel==="undefined"){BX.Crm.ClientEditorEntityBindingPanel=function(){this._id="";this._settings={};this._container=null;this._entityInfo=null;this._editor=null;this._mode=BX.Crm.EntityEditorMode.intermediate;this._item=null};BX.Crm.ClientEditorEntityBindingPanel.prototype={initialize:function(t,e){this._id=BX.type.isNotEmptyString(t)?t:BX.util.getRandomString(4);this._settings=e?e:{};this._container=BX.prop.getElementNode(this._settings,"container",null);this._editor=BX.prop.get(this._settings,"editor");this._entityInfo=BX.prop.get(this._settings,"entityInfo",null);this._mode=BX.prop.getInteger(this._settings,"mode",0);this._item=BX.Crm.ClientEditorEntityPanel.create(this._id+"_"+this._entityInfo.getId().toString(),{editor:this._editor,entityInfo:this._entityInfo,mode:this._mode,onLayout:BX.delegate(this.onItemLayout,this),onDelete:BX.delegate(this.onItemDelete,this)})},getEntity:function(){return this._entityInfo},getContainer:function(){return this._container},setContainer:function(t){this._container=t},layout:function(){this._button=BX.create("div",{props:{className:"crm-entity-widget-client-child-link"},events:{click:BX.delegate(this.onButtonClick,this)}});this._item.setContainer(this._container);this._item.layout()},onItemLayout:function(t,e){BX.addClass(e,"crm-entity-widget-client-block-child");var i=e.firstChild;if(i){e.insertBefore(this._button,i)}else{e.appendChild(this._button)}},clearLayout:function(){this._item.clearLayout()},onItemDelete:function(t){if(this._mode!==BX.Crm.EntityEditorMode.edit){return}var e=BX.prop.getFunction(this._settings,"onChange",null);if(e){e(this,"delete")}},onButtonClick:function(t){if(this._mode!==BX.Crm.EntityEditorMode.edit){return}var e=BX.prop.getFunction(this._settings,"onChange",null);if(e){e(this,"unbind")}}};BX.Crm.ClientEditorEntityBindingPanel.create=function(t,e){var i=new BX.Crm.ClientEditorEntityBindingPanel;i.initialize(t,e);return i}}if(typeof BX.Crm.ClientEditorCommunicationButton==="undefined"){BX.Crm.ClientEditorCommunicationButton=function(){this._id="";this._settings={};this._entityInfo=null;this._type="";this._items=null;this._container=null;this._wrapper=null;this._menu=null};BX.Crm.ClientEditorCommunicationButton.prototype={initialize:function(t,e){this._id=BX.type.isNotEmptyString(t)?t:BX.util.getRandomString(4);this._settings=e?e:{};this._entityInfo=BX.prop.get(this._settings,"entityInfo",null);this._type=BX.prop.getString(this._settings,"type","");this._container=BX.prop.getElementNode(this._settings,"container","");if(this._type===""){this._type="PHONE"}this._items=this._entityInfo.getMultiFieldsByType(this._type)},layout:function(){var t="";if(this._type==="EMAIL"){t="crm-entity-widget-client-action-mail"}else if(this._type==="IM"){t="crm-entity-widget-client-action-im"}else{t="crm-entity-widget-client-action-call"}if(this._items.length>0){t+=" crm-entity-widget-client-action-available"}this._wrapper=BX.create("div",{props:{className:t}});BX.bind(this._wrapper,"click",BX.delegate(this.onClick,this));this._container.appendChild(this._wrapper)},onClick:function(t){if(this._items.length===0){return}if(this._items.length===1){var e=this._items[0];var i=BX.prop.getString(e,"VALUE");if(i!==""){if(this._type==="PHONE"){this.addCall(i)}else if(this._type==="EMAIL"){this.addEmail(i)}else if(this._type==="IM"){}}return}this.toggleMenu()},toggleMenu:function(){if(!this._menu){var t=[];for(var e=0,i=this._items.length;e<i;e++){var n=BX.prop.getString(this._items[e],"VALUE");var r=BX.prop.getString(this._items[e],"VALUE_FORMATTED");var o=BX.prop.getString(this._items[e],"COMPLEX_NAME");var s=(o?o+": ":"")+(r?r:n);if(n!==""){t.push({id:n,text:s})}}this._menu=BX.Crm.ClientEditorMenu.create(this._id.toLowerCase()+"_menu",{anchor:this._wrapper,items:t,callback:BX.delegate(this.onMenuItemSelect,this)})}this._menu.toggle()},onMenuItemSelect:function(t,e){if(this._type==="EMAIL"){this.addEmail(e["id"])}else if(this._type==="IM"){}else{this.addCall(e["id"])}this._menu.close()},addCall:function(t){if(typeof window.top["BXIM"]==="undefined"){window.alert(this.getMessage("telephonyNotSupported"));return}var e={ENTITY_TYPE_NAME:this._entityInfo.getTypeName(),ENTITY_ID:this._entityInfo.getId(),AUTO_FOLD:true};var i=BX.prop.getInteger(this._settings,"ownerTypeId",0);var n=BX.prop.getInteger(this._settings,"ownerId",0);if(i!==this._entityInfo.getTypeId()||n!==this._entityInfo.getId()){e["BINDINGS"]=[{OWNER_TYPE_NAME:BX.CrmEntityType.resolveName(i),OWNER_ID:n}]}window.top["BXIM"].phoneTo(t,e)},addEmail:function(t){BX.CrmActivityEditor.addEmail({communicationsLoaded:true,communications:[{type:"EMAIL",entityType:this._entityInfo.getTypeName(),entityId:this._entityInfo.getId(),value:t}]})}};BX.Crm.ClientEditorCommunicationButton.prototype.getMessage=function(t){var e=BX.Crm.ClientEditorCommunicationButton.messages;return e.hasOwnProperty(t)?e[t]:t};if(typeof BX.Crm.ClientEditorCommunicationButton.messages==="undefined"){BX.Crm.ClientEditorCommunicationButton.messages={}}BX.Crm.ClientEditorCommunicationButton.create=function(t,e){var i=new BX.Crm.ClientEditorCommunicationButton;i.initialize(t,e);return i}}if(typeof BX.Crm.ClientEditorMenu==="undefined"){BX.Crm.ClientEditorMenu=function(){this._id=null;this._settings={};this._items=null;this._isOpened=false;this._popup=null};BX.Crm.ClientEditorMenu.prototype={initialize:function(t,e){this._id=BX.type.isNotEmptyString(t)?t:BX.util.getRandomString(4);this._settings=e?e:{};this._items=BX.prop.getArray(this._settings,"items",[]);for(var i=0,n=this._items.length;i<n;i++){this._items[i]["onclick"]=BX.delegate(this.onItemSelect,this)}},onItemSelect:function(t,e){var i=BX.prop.getFunction(this._settings,"callback",null);if(i){i(this,e)}},isOpened:function(){return this._isOpened},open:function(){if(this._isOpened){return}BX.PopupMenu.show(this._id,BX.prop.getElementNode(this._settings,"anchor",null),this._items,{offsetTop:0,offsetLeft:0,events:{onPopupShow:BX.delegate(this.onPopupShow,this),onPopupClose:BX.delegate(this.onPopupClose,this),onPopupDestroy:BX.delegate(this.onPopupDestroy,this)}});this._popup=BX.PopupMenu.currentItem},close:function(){if(!this._isOpened){return}if(this._popup){if(this._popup.popupWindow){this._popup.popupWindow.destroy()}}},toggle:function(){if(!this._isOpened){this.open()}else{this.close()}},onPopupShow:function(){this._isOpened=true},onPopupClose:function(){this.close()},onPopupDestroy:function(){this._isOpened=false;this._popup=null;if(typeof BX.PopupMenu.Data[this._id]!=="undefined"){delete BX.PopupMenu.Data[this._id]}}};BX.Crm.ClientEditorMenu.create=function(t,e){var i=new BX.Crm.ClientEditorMenu;i.initialize(t,e);return i}}if(typeof BX.Crm.UserFieldTypeMenu==="undefined"){BX.Crm.UserFieldTypeMenu=function(){this._id=null;this._settings={};this._items=null;this._isOpened=false;this._popup=null};BX.Crm.UserFieldTypeMenu.prototype={initialize:function(t,e){this._id=BX.type.isNotEmptyString(t)?t:BX.util.getRandomString(4);this._settings=e?e:{};this._items=[];var i=BX.prop.getArray(e,"items");for(var n=0,r=i.length;n<r;n++){var o=i[n];o["menu"]=this;this._items.push(BX.Crm.UserFieldTypeMenuItem.create(BX.prop.getString(o,"value"),o))}},getId:function(){return this._id},isOpened:function(){return this._isOpened},open:function(t){if(this._isOpened){return}this._popup=new BX.PopupWindow(this._id,t,{autoHide:true,draggable:false,offsetLeft:0,offsetTop:0,bindOptions:{forceBindPosition:true},closeByEsc:true,events:{onPopupShow:BX.delegate(this.onPopupShow,this),onPopupClose:BX.delegate(this.onPopupClose,this),onPopupDestroy:BX.delegate(this.onPopupDestroy,this)},content:this.prepareContent()});this._popup.show()},close:function(){if(!this._isOpened){return}if(this._popup){this._popup.close()}},prepareContent:function(){var t=BX.create("div",{props:{className:"crm-entity-card-widget-create-field-popup"}});var e=BX.create("div",{props:{className:"crm-entity-card-widget-create-field-list"}});t.appendChild(e);for(var i=0,n=this._items.length;i<n;i++){e.appendChild(this._items[i].prepareContent())}return t},onItemSelect:function(t){var e=BX.prop.getFunction(this._settings,"callback",null);if(e){e(this,t)}},onPopupShow:function(){this._isOpened=true},onPopupClose:function(){if(this._popup){this._popup.destroy()}},onPopupDestroy:function(){this._isOpened=false;this._popup=null}};BX.Crm.UserFieldTypeMenu.create=function(t,e){var i=new BX.Crm.UserFieldTypeMenu;i.initialize(t,e);return i}}if(typeof BX.Crm.UserFieldTypeMenuItem==="undefined"){BX.Crm.UserFieldTypeMenuItem=function(){this._id="";this._settings=null;this._menu="";this._value="";this._text="";this._legend=""};BX.Crm.UserFieldTypeMenuItem.prototype={initialize:function(t,e){this._id=BX.type.isNotEmptyString(t)?t:BX.util.getRandomString(4);this._settings=e?e:{};this._menu=BX.prop.get(e,"menu");this._value=BX.prop.getString(e,"value");this._text=BX.prop.getString(e,"text");this._legend=BX.prop.getString(e,"legend")},getId:function(){return this._id},getValue:function(){return this._value},getText:function(){return this._text},getLegend:function(){return this._legend},prepareContent:function(){var t=BX.create("span",{props:{className:"crm-entity-card-widget-create-field-item"},events:{click:BX.delegate(this.onClick,this)}});t.appendChild(BX.create("span",{props:{className:"crm-entity-card-widget-create-field-item-title"},text:this._text}));t.appendChild(BX.create("span",{props:{className:"crm-entity-card-widget-create-field-item-desc"},text:this._legend}));return t},onClick:function(t){this._menu.onItemSelect(this)}};BX.Crm.UserFieldTypeMenuItem.create=function(t,e){var i=new BX.Crm.UserFieldTypeMenuItem;i.initialize(t,e);return i}}if(typeof BX.Crm.EntityEditorRecurring==="undefined"){BX.Crm.EntityEditorRecurring=function(){this._input=null};BX.extend(BX.Crm.EntityEditorRecurring,BX.Crm.EntityEditorControl);BX.Crm.EntityEditorRecurring.prototype.doInitialize=function(t){this._enableRecurring=BX.prop.getBoolean(this._schemeElement._settings,"enableRecurring",true)};BX.Crm.EntityEditorRecurring.prototype.layout=function(t){var e=this._schemeElement.getData();var i=this.getName();var n=this._model.getField(i);var r=this._schemeElement.getTitle();var o=this._mode===BX.Crm.EntityEditorMode.view;this._showClassName="crm-entity-widget-content-show";this._hideClassName="crm-entity-widget-content-hide";this._wrapper=BX.create("div",{props:{className:"crm-entity-widget-content-block"},children:[BX.create("div",{props:{className:"crm-entity-card-widget-draggable-btn-container"},events:{}})]});if(!BX.type.isPlainObject(t)){t={}}var s=BX.prop.getElementNode(t,"anchor",null);if(s){this._container.insertBefore(this._wrapper,s)}else{this._container.appendChild(this._wrapper)}if(o){var a=BX.create("div");if(this._schemeElement._promise instanceof BX.Promise){a.classList="crm-entity-widget-content-wrapper";this._wrapper.appendChild(a);this.loadViewText();this._wrapper.appendChild(a);this._schemeElement._promise.then(BX.proxy(function(){a.classList="crm-entity-widget-content-block-title";a.innerHTML=BX.util.htmlspecialchars(e.view.text);this._wrapper.innerHTML="";this._wrapper.appendChild(a)},this))}else{a.classList="crm-entity-widget-content-block-title";a.innerHTML=e.view.text;this._wrapper.appendChild(a)}}else{if(!this._enableRecurring)BX.addClass(this._wrapper,"crm-entity-widget-content-block-locked");this._input=BX.create("input",{attrs:{name:this.getName(),type:"hidden",value:n}});if(BX.type.isPlainObject(e.data)&&e.data.MULTIPLY_EXECUTION===n.EXECUTION_TYPE&&e.data.NON_ACTIVE===n.PERIOD_DEAL){this._isShowBlock=false}else this._isShowBlock=true;if(this._enableRecurring)this._actionWrapper=this.getLayoutEdit(e.data);this._wrapper.appendChild(BX.create("div",{props:{className:"crm-entity-widget-content-block-title"},text:r}));if(this._enableRecurring){this._wrapper.appendChild(this._actionWrapper)}else{var l=BX.create("div",{props:{className:"crm-entity-widget-content-block-inner"},children:[BX.create("div",{type:"text",props:{className:"crm-entity-widget-content-input",disabled:"disabled"},text:this.getMessage("notRepeat"),events:{click:BX.delegate(this.showLicencePopup,this)}})]});this._wrapper.appendChild(l);var d=BX.create("button",{props:{className:"crm-entity-widget-content-block-locked-icon"},events:{click:BX.delegate(this.showLicencePopup,this)}});this._wrapper.appendChild(d)}}};BX.Crm.EntityEditorRecurring.prototype.toggleFields=function(t){var e=this._schemeElement.getData();var i=null;if(BX.type.isPlainObject(e.data)&&e.data.MULTIPLY_EXECUTION===t.EXECUTION_TYPE&&e.data.NON_ACTIVE===t.PERIOD_DEAL){var n=BX.findChildrenByClassName(this._actionWrapper,this._showClassName);for(i in n){if(BX.type.isDomNode(n[i])){BX.removeClass(n[i],this._showClassName);BX.addClass(n[i],this._hideClassName)}}}else{var r=BX.findChildrenByClassName(this._actionWrapper,this._hideClassName);for(i in r){if(BX.type.isDomNode(r[i])){BX.removeClass(r[i],this._hideClassName);BX.addClass(r[i],this._showClassName)}}}};BX.Crm.EntityEditorRecurring.prototype.getLayoutEdit=function(t){var e=this._model.getField(this.getName());var i={};if(BX.type.isPlainObject(t.PERIOD_DEAL)&&BX.type.isPlainObject(t.PERIOD_DEAL.options)){i=t.PERIOD_DEAL.options}var n=BX.create("div",{props:{className:"crm-entity-widget-content-block-form"},children:[BX.create("div",{props:{className:"crm-entity-widget-content-block-form-radio"},children:[BX.create("input",{props:{name:"RECURRING[EXECUTION_TYPE]",type:"radio",value:BX.prop.getString(t,"MULTIPLY_EXECUTION"),checked:BX.prop.getString(e,"EXECUTION_TYPE")===BX.prop.getString(t,"MULTIPLY_EXECUTION")||!BX.prop.getString(e,"EXECUTION_TYPE",false)},events:{change:BX.delegate(function(t){this.setParams("EXECUTION_TYPE",t.target.value)},this)}})]}),this.createListInput({text:BX.type.isPlainObject(i[BX.prop.getString(e,"PERIOD_DEAL")])?i[BX.prop.getString(e,"PERIOD_DEAL")]["NAME"]:"",props:{className:"crm-entity-widget-content-select crm-entity-widget-content-select-form",name:"PERIOD_DEAL",value:BX.prop.getString(e,"PERIOD_DEAL")},options:i}),BX.create("input",{props:{id:"crm-entity-widget-content-select-PERIOD_DEAL",name:"RECURRING[PERIOD_DEAL]",type:"hidden",value:BX.prop.getString(e,"PERIOD_DEAL")}})]});var r=this._isShowBlock?this._showClassName:this._hideClassName;var o="crm-entity-widget-content-block-form"+" "+r;var s={};if(BX.type.isPlainObject(t.DEAL_TYPE_BEFORE)&&BX.type.isPlainObject(t.DEAL_TYPE_BEFORE.options)){s=t.DEAL_TYPE_BEFORE.options}var a=BX.create("div",{props:{className:o},children:[BX.create("div",{props:{className:"crm-entity-widget-content-block-form-radio"},children:[BX.create("input",{props:{id:"deal_recurring_execution_type2",name:"RECURRING[EXECUTION_TYPE]",type:"radio",value:BX.prop.getString(t,"SINGLE_EXECUTION"),checked:BX.prop.getString(e,"EXECUTION_TYPE")===BX.prop.getString(t,"SINGLE_EXECUTION")},events:{change:BX.delegate(function(t){this.setParams("EXECUTION_TYPE",t.target.value)},this)}})]}),BX.create("div",{props:{className:"crm-entity-widget-content-select-form"},children:[BX.create("label",{text:this.getMessage("createBeforeDate"),style:{marginTop:"10px",display:"block"},attrs:{for:"deal_recurring_execution_type2"}}),BX.create("br",{}),BX.create("input",{style:{width:"50px",display:"inline-block",textAlign:"center",marginRight:"5px"},props:{type:"text",name:"RECURRING[DEAL_COUNT_BEFORE]",className:"crm-entity-widget-content-input",value:BX.prop.getString(e,"DEAL_COUNT_BEFORE")||""},events:{input:BX.delegate(function(t){this.setParams("DEAL_COUNT_BEFORE",t.target.value)},this)}}),this.createListInput({text:BX.type.isPlainObject(s[BX.prop.getString(e,"DEAL_TYPE_BEFORE")])?s[BX.prop.getString(e,"DEAL_TYPE_BEFORE")]["NAME"]:"",style:{width:"130px",display:"inline-block",marginRight:"5px"},props:{className:"crm-entity-widget-content-select",name:"DEAL_TYPE_BEFORE",value:BX.prop.getString(e,"DEAL_TYPE_BEFORE")},options:s}),BX.create("input",{props:{id:"crm-entity-widget-content-select-DEAL_TYPE_BEFORE",name:"RECURRING[DEAL_TYPE_BEFORE]",type:"hidden",value:BX.prop.getString(e,"DEAL_TYPE_BEFORE")}}),BX.create("span",{text:this.getMessage("until")}),BX.create("div",{props:{className:"crm-entity-widget-content-block-date-input"},style:{width:"160px",display:"inline-block"},children:[BX.create("input",{text:BX.prop.getString(e,"DEAL_DATEPICKER_BEFORE")||"",style:{display:"inline-block"},props:{name:"RECURRING[DEAL_DATEPICKER_BEFORE]",className:"crm-entity-widget-content-input",value:BX.prop.getString(e,"DEAL_DATEPICKER_BEFORE")},events:{click:function(){BX.calendar({node:this,field:this,bTime:false})},change:BX.delegate(function(t){this.setParams("DEAL_DATEPICKER_BEFORE",t.target.value)},this)}})]})]})]});var l=BX.create("div",{props:{className:o},children:[BX.create("div",{props:{className:"crm-entity-widget-content-block-title"},text:this.getMessage("repeatUntil")})]});var d=BX.create("div",{props:{className:o},children:[BX.create("div",{props:{className:"crm-entity-widget-content-block-form-radio"},style:{minHeight:"16px"},children:[BX.create("input",{props:{id:"deal_recurring_before_no_limited",name:"RECURRING[REPEAT_TILL]",type:"radio",checked:BX.prop.getString(e,"REPEAT_TILL")===BX.prop.getString(t,"NO_LIMIT")||!BX.prop.getString(e,"REPEAT_TILL",false),value:BX.prop.getString(t,"NO_LIMIT")},events:{change:BX.delegate(function(t){this.setParams("REPEAT_TILL",t.target.value)},this)}})]}),BX.create("div",{props:{className:"crm-entity-widget-content-select-form"},children:[BX.create("label",{text:this.getMessage("noLimitDate"),attrs:{for:"deal_recurring_before_no_limited"}})]})]});var h=BX.create("div",{props:{className:o},children:[BX.create("div",{props:{className:"crm-entity-widget-content-block-form-radio"},children:[BX.create("input",{props:{id:"deal_recurring_before_limited_by_date",name:"RECURRING[REPEAT_TILL]",type:"radio",checked:BX.prop.getString(e,"REPEAT_TILL")===BX.prop.getString(t,"LIMITED_BY_DATE"),value:BX.prop.getString(t,"LIMITED_BY_DATE")},events:{change:BX.delegate(function(t){this.setParams("REPEAT_TILL",t.target.value)},this)}})]}),BX.create("div",{props:{className:"crm-entity-widget-content-select-form"},children:[BX.create("label",{text:this.getMessage("dateLimit"),attrs:{for:"deal_recurring_before_limited_by_date"}}),BX.create("div",{props:{className:"crm-entity-widget-content-block-date-input"},style:{width:"160px",display:"inline-block"},children:[BX.create("input",{text:BX.prop.getString(e,"END_DATE")||"",props:{name:"RECURRING[END_DATE]",className:"crm-entity-widget-content-date-input",value:BX.prop.getString(e,"END_DATE")||""},events:{click:function(){BX.calendar({node:this,field:this,bTime:false})},change:BX.delegate(function(t){this.setParams("END_DATE",t.target.value)},this)}})]})]})]});var p=BX.create("div",{props:{className:o},children:[BX.create("div",{props:{className:"crm-entity-widget-content-block-form-radio"},children:[BX.create("input",{props:{id:"deal_recurring_before_limited_by_times",name:"RECURRING[REPEAT_TILL]",type:"radio",checked:BX.prop.getString(e,"REPEAT_TILL")===BX.prop.getString(t,"LIMITED_BY_TIMES"),value:BX.prop.getString(t,"LIMITED_BY_TIMES")},events:{change:BX.delegate(function(t){this.setParams("REPEAT_TILL",t.target.value)},this)}})]}),BX.create("div",{props:{className:"crm-entity-widget-content-select-form"},children:[BX.create("label",{text:this.getMessage("finishAfter"),attrs:{for:"deal_recurring_before_limited_by_times"}}),BX.create("input",{style:{width:"50px",display:"inline-block"},props:{type:"text",name:"RECURRING[LIMIT_REPEAT]",className:"crm-entity-widget-content-input",value:BX.prop.getString(e,"LIMIT_REPEAT")||""},events:{input:BX.delegate(function(t){this.setParams("LIMIT_REPEAT",t.target.value)},this)}}),BX.create("span",{text:this.getMessage("repeats")})]})]});var c=BX.create("input",{props:{name:"IS_RECURRING",type:"hidden",value:this._model.getField("IS_RECURRING")==="Y"?"Y":"N"}});var u={};if(BX.type.isPlainObject(t.CATEGORY_LIST)&&BX.type.isArray(t.CATEGORY_LIST.options)){u=t.CATEGORY_LIST.options}if(u.length>0){var m=BX.create("div",{props:{className:o},children:[BX.create("div",{props:{className:"crm-entity-widget-content-block-title"},text:this.getMessage("directionSelectorTitle")}),this.createListInput({text:BX.type.isPlainObject(u[BX.prop.getString(e,"CATEGORY_ID")])?u[BX.prop.getString(e,"CATEGORY_ID")]["NAME"]:"",props:{className:"crm-entity-widget-content-select",name:"CATEGORY_ID",value:BX.prop.getString(e,"CATEGORY_ID")},options:u}),BX.create("input",{props:{id:"crm-entity-widget-content-select-CATEGORY_ID",name:"RECURRING[CATEGORY_ID]",type:"hidden",value:BX.prop.getString(e,"CATEGORY_ID")}})]})}return BX.create("div",{children:[n,a,l,d,h,p,c,m]})};BX.Crm.EntityEditorRecurring.prototype.createListInput=function(t){var e=this._model.getField(this.getName());if(!BX.type.isPlainObject(t)){return{}}var i=this.getElementName(t);var n=t.options;var r="";if(i!==""&&BX.type.isNotEmptyString(BX.prop.getString(e,i))&&BX.type.isPlainObject(n[e[i]])&&BX.type.isNotEmptyString(n[e[i]]["text"])){r=n[e[i]]["text"]}else{r=t.text}return BX.create("div",{props:t.props||{},text:r,style:t.style||"",events:{click:BX.delegate(function(t){this._selectContainer=t.target;var e=[];var r="crm-entity-widget-content-select-"+i;var o=BX(r);for(var s in n){if(BX.type.isNotEmptyString(n[s]["NAME"])&&BX.type.isNotEmptyString(n[s]["VALUE"])){e.push({text:n[s]["NAME"],value:n[s]["VALUE"],onclick:BX.delegate(function(t,e){this.onMenuClose();this.setParams(i,e.value);o.setAttribute("value",e.value);this._selectContainer.innerHTML=BX.util.htmlspecialchars(e.text);BX.PopupMenu.destroy(i)},this)})}}BX.addClass(this._selectContainer,"active");BX.PopupMenu.show(i,this._selectContainer,e,{angle:false,width:this._selectContainer.offsetWidth+"px",events:{onPopupClose:BX.delegate(this.onMenuClose,this)}})},this)}})};BX.Crm.EntityEditorRecurring.prototype.onMenuClose=function(t){BX.removeClass(this._selectContainer,"active")};BX.Crm.EntityEditorRecurring.prototype.showLicencePopup=function(t){t.preventDefault();if(!B24||!B24["licenseInfoPopup"]){return}var e=this._schemeElement.getData();var i=e.restrictMessage;if(BX.type.isPlainObject(i)&&BX.type.isNotEmptyString(i.title)&&BX.type.isNotEmptyString(i.text)){B24.licenseInfoPopup.show("crm-deal-recurring-restricted",i.title,i.text)}};BX.Crm.EntityEditorRecurring.prototype.getElementName=function(t){if(BX.type.isPlainObject(t)){if(BX.type.isPlainObject(t.props)){if(BX.type.isNotEmptyString(t.props.name)){return t.props.name}}}return""};BX.Crm.EntityEditorRecurring.prototype.setParams=function(t,e){if(!BX.type.isNotEmptyString(t))return;var i=this._model.getField(this.getName());i[t]=e;this._model.setField(this.getName(),i);if(t==="EXECUTION_TYPE"||t==="PERIOD_DEAL"){this.toggleFields(i)}this.markAsChanged()};BX.Crm.EntityEditorRecurring.prototype.onBeforeSubmit=function(){this._input.value=this._model.getField(this.getName())};BX.Crm.EntityEditorRecurring.prototype.save=function(){this._schemeElement._promise=new BX.Promise};BX.Crm.EntityEditorRecurring.prototype.loadViewText=function(){var t=this._schemeElement.getData();if(BX.type.isPlainObject(t.loaders)&&BX.type.isNotEmptyString(t.loaders["url"])&&BX.type.isNotEmptyString(t.loaders["action"])){BX.ajax({url:t.loaders["url"],method:"POST",dataType:"json",data:{ACTION:t.loaders["action"],PARAMS:{ID:this._model.getField("ID")}},onsuccess:BX.delegate(this.onEntityHintLoad,this)})}};BX.Crm.EntityEditorRecurring.prototype.onEntityHintLoad=function(t){var e=BX.prop.getObject(t,"DATA",null);if(!e){return}if(BX.type.isNotEmptyString(e.HINT)){this._schemeElement._data.view.text=e.HINT}if(this._schemeElement._promise instanceof BX.Promise){this._schemeElement._promise.fulfill();this._schemeElement._promise=null}};BX.Crm.EntityEditorRecurring.prototype.getMessage=function(t){var e=BX.Crm.EntityEditorRecurring.messages;return e.hasOwnProperty(t)?e[t]:t};BX.Crm.EntityEditorRecurring.create=function(t,e){var i=new BX.Crm.EntityEditorRecurring;i.initialize(t,e);return i}}if(typeof BX.Crm.EntityEditorController==="undefined"){BX.Crm.EntityEditorController=function(){this._id="";this._settings={};this._editor=null;this._model=null;this._config=null;this._isChanged=false};BX.Crm.EntityEditorController.prototype={initialize:function(t,e){this._id=BX.type.isNotEmptyString(t)?t:BX.util.getRandomString(4);this._settings=e?e:{};this._editor=BX.prop.get(this._settings,"editor",null);this._model=BX.prop.get(this._settings,"model",null);this._config=BX.prop.getObject(this._settings,"config",{});this.doInitialize()},doInitialize:function(){},getConfig:function(){return this._config},getConfigStringParam:function(t,e){return BX.prop.getString(this._config,t,e)},isChanged:function(){return this._isChanged},markAsChanged:function(){if(this._isChanged){return}this._isChanged=true;if(this._editor){this._editor.processControllerChange(this)}},rollback:function(){},onBeforeSubmit:function(){}}}if(typeof BX.Crm.EntityEditorProductRowProxy==="undefined"){BX.Crm.EntityEditorProductRowProxy=function(){BX.Crm.EntityEditorProductRowProxy.superclass.constructor.apply(this);this._externalEditor=null;this._editorCreateHandler=null;this._sumTotalChangeHandler=null;this._productAddHandler=null;this._productChangeHandler=null;this._productRemoveHandler=null;this._editorModeChangeHandler=BX.delegate(this.onEditorModeChange,this);this._editorControlChangeHandler=BX.delegate(this.onEditorControlChange,this);this._currencyId=""};BX.extend(BX.Crm.EntityEditorProductRowProxy,BX.Crm.EntityEditorController);BX.Crm.EntityEditorProductRowProxy.prototype.doInitialize=function(){BX.Crm.EntityEditorProductRowProxy.superclass.doInitialize.apply(this);this._sumTotalChangeHandler=BX.delegate(this.onSumTotalChange,this);this._productAddHandler=BX.delegate(this.onProductAdd,this);this._productChangeHandler=BX.delegate(this.onProductChange,this);this._productRemoveHandler=BX.delegate(this.onProductRemove,this);var t=typeof BX.CrmProductEditor!=="undefined"?BX.CrmProductEditor.get(this.getExternalEditorId()):null;if(t){this.setExternalEditor(t)}else{this._editorCreateHandler=BX.delegate(this.onEditorCreate,this);BX.addCustomEvent(window,"ProductRowEditorCreated",this._editorCreateHandler)}this._editor.addModeChangeListener(this._editorModeChangeHandler);BX.addCustomEvent(window,"onEntityDetailsTabShow",BX.delegate(this.onTabShow,this))};BX.Crm.EntityEditorProductRowProxy.prototype.onTabShow=function(t){if(t.getId()!=="tab_products"){return}if(this._externalEditor&&!this._externalEditor.hasLayout()){this._externalEditor.layout()}};BX.Crm.EntityEditorProductRowProxy.prototype.getExternalEditorId=function(){return this.getConfigStringParam("editorId","")};BX.Crm.EntityEditorProductRowProxy.prototype.setExternalEditor=function(t){if(this._externalEditor===t){return}if(this._externalEditor){this._externalEditor.setForm(null);BX.removeCustomEvent(this._externalEditor,"sumTotalChange",this._sumTotalChangeHandler);BX.removeCustomEvent(this._externalEditor,"productAdd",this._productAddHandler);BX.removeCustomEvent(this._externalEditor,"productChange",this._productChangeHandler);BX.removeCustomEvent(this._externalEditor,"productRemove",this._productRemoveHandler)}this._externalEditor=t;if(this._externalEditor){this._externalEditor.setForm(this._editor.getFormElement());BX.addCustomEvent(this._externalEditor,"sumTotalChange",this._sumTotalChangeHandler);BX.addCustomEvent(this._externalEditor,"productAdd",this._productAddHandler);BX.addCustomEvent(this._externalEditor,"productChange",this._productChangeHandler);BX.addCustomEvent(this._externalEditor,"productRemove",this._productRemoveHandler);this.adjustLocks()}};BX.Crm.EntityEditorProductRowProxy.prototype.adjustLocks=function(){if(!this._externalEditor){return}if(this._externalEditor.getProductCount()>0){this._model.lockField("OPPORTUNITY")}else{this._model.unlockField("OPPORTUNITY")}};BX.Crm.EntityEditorProductRowProxy.prototype.adjustTotals=function(t){this._model.setField("FORMATTED_OPPORTUNITY",t["FORMATTED_SUM"],{enableNotification:false});this._model.setField("FORMATTED_OPPORTUNITY_WITH_CURRENCY",t["FORMATTED_SUM_WITH_CURRENCY"],{enableNotification:false});this._model.setField("OPPORTUNITY",t["SUM"],{enableNotification:true})};BX.Crm.EntityEditorProductRowProxy.prototype.onEditorCreate=function(t){if(t.getId()!==this.getExternalEditorId()){return}BX.removeCustomEvent(window,"ProductRowEditorCreated",this._editorCreateHandler);delete this._editorCreateHandler;this.setExternalEditor(t)};BX.Crm.EntityEditorProductRowProxy.prototype.onEditorModeChange=function(t){if(this._editor.getMode()===BX.Crm.EntityEditorMode.edit){this._editor.addControlChangeListener(this._editorControlChangeHandler)}else{this._editor.removeControlChangeListener(this._editorControlChangeHandler)}this._isChanged=false};BX.Crm.EntityEditorProductRowProxy.prototype.onEditorControlChange=function(t,e){if(!this._externalEditor){return}var i=BX.prop.getString(e,"fieldName","");if(i!=="CURRENCY_ID"){return}var n=BX.prop.getString(e,"fieldValue","");if(n!==""){this._currencyId=n;this._externalEditor.setCurrencyId(this._currencyId)}};BX.Crm.EntityEditorProductRowProxy.prototype.onProductAdd=function(t){this.adjustLocks();this.markAsChanged()};BX.Crm.EntityEditorProductRowProxy.prototype.onProductChange=function(t){this.adjustLocks();this.markAsChanged()};BX.Crm.EntityEditorProductRowProxy.prototype.onProductRemove=function(t){this.adjustLocks();this.markAsChanged()};BX.Crm.EntityEditorProductRowProxy.prototype.onSumTotalChange=function(t,e){this.adjustTotals({FORMATTED_SUM_WITH_CURRENCY:e["TOTAL_SUM_FORMATTED"],FORMATTED_SUM:e["TOTAL_SUM_FORMATTED_SHORT"],SUM:e["TOTAL_SUM"]});this.markAsChanged()};BX.Crm.EntityEditorProductRowProxy.prototype.rollback=function(){var t=this._model.getField("CURRENCY_ID","");if(this._currencyId!==t){this._currencyId=t;if(this._externalEditor){this._externalEditor.setCurrencyId(this._currencyId)}}};BX.Crm.EntityEditorProductRowProxy.prototype.onBeforeSubmit=function(){if(this._externalEditor){this._externalEditor.handleFormSubmit()}};BX.Crm.EntityEditorProductRowProxy.create=function(t,e){var i=new BX.Crm.EntityEditorProductRowProxy;i.initialize(t,e);return i}}if(typeof BX.Crm.EntityEditorToolPanel==="undefined"){BX.Crm.EntityEditorToolPanel=function(){this._id="";this._settings={};this._container=null;this._wrapper=null;this._editor=null;this._isVisible=false;this._hasLayout=false};BX.Crm.EntityEditorToolPanel.prototype={initialize:function(t,e){this._id=BX.type.isNotEmptyString(t)?t:BX.util.getRandomString(4);this._settings=e?e:{};this._container=BX.prop.getElementNode(this._settings,"container",null);this._editor=BX.prop.get(this._settings,"editor",null);this._isVisible=BX.prop.getBoolean(this._settings,"visible",false)},getId:function(){return this._id},getContainer:function(){return this._container},setContainer:function(t){this._container=t},isVisible:function(){return this._isVisible},setVisible:function(t){t=!!t;if(this._isVisible===t){return}this._isVisible=t;if(this._hasLayout){if(!this._isVisible){BX.removeClass(this._wrapper,"crm-section-control-active")}else{BX.addClass(this._wrapper,"crm-section-control-active")}}},layout:function(){this._editButton=BX.create("button",{props:{className:"webform-small-button webform-small-button-accept webform-button-active"},children:[BX.create("span",{props:{className:"webform-small-button-text"},text:BX.message("CRM_EDITOR_SAVE")})],events:{click:BX.delegate(this.onSaveButtonClick,this)}});this._cancelButton=BX.create("a",{props:{className:"webform-button-link"},text:BX.message("CRM_EDITOR_CANCEL"),attrs:{href:"#"},events:{click:BX.delegate(this.onCancelButtonClick,this)}});this._errorContainer=BX.create("DIV",{props:{className:"crm-entity-section-control-error-block"}});this._errorContainer.style.maxHeight="0px";this._wrapper=BX.create("DIV",{props:{className:"crm-entity-wrap"},children:[BX.create("DIV",{props:{className:"crm-entity-section crm-entity-section-control"},children:[this._editButton,this._cancelButton,this._errorContainer]})]});if(!this._isVisible){BX.removeClass(this._wrapper,"crm-section-control-active")}else{BX.addClass(this._wrapper,"crm-section-control-active")}document.body.appendChild(this._wrapper);this._hasLayout=true}};BX.Crm.EntityEditorToolPanel.prototype.onSaveButtonClick=function(t){this._editor.save()};BX.Crm.EntityEditorToolPanel.prototype.onCancelButtonClick=function(t){this._editor.cancel()};BX.Crm.EntityEditorToolPanel.prototype.processSaveBegin=function(){BX.addClass(this._editButton,"webform-small-button-wait")};BX.Crm.EntityEditorToolPanel.prototype.processSaveComplete=function(){BX.removeClass(this._editButton,"webform-small-button-wait")};BX.Crm.EntityEditorToolPanel.prototype.addError=function(t){this._errorContainer.appendChild(BX.create("DIV",{attrs:{className:"crm-entity-section-control-error-text"},html:t}));this._errorContainer.style.maxHeight=""};BX.Crm.EntityEditorToolPanel.prototype.clearErrors=function(){this._errorContainer.innerHTML="";this._errorContainer.style.maxHeight="0px"};BX.Crm.EntityEditorToolPanel.prototype.getMessage=function(t){var e=BX.Crm.EntityEditorToolPanel.messages;return e.hasOwnProperty(t)?e[t]:t};if(typeof BX.Crm.EntityEditorToolPanel.messages==="undefined"){BX.Crm.EntityEditorToolPanel.messages={}}BX.Crm.EntityEditorToolPanel.create=function(t,e){var i=new BX.Crm.EntityEditorToolPanel;i.initialize(t,e);return i}}if(typeof BX.Crm.EntityEditorFieldSelector==="undefined"){BX.Crm.EntityEditorFieldSelector=function(){this._id="";this._settings={};this._scheme=null;this._excludedNames=null;this._closingNotifier=null;this._contentWrapper=null;this._popup=null};BX.Crm.EntityEditorFieldSelector.prototype={initialize:function(t,e){this._id=t;this._settings=e?e:{};this._scheme=BX.prop.get(this._settings,"scheme",null);if(!this._scheme){throw"BX.Crm.EntityEditorFieldSelector. Parameter 'scheme' is not found."}this._excludedNames=BX.prop.getArray(this._settings,"excludedNames",[]);this._closingNotifier=BX.CrmNotifier.create(this)},getMessage:function(t){return BX.prop.getString(BX.Crm.EntityEditorFieldSelector.messages,t,t)},isSchemeElementEnabled:function(t){var e=t.getName();for(var i=0,n=this._excludedNames.length;i<n;i++){if(this._excludedNames[i]===e){return false}}return true},addClosingListener:function(t){this._closingNotifier.addListener(t)},removeClosingListener:function(t){this._closingNotifier.removeListener(t)},isOpened:function(){return this._popup&&this._popup.isShown()},open:function(){if(this.isOpened()){return}this._popup=new BX.PopupWindow(this._id,null,{autoHide:false,draggable:true,bindOptions:{forceBindPosition:false},closeByEsc:true,closeIcon:{},zIndex:1,titleBar:BX.prop.getString(this._settings,"title",""),events:{onPopupClose:BX.delegate(this._onPopupClose,this),onPopupDestroy:BX.delegate(this._onPopupDestroy,this)},content:this.prepareContent(),lightShadow:true,contentNoPaddings:true,buttons:[new BX.PopupWindowButton({text:this.getMessage("select"),className:"popup-window-button-create",events:{click:BX.delegate(this.onAcceptButtonClick,this)}}),new BX.PopupWindowButtonLink({text:this.getMessage("cancel"),className:"webform-button-link-cancel",events:{click:BX.delegate(this.onCancelButtonClick,this)}})]});this._popup.show()},close:function(){if(!(this._popup&&this._popup.isShown())){return}this._popup.close()},prepareContent:function(){this._contentWrapper=BX.create("div",{props:{className:"crm-entity-field-selector-window"}});var t=BX.create("div",{props:{className:"crm-entity-field-selector-window-list"}});this._contentWrapper.appendChild(t);var e=this._scheme.getElements();for(var i=0;i<e.length;i++){var n=e[i];if(!this.isSchemeElementEnabled(n)){continue}var r=[];var o=n.getElements();var s;for(var a=0;a<o.length;a++){s=o[a];if(s.isTransferable()&&s.getName()!==""){r.push(s)}}if(r.length===0){continue}var l=n.getName();var d=n.getTitle();t.appendChild(BX.create("div",{attrs:{className:"crm-entity-field-selector-window-list-caption"},text:d}));for(var h=0;h<r.length;h++){s=r[h];var p=s.getName();var c=s.getTitle();var u=l+"\\"+p;var m=BX.create("div",{attrs:{className:"crm-entity-field-selector-window-list-item"}});t.appendChild(m);m.appendChild(BX.create("input",{attrs:{id:u,type:"checkbox",className:"crm-entity-field-selector-window-list-checkbox"}}));m.appendChild(BX.create("label",{attrs:{for:u,className:"crm-entity-field-selector-window-list-label"},text:c}))}}return this._contentWrapper},getSelectedItems:function(){if(!this._contentWrapper){return[]}var t=[];var e=this._contentWrapper.querySelectorAll("input.crm-entity-field-selector-window-list-checkbox");for(var i=0,n=e.length;i<n;i++){var r=e[i];if(r.checked){var o=r.id.split("\\");if(o.length>=2){t.push({sectionName:o[0],fieldName:o[1]})}}}return t},onAcceptButtonClick:function(){this._closingNotifier.notify([{isCanceled:false,items:this.getSelectedItems()}]);this.close()},onCancelButtonClick:function(){this._closingNotifier.notify([{isCanceled:true}]);this.close()},onPopupClose:function(){if(this._popup){this._contentWrapper=null;this._popup.destroy()}},onPopupDestroy:function(){if(!this._popup){return}this._contentWrapper=null;this._popup=null}};if(typeof BX.Crm.EntityEditorFieldSelector.messages==="undefined"){BX.Crm.EntityEditorFieldSelector.messages={}}BX.Crm.EntityEditorFieldSelector.create=function(t,e){var i=new BX.Crm.EntityEditorFieldSelector(t,e);i.initialize(t,e);return i}}if(typeof BX.Crm.EntityEditorUserSelector==="undefined"){BX.Crm.EntityEditorUserSelector=function(){this._id="";this._settings={}};BX.Crm.EntityEditorUserSelector.prototype={initialize:function(t,e){this._id=t;this._settings=e?e:{};this._isInitialized=false},getId:function(){return this._id},open:function(t){if(this._mainWindow&&this._mainWindow===BX.SocNetLogDestination.containerWindow){return}if(!this._isInitialized){BX.SocNetLogDestination.init({name:this._id,extranetUser:false,bindMainPopup:{node:t,offsetTop:"5px",offsetLeft:"15px"},callback:{select:BX.delegate(this.onSelect,this)},showSearchInput:true,departmentSelectDisable:true,items:{users:BX.Crm.EntityEditorUserSelector.users,groups:{},sonetgroups:{},department:BX.Crm.EntityEditorUserSelector.department,departmentRelation:BX.SocNetLogDestination.buildDepartmentRelation(BX.Crm.EntityEditorUserSelector.department)},itemsLast:BX.Crm.EntityEditorUserSelector.last,itemsSelected:{},isCrmFeed:false,useClientDatabase:false,destSort:{},allowAddUser:false,allowSearchCrmEmailUsers:false,allowUserSearch:true});this._isInitialized=true}BX.SocNetLogDestination.openDialog(this._id);this._mainWindow=BX.SocNetLogDestination.containerWindow},close:function(){if(this._mainWindow&&this._mainWindow===BX.SocNetLogDestination.containerWindow){BX.SocNetLogDestination.closeDialog();this._mainWindow=null;this._isInitialized=false}},onSelect:function(t,e,i,n){if(e!=="users"){return}var r=BX.prop.getFunction(this._settings,"callback",null);if(r){r(this,t)}}};BX.Crm.EntityEditorUserSelector.items={};BX.Crm.EntityEditorUserSelector.create=function(t,e){var i=new BX.Crm.EntityEditorUserSelector(t,e);i.initialize(t,e);this.items[i.getId()]=i;return i}}if(typeof BX.Crm.EntityEditorCrmSelector==="undefined"){BX.Crm.EntityEditorCrmSelector=function(){this._id="";this._settings={};this._entityTypeIds=[];this._supportedItemTypes={}};BX.Crm.EntityEditorCrmSelector.prototype={initialize:function(t,e){this._id=t;this._settings=e?e:{};this._isInitialized=false;this._entityTypeIds=BX.prop.getArray(this._settings,"entityTypeIds",[]);this._supportedItemTypes=[];for(var i=0,n=this._entityTypeIds.length;i<n;i++){var r=this._entityTypeIds[i];if(r===BX.CrmEntityType.enumeration.contact){this._supportedItemTypes.push({name:"contacts",altName:"CRMCONTACT"})}else if(r===BX.CrmEntityType.enumeration.company){this._supportedItemTypes.push({name:"companies",altName:"CRMCOMPANY"})}}},getId:function(){return this._id},isOpened:function(){return BX.SocNetLogDestination.isOpenDialog()},open:function(t){if(this.isOpened()){return}if(this._mainWindow&&this._mainWindow===BX.SocNetLogDestination.containerWindow){return}if(!this._isInitialized){var e={};var i={};var n=[];for(var r=0,o=this._supportedItemTypes.length;r<o;r++){var s=this._supportedItemTypes[r];e[s.name]=BX.Crm.EntityEditorCrmSelector[s.name];i[s.name]=BX.Crm.EntityEditorCrmSelector[s.name+"Last"];n.push(s.altName)}i["crm"]={};BX.SocNetLogDestination.init({name:this._id,extranetUser:false,bindMainPopup:{node:t,offsetTop:"20px",offsetLeft:"20px"},callback:{select:BX.delegate(this.onSelect,this)},showSearchInput:true,departmentSelectDisable:true,items:e,itemsLast:i,itemsSelected:{},useClientDatabase:false,destSort:{},allowAddUser:false,allowSearchCrmEmailUsers:false,allowUserSearch:false,isCrmFeed:true,CrmTypes:n});this._isInitialized=true}BX.SocNetLogDestination.openDialog(this._id,{bindNode:t});this._mainWindow=BX.SocNetLogDestination.containerWindow},close:function(){if(!this.isOpened()){return}if(this._mainWindow&&this._mainWindow===BX.SocNetLogDestination.containerWindow){BX.SocNetLogDestination.closeDialog();this._mainWindow=null}},onSelect:function(t,e,i,n,r,o){if(o!=="select"){return}var s=false;for(var a=0,l=this._supportedItemTypes.length;a<l;a++){var d=this._supportedItemTypes[a];if(d.name===e){s=true;break}}if(!s){return}var h=BX.prop.getFunction(this._settings,"callback",null);if(h){h(this,t)}}};if(typeof BX.Crm.EntityEditorCrmSelector.contacts==="undefined"){BX.Crm.EntityEditorCrmSelector.contacts={}}if(typeof BX.Crm.EntityEditorCrmSelector.contactsLast==="undefined"){BX.Crm.EntityEditorCrmSelector.contactsLast={}}if(typeof BX.Crm.EntityEditorCrmSelector.companies==="undefined"){BX.Crm.EntityEditorCrmSelector.companies={}}if(typeof BX.Crm.EntityEditorCrmSelector.companiesLast==="undefined"){BX.Crm.EntityEditorCrmSelector.companiesLast={}}BX.Crm.EntityEditorCrmSelector.items={};BX.Crm.EntityEditorCrmSelector.create=function(t,e){var i=new BX.Crm.EntityEditorCrmSelector(t,e);i.initialize(t,e);this.items[i.getId()]=i;return i}}if(typeof BX.Crm.EntityBizprocManager==="undefined"){BX.Crm.EntityBizprocManager=function(){this._id="";this._settings={};this._moduleId="";this._entity="";this._documentType="";this._autoExecuteType=0;this._containerId=null;this._fieldName=null;this._validParameters=null;this._formInput=null;this._editor=null;this._starter=null};BX.Crm.EntityBizprocManager.prototype={initialize:function(t,e){this._id=BX.type.isNotEmptyString(t)?t:BX.util.getRandomString(4);this._settings=e?e:{};this._hasParameters=BX.prop.getBoolean(this._settings,"hasParameters",false);this._moduleId=BX.prop.getString(this._settings,"moduleId","");this._entity=BX.prop.getString(this._settings,"entity","");this._documentType=BX.prop.getString(this._settings,"documentType","");this._autoExecuteType=BX.prop.getInteger(this._settings,"autoExecuteType",0);this._containerId=BX.prop.getString(this._settings,"containerId","");this._fieldName=BX.prop.getString(this._settings,"fieldName","");this._contentNode=this._containerId?BX(this._containerId):null;if(this._hasParameters){this._starter=new BX.Bizproc.Starter({moduleId:this._moduleId,entity:this._entity,documentType:this._documentType})}},onBeforeSave:function(t){var e=new BX.Promise;var i=function(){window.setTimeout(BX.delegate(function(){e.fulfill()},this),0)};if(t.getStatus()&&this._hasParameters&&this._validParameters===null){try{this._starter.showAutoStartParametersPopup(this._autoExecuteType,{contentNode:this._contentNode,callback:this.onFillParameters.bind(this,e)});this._contentNode=null}catch(t){if("console"in window){window.console.log("Error occurred when bizproc popup is going to show",t)}i()}}else{i()}return e},onAfterSave:function(){this._validParameters=null;if(this._editor&&this._formInput){var t=this._editor.getFormElement();t.removeChild(this._formInput)}},onFillParameters:function(t,e){this._validParameters=e.parameters;if(this._editor){var i=this._editor.getFormElement();this._formInput=BX.create("input",{props:{type:"hidden",name:this._fieldName,value:this._validParameters}});i.appendChild(this._formInput)}t.fulfill()}};if(typeof BX.Crm.EntityBizprocManager.messages==="undefined"){BX.Crm.EntityBizprocManager.messages={}}BX.Crm.EntityBizprocManager.items={};BX.Crm.EntityBizprocManager.create=function(t,e){var i=new BX.Crm.EntityBizprocManager;i.initialize(t,e);this.items[t]=i;return i}}if(typeof BX.Crm.EntityRestPlacementManager==="undefined"){BX.Crm.EntityRestPlacementManager=function(){this._id="";this._entity="";this._editor=null};BX.Crm.EntityRestPlacementManager.items={};BX.Crm.EntityRestPlacementManager.prototype={initialize:function(t,e){this._id=BX.type.isNotEmptyString(t)?t:BX.util.getRandomString(4);this._settings=e?e:{};this._entity=BX.prop.getString(this._settings,"entity","");BX.defer(this.initializeInterface,this)()},initializeInterface:function(){if(!!BX.rest&&!!BX.rest.AppLayout){var t=BX.rest.AppLayout.initializePlacement("CRM_"+this._entity+"_DETAIL_TAB");var e=this._editor._entityTypeId,i=this._editor._entityId;t.prototype.resizeWindow=function(t,e){var i=BX(this.params.layoutName);t.height=parseInt(t.height);if(!!t.height){i.style.height=t.height+"px"}var n=BX.pos(i);e({width:n.width,height:n.height})};t.prototype.reloadData=function(t,n){BX.Crm.EntityEvent.fireUpdate(e,i,"");n()}}}};BX.Crm.EntityRestPlacementManager.create=function(t,e){var i=new BX.Crm.EntityRestPlacementManager;i.initialize(t,e);this.items[t]=i;return i}}
/* End */
;
; /* Start:"a:4:{s:4:"full";s:88:"/bitrix/components/bitrix/crm.timeline/templates/.default/script.min.js?1518596184190275";s:6:"source";s:67:"/bitrix/components/bitrix/crm.timeline/templates/.default/script.js";s:3:"min";s:0:"";s:3:"map";s:0:"";}"*/
if(typeof BX.CrmTimelineManager==="undefined"){BX.CrmTimelineManager=function(){this._id="";this._settings={};this._container=null;this._ownerTypeId=0;this._ownerId=0;this._ownerInfo=null;this._progressSemantics="";this._commentEditor=null;this._waitEditor=null;this._smsEditor=null;this._schedule=null;this._history=null;this._activityEditor=null;this._menuBar=null;this._readOnly=false;this._pullTagName=""};BX.CrmTimelineManager.prototype={initialize:function(t,e){this._id=BX.type.isNotEmptyString(t)?t:BX.util.getRandomString(4);this._settings=e?e:{};this._ownerTypeId=parseInt(this.getSetting("ownerTypeId"));this._ownerId=parseInt(this.getSetting("ownerId"));this._ownerInfo=this.getSetting("ownerInfo");this._progressSemantics=BX.prop.getString(this._settings,"progressSemantics","");var i=this.getSetting("containerId");if(!BX.type.isNotEmptyString(i)){throw"BX.CrmTimelineManager. A required parameter 'containerId' is missing."}this._container=BX(i);if(!BX.type.isElementNode(this._container)){throw"BX.CrmTimelineManager. Container node is not found."}this._readOnly=BX.prop.getBoolean(this._settings,"readOnly",false);var r=this.getSetting("activityEditorId");if(!BX.type.isNotEmptyString(r)){throw"BX.CrmTimeline. A required parameter 'activityEditorId' is missing."}this._activityEditor=BX.CrmActivityEditor.items[r];if(!(this._activityEditor instanceof BX.CrmActivityEditor)){throw"BX.CrmTimeline. Activity editor instance is not found."}var n=this.getSetting("ajaxId");var s=this.getSetting("currentUrl");this._schedule=BX.CrmSchedule.create(this._id,{manager:this,container:this._container,activityEditor:this._activityEditor,itemData:this.getSetting("scheduleData"),isStubMode:this._ownerId<=0,ajaxId:n,currentUrl:s,readOnly:this._readOnly});this._history=BX.CrmHistory.create(this._id,{manager:this,container:this._container,activityEditor:this._activityEditor,itemData:this.getSetting("historyData"),isStubMode:this._ownerId<=0,ajaxId:n,serviceUrl:this.getSetting("serviceUrl"),currentUrl:s,readOnly:this._readOnly});this._schedule.setHistory(this._history);this._commentEditor=BX.CrmTimelineCommentEditor.create(this._id,{manager:this,ownerTypeId:this._ownerTypeId,ownerId:this._ownerId,serviceUrl:this.getSetting("serviceUrl"),container:this.getSetting("editorCommentContainer"),input:this.getSetting("editorCommentInput"),button:this.getSetting("editorCommentButton"),cancelButton:this.getSetting("editorCommentCancelButton")});this._commentEditor.setVisible(true);this._commentEditor.setHistory(this._history);if(this._readOnly){this._commentEditor.setVisible(false)}if(BX.prop.getBoolean(this._settings,"enableWait",false)){this._waitEditor=BX.CrmTimelineWaitEditor.create(this._id,{manager:this,ownerTypeId:this._ownerTypeId,ownerId:this._ownerId,serviceUrl:this.getSetting("serviceUrl"),config:this.getSetting("editorWaitConfig",{}),targetDates:this.getSetting("editorWaitTargetDates",[]),container:this.getSetting("editorWaitContainer"),configContainer:this.getSetting("editorWaitConfigContainer"),input:this.getSetting("editorWaitInput"),button:this.getSetting("editorWaitButton"),cancelButton:this.getSetting("editorWaitCancelButton")});this._waitEditor.setVisible(false)}if(BX.prop.getBoolean(this._settings,"enableSms",false)){this._smsEditor=BX.CrmTimelineSmsEditor.create(this._id,{manager:this,ownerTypeId:this._ownerTypeId,ownerId:this._ownerId,serviceUrl:this.getSetting("serviceUrl"),config:this.getSetting("editorSmsConfig",{}),container:this.getSetting("editorSmsContainer"),input:this.getSetting("editorSmsInput"),button:this.getSetting("editorSmsButton"),cancelButton:this.getSetting("editorSmsCancelButton")});this._smsEditor.setVisible(false)}if(BX.prop.getBoolean(this._settings,"enableRest",false)){this._restEditor=BX.CrmTimelineRestEditor.create(this._id,{manager:this,ownerTypeId:this._ownerTypeId,ownerId:this._ownerId,placement:BX.prop.getString(this._settings,"restPlacement","")})}this._schedule.layout();this._history.layout();this._pullTagName=BX.prop.getString(this._settings,"pullTagName","");if(this._pullTagName!==""){BX.addCustomEvent("onPullEvent-crm",BX.delegate(this.onPullEvent,this));this.extendWatch()}this._menuBar=BX.CrmTimelineMenuBar.create(this._id,{container:BX(this.getSetting("menuBarContainer")),ownerInfo:this._ownerInfo,activityEditor:this._activityEditor,commentEditor:this._commentEditor,waitEditor:this._waitEditor,smsEditor:this._smsEditor,restEditor:this._restEditor,readOnly:this._readOnly,manager:this});if(!this._readOnly){this._menuBar.setActiveItemById("comment")}BX.addCustomEvent(window,"Crm.EntityProgress.Change",BX.delegate(this.onEntityProgressChange,this))},extendWatch:function(){if(BX.type.isFunction(BX.PULL)&&this._pullTagName!==""){BX.PULL.extendWatch(this._pullTagName);window.setTimeout(BX.delegate(this.extendWatch,this),6e4)}},onPullEvent:function(t,e){if(this._pullTagName!==BX.prop.getString(e,"TAG","")){return}if(t==="timeline_activity_add"){this.processActivityExternalAdd(e)}else if(t==="timeline_activity_update"){this.processActivityExternalUpdate(e)}else if(t==="timeline_activity_delete"){this.processActivityExternalDelete(e)}else if(t==="timeline_comment_add"){this.processCommentExternalAdd(e)}else if(t==="timeline_link_add"){this.processLinkExternalAdd(e)}else if(t==="timeline_wait_add"){this.processWaitExternalAdd(e)}else if(t==="timeline_wait_update"){this.processWaitExternalUpdate(e)}else if(t==="timeline_wait_delete"){this.processWaitExternalDelete(e)}else if(t==="timeline_bizproc_status"){this.processBizprocStatus(e)}},processActivityExternalAdd:function(t){var e,i,r,n,s;e=BX.prop.getObject(t,"ENTITY",null);i=BX.prop.getObject(t,"SCHEDULE_ITEM",null);r=BX.prop.getObject(t,"HISTORY_ITEM",null);if(e&&r&&!BX.type.isPlainObject(r["ASSOCIATED_ENTITY"])){r["ASSOCIATED_ENTITY"]=e}if(i!==null){n=this.addScheduleItem(i);n.addWrapperClass("crm-entity-stream-section-updated",1e3)}if(r!==null){s=this.addHistoryItem(r);BX.CrmTimelineItemExpand.create(s.getWrapper(),null).run()}},processActivityExternalUpdate:function(t){var e,i,r,n,s;e=BX.prop.getObject(t,"ENTITY",null);i=BX.prop.getObject(t,"SCHEDULE_ITEM",null);n=BX.prop.getObject(t,"HISTORY_ITEM",null);if(e){if(n&&!BX.type.isPlainObject(n["ASSOCIATED_ENTITY"])){n["ASSOCIATED_ENTITY"]=e}var a=BX.prop.getInteger(e,"ID",0);var o=this._history.getItemsByAssociatedEntity(BX.CrmEntityType.enumeration.activity,a);for(var c=0,m=o.length;c<m;c++){s=o[c];s.setAssociatedEntityData(e);s.refreshLayout()}}if(i!==null){r=this._schedule.getItemByAssociatedEntity(BX.CrmEntityType.enumeration.activity,BX.prop.getInteger(i,"ASSOCIATED_ENTITY_ID"));if(r){r.setData(i);if(!r.isDone()){this._schedule.refreshItem(r)}else{if(n){this._schedule.transferItemToHistory(r,n);n=null}else{this._schedule.deleteItem(r)}}}else if(!BX.CrmScheduleItem.isDone(i)){r=this.addScheduleItem(i);r.addWrapperClass("crm-entity-stream-section-updated",1e3)}}if(n!==null){s=this._history.findItemById(BX.prop.getString(n,"ID"));if(!s){s=this.addHistoryItem(n);BX.CrmTimelineItemExpand.create(s.getWrapper(),null).run()}else{s.setData(n);s.refreshLayout()}}},processActivityExternalDelete:function(t){var e=BX.prop.getInteger(t,"ENTITY_ID",0);var i=this._history.getItemsByAssociatedEntity(BX.CrmEntityType.enumeration.activity,e);for(var r=0,n=i.length;r<n;r++){this._history.deleteItem(i[r])}var s=this._schedule.getItemByAssociatedEntity(BX.CrmEntityType.enumeration.activity,e);if(s){this._schedule.deleteItem(s)}},processCommentExternalAdd:function(t){var e,i;e=BX.prop.getObject(t,"HISTORY_ITEM",null);if(e!==null){i=this.addHistoryItem(e);BX.CrmTimelineItemExpand.create(i.getWrapper(),null).run()}},processLinkExternalAdd:function(t){var e,i;e=BX.prop.getObject(t,"HISTORY_ITEM",null);if(e!==null){i=this.addHistoryItem(e);BX.CrmTimelineItemExpand.create(i.getWrapper(),null).run()}},processWaitExternalAdd:function(t){var e=BX.prop.getObject(t,"SCHEDULE_ITEM",null);if(e!==null){this.addScheduleItem(e)}},processWaitExternalUpdate:function(t){var e,i,r,n,s;e=BX.prop.getObject(t,"ENTITY",null);i=BX.prop.getObject(t,"SCHEDULE_ITEM",null);n=BX.prop.getObject(t,"HISTORY_ITEM",null);if(e){if(n&&!BX.type.isPlainObject(n["ASSOCIATED_ENTITY"])){n["ASSOCIATED_ENTITY"]=e}var a=BX.prop.getInteger(e,"ID",0);var o=this._history.getItemsByAssociatedEntity(BX.CrmEntityType.enumeration.wait,a);for(var c=0,m=o.length;c<m;c++){s=o[c];s.setAssociatedEntityData(e);s.refreshLayout()}}if(i!==null){r=this._schedule.getItemByAssociatedEntity(BX.CrmEntityType.enumeration.wait,BX.prop.getInteger(i,"ASSOCIATED_ENTITY_ID"));if(!r){this.addScheduleItem(i)}else{r.setData(i);if(!r.isDone()){this._schedule.refreshItem(r)}else{if(n){this._schedule.transferItemToHistory(r,n);n=null}else{this._schedule.deleteItem(r)}}}}if(n!==null){s=this._history.findItemById(BX.prop.getString(n,"ID"));if(!s){s=this.addHistoryItem(n);BX.CrmTimelineItemExpand.create(s.getWrapper(),null).run()}else{s.setData(n);s.refreshLayout()}}},processWaitExternalDelete:function(t){var e=BX.prop.getInteger(t,"ENTITY_ID",0);var i=this._history.getItemsByAssociatedEntity(BX.CrmEntityType.enumeration.wait,e);for(var r=0,n=i.length;r<n;r++){this._history.deleteItem(i[r])}var s=this._schedule.getItemByAssociatedEntity(BX.CrmEntityType.enumeration.wait,e);if(s){this._schedule.deleteItem(s)}},processBizprocStatus:function(t){var e,i;e=BX.prop.getObject(t,"HISTORY_ITEM",null);if(e!==null){i=this.addHistoryItem(e);BX.CrmTimelineItemExpand.create(i.getWrapper(),null).run()}},onEntityProgressChange:function(t,e){if(BX.prop.getInteger(e,"entityTypeId",0)!==this._ownerTypeId||BX.prop.getInteger(e,"entityId",0)!==this._ownerId){return}var i=BX.prop.getString(e,"semantics","");if(i===this._progressSemantics){return}this._progressSemantics=i;this._schedule.refreshLayout()},getId:function(){return this._id},getSetting:function(t,e){return this._settings.hasOwnProperty(t)?this._settings[t]:e},getOwnerTypeId:function(){return this._ownerTypeId},getOwnerId:function(){return this._ownerId},getOwnerInfo:function(){return this._ownerInfo},isStubCounterEnabled:function(){if(this._ownerId<=0){return false}return(this._ownerTypeId===BX.CrmEntityType.enumeration.deal||this._ownerTypeId===BX.CrmEntityType.enumeration.lead)&&this._progressSemantics==="process"},getSchedule:function(){return this._schedule},getHistory:function(){return this._history},getWaitEditor:function(){return this._waitEditor},getSmsEditor:function(){return this._smsEditor},processSheduleLayoutChange:function(){},processHistoryLayoutChange:function(){this._schedule.refreshLayout()},processEditingCompletion:function(t){if(this._waitEditor&&t===this._waitEditor){this._waitEditor.setVisible(false);this._commentEditor.setVisible(true);this._menuBar.setActiveItemById("comment")}if(this._smsEditor&&t===this._smsEditor){this._smsEditor.setVisible(false);this._commentEditor.setVisible(true);this._menuBar.setActiveItemById("comment")}},processEditingCancellation:function(t){if(this._waitEditor&&t===this._waitEditor){this._waitEditor.setVisible(false);this._commentEditor.setVisible(true);this._menuBar.setActiveItemById("comment")}if(this._smsEditor&&t===this._smsEditor){this._smsEditor.setVisible(false);this._commentEditor.setVisible(true);this._menuBar.setActiveItemById("comment")}},addScheduleItem:function(t){var e=this._schedule.createItem(t);var i=this._schedule.calculateItemIndex(e);var r=this._schedule.createAnchor(i);this._schedule.addItem(e,i);e.layout({anchor:r});return e},addHistoryItem:function(t){var e=this._history.createItem(t);var i=this._history.calculateItemIndex(e);var r=this._history.createAnchor(i);this._history.addItem(e,i);e.layout({anchor:r});return e},loadMediaPlayer:function(t,e,i,r){var n=this.getSetting("playerUrl","");if(n===""){return}var s=BX.util.add_url_param(n,{id:BX.util.urlencode(t),path:BX.util.urlencode(e),type:BX.util.urlencode(i)});BX.ajax.get(s,function(t){r.innerHTML=t})},onActivityCreated:function(t,e){}};BX.CrmTimelineManager.instances={};BX.CrmTimelineManager.create=function(t,e){var i=new BX.CrmTimelineManager;i.initialize(t,e);this.instances[i.getId()]=i;return i}}if(typeof BX.CrmTimeline==="undefined"){BX.CrmTimeline=function(){this._id="";this._settings={};this._container=null;this._manager=null;this._activityEditor=null;this._isStubMode=false;this._readOnly=false};BX.CrmTimeline.prototype={initialize:function(t,e){this._id=BX.type.isNotEmptyString(t)?t:BX.util.getRandomString(4);this._settings=e?e:{};this._container=BX(this.getSetting("container"));if(!BX.type.isElementNode(this._container)){throw"BX.CrmTimeline. Container node is not found."}this._manager=this.getSetting("manager");if(!(this._manager instanceof BX.CrmTimelineManager)){throw"BX.CrmTimeline. Manager instance is not found."}this._activityEditor=this.getSetting("activityEditor");if(!(this._activityEditor instanceof BX.CrmActivityEditor)){throw"BX.CrmTimeline. Activity editor instance is not found."}this._isStubMode=this.getSetting("isStubMode",false);this._readOnly=BX.prop.getBoolean(this._settings,"readOnly",false);this.doInitialize()},getId:function(){return this._id},getSetting:function(t,e){return this._settings.hasOwnProperty(t)?this._settings[t]:e},doInitialize:function(){},layout:function(){},isStubMode:function(){return this._isStubMode},isReadOnly:function(){return this._readOnly},refreshLayout:function(){},getManager:function(){return this._manager},getOwnerInfo:function(){return this._manager.getOwnerInfo()},reload:function(){var t=this.getSetting("currentUrl");var e=this.getSetting("ajaxId");if(e!==""){BX.ajax.insertToNode(BX.util.add_url_param(t,{bxajaxid:e}),"comp_"+e)}else{window.location=t}}}}if(typeof BX.CrmHistory==="undefined"){BX.CrmHistory=function(){BX.CrmHistory.superclass.constructor.apply(this);this._items=[];this._wrapper=null;this._currentDaySection=null;this._lastDaySection=null;this._lastDate=null;this._anchor=null;this._year=0;this._enableLoading=false;this._lastLoadedItemTimestamp="";this._scrollHandler=BX.delegate(this.onWindowScroll,this);this._loadingWaiter=null;this._isRequestRunning=false;BX.addCustomEvent("Player:onAfterInit",function(t){if(!t.isPlaying()){t.play()}})};BX.extend(BX.CrmHistory,BX.CrmTimeline);BX.CrmHistory.prototype.doInitialize=function(){var t=BX.message("FORMAT_DATETIME").replace(/:SS/,"");var e=BX.message("FORMAT_DATE");var i=BX.util.trim(t.replace(e,""));this._timeFormat=BX.date.convertBitrixFormat(i);this._year=(new Date).getFullYear();if(!this.isStubMode()){var r=this.getSetting("itemData");if(!BX.type.isArray(r)){r=[]}var n,s,a;for(n=0,s=r.length;n<s;n++){a=this.createItem(r[n]);this._items.push(a)}}};BX.CrmHistory.prototype.layout=function(){this._wrapper=BX.create("DIV",{});this._container.appendChild(this._wrapper);var t=BX.prop.extractDate(new Date);var e,i,r;if(!this.isStubMode()){for(e=0,i=this._items.length;e<i;e++){r=this._items[e];r.setContainer(this._wrapper);var n=r.getCreatedDate();if(this._lastDate===null||this._lastDate.getTime()!==n.getTime()){this._lastDate=n;if(t.getTime()===n.getTime()){this._currentDaySection=this._lastDaySection=this.createCurrentDaySection();this._wrapper.appendChild(this._currentDaySection)}else{this._lastDaySection=this.createDaySection(this._lastDate);this._wrapper.appendChild(this._lastDaySection)}}r.layout()}i=this._items.length;if(i){this._lastLoadedItemTimestamp=this._items[i-1].getCreatedTimestamp();this._loadingWaiter=this._items[i-1].getWrapper();this._enableLoading=true;BX.bind(window,"scroll",this._scrollHandler)}this.refreshLayout()}else{this._currentDaySection=this._lastDaySection=this.createCurrentDaySection();this._wrapper.appendChild(this._currentDaySection);this._wrapper.appendChild(BX.create("DIV",{attrs:{className:"crm-entity-stream-section crm-entity-stream-section-createEntity crm-entity-stream-section-last"},children:[BX.create("DIV",{attrs:{className:"crm-entity-stream-section-icon crm-entity-stream-section-icon-info"}}),BX.create("DIV",{attrs:{className:"crm-entity-stream-section-content"},children:[BX.create("DIV",{attrs:{className:"crm-entity-stream-content-event"},children:[BX.create("DIV",{attrs:{className:"crm-entity-stream-content-header"}}),BX.create("DIV",{attrs:{className:"crm-entity-stream-content-detail"},text:BX.message("CRM_TIMELINE_HISTORY_STUB")})]})]})]}))}this._manager.processHistoryLayoutChange()};BX.CrmHistory.prototype.refreshLayout=function(){var t=this._items.length;if(t===0){return}if(t>1){for(var e=0;e<t-1;e++){var i=this._items[e];if(i.isTerminated()){i.markAsTerminated(false)}}}this._items[t-1].markAsTerminated(true)};BX.CrmHistory.prototype.formatTime=function(t){return BX.date.format(this._timeFormat,t)};BX.CrmHistory.prototype.calculateItemIndex=function(t){return 0};BX.CrmHistory.prototype.checkItemForTermination=function(t){return this.getLastItem()===t};BX.CrmHistory.prototype.getLastItem=function(){return this._items.length>0?this._items[this._items.length-1]:null};BX.CrmHistory.prototype.getItemByIndex=function(t){return t<this._items.length?this._items[t]:null};BX.CrmHistory.prototype.getItemCount=function(){return this._items.length};BX.CrmHistory.prototype.removeItemByIndex=function(t){if(t<this._items.length){this._items.splice(t,1)}};BX.CrmHistory.prototype.getItemIndex=function(t){for(var e=0,i=this._items.length;e<i;e++){if(this._items[e]===t){return e}}return-1};BX.CrmHistory.prototype.getItemsByAssociatedEntity=function(t,e){if(!BX.type.isNumber(t)){t=parseInt(t)}if(!BX.type.isNumber(e)){e=parseInt(e)}if(isNaN(t)||t<=0||isNaN(e)||e<=0){return[]}var i=[];for(var r=0,n=this._items.length;r<n;r++){var s=this._items[r];if(s.getAssociatedEntityTypeId()===t&&s.getAssociatedEntityId()===e){i.push(s)}}return i};BX.CrmHistory.prototype.findItemById=function(t){t=t.toString();for(var e=0,i=this._items.length;e<i;e++){if(this._items[e].getId()===t){return this._items[e]}}return null};BX.CrmHistory.prototype.formatDate=function(t){return BX.date.format([["today","today"],["tommorow","tommorow"],["yesterday","yesterday"],["",t.getFullYear()===this._year?"j F":"j F Y"]],t)};BX.CrmHistory.prototype.createCurrentDaySection=function(){return BX.create("DIV",{attrs:{className:"crm-entity-stream-section crm-entity-stream-section-today-label"},children:[BX.create("DIV",{attrs:{className:"crm-entity-stream-section-content"},children:[BX.create("DIV",{attrs:{className:"crm-entity-stream-today-label"},text:this.formatDate(BX.prop.extractDate(new Date))})]})]})};BX.CrmHistory.prototype.createDaySection=function(t){return BX.create("DIV",{attrs:{className:"crm-entity-stream-section crm-entity-stream-section-history-label"},children:[BX.create("DIV",{attrs:{className:"crm-entity-stream-section-content"},children:[BX.create("DIV",{attrs:{className:"crm-entity-stream-history-label"},text:this.formatDate(t)})]})]})};BX.CrmHistory.prototype.createAnchor=function(t){if(this._currentDaySection===null){this._currentDaySection=this.createCurrentDaySection();if(this._wrapper.firstChild){this._wrapper.insertBefore(this._currentDaySection,this._wrapper.firstChild)}else{this._wrapper.appendChild(this._currentDaySection)}}if(this._anchor===null){this._anchor=BX.create("DIV",{attrs:{className:"crm-entity-stream-section crm-entity-stream-section-shadow"}});if(this._currentDaySection.nextSibling){this._wrapper.insertBefore(this._anchor,this._currentDaySection.nextSibling)}else{this._wrapper.appendChild(this._anchor)}}return this._anchor};BX.CrmHistory.prototype.createActivityItem=function(t){var e=BX.prop.getInteger(t,"TYPE_ID",BX.CrmTimelineType.undefined);var i=BX.prop.getInteger(t,"TYPE_CATEGORY_ID",0);if(e!==BX.CrmTimelineType.activity){return null}if(i===BX.CrmActivityType.email){return BX.CrmHistoryItemEmail.create(t["ID"],{history:this,container:this._wrapper,activityEditor:this._activityEditor,data:t})}if(i===BX.CrmActivityType.call){return BX.CrmHistoryItemCall.create(t["ID"],{history:this,container:this._wrapper,activityEditor:this._activityEditor,data:t})}else if(i===BX.CrmActivityType.meeting){return BX.CrmHistoryItemMeeting.create(t["ID"],{history:this,container:this._wrapper,activityEditor:this._activityEditor,data:t})}else if(i===BX.CrmActivityType.task){return BX.CrmHistoryItemTask.create(t["ID"],{history:this,container:this._wrapper,activityEditor:this._activityEditor,data:t})}else if(i===BX.CrmActivityType.provider){var r=BX.prop.getString(BX.prop.getObject(t,"ASSOCIATED_ENTITY",{}),"PROVIDER_ID","");if(r==="CRM_WEBFORM"){return BX.CrmHistoryItemWebForm.create(t["ID"],{history:this,container:this._wrapper,activityEditor:this._activityEditor,data:t})}else if(r==="CRM_SMS"){return BX.CrmHistoryItemSms.create(t["ID"],{history:this,container:this._wrapper,activityEditor:this._activityEditor,data:t,smsStatusDescriptions:this._manager.getSetting("smsStatusDescriptions",{}),smsStatusSemantics:this._manager.getSetting("smsStatusSemantics",{})})}else if(r==="CRM_REQUEST"){return BX.CrmHistoryItemActivityRequest.create(t["ID"],{history:this,container:this._wrapper,activityEditor:this._activityEditor,data:t})}else if(r==="IMOPENLINES_SESSION"){return BX.CrmHistoryItemOpenLine.create(t["ID"],{history:this,container:this._wrapper,activityEditor:this._activityEditor,data:t})}else if(r==="REST_APP"){return BX.CrmHistoryItemActivityRestApplication.create(t["ID"],{history:this,container:this._wrapper,activityEditor:this._activityEditor,data:t})}else if(r==="VISIT_TRACKER"){return BX.CrmHistoryItemVisit.create(t["ID"],{history:this,container:this._wrapper,activityEditor:this._activityEditor,data:t})}}return BX.CrmHistoryItemActivity.create(t["ID"],{history:this,container:this._wrapper,activityEditor:this._activityEditor,data:t})};BX.CrmHistory.prototype.createItem=function(t){var e=BX.prop.getInteger(t,"TYPE_ID",BX.CrmTimelineType.undefined);var i=BX.prop.getInteger(t,"TYPE_CATEGORY_ID",0);if(e===BX.CrmTimelineType.activity){return this.createActivityItem(t)}else if(e===BX.CrmTimelineType.creation){return BX.CrmHistoryItemCreation.create(t["ID"],{history:this,container:this._wrapper,activityEditor:this._activityEditor,data:t})}else if(e===BX.CrmTimelineType.link){return BX.CrmHistoryItemLink.create(t["ID"],{history:this,container:this._wrapper,activityEditor:this._activityEditor,data:t})}else if(e===BX.CrmTimelineType.mark){var r=BX.prop.getInteger(t,"ASSOCIATED_ENTITY_TYPE_ID",0);if(r===BX.CrmEntityType.enumeration.activity&&BX.type.isPlainObject(t["ASSOCIATED_ENTITY"])){t["TYPE_ID"]=BX.CrmTimelineType.activity;t["TYPE_CATEGORY_ID"]=BX.prop.getInteger(t["ASSOCIATED_ENTITY"],"TYPE_ID",0);t["ASSOCIATED_ENTITY"]["MARK_TYPE_ID"]=i;return this.createActivityItem(t)}return BX.CrmHistoryItemMark.create(t["ID"],{history:this,container:this._wrapper,activityEditor:this._activityEditor,data:t})}else if(e===BX.CrmTimelineType.comment){return BX.CrmHistoryItemComment.create(t["ID"],{history:this,container:this._wrapper,activityEditor:this._activityEditor,data:t})}else if(e===BX.CrmTimelineType.wait){return BX.CrmHistoryItemWait.create(t["ID"],{history:this,container:this._wrapper,activityEditor:this._activityEditor,data:t})}else if(e===BX.CrmTimelineType.sender){return BX.CrmHistoryItemSender.create(t["ID"],{history:this,container:this._wrapper,activityEditor:this._activityEditor,data:t})}else if(e===BX.CrmTimelineType.modification){return BX.CrmHistoryItemModification.create(t["ID"],{history:this,container:this._wrapper,activityEditor:this._activityEditor,data:t})}else if(e===BX.CrmTimelineType.conversion){return BX.CrmHistoryItemConversion.create(t["ID"],{history:this,container:this._wrapper,activityEditor:this._activityEditor,data:t})}else if(e===BX.CrmTimelineType.bizproc){return BX.CrmHistoryItemBizproc.create(t["ID"],{history:this,container:this._wrapper,activityEditor:this._activityEditor,data:t})}return BX.CrmHistoryItem.create(t["ID"],{history:this,container:this._wrapper,activityEditor:this._activityEditor,data:t})};BX.CrmHistory.prototype.addItem=function(t,e){if(!BX.type.isNumber(e)||e<0){e=this.calculateItemIndex(t)}if(e<this._items.length){this._items.splice(e,0,t)}else{this._items.push(t)}this.refreshLayout();this._manager.processHistoryLayoutChange()};BX.CrmHistory.prototype.deleteItem=function(t){var e=this.getItemIndex(t);if(e<0){return}t.clearLayout();this.removeItemByIndex(e);this.refreshLayout();this._manager.processHistoryLayoutChange()};BX.CrmHistory.prototype.onWindowScroll=function(t){if(!this._loadingWaiter||!this._enableLoading||this._isRequestRunning){return}var e=this._loadingWaiter.getBoundingClientRect();if(e.top<=document.documentElement.clientHeight){this.loadItems()}};BX.CrmHistory.prototype.onItemsLoad=function(t,e){var i=BX.prop.extractDate(new Date);var r=BX.prop.getArray(e,"HISTORY_ITEMS");var n,s,a;var o="";var c=0;for(n=0,s=r.length;n<s;n++){var m=BX.prop.getInteger(r[n],"ID",0);if(m<=0){continue}o=BX.prop.getString(r[n],"CREATED_SERVER","");if(this.findItemById(m)!==null){continue}a=this.createItem(r[n]);this._items.push(a);var l=a.getCreatedDate();if(this._lastDate===null||this._lastDate.getTime()!==l.getTime()){this._lastDate=l;if(i.getTime()===l.getTime()){this._currentDaySection=this._lastDaySection=this.createCurrentDaySection();this._wrapper.appendChild(this._currentDaySection)}else{this._lastDaySection=this.createDaySection(this._lastDate);this._wrapper.appendChild(this._lastDaySection)}}a.layout();c++}if(c>0){if(o!==""){this._lastLoadedItemTimestamp=o}s=this._items.length;this._loadingWaiter=this._items[s-1].getWrapper();this.refreshLayout();this._manager.processHistoryLayoutChange()}else{this._loadingWaiter=null;this._enableLoading=false;BX.unbind(window,"scroll",this._scrollHandler)}this._isRequestRunning=false};BX.CrmHistory.prototype.loadItems=function(){this._isRequestRunning=true;BX.CrmDataLoader.create(this._id,{serviceUrl:this.getSetting("serviceUrl",""),action:"GET_HISTORY_ITEMS",params:{OWNER_TYPE_ID:this._manager.getOwnerTypeId(),OWNER_ID:this._manager.getOwnerId(),LAST_ITEM_TIME:this._lastLoadedItemTimestamp}}).load(BX.delegate(this.onItemsLoad,this))};BX.CrmHistory.prototype.getMessage=function(t){var e=BX.CrmHistory.messages;return e.hasOwnProperty(t)?e[t]:t};if(typeof BX.CrmHistory.messages==="undefined"){BX.CrmHistory.messages={}}BX.CrmHistory.instances={};BX.CrmHistory.create=function(t,e){var i=new BX.CrmHistory;i.initialize(t,e);this.instances[i.getId()]=i;return i}}if(typeof BX.CrmSchedule==="undefined"){BX.CrmSchedule=function(){BX.CrmSchedule.superclass.constructor.apply(this);this._items=[];this._history=null;this._wrapper=null;this._anchor=null;this._stub=null;this._timeFormat=""};BX.extend(BX.CrmSchedule,BX.CrmTimeline);BX.CrmSchedule.prototype.doInitialize=function(){var t=BX.message("FORMAT_DATETIME").replace(/:SS/,"");var e=BX.message("FORMAT_DATE");var i=BX.util.trim(t.replace(e,""));this._timeFormat=BX.date.convertBitrixFormat(i);if(!this.isStubMode()){var r=this.getSetting("itemData");if(!BX.type.isArray(r)){r=[]}var n,s,a;for(n=0,s=r.length;n<s;n++){a=this.createItem(r[n]);if(a){this._items.push(a)}}}};BX.CrmSchedule.prototype.layout=function(){this._wrapper=BX.create("DIV",{});this._container.appendChild(this._wrapper);var t=BX.create("DIV",{attrs:{className:"crm-entity-stream-planned-label"},text:this.getMessage("planned")});var e="crm-entity-stream-section crm-entity-stream-section-planned-label";this._wrapper.appendChild(BX.create("DIV",{attrs:{className:e},children:[BX.create("DIV",{attrs:{className:"crm-entity-stream-section-content"},children:[t]})]}));if(this.isStubMode()){this.addStub()}else{var i=this._items.length;if(i===0){this.addStub()}else{for(var r=0;r<i;r++){var n=this._items[r];n.setContainer(this._wrapper);n.layout()}}}this.refreshLayout();this._manager.processSheduleLayoutChange()};BX.CrmSchedule.prototype.refreshLayout=function(){var t=this._items.length;var e=this._history?this._history.getItemCount():0;if(t===0){this.addStub();if(e>0||this._history.isStubMode()){BX.removeClass(this._stub,"crm-entity-stream-section-last")}else{BX.addClass(this._stub,"crm-entity-stream-section-last")}var i=this._stub.querySelector(".crm-entity-stream-section-icon");if(i){if(this._manager.isStubCounterEnabled()){BX.addClass(i,"crm-entity-stream-section-counter")}else{BX.removeClass(i,"crm-entity-stream-section-counter")}}return}var r,n;if(e>0){for(r=0;r<t;r++){n=this._items[r];if(n.isTerminated()){n.markAsTerminated(false)}}}else{if(t>1){for(r=0;r<t-1;r++){n=this._items[r];if(n.isTerminated()){n.markAsTerminated(false)}}}this._items[t-1].markAsTerminated(true)}};BX.CrmSchedule.prototype.formatDateTime=function(t){var e=new Date;return BX.date.format([["today","today, "+this._timeFormat],["tommorow","tommorow, "+this._timeFormat],["yesterday","yesterday, "+this._timeFormat],["",(t.getFullYear()===e.getFullYear()?"j F ":"j F Y ")+this._timeFormat]],t,e)};BX.CrmSchedule.prototype.checkItemForTermination=function(t){if(this._history&&this._history.getItemCount()>0){return false}return this.getLastItem()===t};BX.CrmSchedule.prototype.getLastItem=function(){return this._items.length>0?this._items[this._items.length-1]:null};BX.CrmSchedule.prototype.calculateItemIndex=function(t){var e,i;var r=t.getDeadline();if(r){for(e=0,i=this._items.length;e<i;e++){var n=this._items[e].getDeadline();if(!n||r<=n){return e}}}else{var s=t.getSourceId();for(e=0,i=this._items.length;e<i;e++){if(this._items[e].getDeadline()){continue}if(s<=this._items[e].getSourceId()){return e}}}return this._items.length};BX.CrmSchedule.prototype.getItemCount=function(){return this._items.length};BX.CrmSchedule.prototype.getItems=function(){return this._items};BX.CrmSchedule.prototype.getItemByAssociatedEntity=function(t,e){if(!BX.type.isNumber(t)){t=parseInt(t)}if(!BX.type.isNumber(e)){e=parseInt(e)}if(isNaN(t)||t<=0||isNaN(e)||e<=0){return null}for(var i=0,r=this._items.length;i<r;i++){var n=this._items[i];if(n.getAssociatedEntityTypeId()===t&&n.getAssociatedEntityId()===e){return n}}return null};BX.CrmSchedule.prototype.getItemIndex=function(t){for(var e=0,i=this._items.length;e<i;e++){if(this._items[e]===t){return e}}return-1};BX.CrmSchedule.prototype.getItemByIndex=function(t){return t<this._items.length?this._items[t]:null};BX.CrmSchedule.prototype.removeItemByIndex=function(t){if(t<this._items.length){this._items.splice(t,1)}};BX.CrmSchedule.prototype.createItem=function(t){var e=BX.prop.getInteger(t,"ASSOCIATED_ENTITY_TYPE_ID",0);var i=BX.prop.getInteger(t,"ASSOCIATED_ENTITY_ID",0);var r=BX.prop.getObject(t,"ASSOCIATED_ENTITY",{});var n=BX.CrmEntityType.resolveName(e)+"_"+i.toString();if(e===BX.CrmEntityType.enumeration.wait){return BX.CrmScheduleItemWait.create(n,{schedule:this,container:this._wrapper,activityEditor:this._activityEditor,data:t})}else{var s=BX.prop.getInteger(r,"TYPE_ID",0);var a=BX.prop.getString(r,"PROVIDER_ID","");if(s===BX.CrmActivityType.email){return BX.CrmScheduleItemEmail.create(n,{schedule:this,container:this._wrapper,activityEditor:this._activityEditor,data:t})}else if(s===BX.CrmActivityType.call){return BX.CrmScheduleItemCall.create(n,{schedule:this,container:this._wrapper,activityEditor:this._activityEditor,data:t})}else if(s===BX.CrmActivityType.meeting){return BX.CrmScheduleItemMeeting.create(n,{schedule:this,container:this._wrapper,activityEditor:this._activityEditor,data:t})}else if(s===BX.CrmActivityType.task){return BX.CrmScheduleItemTask.create(n,{schedule:this,container:this._wrapper,activityEditor:this._activityEditor,data:t})}else if(s===BX.CrmActivityType.provider){if(a==="CRM_WEBFORM"){return BX.CrmScheduleItemWebForm.create(n,{schedule:this,container:this._wrapper,activityEditor:this._activityEditor,data:t})}else if(a==="CRM_REQUEST"){return BX.CrmScheduleItemActivityRequest.create(n,{schedule:this,container:this._wrapper,activityEditor:this._activityEditor,data:t})}else if(a==="IMOPENLINES_SESSION"){return BX.CrmScheduleItemActivityOpenLine.create(n,{schedule:this,container:this._wrapper,activityEditor:this._activityEditor,data:t})}else if(a==="REST_APP"){return BX.CrmScheduleItemActivityRestApplication.create(n,{schedule:this,container:this._wrapper,activityEditor:this._activityEditor,data:t})}}}return null};BX.CrmSchedule.prototype.addItem=function(t,e){if(!BX.type.isNumber(e)||e<0){e=this.calculateItemIndex(t)}if(e<this._items.length){this._items.splice(e,0,t)}else{this._items.push(t)}this.removeStub();this.refreshLayout();this._manager.processSheduleLayoutChange()};BX.CrmSchedule.prototype.getHistory=function(){return this._history};BX.CrmSchedule.prototype.setHistory=function(t){this._history=t};BX.CrmSchedule.prototype.createAnchor=function(t){this._anchor=BX.create("DIV",{attrs:{className:"crm-entity-stream-section crm-entity-stream-section-shadow"}});if(t>=0&&t<this._items.length){this._wrapper.insertBefore(this._anchor,this._items[t].getWrapper())}else{this._wrapper.appendChild(this._anchor)}return this._anchor};BX.CrmSchedule.prototype.deleteItem=function(t){var e=this.getItemIndex(t);if(e<0){return}t.clearLayout();this.removeItemByIndex(e);this.refreshLayout();this._manager.processSheduleLayoutChange()};BX.CrmSchedule.prototype.refreshItem=function(t){var e=this.getItemIndex(t);if(e<0){return}this.removeItemByIndex(e);var i=this.createItem(t.getData());var r=this.calculateItemIndex(i);if(r===e){this.addItem(t,r);t.refreshLayout();t.addWrapperClass("crm-entity-stream-section-updated",1e3);return}var n=this.createAnchor(r);this.addItem(i,r);i.layout({add:false});var s=BX.CrmTimelineItemAnimation.create("",{initialItem:t,finalItem:i,anchor:n});s.run()};BX.CrmSchedule.prototype.transferItemToHistory=function(t,e){var i=this.getItemIndex(t);if(i<0){return}this.removeItemByIndex(i);this.refreshLayout();this._manager.processSheduleLayoutChange();var r=this._history.createItem(e);this._history.addItem(r,0);r.layout({add:false});var n=BX.CrmTimelineItemAnimationNew.create("",{initialItem:t,finalItem:r,anchor:this._history.createAnchor(),events:{complete:BX.delegate(this.onTransferComplete,this)}});n.run()};BX.CrmSchedule.prototype.onTransferComplete=function(){if(this._items.length===0){this.addStub()}};BX.CrmSchedule.prototype.onItemMarkedAsDone=function(t,e){};BX.CrmSchedule.prototype.addStub=function(){if(!this._stub){var t="crm-entity-stream-section crm-entity-stream-section-planned crm-entity-stream-section-notTask";var e="crm-entity-stream-section-icon crm-entity-stream-section-icon-info";var i=this.getMessage("stub");var r=this._manager.getOwnerTypeId();if(r===BX.CrmEntityType.enumeration.lead){i=this.getMessage("leadStub")}else if(r===BX.CrmEntityType.enumeration.deal){i=this.getMessage("dealStub")}if(this._manager.isStubCounterEnabled()){e+=" crm-entity-stream-section-counter"}this._stub=BX.create("DIV",{attrs:{className:t},children:[BX.create("DIV",{attrs:{className:e}}),BX.create("DIV",{attrs:{className:"crm-entity-stream-section-content"},children:[BX.create("DIV",{attrs:{className:"crm-entity-stream-content-event"},children:[BX.create("DIV",{attrs:{className:"crm-entity-stream-content-detail"},text:i})]})]})]});this._wrapper.appendChild(this._stub)}if(this._history&&this._history.getItemCount()>0){BX.removeClass(this._stub,"crm-entity-stream-section-last")}else{BX.addClass(this._stub,"crm-entity-stream-section-last")}};BX.CrmSchedule.prototype.removeStub=function(){if(this._stub){this._stub=BX.remove(this._stub)}};BX.CrmSchedule.items={};BX.CrmSchedule.prototype.getMessage=function(t){var e=BX.CrmSchedule.messages;return e.hasOwnProperty(t)?e[t]:t};if(typeof BX.CrmSchedule.messages==="undefined"){BX.CrmSchedule.messages={}}BX.CrmSchedule.create=function(t,e){var i=new BX.CrmSchedule;i.initialize(t,e);this.items[i.getId()]=i;return i}}if(typeof BX.CrmTimelineBaseEditor==="undefined"){BX.CrmTimelineBaseEditor=function(){this._id="";this._settings={};this._manager=null;this._ownerTypeId=0;this._ownerId=0;this._container=null;this._input=null;this._saveButton=null;this._cancelButton=null;this._ghostInput=null;this._saveButtonHandler=BX.delegate(this.onSaveButtonClick,this);this._cancelButtonHandler=BX.delegate(this.onCancelButtonClick,this);this._focusHandler=BX.delegate(this.onFocus,this);this._blurHandler=BX.delegate(this.onBlur,this);this._keyupHandler=BX.delegate(this.resizeForm,this);this._isVisible=true;this._hideButtonsOnBlur=true};BX.CrmTimelineBaseEditor.prototype={initialize:function(t,e){this._id=BX.type.isNotEmptyString(t)?t:BX.util.getRandomString(4);this._settings=e?e:{};this._manager=this.getSetting("manager");if(!(this._manager instanceof BX.CrmTimelineManager)){throw"BX.CrmTimelineBaseEditor. Manager instance is not found."}this._ownerTypeId=this.getSetting("ownerTypeId",0);this._ownerId=this.getSetting("ownerId",0);this._container=BX(this.getSetting("container"));this._input=BX(this.getSetting("input"));this._saveButton=BX(this.getSetting("button"));this._cancelButton=BX(this.getSetting("cancelButton"));BX.bind(this._saveButton,"click",this._saveButtonHandler);if(this._cancelButton){BX.bind(this._cancelButton,"click",this._cancelButtonHandler)}BX.bind(this._input,"focus",this._focusHandler);BX.bind(this._input,"blur",this._blurHandler);BX.bind(this._input,"keyup",this._keyupHandler);this.doInitialize()},doInitialize:function(){},getId:function(){return this._id},getSetting:function(t,e){return this._settings.hasOwnProperty(t)?this._settings[t]:e},setVisible:function(t){t=!!t;if(this._isVisible===t){return}this._isVisible=t;this._container.style.display=t?"":"none"},isVisible:function(){return this._isVisible},onFocus:function(t){BX.addClass(this._container,"focus")},onBlur:function(t){if(!this._hideButtonsOnBlur){return}if(this._input.value===""){window.setTimeout(BX.delegate(function(){BX.removeClass(this._container,"focus");this._input.style.minHeight=""},this),200)}},onSaveButtonClick:function(t){this.save()},onCancelButtonClick:function(){this.cancel();this._manager.processEditingCancellation(this)},save:function(){},cancel:function(){},release:function(){if(this._ghostInput){this._ghostInput=BX.remove(this._ghostInput)}},ensureGhostCreated:function(){if(this._ghostInput){return this._ghostInput}this._ghostInput=BX.create("div",{props:{className:"crm-entity-stream-content-new-comment-textarea-shadow"},text:this._input.value});this._ghostInput.style.width=this._input.offsetWidth+"px";document.body.appendChild(this._ghostInput);return this._ghostInput},resizeForm:function(){var t=this.ensureGhostCreated();var e=getComputedStyle(this._input);var i=parseInt(e.paddingBottom)+parseInt(e.paddingTop)+parseInt(e.borderTopWidth)+parseInt(e.borderBottomWidth)||0;t.innerHTML=this._input.value.replace(/[\r\n]{1}/g,"<br>");this._input.style.minHeight=t.scrollHeight+i+"px"}}}if(typeof BX.CrmTimelineCommentEditor==="undefined"){BX.CrmTimelineCommentEditor=function(){BX.CrmTimelineCommentEditor.superclass.constructor.apply(this);this._history=null;this._serviceUrl="";this._isRequestRunning=false;this._isLocked=false};BX.extend(BX.CrmTimelineCommentEditor,BX.CrmTimelineBaseEditor);BX.CrmTimelineCommentEditor.prototype.doInitialize=function(){this._serviceUrl=this.getSetting("serviceUrl","")};BX.CrmTimelineCommentEditor.prototype.getHistory=function(){return this._history};BX.CrmTimelineCommentEditor.prototype.setHistory=function(t){this._history=t};BX.CrmTimelineCommentEditor.prototype.save=function(){var t=this._input.value;if(t===""){return}if(this._isRequestRunning||this._isLocked){return}this._isRequestRunning=this._isLocked=true;BX.ajax({url:this._serviceUrl,method:"POST",dataType:"json",data:{ACTION:"SAVE_COMMENT",TEXT:t,OWNER_TYPE_ID:this._ownerTypeId,OWNER_ID:this._ownerId},onsuccess:BX.delegate(this.onSaveSuccess,this),onfailure:BX.delegate(this.onSaveFailure,this)})};BX.CrmTimelineCommentEditor.prototype.cancel=function(){this._input.value="";this._input.style.minHeight="";this.release()};BX.CrmTimelineCommentEditor.prototype.onSaveSuccess=function(t){this._isRequestRunning=false;var e=BX.prop.getObject(t,"HISTORY_ITEM");var i=this._history.createItem(e);this._history.addItem(i,0);var r=this._history.createAnchor();i.layout({anchor:r});var n=BX.CrmCommentAnimation.create(i.getWrapper(),r,BX.pos(this._input),{start:BX.delegate(this.onAnimationStart,this),complete:BX.delegate(this.onAnimationComplete,this)});n.run()};BX.CrmTimelineCommentEditor.prototype.onSaveFailure=function(){this._isRequestRunning=this._isLocked=false};BX.CrmTimelineCommentEditor.prototype.onAnimationStart=function(){this._input.value=""};BX.CrmTimelineCommentEditor.prototype.onAnimationComplete=function(){this._isLocked=false;BX.removeClass(this._container,"focus");this._input.style.minHeight="";this._manager.processEditingCompletion(this);this.release()};BX.CrmTimelineCommentEditor.items={};BX.CrmTimelineCommentEditor.create=function(t,e){var i=new BX.CrmTimelineCommentEditor;i.initialize(t,e);this.items[i.getId()]=i;return i}}if(typeof BX.CrmTimelineWaitType==="undefined"){BX.CrmTimelineWaitType={undefined:0,after:1,before:2,names:{after:"after",before:"before"},resolveTypeId:function(t){if(t===this.names.after){return this.after}else if(t===this.names.before){return this.before}return this.undefined}}}if(typeof BX.CrmTimelineWaitHelper==="undefined"){BX.CrmTimelineWaitHelper={getDurationText:function(t,e){e=!!e;var i="D";if(e){var r="";if(t%7===0){t=t/7;i="W"}}if(i==="W"){r=BX.CrmMessageHelper.getCurrent().getNumberDeclension(t,this.getMessage("weekNominative"),this.getMessage("weekGenitiveSingular"),this.getMessage("weekGenitivePlural"))}else{r=BX.CrmMessageHelper.getCurrent().getNumberDeclension(t,this.getMessage("dayNominative"),this.getMessage("dayGenitiveSingular"),this.getMessage("dayGenitivePlural"))}if(e){r=t.toString()+" "+r}return r},getMessage:function(t){return this.messages.hasOwnProperty(t)?this.messages[t]:t}};if(typeof BX.CrmTimelineWaitHelper.messages==="undefined"){BX.CrmTimelineWaitHelper.messages={}}}if(typeof BX.CrmTimelineWaitEditor==="undefined"){BX.CrmTimelineWaitEditor=function(){BX.CrmTimelineWaitEditor.superclass.constructor.apply(this);this._serviceUrl="";this._isRequestRunning=false;this._isLocked=false;this._hideButtonsOnBlur=false;this._type=BX.CrmTimelineWaitType.after;this._duration=1;this._target="";this._configContainer=null;this._configSelector=null;this._isMenuShown=false;this._menu=null;this._configDialog=null};BX.extend(BX.CrmTimelineWaitEditor,BX.CrmTimelineBaseEditor);BX.CrmTimelineWaitEditor.prototype.doInitialize=function(){this._configContainer=BX(this.getSetting("configContainer"));this._serviceUrl=this.getSetting("serviceUrl","");var t=BX.prop.getObject(this._settings,"config",{});this._type=BX.CrmTimelineWaitType.resolveTypeId(BX.prop.getString(t,"type",BX.CrmTimelineWaitType.names.after));this._duration=BX.prop.getInteger(t,"duration",1);this._target=BX.prop.getString(t,"target","");this._targetDates=BX.prop.getArray(this._settings,"targetDates",[]);this.layoutConfigurationSummary()};BX.CrmTimelineWaitEditor.prototype.getDurationText=function(t,e){return BX.CrmTimelineWaitHelper.getDurationText(t,e)};BX.CrmTimelineWaitEditor.prototype.getTargetDateCaption=function(t){for(var e=0,i=this._targetDates.length;e<i;e++){var r=this._targetDates[e];if(r["name"]===t){return r["caption"]}}return""};BX.CrmTimelineWaitEditor.prototype.onSelectorClick=function(t){if(!this._isMenuShown){this.openMenu()}else{this.closeMenu()}t.preventDefault?t.preventDefault():t.returnValue=false};BX.CrmTimelineWaitEditor.prototype.openMenu=function(){if(this._isMenuShown){return}var t=BX.delegate(this.onMenuItemClick,this);var e=[{id:"day_1",text:this.getMessage("oneDay"),onclick:t},{id:"day_2",text:this.getMessage("twoDays"),onclick:t},{id:"day_3",text:this.getMessage("threeDays"),onclick:t},{id:"week_1",text:this.getMessage("oneWeek"),onclick:t},{id:"week_2",text:this.getMessage("twoWeek"),onclick:t},{id:"week_3",text:this.getMessage("threeWeeks"),onclick:t}];var i={id:"custom",text:this.getMessage("custom"),items:[]};i["items"].push({id:"afterDays",text:this.getMessage("afterDays"),onclick:t});if(this._targetDates.length>0){i["items"].push({id:"beforeDate",text:this.getMessage("beforeDate"),onclick:t})}e.push(i);BX.PopupMenu.show(this._id,this._configSelector,e,{offsetTop:0,offsetLeft:36,angle:{position:"top",offset:0},events:{onPopupShow:BX.delegate(this.onMenuShow,this),onPopupClose:BX.delegate(this.onMenuClose,this),onPopupDestroy:BX.delegate(this.onMenuDestroy,this)}});this._menu=BX.PopupMenu.currentItem};BX.CrmTimelineWaitEditor.prototype.closeMenu=function(){if(!this._isMenuShown){return}if(this._menu){this._menu.close()}};BX.CrmTimelineWaitEditor.prototype.onMenuItemClick=function(t,e){this.closeMenu();if(e.id==="afterDays"||e.id==="beforeDate"){this.openConfigDialog(e.id==="afterDays"?BX.CrmTimelineWaitType.after:BX.CrmTimelineWaitType.before);return}var i={type:BX.CrmTimelineWaitType.after};if(e.id==="day_1"){i["duration"]=1}else if(e.id==="day_2"){i["duration"]=2}else if(e.id==="day_3"){i["duration"]=3}if(e.id==="week_1"){i["duration"]=7}else if(e.id==="week_2"){i["duration"]=14}else if(e.id==="week_3"){i["duration"]=21}this.saveConfiguration(i)};BX.CrmTimelineWaitEditor.prototype.openConfigDialog=function(t){if(!this._configDialog){this._configDialog=BX.CrmTimelineWaitConfigurationDialog.create("",{targetDates:this._targetDates,onSave:BX.delegate(this.onConfigDialogSave,this),onCancel:BX.delegate(this.onConfigDialogCancel,this)})}this._configDialog.setType(t);this._configDialog.setDuration(this._duration);var e=this._target;if(e===""&&this._targetDates.length>0){e=this._targetDates[0]["name"]}this._configDialog.setTarget(e);this._configDialog.open()};BX.CrmTimelineWaitEditor.prototype.onConfigDialogSave=function(t,e){this.saveConfiguration(e);this._configDialog.close()};BX.CrmTimelineWaitEditor.prototype.onConfigDialogCancel=function(t){this._configDialog.close()};BX.CrmTimelineWaitEditor.prototype.onMenuShow=function(){this._isMenuShown=true};BX.CrmTimelineWaitEditor.prototype.onMenuClose=function(){if(this._menu&&this._menu.popupWindow){this._menu.popupWindow.destroy()}};BX.CrmTimelineWaitEditor.prototype.onMenuDestroy=function(){this._isMenuShown=false;this._menu=null;if(typeof BX.PopupMenu.Data[this._id]!=="undefined"){delete BX.PopupMenu.Data[this._id]}};BX.CrmTimelineWaitEditor.prototype.saveConfiguration=function(t){this._type=BX.prop.getInteger(t,"type",BX.CrmTimelineWaitType.after);this._duration=BX.prop.getInteger(t,"duration",0);if(this._duration<=0){this._duration=1}this._target=this._type===BX.CrmTimelineWaitType.before?BX.prop.getString(t,"target",""):"";var e=this._manager.getId().toLowerCase();BX.userOptions.save("crm.timeline.wait",e,"type",this._type===BX.CrmTimelineWaitType.after?"after":"before");BX.userOptions.save("crm.timeline.wait",e,"duration",this._duration);BX.userOptions.save("crm.timeline.wait",e,"target",this._target);this.layoutConfigurationSummary()};BX.CrmTimelineWaitEditor.prototype.getSummaryHtml=function(){if(this._type===BX.CrmTimelineWaitType.before){return this.getMessage("completionTypeBefore").replace("#DURATION#",this.getDurationText(this._duration,true)).replace("#TARGET_DATE#",this.getTargetDateCaption(this._target))}return this.getMessage("completionTypeAfter").replace("#DURATION#",this.getDurationText(this._duration,true))};BX.CrmTimelineWaitEditor.prototype.getSummaryText=function(){return BX.util.strip_tags(this.getSummaryHtml())};BX.CrmTimelineWaitEditor.prototype.layoutConfigurationSummary=function(){this._configContainer.innerHTML=this.getSummaryHtml();this._configSelector=this._configContainer.querySelector("a");if(this._configSelector){BX.bind(this._configSelector,"click",BX.delegate(this.onSelectorClick,this))}};BX.CrmTimelineWaitEditor.prototype.postpone=function(t,e,i){BX.ajax({url:this._serviceUrl,method:"POST",dataType:"json",data:{ACTION:"POSTPONE_WAIT",DATA:{ID:t,OFFSET:e}},onsuccess:i})};BX.CrmTimelineWaitEditor.prototype.complete=function(t,e,i){BX.ajax({url:this._serviceUrl,method:"POST",dataType:"json",data:{ACTION:"COMPLETE_WAIT",DATA:{ID:t,COMPLETED:e?"Y":"N"}},onsuccess:i})};BX.CrmTimelineWaitEditor.prototype.save=function(){if(this._isRequestRunning||this._isLocked){return}var t=this.getSummaryText();var e=BX.util.trim(this._input.value);if(e!==""){t+="\n"+e}var i={ID:0,typeId:this._type,duration:this._duration,targetFieldName:this._target,subject:"",description:t,completed:0,ownerType:BX.CrmEntityType.resolveName(this._ownerTypeId),ownerID:this._ownerId};BX.ajax({url:this._serviceUrl,method:"POST",dataType:"json",data:{ACTION:"SAVE_WAIT",DATA:i},onsuccess:BX.delegate(this.onSaveSuccess,this),onfailure:BX.delegate(this.onSaveFailure,this)});this._isRequestRunning=this._isLocked=true};BX.CrmTimelineWaitEditor.prototype.cancel=function(){this._input.value="";this._input.style.minHeight="";this.release()};BX.CrmTimelineWaitEditor.prototype.onSaveSuccess=function(t){this._isRequestRunning=this._isLocked=false;var e=BX.prop.getString(t,"ERROR","");if(e!==""){alert(e);return}this._input.value="";this._input.style.minHeight="";this._manager.processEditingCompletion(this);this.release()};BX.CrmTimelineWaitEditor.prototype.onSaveFailure=function(){this._isRequestRunning=this._isLocked=false};BX.CrmTimelineWaitEditor.prototype.getMessage=function(t){var e=BX.CrmTimelineWaitEditor.messages;return e.hasOwnProperty(t)?e[t]:t};if(typeof BX.CrmTimelineWaitEditor.messages==="undefined"){BX.CrmTimelineWaitEditor.messages={}}BX.CrmTimelineWaitEditor.items={};BX.CrmTimelineWaitEditor.create=function(t,e){var i=new BX.CrmTimelineWaitEditor;i.initialize(t,e);this.items[i.getId()]=i;return i}}if(typeof BX.CrmTimelineSmsEditor==="undefined"){BX.CrmTimelineSmsEditor=function(){BX.CrmTimelineSmsEditor.superclass.constructor.apply(this);this._history=null;this._serviceUrl="";this._isRequestRunning=false;this._isLocked=false;this._senderId=null;this._from=null;this._commEntityTypeId=null;this._commEntityId=null;this._to=null;this._canUse=null;this._canSendMessage=null;this._manageUrl="";this._senders=[];this._fromList=[];this._toList=[];this._defaults={};this._communications=[];this._menu=null;this._isMenuShown=false;this._shownMenuId=null};BX.extend(BX.CrmTimelineSmsEditor,BX.CrmTimelineBaseEditor);BX.CrmTimelineSmsEditor.prototype.doInitialize=function(){this._serviceUrl=BX.util.remove_url_param(this.getSetting("serviceUrl",""),["sessid","site"]);var t=BX.prop.getObject(this._settings,"config",{});this._canUse=BX.prop.getBoolean(t,"canUse",false);this._canSendMessage=BX.prop.getBoolean(t,"canSendMessage",false);this._manageUrl=BX.prop.getString(t,"manageUrl","");this._senders=BX.prop.getArray(t,"senders",[]);this._defaults=BX.prop.getObject(t,"defaults",{senderId:null,from:null});this._communications=BX.prop.getArray(t,"communications",[]);this._senderSelectorNode=this._container.querySelector('[data-role="sender-selector"]');this._fromContainerNode=this._container.querySelector('[data-role="from-container"]');this._fromSelectorNode=this._container.querySelector('[data-role="from-selector"]');this._clientContainerNode=this._container.querySelector('[data-role="client-container"]');this._clientSelectorNode=this._container.querySelector('[data-role="client-selector"]');this._toSelectorNode=this._container.querySelector('[data-role="to-selector"]');this._messageLengthCounterNode=this._container.querySelector('[data-role="message-length-counter"]');if(this._canUse&&this._canSendMessage){this.initSenderSelector();this.initFromSelector();this.initClientContainer();this.initClientSelector();this.initToSelector();this.initMessageLengthCounter()}};BX.CrmTimelineSmsEditor.prototype.initSenderSelector=function(){var t=this._defaults.senderId;var e=this._senders[0].canUse?this._senders[0]:null;var i=null;var r=[];var n=this.onSenderSelectorClick.bind(this);for(var s=0;s<this._senders.length;++s){if(this._senders[s].canUse&&(this._senders[s].id===t||!e)){e=this._senders[s]}if(this._senders[s].id==="rest"){i=this._senders[s];continue}r.push({text:this._senders[s].name,sender:this._senders[s],onclick:n,className:!this._senders[s].canUse||!this._senders[s].fromList.length?"crm-timeline-popup-menu-item-disabled menu-popup-no-icon":""})}if(i){if(i.fromList.length>0){r.push({delimiter:true});for(s=0;s<i.fromList.length;++s){r.push({text:i.fromList[s].name,sender:i,from:i.fromList[s],onclick:n})}}r.push({delimiter:true},{text:BX.message("CRM_TIMELINE_SMS_REST_MARKETPLACE"),href:"/marketplace/category/crm_robot_sms/",target:"_blank"})}if(e){this.setSender(e)}BX.bind(this._senderSelectorNode,"click",this.openMenu.bind(this,"sender",this._senderSelectorNode,r))};BX.CrmTimelineSmsEditor.prototype.onSenderSelectorClick=function(t,e){if(e.sender){if(!e.sender.canUse||!e.sender.fromList.length){window.open(e.sender.manageUrl);return}this.setSender(e.sender,true);var i=e.from?e.from:e.sender.fromList[0];this.setFrom(i,true)}this._menu.close()};BX.CrmTimelineSmsEditor.prototype.setSender=function(t,e){this._senderId=t.id;this._fromList=t.fromList;this._senderSelectorNode.textContent=t.shortName?t.shortName:t.name;var i=t.id==="rest"?"hide":"show";BX[i](this._fromContainerNode);if(e){BX.userOptions.save("crm","sms_manager_editor","senderId",this._senderId)}};BX.CrmTimelineSmsEditor.prototype.initFromSelector=function(){if(this._fromList.length>0){var t=this._defaults.from||this._fromList[0].id;var e=null;for(var i=0;i<this._fromList.length;++i){if(this._fromList[i].id===t||!e){e=this._fromList[i]}}if(e){this.setFrom(e)}}BX.bind(this._fromSelectorNode,"click",this.onFromSelectorClick.bind(this))};BX.CrmTimelineSmsEditor.prototype.onFromSelectorClick=function(t){var e=[];var i=this.onFromSelectorItemClick.bind(this);for(var r=0;r<this._fromList.length;++r){e.push({text:this._fromList[r].name,from:this._fromList[r],onclick:i})}this.openMenu("from_"+this._senderId,this._fromSelectorNode,e,t)};BX.CrmTimelineSmsEditor.prototype.onFromSelectorItemClick=function(t,e){if(e.from){this.setFrom(e.from,true)}this._menu.close()};BX.CrmTimelineSmsEditor.prototype.setFrom=function(t,e){this._from=t.id;if(this._senderId==="rest"){this._senderSelectorNode.textContent=t.name}else{this._fromSelectorNode.textContent=t.name}if(e){BX.userOptions.save("crm","sms_manager_editor","from",this._from)}};BX.CrmTimelineSmsEditor.prototype.initClientContainer=function(){if(this._communications.length===0){BX.hide(this._clientContainerNode)}};BX.CrmTimelineSmsEditor.prototype.initClientSelector=function(){var t=[];var e=this.onClientSelectorClick.bind(this);for(var i=0;i<this._communications.length;++i){t.push({text:this._communications[i].caption,client:this._communications[i],onclick:e});if(i===0){this.setClient(this._communications[i])}}BX.bind(this._clientSelectorNode,"click",this.openMenu.bind(this,"comm",this._clientSelectorNode,t))};BX.CrmTimelineSmsEditor.prototype.onClientSelectorClick=function(t,e){if(e.client){this.setClient(e.client)}this._menu.close()};BX.CrmTimelineSmsEditor.prototype.setClient=function(t){this._commEntityTypeId=t.entityTypeId;this._commEntityId=t.entityId;this._clientSelectorNode.textContent=t.caption;this._toList=t.phones;this.setTo(t.phones[0])};BX.CrmTimelineSmsEditor.prototype.initToSelector=function(){BX.bind(this._toSelectorNode,"click",this.onToSelectorClick.bind(this))};BX.CrmTimelineSmsEditor.prototype.onToSelectorClick=function(t){var e=[];var i=this.onToSelectorItemClick.bind(this);for(var r=0;r<this._toList.length;++r){e.push({text:this._toList[r].valueFormatted||this._toList[r].value,to:this._toList[r],onclick:i})}this.openMenu("to_"+this._commEntityTypeId+"_"+this._commEntityId,this._toSelectorNode,e,t)};BX.CrmTimelineSmsEditor.prototype.onToSelectorItemClick=function(t,e){if(e.to){this.setTo(e.to)}this._menu.close()};BX.CrmTimelineSmsEditor.prototype.setTo=function(t){this._to=t.value;this._toSelectorNode.textContent=t.valueFormatted||t.value};BX.CrmTimelineSmsEditor.prototype.openMenu=function(t,e,i,r){if(this._shownMenuId===t){return}if(this._shownMenuId!==null&&this._menu){this._menu.close();this._shownMenuId=null}BX.PopupMenu.show(this._id+t,e,i,{offsetTop:0,offsetLeft:36,angle:{position:"top",offset:0},events:{onPopupClose:BX.delegate(this.onMenuClose,this)}});this._menu=BX.PopupMenu.currentItem;r.preventDefault()};BX.CrmTimelineSmsEditor.prototype.onMenuClose=function(){this._shownMenuId=null;this._menu=null};BX.CrmTimelineSmsEditor.prototype.initMessageLengthCounter=function(){this._messageLengthMax=parseInt(this._messageLengthCounterNode.getAttribute("data-length-max"));BX.bind(this._input,"keyup",this.setMessageLengthCounter.bind(this))};BX.CrmTimelineSmsEditor.prototype.setMessageLengthCounter=function(){var t=this._input.value.length;this._messageLengthCounterNode.textContent=t;var e=t>=this._messageLengthMax?"addClass":"removeClass";BX[e](this._messageLengthCounterNode,"crm-entity-stream-content-sms-symbol-counter-number-overhead")};BX.CrmTimelineSmsEditor.prototype.save=function(){var t=this._input.value;if(t===""){return}if(!this._communications.length){alert(BX.message("CRM_TIMELINE_SMS_ERROR_NO_COMMUNICATIONS"));return}if(this._isRequestRunning||this._isLocked){return}this._isRequestRunning=this._isLocked=true;BX.ajax({url:BX.util.add_url_param(this._serviceUrl,{action:"save_sms_message",sender:this._senderId}),method:"POST",dataType:"json",data:{site:BX.message("SITE_ID"),sessid:BX.bitrix_sessid(),ACTION:"SAVE_SMS_MESSAGE",SENDER_ID:this._senderId,MESSAGE_FROM:this._from,MESSAGE_TO:this._to,MESSAGE_BODY:t,OWNER_TYPE_ID:this._ownerTypeId,OWNER_ID:this._ownerId,TO_ENTITY_TYPE_ID:this._commEntityTypeId,TO_ENTITY_ID:this._commEntityId},onsuccess:BX.delegate(this.onSaveSuccess,this),onfailure:BX.delegate(this.onSaveFailure,this)})};BX.CrmTimelineSmsEditor.prototype.cancel=function(){this._input.value="";this.setMessageLengthCounter();this._input.style.minHeight="";this.release()};BX.CrmTimelineSmsEditor.prototype.onSaveSuccess=function(t){this._isRequestRunning=this._isLocked=false;var e=BX.prop.getString(t,"ERROR","");if(e!==""){alert(e);return}this._input.value="";this.setMessageLengthCounter();this._input.style.minHeight="";this._manager.processEditingCompletion(this);this.release()};BX.CrmTimelineSmsEditor.prototype.onSaveFailure=function(){this._isRequestRunning=this._isLocked=false};BX.CrmTimelineSmsEditor.items={};BX.CrmTimelineSmsEditor.create=function(t,e){var i=new BX.CrmTimelineSmsEditor;i.initialize(t,e);this.items[i.getId()]=i;return i}}if(typeof BX.CrmTimelineRestEditor==="undefined"){BX.CrmTimelineRestEditor=function(){BX.CrmTimelineRestEditor.superclass.constructor.apply(this);this._interfaceInitialized=false};BX.extend(BX.CrmTimelineRestEditor,BX.CrmTimelineBaseEditor);BX.CrmTimelineRestEditor.prototype.action=function(t){if(!this._interfaceInitialized){this._interfaceInitialized=true;this.initializeInterface()}var e=t.replace("activity_rest_","");var i=e.split("_");BX.rest.AppLayout.openApplication(i[0],{ID:this._ownerId},{PLACEMENT:this.getSetting("placement",""),PLACEMENT_ID:i[1]})};BX.CrmTimelineRestEditor.prototype.initializeInterface=function(){if(!!top.BX.rest&&!!top.BX.rest.AppLayout){var t=this._manager._ownerTypeId,e=this._manager._ownerId;var i=top.BX.rest.AppLayout.initializePlacement(this.getSetting("placement",""));i.prototype.reloadData=function(i,r){BX.Crm.EntityEvent.fireUpdate(t,e,"");r()}}};BX.CrmTimelineRestEditor.items={};BX.CrmTimelineRestEditor.create=function(t,e){var i=new BX.CrmTimelineRestEditor;i.initialize(t,e);this.items[i.getId()]=i;return i}}if(typeof BX.CrmTimelineWaitConfigurationDialog==="undefined"){BX.CrmTimelineWaitConfigurationDialog=function(){this._id="";this._settings={};this._type=BX.CrmTimelineWaitType.undefined;this._duration=0;this._target="";this._targetDates=null;this._container=null;this._durationMeasureNode=null;this._durationInput=null;this._targetDateNode=null;this._popup=null};BX.CrmTimelineWaitConfigurationDialog.prototype={initialize:function(t,e){this._id=BX.type.isNotEmptyString(t)?t:BX.util.getRandomString(4);this._settings=e?e:{};this._type=BX.prop.getInteger(this._settings,"type",BX.CrmTimelineWaitType.after);this._duration=BX.prop.getInteger(this._settings,"duration",1);this._target=BX.prop.getString(this._settings,"target","");this._targetDates=BX.prop.getArray(this._settings,"targetDates",[]);this._menuId=this._id+"_target_date_sel"},getId:function(){return this._id},getType:function(){return this._type},setType:function(t){this._type=t},getDuration:function(){return this._duration},setDuration:function(t){this._duration=t},getTarget:function(){return this._target},setTarget:function(t){this._target=t},getMessage:function(t){var e=BX.CrmTimelineWaitConfigurationDialog.messages;return e.hasOwnProperty(t)?e[t]:t},getDurationText:function(t,e){return BX.CrmTimelineWaitHelper.getDurationText(t,e)},getTargetDateCaption:function(t){for(var e=0,i=this._targetDates.length;e<i;e++){var r=this._targetDates[e];if(r["name"]===t){return r["caption"]}}return""},open:function(){this._popup=new BX.PopupWindow(this._id,this._configSelector,{autoHide:true,draggable:false,bindOptions:{forceBindPosition:false},closeByEsc:true,zIndex:0,content:this.prepareDialogContent(),events:{onPopupShow:BX.delegate(this.onPopupShow,this),onPopupClose:BX.delegate(this.onPopupClose,this),onPopupDestroy:BX.delegate(this.onPopupDestroy,this)},buttons:[new BX.PopupWindowButton({text:this.getMessage("select"),className:"popup-window-button-accept",events:{click:BX.delegate(this.onSaveButtonClick,this)}}),new BX.PopupWindowButtonLink({text:BX.message("JS_CORE_WINDOW_CANCEL"),events:{click:BX.delegate(this.onCancelButtonClick,this)}})]});this._popup.show()},close:function(){if(this._popup){this._popup.close()}},prepareDialogContent:function(){var t=BX.create("div",{attrs:{className:"crm-wait-popup-select-block"}});var e=BX.create("div",{attrs:{className:"crm-wait-popup-select-wrapper"}});t.appendChild(e);this._durationInput=BX.create("input",{attrs:{type:"text",className:"crm-wait-popup-settings-input",value:this._duration},events:{keyup:BX.delegate(this.onDurationChange,this)}});this._durationMeasureNode=BX.create("span",{attrs:{className:"crm-wait-popup-settings-title"},text:this.getDurationText(this._duration,false)});if(this._type===BX.CrmTimelineWaitType.after){e.appendChild(BX.create("span",{attrs:{className:"crm-wait-popup-settings-title"},text:this.getMessage("prefixTypeAfter")}));e.appendChild(this._durationInput);e.appendChild(this._durationMeasureNode)}else{e.appendChild(BX.create("span",{attrs:{className:"crm-wait-popup-settings-title"},text:this.getMessage("prefixTypeBefore")}));e.appendChild(this._durationInput);e.appendChild(this._durationMeasureNode);e.appendChild(BX.create("span",{attrs:{className:"crm-wait-popup-settings-title"},text:" "+this.getMessage("targetPrefixTypeBefore")}));this._targetDateNode=BX.create("span",{attrs:{className:"crm-automation-popup-settings-link"},text:this.getTargetDateCaption(this._target),events:{click:BX.delegate(this.toggleTargetMenu,this)}});e.appendChild(this._targetDateNode)}return t},onDurationChange:function(){var t=parseInt(this._durationInput.value);if(isNaN(t)||t<=0){t=1}this._duration=t;this._durationMeasureNode.innerHTML=BX.util.htmlspecialchars(this.getDurationText(t,false))},toggleTargetMenu:function(){if(this.isTargetMenuOpened()){this.closeTargetMenu()}else{this.openTargetMenu()}},isTargetMenuOpened:function(){return!!BX.PopupMenu.getMenuById(this._menuId)},openTargetMenu:function(){var t=[];for(var e=0,i=this._targetDates.length;e<i;e++){var r=this._targetDates[e];t.push({text:r["caption"],title:r["caption"],value:r["name"],onclick:BX.delegate(this.onTargetSelect,this)})}BX.PopupMenu.show(this._menuId,this._targetDateNode,t,{zIndex:200,autoHide:true,offsetLeft:BX.pos(this._targetDateNode)["width"]/2,angle:{position:"top",offset:0}})},closeTargetMenu:function(){BX.PopupMenu.destroy(this._menuId)},onPopupShow:function(t,e){},onPopupClose:function(){if(this._popup){this._popup.destroy()}this.closeTargetMenu()},onPopupDestroy:function(){if(this._popup){this._popup=null}},onSaveButtonClick:function(t){var e=BX.prop.getFunction(this._settings,"onSave",null);if(!e){return}var i={type:this._type};i["duration"]=this._duration;i["target"]=this._type===BX.CrmTimelineWaitType.before?this._target:"";e(this,i)},onCancelButtonClick:function(t){var e=BX.prop.getFunction(this._settings,"onCancel",null);if(e){e(this)}},onTargetSelect:function(t,e){var i=BX.prop.getString(e,"value","");if(i!==""){this._target=i;this._targetDateNode.innerHTML=BX.util.htmlspecialchars(this.getTargetDateCaption(i))}this.closeTargetMenu();t.preventDefault?t.preventDefault():t.returnValue=false}};if(typeof BX.CrmTimelineWaitConfigurationDialog.messages==="undefined"){BX.CrmTimelineWaitConfigurationDialog.messages={}}BX.CrmTimelineWaitConfigurationDialog.create=function(t,e){var i=new BX.CrmTimelineWaitConfigurationDialog;i.initialize(t,e);return i}}if(typeof BX.CrmTimelineType==="undefined"){BX.CrmTimelineType={undefined:0,activity:1,creation:2,modification:3,link:4,mark:6,comment:7,wait:8,bizproc:9,conversion:10,sender:11}}if(typeof BX.CrmTimelineAction==="undefined"){BX.CrmTimelineAction=function(){this._id="";this._settings={};this._container=null};BX.CrmTimelineAction.prototype={initialize:function(t,e){this._id=BX.type.isNotEmptyString(t)?t:BX.util.getRandomString(4);this._settings=e?e:{};this._container=this.getSetting("container");if(!BX.type.isElementNode(this._container)){throw"BX.CrmTimelineAction: Could not find container."}this.doInitialize()},doInitialize:function(){},getId:function(){return this._id},getSetting:function(t,e){return this._settings.hasOwnProperty(t)?this._settings[t]:e},layout:function(){this.doLayout()},doLayout:function(){}}}if(typeof BX.CrmTimelineActivityAction==="undefined"){BX.CrmTimelineActivityAction=function(){BX.CrmTimelineActivityAction.superclass.constructor.apply(this);this._activityEditor=null;this._entityData=null;this._item=null;this._isEnabled=true};BX.extend(BX.CrmTimelineActivityAction,BX.CrmTimelineAction);BX.CrmTimelineActivityAction.prototype.doInitialize=function(){this._entityData=this.getSetting("entityData");if(!BX.type.isPlainObject(this._entityData)){throw"BX.CrmTimelineActivityAction. A required parameter 'entityData' is missing."}this._activityEditor=this.getSetting("activityEditor");if(!(this._activityEditor instanceof BX.CrmActivityEditor)){throw"BX.CrmTimelineActivityAction. A required parameter 'activityEditor' is missing."}this._item=this.getSetting("item");this._isEnabled=this.getSetting("enabled",true)};BX.CrmTimelineActivityAction.prototype.getActivityId=function(){return BX.prop.getInteger(this._entityData,"ID",0)};BX.CrmTimelineActivityAction.prototype.loadActivityCommunications=function(t){this._activityEditor.getActivityCommunications(this.getActivityId(),function(e){if(BX.type.isFunction(t)){t(e)}},true)};BX.CrmTimelineActivityAction.prototype.getItemData=function(){return this._item?this._item.getData():null}}if(typeof BX.CrmTimelineEmailAction==="undefined"){BX.CrmTimelineEmailAction=function(){BX.CrmTimelineEmailAction.superclass.constructor.apply(this);this._clickHandler=BX.delegate(this.onClick,this);this._saveHandler=BX.delegate(this.onSave,this)};BX.extend(BX.CrmTimelineEmailAction,BX.CrmTimelineActivityAction);BX.CrmTimelineEmailAction.prototype.onClick=function(t){var e={ownerType:BX.CrmEntityType.resolveName(BX.prop.getInteger(this._entityData,"OWNER_TYPE_ID",0)),ownerID:BX.prop.getInteger(this._entityData,"OWNER_ID",0),ownerUrl:BX.prop.getString(this._entityData,"OWNER_URL",""),ownerTitle:BX.prop.getString(this._entityData,"OWNER_TITLE",""),subject:BX.prop.getString(this._entityData,"SUBJECT",""),descriptionBBCode:BX.prop.getString(this._entityData,"DESCRIPTION_BBCODE",""),description:BX.prop.getString(this._entityData,"DESCRIPTION_RAW",""),originalMessageID:BX.prop.getInteger(this._entityData,"ID",0),messageType:"RE"};if(BX.CrmActivityProvider&&top.BX.Bitrix24&&top.BX.Bitrix24.Slider){var i=this._activityEditor.addEmail(e);i.addOnSave(this._saveHandler)}else{this.loadActivityCommunications(BX.delegate(function(t){e["communications"]=BX.type.isArray(t)?t:[];e["communicationsLoaded"]=true;BX.CrmActivityEmail.prepareReply(e);var i=this._activityEditor.addEmail(e);i.addOnSave(this._saveHandler)},this))}return BX.PreventDefault(t)};BX.CrmTimelineEmailAction.prototype.onSave=function(t,e){if(BX.type.isFunction(this._item.onActivityCreate)){this._item.onActivityCreate(t,e)}}}if(typeof BX.CrmTimelineCallAction==="undefined"){BX.CrmTimelineCallAction=function(){BX.CrmTimelineCallAction.superclass.constructor.apply(this);this._clickHandler=BX.delegate(this.onClick,this);this._menu=null;this._isMenuShown=false;this._menuItems=null};BX.extend(BX.CrmTimelineCallAction,BX.CrmTimelineActivityAction);BX.CrmTimelineCallAction.prototype.getButton=function(){return null};BX.CrmTimelineCallAction.prototype.onClick=function(t){if(typeof window.top["BXIM"]==="undefined"){window.alert(this.getMessage("telephonyNotSupported"));return}var e="";var i=BX.prop.getObject(this._entityData,"COMMUNICATION",null);var r=this.getItemData();var n=BX.prop.getArray(r,"PHONE",[]);if(i){if(BX.prop.getString(i,"TYPE")==="PHONE"){e=BX.prop.getString(i,"VALUE")}}if(e===""){if(n.length===1){this.addCall(n[0]["VALUE"])}else if(n.length>1){this.showMenu()}}else{this.addCall(e)}return BX.PreventDefault(t)};BX.CrmTimelineCallAction.prototype.showMenu=function(){if(this._isMenuShown){return}this.prepareMenuItems();if(!this._menuItems||this._menuItems.length===0){return}this._menu=new BX.PopupMenuWindow(this._id,this._container,this._menuItems,{offsetTop:0,offsetLeft:16,events:{onPopupShow:BX.delegate(this.onMenuShow,this),onPopupClose:BX.delegate(this.onMenuClose,this),onPopupDestroy:BX.delegate(this.onMenuDestroy,this)}});this._menu.popupWindow.show()};BX.CrmTimelineCallAction.prototype.closeMenu=function(){if(!this._isMenuShown){return}if(this._menu){this._menu.close()}};BX.CrmTimelineCallAction.prototype.prepareMenuItems=function(){if(this._menuItems){return}var t=this.getItemData();var e=BX.prop.getArray(t,"PHONE",[]);var i=BX.delegate(this.onMenuItemClick,this);this._menuItems=[];if(e.length===0){return}for(var r=0,n=e.length;r<n;r++){var s=BX.prop.getString(e[r],"VALUE");var a=BX.prop.getString(e[r],"VALUE_FORMATTED");var o=BX.prop.getString(e[r],"COMPLEX_NAME");var c=(o?o+": ":"")+(a?a:s);if(s!==""){this._menuItems.push({id:s,text:c,onclick:i})}}};BX.CrmTimelineCallAction.prototype.onMenuItemClick=function(t,e){this.closeMenu();this.addCall(e.id)};BX.CrmTimelineCallAction.prototype.onMenuShow=function(){this._isMenuShown=true};BX.CrmTimelineCallAction.prototype.onMenuClose=function(){this._isMenuShown=false;this._menu.popupWindow.destroy()};BX.CrmTimelineCallAction.prototype.onMenuDestroy=function(){this._menu=null};BX.CrmTimelineCallAction.prototype.addCall=function(t){var e=BX.prop.getObject(this._entityData,"COMMUNICATION",null);var i=parseInt(BX.prop.getString(e,"ENTITY_TYPE_ID","0"));if(isNaN(i)){i=0}var r=parseInt(BX.prop.getString(e,"ENTITY_ID","0"));if(isNaN(r)){r=0}var n=0;var s=0;var a=BX.prop.getObject(this._settings,"ownerInfo");if(a){n=BX.prop.getInteger(a,"ENTITY_TYPE_ID",0);s=BX.prop.getInteger(a,"ENTITY_ID",0)}if(n<=0||s<=0){n=BX.prop.getInteger(this._entityData,"OWNER_TYPE_ID",0);s=BX.prop.getInteger(this._entityData,"OWNER_ID","0")}if(n<=0||s<=0){n=i;s=r}var o=parseInt(BX.prop.getString(this._entityData,"ID","0"));if(isNaN(o)){o=0}var c={ENTITY_TYPE_NAME:BX.CrmEntityType.resolveName(i),ENTITY_ID:r,AUTO_FOLD:true};if(n!==i||s!==r){c["BINDINGS"]=[{OWNER_TYPE_NAME:BX.CrmEntityType.resolveName(n),OWNER_ID:s}]}if(o>0){c["SRC_ACTIVITY_ID"]=o}window.top["BXIM"].phoneTo(t,c)};BX.CrmTimelineCallAction.prototype.getMessage=function(t){var e=BX.CrmTimelineCallAction.messages;return e.hasOwnProperty(t)?e[t]:t};if(typeof BX.CrmTimelineCallAction.messages==="undefined"){BX.CrmTimelineCallAction.messages={}}}if(typeof BX.CrmTimelineOpenLineAction==="undefined"){BX.CrmTimelineOpenLineAction=function(){BX.CrmTimelineOpenLineAction.superclass.constructor.apply(this);this._clickHandler=BX.delegate(this.onClick,this);this._button=null};BX.extend(BX.CrmTimelineOpenLineAction,BX.CrmTimelineActivityAction);BX.CrmTimelineOpenLineAction.prototype.getButton=function(){return this._button};BX.CrmTimelineOpenLineAction.prototype.onClick=function(){if(typeof window.top["BXIM"]==="undefined"){window.alert(this.getMessage("openLineNotSupported"));return}var t="";var e=BX.prop.getObject(this._entityData,"COMMUNICATION",null);if(e){if(BX.prop.getString(e,"TYPE")==="IM"){t=BX.prop.getString(e,"VALUE")}}if(t!==""){window.top["BXIM"].openMessenger(t)}};BX.CrmTimelineOpenLineAction.prototype.doLayout=function(){this._button=BX.create("DIV",{attrs:{className:"crm-entity-stream-content-action-reply-btn"},events:{click:this._clickHandler}});this._container.appendChild(this._button)};BX.CrmTimelineOpenLineAction.prototype.getMessage=function(t){var e=BX.CrmTimelineOpenLineAction.messages;return e.hasOwnProperty(t)?e[t]:t};if(typeof BX.CrmTimelineOpenLineAction.messages==="undefined"){BX.CrmTimelineOpenLineAction.messages={}}}if(typeof BX.CrmHistoryEmailAction==="undefined"){BX.CrmHistoryEmailAction=function(){BX.CrmHistoryEmailAction.superclass.constructor.apply(this)};BX.extend(BX.CrmHistoryEmailAction,BX.CrmTimelineEmailAction);BX.CrmHistoryEmailAction.prototype.doLayout=function(){this._container.appendChild(BX.create("A",{attrs:{className:"crm-entity-stream-content-action-reply-btn"},events:{click:this._clickHandler}}))};BX.CrmHistoryEmailAction.create=function(t,e){var i=new BX.CrmHistoryEmailAction;i.initialize(t,e);return i}}if(typeof BX.CrmHistoryCallAction==="undefined"){BX.CrmHistoryCallAction=function(){BX.CrmHistoryCallAction.superclass.constructor.apply(this);this._button=null};BX.extend(BX.CrmHistoryCallAction,BX.CrmTimelineCallAction);BX.CrmHistoryCallAction.prototype.getButton=function(){return this._button};BX.CrmHistoryCallAction.prototype.doLayout=function(){this._button=BX.create("A",{attrs:{className:"crm-entity-stream-content-action-reply-btn"},events:{click:this._clickHandler}});this._container.appendChild(this._button)};BX.CrmHistoryCallAction.create=function(t,e){var i=new BX.CrmHistoryCallAction;i.initialize(t,e);return i}}if(typeof BX.CrmHistoryOpenLineAction==="undefined"){BX.CrmHistoryOpenLineAction=function(){BX.CrmHistoryOpenLineAction.superclass.constructor.apply(this)};BX.extend(BX.CrmHistoryOpenLineAction,BX.CrmTimelineOpenLineAction);BX.CrmHistoryOpenLineAction.create=function(t,e){var i=new BX.CrmHistoryOpenLineAction;i.initialize(t,e);return i}}if(typeof BX.CrmScheduleEmailAction==="undefined"){BX.CrmScheduleEmailAction=function(){BX.CrmScheduleEmailAction.superclass.constructor.apply(this)};BX.extend(BX.CrmScheduleEmailAction,BX.CrmTimelineEmailAction);BX.CrmScheduleEmailAction.prototype.doLayout=function(){this._container.appendChild(BX.create("DIV",{attrs:{className:"crm-entity-stream-content-action-reply-btn"},events:{click:this._clickHandler}}))};BX.CrmScheduleEmailAction.create=function(t,e){var i=new BX.CrmScheduleEmailAction;i.initialize(t,e);return i}}if(typeof BX.CrmSchedulePostponeController==="undefined"){BX.CrmSchedulePostponeController=function(){this._item=null};BX.CrmSchedulePostponeController.prototype={initialize:function(t,e){this._id=BX.type.isNotEmptyString(t)?t:BX.util.getRandomString(4);this._settings=e?e:{};this._item=BX.prop.get(this._settings,"item",null)},getTitle:function(){return this.getMessage("title")},getCommandList:function(){return[{name:"postpone_hour_1",title:this.getMessage("forOneHour")},{name:"postpone_hour_2",title:this.getMessage("forTwoHours")},{name:"postpone_hour_3",title:this.getMessage("forThreeHours")},{name:"postpone_day_1",title:this.getMessage("forOneDay")},{name:"postpone_day_2",title:this.getMessage("forTwoDays")},{name:"postpone_day_3",title:this.getMessage("forThreeDays")}]},processCommand:function(t){if(t.indexOf("postpone")!==0){return false}var e=0;if(t==="postpone_hour_1"){e=3600}else if(t==="postpone_hour_2"){e=7200}else if(t==="postpone_hour_3"){e=10800}else if(t==="postpone_day_1"){e=86400}else if(t==="postpone_day_2"){e=172800}else if(t==="postpone_day_3"){e=259200}if(e>0&&this._item){this._item.postpone(e)}return true},getMessage:function(t){var e=BX.CrmSchedulePostponeController.messages;return e.hasOwnProperty(t)?e[t]:t}};if(typeof BX.CrmSchedulePostponeController.messages==="undefined"){BX.CrmSchedulePostponeController.messages={}}BX.CrmSchedulePostponeController.create=function(t,e){var i=new BX.CrmSchedulePostponeController;i.initialize(t,e);return i}}if(typeof BX.CrmSchedulePostponeAction==="undefined"){BX.CrmSchedulePostponeAction=function(){BX.CrmSchedulePostponeAction.superclass.constructor.apply(this);this._button=null;this._clickHandler=BX.delegate(this.onClick,this);this._isMenuShown=false;this._menu=false};BX.extend(BX.CrmSchedulePostponeAction,BX.CrmTimelineActivityAction);BX.CrmSchedulePostponeAction.prototype.doLayout=function(){this._button=BX.create("DIV",{attrs:{className:this._isEnabled?"crm-entity-stream-planned-action-aside":"crm-entity-stream-planned-action-aside-disabled"},text:this.getMessage("postpone")});if(this._isEnabled){BX.bind(this._button,"click",this._clickHandler)}this._container.appendChild(this._button)};BX.CrmSchedulePostponeAction.prototype.openMenu=function(){if(this._isMenuShown){return}var t=BX.delegate(this.onMenuItemClick,this);var e=[{id:"hour_1",text:this.getMessage("forOneHour"),onclick:t},{id:"hour_2",text:this.getMessage("forTwoHours"),onclick:t},{id:"hour_3",text:this.getMessage("forThreeHours"),onclick:t},{id:"day_1",text:this.getMessage("forOneDay"),onclick:t},{id:"day_2",text:this.getMessage("forTwoDays"),onclick:t},{id:"day_3",text:this.getMessage("forThreeDays"),onclick:t}];BX.PopupMenu.show(this._id,this._button,e,{offsetTop:0,offsetLeft:16,events:{onPopupShow:BX.delegate(this.onMenuShow,this),onPopupClose:BX.delegate(this.onMenuClose,this),onPopupDestroy:BX.delegate(this.onMenuDestroy,this)}});this._menu=BX.PopupMenu.currentItem};BX.CrmSchedulePostponeAction.prototype.closeMenu=function(){if(!this._isMenuShown){return}if(this._menu){this._menu.close()}};BX.CrmSchedulePostponeAction.prototype.onClick=function(){if(!this._isEnabled){return}if(this._isMenuShown){this.closeMenu()}else{this.openMenu()}};BX.CrmSchedulePostponeAction.prototype.onMenuItemClick=function(t,e){this.closeMenu();var i=0;if(e.id==="hour_1"){i=3600}else if(e.id==="hour_2"){i=7200}else if(e.id==="hour_3"){i=10800}else if(e.id==="day_1"){i=86400}else if(e.id==="day_2"){i=172800}else if(e.id==="day_3"){i=259200}if(i>0&&this._item){this._item.postpone(i)}};BX.CrmSchedulePostponeAction.prototype.onMenuShow=function(){this._isMenuShown=true};BX.CrmSchedulePostponeAction.prototype.onMenuClose=function(){if(this._menu&&this._menu.popupWindow){this._menu.popupWindow.destroy()}};BX.CrmSchedulePostponeAction.prototype.onMenuDestroy=function(){this._isMenuShown=false;this._menu=null;if(typeof BX.PopupMenu.Data[this._id]!=="undefined"){delete BX.PopupMenu.Data[this._id]}};BX.CrmSchedulePostponeAction.prototype.getMessage=function(t){var e=BX.CrmSchedulePostponeAction.messages;return e.hasOwnProperty(t)?e[t]:t};if(typeof BX.CrmSchedulePostponeAction.messages==="undefined"){BX.CrmSchedulePostponeAction.messages={}}BX.CrmSchedulePostponeAction.create=function(t,e){var i=new BX.CrmSchedulePostponeAction;i.initialize(t,e);return i}}if(typeof BX.CrmScheduleCallAction==="undefined"){BX.CrmScheduleCallAction=function(){BX.CrmScheduleCallAction.superclass.constructor.apply(this)};BX.extend(BX.CrmScheduleCallAction,BX.CrmTimelineCallAction);BX.CrmScheduleCallAction.prototype.doLayout=function(){this._container.appendChild(BX.create("DIV",{attrs:{className:"crm-entity-stream-content-action-reply-btn"},events:{click:this._clickHandler}}))};BX.CrmScheduleCallAction.create=function(t,e){var i=new BX.CrmScheduleCallAction;i.initialize(t,e);return i}}if(typeof BX.CrmScheduleOpenLineAction==="undefined"){BX.CrmScheduleOpenLineAction=function(){BX.CrmScheduleOpenLineAction.superclass.constructor.apply(this)};BX.extend(BX.CrmScheduleOpenLineAction,BX.CrmTimelineOpenLineAction);BX.CrmScheduleOpenLineAction.create=function(t,e){var i=new BX.CrmScheduleOpenLineAction;i.initialize(t,e);return i}}if(typeof BX.CrmTimelineItem==="undefined"){BX.CrmTimelineItem=function(){this._id="";this._settings={};this._data={};this._container=null;this._wrapper=null;this._typeCategoryId=null;this._associatedEntityData=null;this._associatedEntityTypeId=null;this._associatedEntityId=null;this._activityEditor=null;this._actions=[];this._actionContainer=null;this._isTerminated=false};BX.CrmTimelineItem.prototype={initialize:function(t,e){this._id=BX.type.isNotEmptyString(t)?t:BX.util.getRandomString(4);this._settings=e?e:{};this._container=this.getSetting("container");if(!BX.type.isPlainObject(e["data"])){throw"BX.CrmTimelineItem. A required parameter 'data' is missing."}this._data=e["data"];this._activityEditor=this.getSetting("activityEditor");if(!(this._activityEditor instanceof BX.CrmActivityEditor)){throw"BX.CrmTimelineItem. A required parameter 'activityEditor' is missing."}this.doInitialize()},doInitialize:function(){},getId:function(){return this._id},getSetting:function(t,e){return this._settings.hasOwnProperty(t)?this._settings[t]:e},getData:function(){return this._data},setData:function(t){if(BX.type.isPlainObject(t)){this._data=t;this.clearCachedData()}},getAssociatedEntityData:function(){if(this._associatedEntityData===null){this._associatedEntityData=BX.type.isPlainObject(this._data["ASSOCIATED_ENTITY"])?this._data["ASSOCIATED_ENTITY"]:{}}return this._associatedEntityData},getAssociatedEntityTypeId:function(){if(this._associatedEntityTypeId===null){this._associatedEntityTypeId=BX.prop.getInteger(this._data,"ASSOCIATED_ENTITY_TYPE_ID",0)}return this._associatedEntityTypeId},getAssociatedEntityId:function(){if(this._associatedEntityId===null){this._associatedEntityId=BX.prop.getInteger(this._data,"ASSOCIATED_ENTITY_ID",0)}return this._associatedEntityId},setAssociatedEntityData:function(t){if(!BX.type.isPlainObject(t)){t={}}this._data["ASSOCIATED_ENTITY"]=t;this.clearCachedData()},getTextDataParam:function(t){return BX.prop.getString(this._data,t,"")},getObjectDataParam:function(t){return BX.prop.getObject(this._data,t,{})},getArrayDataParam:function(t){return BX.prop.getArray(this._data,t,[])},getTypeId:function(){return BX.CrmTimelineType.undefined},getTypeCategoryId:function(){if(this._typeCategoryId===null){this._typeCategoryId=BX.prop.getInteger(this._data,"TYPE_CATEGORY_ID",0)}return this._typeCategoryId},getContainer:function(){return this._container},setContainer:function(t){this._container=BX.type.isElementNode(t)?t:null},getWrapper:function(){return this._wrapper},addWrapperClass:function(t,e){if(!this._wrapper){return}BX.addClass(this._wrapper,t);if(BX.type.isNumber(e)&&e>=0){window.setTimeout(BX.delegate(function(){this.removeWrapperClass(t)},this),e)}},removeWrapperClass:function(t,e){if(!this._wrapper){return}BX.removeClass(this._wrapper,t);if(BX.type.isNumber(e)&&e>=0){window.setTimeout(BX.delegate(function(){this.addWrapperClass(t)},this),e)}},layout:function(t){if(!BX.type.isElementNode(this._container)){throw"BX.CrmTimelineItem. Container is not assigned."}this.prepareLayout(t);this.prepareActions();var e=this._actions.length;for(var i=0;i<e;i++){this._actions[i].layout()}this.showActions(e>0)},prepareLayout:function(t){},prepareActions:function(){},showActions:function(t){},clearLayout:function(){this._wrapper=BX.remove(this._wrapper)},refreshLayout:function(){var t=this._wrapper.previousSibling;this._wrapper=BX.remove(this._wrapper);this.layout({anchor:t})},clearCachedData:function(){this._typeCategoryId=null;this._associatedEntityData=null;this._associatedEntityTypeId=null;this._associatedEntityId=null},isDone:function(){return false},markAsDone:function(t){},isTerminated:function(){return this._isTerminated},markAsTerminated:function(t){t=!!t;if(this._isTerminated===t){return}this._isTerminated=t;if(!this._wrapper){return}if(t){BX.addClass(this._wrapper,"crm-entity-stream-section-last")}else{BX.removeClass(this._wrapper,"crm-entity-stream-section-last")}},view:function(){},cutOffText:function(t,e){if(!BX.type.isNumber(e)){e=0}if(e<=0||t.length<=e){return t}var i=e-1;var r=t.substring(i).search(/\s/i);if(r>0){i+=r}return t.substring(0,i)},prepareCutOffElements:function(t,e,i){if(!BX.type.isNumber(e)){e=0}if(e<=0||t.length<=e){return[t]}var r=e-1;var n=t.substring(r).search(/\s/i);if(n>0){r+=n}return[t.substring(0,r)+"&hellip;&nbsp;",BX.create("A",{attrs:{className:"crm-entity-stream-content-letter-more",href:"#"},events:{click:i},text:this.getMessage("details")})]},prepareAuthorLayout:function(){var t=this.getObjectDataParam("AUTHOR",null);if(!t){return null}var e=BX.prop.getString(t,"SHOW_URL","");if(e===""){return null}var i=BX.create("A",{attrs:{className:"crm-entity-stream-content-detail-employee",href:e,target:"_blank",title:BX.prop.getString(t,"FORMATTED_NAME","")}});var r=BX.prop.getString(t,"IMAGE_URL","");if(r!==""){i.style.backgroundImage="url("+r+")";i.style.backgroundSize="21px"}return i},onActivityCreate:function(t,e){}};BX.CrmTimelineItem.userTimezoneOffset=null;BX.CrmTimelineItem.getUserTimezoneOffset=function(){if(!this.userTimezoneOffset){this.userTimezoneOffset=parseInt(BX.message("USER_TZ_OFFSET"));if(isNaN(this.userTimezoneOffset)){this.userTimezoneOffset=0}}return this.userTimezoneOffset};BX.CrmTimelineItem.prototype.getMessage=function(t){var e=BX.CrmTimelineItem.messages;return e.hasOwnProperty(t)?e[t]:t};if(typeof BX.CrmTimelineItem.messages==="undefined"){BX.CrmTimelineItem.messages={}}}if(typeof BX.CrmHistoryItem==="undefined"){BX.CrmHistoryItem=function(){BX.CrmHistoryItem.superclass.constructor.apply(this);this._history=null;this._typeId=null;this._createdTime=null;this._headerClickHandler=BX.delegate(this.onHeaderClick,this)};BX.extend(BX.CrmHistoryItem,BX.CrmTimelineItem);BX.CrmHistoryItem.prototype.doInitialize=function(){this._history=this.getSetting("history")};BX.CrmHistoryItem.prototype.getTypeId=function(){if(this._typeId===null){this._typeId=BX.prop.getInteger(this._data,"TYPE_ID",BX.CrmTimelineType.undefined)}return this._typeId};BX.CrmHistoryItem.prototype.getTitle=function(){return""};BX.CrmHistoryItem.prototype.getCreatedTimestamp=function(){return this.getTextDataParam("CREATED_SERVER")};BX.CrmHistoryItem.prototype.getCreatedTime=function(){if(this._createdTime===null){var t=BX.parseDate(this.getCreatedTimestamp(),false,"YYYY-MM-DD","YYYY-MM-DD HH:MI:SS");this._createdTime=new Date(t.getTime()+1e3*BX.CrmTimelineItem.getUserTimezoneOffset())}return this._createdTime};BX.CrmHistoryItem.prototype.getCreatedDate=function(){return BX.prop.extractDate(new Date(this.getCreatedTime().getTime()))};BX.CrmHistoryItem.prototype.getOwnerInfo=function(){return this._history?this._history.getOwnerInfo():null};BX.CrmHistoryItem.prototype.getOwnerTypeId=function(){return BX.prop.getInteger(this.getOwnerInfo(),"ENTITY_TYPE_ID",BX.CrmEntityType.enumeration.undefined)};BX.CrmHistoryItem.prototype.getOwnerId=function(){return BX.prop.getInteger(this.getOwnerInfo(),"ENTITY_ID",0)};BX.CrmHistoryItem.prototype.isReadOnly=function(){return this._history.isReadOnly()};BX.CrmHistoryItem.prototype.isDone=function(){var t=this.getTypeId();if(t===BX.CrmTimelineType.activity){var e=this.getAssociatedEntityData();return BX.CrmActivityStatus.isFinal(BX.prop.getInteger(e,"STATUS",0))}return false};BX.CrmHistoryItem.prototype.view=function(){};BX.CrmHistoryItem.prototype.getWrapperClassName=function(){return""};BX.CrmHistoryItem.prototype.getIconClassName=function(){return"crm-entity-stream-section-icon crm-entity-stream-section-icon-info"};BX.CrmHistoryItem.prototype.prepareContentDetails=function(){return[]};BX.CrmHistoryItem.prototype.prepareContent=function(){var t=this.getWrapperClassName();if(t!==""){t="crm-entity-stream-section crm-entity-stream-section-history"+" "+t}else{t="crm-entity-stream-section crm-entity-stream-section-history"}var e=BX.create("DIV",{attrs:{className:t}});e.appendChild(BX.create("DIV",{attrs:{className:this.getIconClassName()}}));var i=BX.create("DIV",{attrs:{className:"crm-entity-stream-content-event"}});e.appendChild(BX.create("DIV",{attrs:{className:"crm-entity-stream-section-content"},children:[i]}));var r=BX.create("DIV",{attrs:{className:"crm-entity-stream-content-header"},children:[BX.create("DIV",{attrs:{className:"crm-entity-stream-content-event-title"},children:[BX.create("A",{attrs:{href:"#"},events:{click:this._headerClickHandler},text:this.getTitle()})]}),BX.create("SPAN",{attrs:{className:"crm-entity-stream-content-event-time"},text:this.formatTime(this.getCreatedTime())})]});i.appendChild(r);i.appendChild(BX.create("DIV",{attrs:{className:"crm-entity-stream-content-detail"},children:this.prepareContentDetails()}));var n=this.prepareAuthorLayout();if(n){i.appendChild(n)}return e};BX.CrmHistoryItem.prototype.prepareLayout=function(t){this._wrapper=this.prepareContent();if(this._wrapper){var e=BX.type.isPlainObject(t)?BX.prop.getBoolean(t,"add",true):true;if(e){var i=BX.type.isPlainObject(t)&&BX.type.isElementNode(t["anchor"])?t["anchor"]:null;if(i&&i.nextSibling){this._container.insertBefore(this._wrapper,i.nextSibling)}else{this._container.appendChild(this._wrapper)}}this.markAsTerminated(this._history.checkItemForTermination(this))}};BX.CrmHistoryItem.prototype.onHeaderClick=function(t){this.view();t.preventDefault?t.preventDefault():t.returnValue=false};BX.CrmHistoryItem.prototype.prepareTitleLayout=function(){return BX.create("SPAN",{attrs:{className:"crm-entity-stream-content-event-title"},text:this.getTitle()})};BX.CrmHistoryItem.prototype.prepareHeaderLayout=function(){var t=BX.create("DIV",{attrs:{className:"crm-entity-stream-content-header"}});t.appendChild(this.prepareTitleLayout());t.appendChild(BX.create("SPAN",{attrs:{className:"crm-entity-stream-content-event-time"},text:this.formatTime(this.getCreatedTime())}));return t};BX.CrmHistoryItem.prototype.onActivityCreate=function(t,e){this._history.getManager().onActivityCreated(t,e)};BX.CrmHistoryItem.prototype.formatTime=function(t){return this._history.formatTime(t)};BX.CrmHistoryItem.create=function(t,e){var i=new BX.CrmHistoryItem;i.initialize(t,e);return i};BX.CrmHistoryItem.isCounterEnabled=function(t){if(!BX.type.isDate(t)){return false}var e=new Date;e.setHours(0);e.setMinutes(0);e.setSeconds(0);e.setMilliseconds(0);e=e.getTime();var i=new Date;i.setHours(23);i.setMinutes(59);i.setSeconds(59);i.setMilliseconds(999);i=i.getTime();var r=t.getTime();return r<e||r>=e&&r<=i}}if(typeof BX.CrmHistoryItemActivity==="undefined"){BX.CrmHistoryItemActivity=function(){BX.CrmHistoryItemActivity.superclass.constructor.apply(this)};BX.extend(BX.CrmHistoryItemActivity,BX.CrmHistoryItem);BX.CrmHistoryItemActivity.prototype.getTitle=function(){return BX.prop.getString(this.getAssociatedEntityData(),"SUBJECT","")};BX.CrmHistoryItemActivity.prototype.getTypeDescription=function(){var t=this.getAssociatedEntityData();var e=BX.prop.getInteger(t,"DIRECTION",0);var i=this.getTypeCategoryId();if(i===BX.CrmActivityType.email){return this.getMessage(e===BX.CrmActivityDirection.incoming?"incomingEmail":"outgoingEmail")}else if(i===BX.CrmActivityType.call){return this.getMessage(e===BX.CrmActivityDirection.incoming?"incomingCall":"outgoingCall")}else if(i===BX.CrmActivityType.meeting){return this.getMessage("meeting")}else if(i===BX.CrmActivityType.task){return this.getMessage("task")}else if(i===BX.CrmActivityType.provider){var r=BX.prop.getString(t,"PROVIDER_ID","");if(r==="CRM_WEBFORM"){return this.getMessage("webform")}else if(r==="CRM_SMS"){return this.getMessage("sms")}else if(r==="CRM_REQUEST"){return this.getMessage("activityRequest")}else if(r==="IMOPENLINES_SESSION"){return this.getMessage("openLine")}else if(r==="REST_APP"){return this.getMessage("restApplication")}else if(r==="VISIT_TRACKER"){return this.getMessage("visit")}}return""};BX.CrmHistoryItemActivity.prototype.prepareTitleLayout=function(){return BX.create("A",{attrs:{href:"#",className:"crm-entity-stream-content-event-title"},events:{click:this._headerClickHandler},text:this.getTypeDescription()})};BX.CrmHistoryItemActivity.prototype.prepareTimeLayout=function(){return BX.create("SPAN",{attrs:{className:"crm-entity-stream-content-event-time"},text:this.formatTime(this.getCreatedTime())})};BX.CrmHistoryItemActivity.prototype.prepareMarkLayout=function(){var t=this.getAssociatedEntityData();var e=BX.prop.getInteger(t,"MARK_TYPE_ID",0);if(e<=0){return null}var i="";if(e===2){i="SuccessMark"}else if(e===3){i="RenewMark"}if(i===""){return null}var r="";var n=this.getTypeCategoryId();if(n===BX.CrmActivityType.email){r=this.getMessage("email"+i)}else if(n===BX.CrmActivityType.call){r=this.getMessage("call"+i)}else if(n===BX.CrmActivityType.meeting){r=this.getMessage("meeting"+i)}else if(n===BX.CrmActivityType.task){r=this.getMessage("task"+i)}if(r===""){return null}return BX.create("SPAN",{props:{className:"crm-entity-stream-content-event-skipped"},text:r})};BX.CrmHistoryItemActivity.prototype.prepareActions=function(){if(this.isReadOnly()){return}var t=this.getTypeCategoryId();if(t===BX.CrmActivityType.email){this._actions.push(BX.CrmHistoryEmailAction.create("email",{item:this,container:this._actionContainer,entityData:this.getAssociatedEntityData(),activityEditor:this._activityEditor}))}};BX.CrmHistoryItemActivity.prototype.view=function(){var t=this.getAssociatedEntityData();var e=BX.prop.getInteger(t,"ID",0);if(e>0){this._activityEditor.viewActivity(e)}};if(typeof BX.CrmHistoryItemActivity.messages==="undefined"){BX.CrmHistoryItemActivity.messages={}}if(typeof BX.CrmHistoryItemActivity.messages==="undefined"){BX.CrmHistoryItemActivity.messages={}}BX.CrmHistoryItemActivity.create=function(t,e){var i=new BX.CrmHistoryItemActivity;i.initialize(t,e);return i}}if(typeof BX.CrmHistoryItemComment==="undefined"){BX.CrmHistoryItemComment=function(){BX.CrmHistoryItemComment.superclass.constructor.apply(this);this._isCollapsed=false};BX.extend(BX.CrmHistoryItemComment,BX.CrmHistoryItem);BX.CrmHistoryItemComment.prototype.getTitle=function(){return this.getMessage("comment")};BX.CrmHistoryItemComment.prototype.prepareContent=function(){var t=this.getTextDataParam("COMMENT","");var e=BX.util.htmlspecialchars(t).replace(/\r\n|\r|\n/g,"<br/>");var i=BX.create("DIV",{attrs:{className:"crm-entity-stream-section crm-entity-stream-section-comment"}});i.appendChild(BX.create("DIV",{attrs:{className:"crm-entity-stream-section-icon crm-entity-stream-section-icon-comment"}}));var r=BX.create("DIV",{attrs:{className:"crm-entity-stream-content-event"}});var n=this.prepareHeaderLayout();r.appendChild(n);r.appendChild(BX.create("DIV",{attrs:{className:"crm-entity-stream-content-detail"},children:[BX.create("DIV",{attrs:{className:"crm-entity-stream-content-detail-description"},html:e})]}));var s=this.prepareAuthorLayout();if(s){r.appendChild(s)}if(t.length<=128){this._isCollapsed=false;i.appendChild(BX.create("DIV",{attrs:{className:"crm-entity-stream-section-content"},children:[r]}))}else{this._isCollapsed=true;i.appendChild(BX.create("DIV",{attrs:{className:"crm-entity-stream-section-content crm-entity-stream-section-content-collapsed"},children:[r,BX.create("DIV",{attrs:{className:"crm-entity-stream-section-content-expand-btn-container"},children:[BX.create("A",{attrs:{className:"crm-entity-stream-section-content-expand-btn",href:"#"},events:{click:BX.delegate(this.onExpandButtonClick,this)},text:this.getMessage("expand")})]})]}))}return i};BX.CrmHistoryItemComment.prototype.onExpandButtonClick=function(t){if(!this._wrapper){return BX.PreventDefault(t)}var e=this._wrapper.querySelector("div.crm-entity-stream-section-content");if(!e){return BX.PreventDefault(t)}if(this._isCollapsed){e.style.maxHeight=e.scrollHeight+130+"px";BX.removeClass(e,"crm-entity-stream-section-content-collapsed");BX.addClass(e,"crm-entity-stream-section-content-expand");setTimeout(BX.delegate(function(){e.style.maxHeight=""},this),300)}else{e.style.maxHeight=e.clientHeight+"px";BX.removeClass(e,"crm-entity-stream-section-content-expand");BX.addClass(e,"crm-entity-stream-section-content-collapsed");setTimeout(BX.delegate(function(){e.style.maxHeight=""},this),0)}this._isCollapsed=!this._isCollapsed;var i=e.querySelector("a.crm-entity-stream-section-content-expand-btn");if(i){i.innerHTML=this.getMessage(this._isCollapsed?"expand":"collapse")}return BX.PreventDefault(t)};BX.CrmHistoryItemComment.create=function(t,e){var i=new BX.CrmHistoryItemComment;i.initialize(t,e);return i}}if(typeof BX.CrmHistoryItemModification==="undefined"){BX.CrmHistoryItemModification=function(){BX.CrmHistoryItemModification.superclass.constructor.apply(this)};BX.extend(BX.CrmHistoryItemModification,BX.CrmHistoryItem);BX.CrmHistoryItemModification.prototype.getMessage=function(t){var e=BX.CrmHistoryItemModification.messages;return e.hasOwnProperty(t)?e[t]:t};BX.CrmHistoryItemModification.prototype.getTitle=function(){return this.getTextDataParam("TITLE")};BX.CrmHistoryItemModification.prototype.prepareContent=function(){var t=BX.create("DIV",{attrs:{className:"crm-entity-stream-section crm-entity-stream-section-info"}});t.appendChild(BX.create("DIV",{attrs:{className:"crm-entity-stream-section-icon crm-entity-stream-section-icon-info"}}));var e=BX.create("DIV",{attrs:{className:"crm-entity-stream-content-event"}});var i=this.prepareHeaderLayout();var r=[];if(BX.type.isNotEmptyString(this.getTextDataParam("START_NAME"))){r.push(BX.create("SPAN",{attrs:{className:"crm-entity-stream-content-detain-info-status"},text:this.getTextDataParam("START_NAME")}));r.push(BX.create("SPAN",{attrs:{className:"crm-entity-stream-content-detail-info-separator-icon"}}))}if(BX.type.isNotEmptyString(this.getTextDataParam("FINISH_NAME"))){r.push(BX.create("SPAN",{attrs:{className:"crm-entity-stream-content-detain-info-status"},text:this.getTextDataParam("FINISH_NAME")}))}e.appendChild(i);e.appendChild(BX.create("DIV",{attrs:{className:"crm-entity-stream-content-detail"},children:[BX.create("DIV",{attrs:{className:"crm-entity-stream-content-detail-info"},children:r})]}));var n=this.prepareAuthorLayout();if(n){e.appendChild(n)}t.appendChild(BX.create("DIV",{attrs:{className:"crm-entity-stream-section-content"},children:[e]}));return t};if(typeof BX.CrmHistoryItemModification.messages==="undefined"){BX.CrmHistoryItemModification.messages={}}BX.CrmHistoryItemModification.create=function(t,e){var i=new BX.CrmHistoryItemModification;i.initialize(t,e);return i}}if(typeof BX.CrmHistoryItemMark==="undefined"){BX.CrmHistoryItemMark=function(){BX.CrmHistoryItemMark.superclass.constructor.apply(this)};BX.extend(BX.CrmHistoryItemMark,BX.CrmHistoryItem);BX.CrmHistoryItemMark.prototype.getMessage=function(t){var e=BX.CrmHistoryItemMark.messages;return e.hasOwnProperty(t)?e[t]:t};BX.CrmHistoryItemMark.prototype.getTitle=function(){var t="";var e=this.getAssociatedEntityData();var i=this.getAssociatedEntityTypeId();var r=this.getTypeCategoryId();if(i===BX.CrmEntityType.enumeration.activity){var n=BX.prop.getInteger(e,"TYPE_ID",0);var s=BX.prop.getInteger(e,"DIRECTION",0);var a=BX.prop.getString(e,"PROVIDER_ID","");if(n===BX.CrmActivityType.email){if(r===2){t=this.getMessage((s===BX.CrmActivityDirection.incoming?"incomingEmail":"outgoingEmail")+"SuccessMark")}else if(r===3){t=this.getMessage((s===BX.CrmActivityDirection.incoming?"incomingEmail":"outgoingEmail")+"RenewMark")}}else if(n===BX.CrmActivityType.call){if(r===2){t=this.getMessage((s===BX.CrmActivityDirection.incoming?"incomingCall":"outgoingCall")+"SuccessMark")}else if(r===3){t=this.getMessage((s===BX.CrmActivityDirection.incoming?"incomingCall":"outgoingCall")+"RenewMark")}}else if(n===BX.CrmActivityType.meeting){if(r===2){t=this.getMessage("meetingSuccessMark")}else if(r===3){t=this.getMessage("meetingRenewMark")}}else if(n===BX.CrmActivityType.task){if(r===2){t=this.getMessage("taskSuccessMark")}else if(r===3){t=this.getMessage("taskRenewMark")}}else if(n===BX.CrmActivityType.provider){if(a==="CRM_REQUEST"){if(r===2){t=this.getMessage("requestSuccessMark")}else if(r===3){t=this.getMessage("requestRenewMark")}}else if(r===2){t=this.getMessage("webformSuccessMark")}else if(r===3){t=this.getMessage("webformRenewMark")}}}else if(i===BX.CrmEntityType.enumeration.deal){if(r===2){t=this.getMessage("dealSuccessMark")}else if(r===5){t=this.getMessage("dealFailedMark")}}return t};BX.CrmHistoryItemMark.prototype.prepareTitleLayout=function(){return BX.create("A",{attrs:{href:"#",className:"crm-entity-stream-content-event-title"},events:{click:this._headerClickHandler},text:this.getTitle()})};BX.CrmHistoryItemMark.prototype.prepareContent=function(){var t=this.getAssociatedEntityData();var e=this.getAssociatedEntityTypeId();var i=BX.create("DIV",{attrs:{className:"crm-entity-stream-section crm-entity-stream-section-completed"}});var r=BX.create("DIV",{attrs:{className:"crm-entity-stream-content-event"}});var n=this.prepareHeaderLayout();if(e===BX.CrmEntityType.enumeration.activity){var s=BX.prop.getInteger(t,"TYPE_ID",0);var a="crm-entity-stream-section-icon";if(s===BX.CrmActivityType.email){a+=" crm-entity-stream-section-icon-email"}else if(s===BX.CrmActivityType.call){a+=" crm-entity-stream-section-icon-call"}else if(s===BX.CrmActivityType.meeting){a+=" crm-entity-stream-section-icon-meeting"}else if(s===BX.CrmActivityType.task){a+=" crm-entity-stream-section-icon-task"}else if(s===BX.CrmActivityType.provider){var o=BX.prop.getString(t,"PROVIDER_ID","");if(o==="CRM_WEBFORM"){a+=" crm-entity-stream-section-icon-crmForm"}}i.appendChild(BX.create("DIV",{attrs:{className:a}}));r.appendChild(n);r.appendChild(BX.create("DIV",{attrs:{className:"crm-entity-stream-content-detail"},text:this.cutOffText(BX.prop.getString(t,"SUBJECT",""),128)}))}else{i.appendChild(BX.create("DIV",{attrs:{className:"crm-entity-stream-section-icon crm-entity-stream-section-icon-info"}}));r.appendChild(n);r.appendChild(BX.create("DIV",{attrs:{className:"crm-entity-stream-content-detail"},text:this.cutOffText(BX.prop.getString(t,"TITLE",""),128)}))}var c=this.prepareAuthorLayout();if(c){r.appendChild(c)}i.appendChild(BX.create("DIV",{attrs:{className:"crm-entity-stream-section-content"},children:[r]}));return i};BX.CrmHistoryItemMark.prototype.view=function(){var t=this.getAssociatedEntityData();var e=this.getAssociatedEntityTypeId();if(e===BX.CrmEntityType.enumeration.activity){var i=BX.prop.getInteger(t,"ID",0);if(i>0){this._activityEditor.viewActivity(i)}}else{var r=BX.prop.getString(t,"SHOW_URL","");if(r!==""){BX.Crm.Page.open(r)}}};if(typeof BX.CrmHistoryItemMark.messages==="undefined"){BX.CrmHistoryItemMark.messages={}}BX.CrmHistoryItemMark.create=function(t,e){var i=new BX.CrmHistoryItemMark;i.initialize(t,e);return i}}if(typeof BX.CrmHistoryItemCreation==="undefined"){BX.CrmHistoryItemCreation=function(){BX.CrmHistoryItemCreation.superclass.constructor.apply(this)};BX.extend(BX.CrmHistoryItemCreation,BX.CrmHistoryItem);BX.CrmHistoryItemCreation.prototype.getTitle=function(){var t=this.getAssociatedEntityTypeId();var e=this.getAssociatedEntityData();if(t===BX.CrmEntityType.enumeration.activity){var i=BX.prop.getInteger(e,"TYPE_ID");var r=this.getMessage(i===BX.CrmActivityType.task?"task":"activity");return r.replace(/#TITLE#/gi,this.cutOffText(BX.prop.getString(e,"SUBJECT")),64)}return this.getMessage(BX.CrmEntityType.resolveName(this.getAssociatedEntityTypeId()).toLowerCase())};BX.CrmHistoryItemCreation.prototype.getWrapperClassName=function(){return"crm-entity-stream-section-createEntity"};BX.CrmHistoryItemCreation.prototype.prepareContentDetails=function(){var t=this.getAssociatedEntityTypeId();var e=this.getAssociatedEntityId();var i=this.getAssociatedEntityData();if(t===BX.CrmEntityType.enumeration.activity){var r=BX.create("A",{attrs:{href:"#"},html:this.cutOffText(BX.prop.getString(i,"DESCRIPTION_RAW"),128)});BX.bind(r,"click",this._headerClickHandler);return[r]}var n=BX.prop.getString(i,"TITLE");if(n!==""){var s=[];if(t===this.getOwnerTypeId()&&e===this.getOwnerId()){s.push(BX.create("SPAN",{text:n}))}else{s.push(BX.create("A",{attrs:{href:BX.prop.getString(i,"SHOW_URL","#")},text:n}))}var a=this.getObjectDataParam("BASE");var o=BX.prop.getObject(a,"ENTITY_INFO");if(o){s.push(BX.create("BR"));s.push(BX.create("SPAN",{text:BX.prop.getString(a,"CAPTION")+": "}));s.push(BX.create("A",{attrs:{href:BX.prop.getString(o,"SHOW_URL","#")},text:BX.prop.getString(o,"TITLE","")}))}return s}return[]};BX.CrmHistoryItemCreation.prototype.view=function(){var t=this.getAssociatedEntityTypeId();if(t===BX.CrmEntityType.enumeration.activity){var e=this.getAssociatedEntityData();var i=BX.prop.getInteger(e,"ID",0);if(i>0){this._activityEditor.viewActivity(i)}}};BX.CrmHistoryItemCreation.prototype.getMessage=function(t){var e=BX.CrmHistoryItemCreation.messages;return e.hasOwnProperty(t)?e[t]:t};if(typeof BX.CrmHistoryItemCreation.messages==="undefined"){BX.CrmHistoryItemCreation.messages={}}BX.CrmHistoryItemCreation.create=function(t,e){var i=new BX.CrmHistoryItemCreation;i.initialize(t,e);return i}}if(typeof BX.CrmHistoryItemLink==="undefined"){BX.CrmHistoryItemLink=function(){BX.CrmHistoryItemLink.superclass.constructor.apply(this)};BX.extend(BX.CrmHistoryItemLink,BX.CrmHistoryItem);BX.CrmHistoryItemLink.prototype.getTitle=function(){return this.getMessage(BX.CrmEntityType.resolveName(this.getAssociatedEntityTypeId()).toLowerCase())};BX.CrmHistoryItemLink.prototype.getWrapperClassName=function(){return"crm-entity-stream-section-createEntity"};BX.CrmHistoryItemLink.prototype.prepareContentDetails=function(){var t=this.getAssociatedEntityData();var e=[];e.push(BX.create("A",{attrs:{href:BX.prop.getString(t,"SHOW_URL","#")},text:BX.prop.getString(t,"TITLE")}));return e};BX.CrmHistoryItemLink.prototype.getMessage=function(t){var e=BX.CrmHistoryItemLink.messages;return e.hasOwnProperty(t)?e[t]:t};if(typeof BX.CrmHistoryItemLink.messages==="undefined"){BX.CrmHistoryItemLink.messages={}}BX.CrmHistoryItemLink.create=function(t,e){var i=new BX.CrmHistoryItemLink;i.initialize(t,e);return i}}if(typeof BX.CrmHistoryItemEmail==="undefined"){BX.CrmHistoryItemEmail=function(){BX.CrmHistoryItemEmail.superclass.constructor.apply(this)};BX.extend(BX.CrmHistoryItemEmail,BX.CrmHistoryItemActivity);BX.CrmHistoryItemEmail.prototype.prepareHeaderLayout=function(){var t=BX.create("DIV",{attrs:{className:"crm-entity-stream-content-header"}});t.appendChild(this.prepareTitleLayout());var e=this.getAssociatedEntityData();var i=BX.prop.getObject(e,"EMAIL_INFO",null);var r=i!==null?BX.prop.getString(i,"STATUS_TEXT",""):"";if(r!==""){t.appendChild(BX.create("SPAN",{props:{className:"crm-entity-stream-content-event-skipped"},text:r}))}var n=this.prepareMarkLayout();if(n){t.appendChild(n)}t.appendChild(this.prepareTimeLayout());return t};BX.CrmHistoryItemEmail.prototype.prepareContent=function(){var t=this.getAssociatedEntityData();var e=BX.prop.getString(t,"DESCRIPTION_RAW","");if(e!==""){e=e.replace(/^\s+/,"")}var i=BX.prop.getObject(t,"COMMUNICATION",{});var r=BX.prop.getString(i,"TITLE","");var n=BX.prop.getString(i,"SHOW_URL","");var s=BX.prop.getString(i,"VALUE","");var a=BX.create("DIV",{attrs:{className:"crm-entity-stream-section crm-entity-stream-section-history crm-entity-stream-section-email"}});a.appendChild(BX.create("DIV",{attrs:{className:"crm-entity-stream-section-icon crm-entity-stream-section-icon-email"}}));var o=BX.create("DIV",{attrs:{className:"crm-entity-stream-content-event"}});a.appendChild(BX.create("DIV",{attrs:{className:"crm-entity-stream-section-content"},children:[o]}));var c=this.prepareHeaderLayout();o.appendChild(c);var m=BX.create("DIV",{attrs:{className:"crm-entity-stream-content-detail-email"}});o.appendChild(BX.create("DIV",{attrs:{className:"crm-entity-stream-content-detail"},children:[m]}));m.appendChild(BX.create("DIV",{attrs:{className:"crm-entity-stream-content-detail-email-title"},children:[BX.create("A",{attrs:{href:"#"},events:{click:this._headerClickHandler},text:this.getTitle()})]}));var l=BX.create("DIV",{attrs:{className:"crm-entity-stream-content-detail-email-to"}});m.appendChild(l);if(r!==""){if(n!==""){l.appendChild(BX.create("A",{attrs:{href:n},text:r}))}else{l.appendChild(BX.create("SPAN",{text:r}))}}if(s!==""){if(r!==""){l.appendChild(BX.create("SPAN",{text:" "}))}l.appendChild(BX.create("SPAN",{attrs:{className:"crm-entity-stream-content-detail-email-address"},text:s}))}m.appendChild(BX.create("DIV",{attrs:{className:"crm-entity-stream-content-detail-email-fragment"},children:this.prepareCutOffElements(e,128,this._headerClickHandler)}));var p=this.prepareAuthorLayout();if(p){o.appendChild(p)}this._actionContainer=BX.create("SPAN",{attrs:{className:"crm-entity-stream-content-detail-action"}});o.appendChild(this._actionContainer);return a};BX.CrmHistoryItemEmail.prototype.prepareActions=function(){if(this.isReadOnly()){return}this._actions.push(BX.CrmHistoryEmailAction.create("email",{item:this,container:this._actionContainer,entityData:this.getAssociatedEntityData(),activityEditor:this._activityEditor}))};BX.CrmHistoryItemEmail.prototype.showActions=function(t){if(this._actionContainer){this._actionContainer.style.display=t?"":"none"}};BX.CrmHistoryItemEmail.create=function(t,e){var i=new BX.CrmHistoryItemEmail;i.initialize(t,e);return i}}if(typeof BX.CrmHistoryItemCall==="undefined"){BX.CrmHistoryItemCall=function(){BX.CrmHistoryItemCall.superclass.constructor.apply(this);this._playerDummyClickHandler=BX.delegate(this.onPlayerDummyClick,this);this._playerWrapper=null;this._transcriptWrapper=null;this._mediaFileInfo=null};BX.extend(BX.CrmHistoryItemCall,BX.CrmHistoryItemActivity);BX.CrmHistoryItemCall.prototype.getTypeDescription=function(){var t=this.getAssociatedEntityData();var e=BX.prop.getObject(t,"CALL_INFO",null);var i=e!==null?BX.prop.getString(e,"CALL_TYPE_TEXT",""):"";if(i!==""){return i}var r=BX.prop.getInteger(t,"DIRECTION",0);return this.getMessage(r===BX.CrmActivityDirection.incoming?"incomingCall":"outgoingCall")};BX.CrmHistoryItemCall.prototype.prepareHeaderLayout=function(){var t=BX.create("DIV",{attrs:{className:"crm-entity-stream-content-header"}});t.appendChild(this.prepareTitleLayout());var e=this.getAssociatedEntityData();var i=BX.prop.getObject(e,"CALL_INFO",null);var r=i!==null;var n=r?BX.prop.getBoolean(i,"SUCCESSFUL",false):false;var s=r?BX.prop.getString(i,"STATUS_TEXT",""):"";if(r){t.appendChild(BX.create("DIV",{attrs:{className:n?"crm-entity-stream-content-event-successful":"crm-entity-stream-content-event-missing"},text:s}))}t.appendChild(BX.create("SPAN",{attrs:{className:"crm-entity-stream-content-event-time"},text:this.formatTime(this.getCreatedTime())}));return t};BX.CrmHistoryItemCall.prototype.prepareContent=function(){var t=this.getAssociatedEntityData();var e=BX.prop.getString(t,"DESCRIPTION_RAW","");if(e!==""){e=e.replace(/^\s+/,"")}var i=BX.prop.getObject(t,"COMMUNICATION",{});var r=BX.prop.getString(i,"TITLE","");var n=BX.prop.getString(i,"SHOW_URL","");var s=BX.prop.getString(i,"VALUE","");var a=BX.prop.getString(i,"FORMATTED_VALUE",s);var o=BX.prop.getObject(t,"CALL_INFO",null);var c=o!==null;var m=c?BX.prop.getString(o,"DURATION_TEXT",""):"";var l=c?BX.prop.getBoolean(o,"HAS_TRANSCRIPT",""):"";var p=c?BX.prop.getBoolean(o,"TRANSCRIPT_PENDING",""):"";var h=c?BX.prop.getString(o,"CALL_ID",""):"";var d=c?BX.prop.getString(o,"COMMENT",""):"";var u=BX.create("DIV",{attrs:{className:"crm-entity-stream-section crm-entity-stream-section-history crm-entity-stream-section-call"}});u.appendChild(BX.create("DIV",{attrs:{className:"crm-entity-stream-section-icon crm-entity-stream-section-icon-call"}}));var y=BX.create("DIV",{attrs:{className:"crm-entity-stream-content-event"}});u.appendChild(BX.create("DIV",{attrs:{className:"crm-entity-stream-section-content"},children:[y]}));var B=this.prepareHeaderLayout();y.appendChild(B);var f=BX.create("DIV",{attrs:{className:"crm-entity-stream-content-detail"}});y.appendChild(f);f.appendChild(BX.create("DIV",{attrs:{className:"crm-entity-stream-content-detail-title"},children:[BX.create("A",{attrs:{href:"#"},events:{click:this._headerClickHandler},text:this.getTitle()})]}));f.appendChild(BX.create("DIV",{attrs:{className:"crm-entity-stream-content-detail-description"},children:this.prepareCutOffElements(e,128,this._headerClickHandler)}));if(c){var g=BX.create("DIV",{attrs:{className:"crm-entity-stream-content-detail-call"}});f.appendChild(g);this._mediaFileInfo=BX.prop.getObject(t,"MEDIA_FILE_INFO",null);if(this._mediaFileInfo!==null){this._playerWrapper=BX.create("DIV",{attrs:{className:"crm-audio-cap-wrap-container"}});this._playerWrapper.appendChild(BX.create("DIV",{attrs:{className:"crm-audio-cap-wrap"},children:[BX.create("DIV",{attrs:{className:"crm-audio-cap-time"},text:m})],events:{click:this._playerDummyClickHandler}}));g.appendChild(this._playerWrapper)}if(l){this._transcriptWrapper=BX.create("DIV",{attrs:{className:"crm-audio-transcript-wrap-container"},events:{click:function(t){if(BX.Voximplant&&BX.Voximplant.Transcript){BX.Voximplant.Transcript.create({callId:h}).show()}}},children:[BX.create("DIV",{attrs:{className:"crm-audio-transcript-icon"}}),BX.create("DIV",{attrs:{className:"crm-audio-transcript-conversation"},text:BX.message("CRM_TIMELINE_CALL_TRANSCRIPT")})]});g.appendChild(this._transcriptWrapper)}else if(p){this._transcriptWrapper=BX.create("DIV",{attrs:{className:"crm-audio-transcript-wrap-container-pending"},children:[BX.create("DIV",{attrs:{className:"crm-audio-transcript-icon-pending"},html:'<svg class="crm-transcript-loader-circular" viewBox="25 25 50 50"><circle class="crm-transcript-loader-path" cx="50" cy="50" r="20" fill="none" stroke-miterlimit="10"></circle></svg>'}),BX.create("DIV",{attrs:{className:"crm-audio-transcript-conversation"},text:BX.message("CRM_TIMELINE_CALL_TRANSCRIPT_PENDING")})]});g.appendChild(this._transcriptWrapper)}if(d){f.appendChild(BX.create("DIV",{attrs:{className:"crm-entity-stream-content-detail-description"},text:BX.util.htmlspecialchars(d)}))}}var C=BX.create("DIV",{attrs:{className:"crm-entity-stream-content-detail-contact-info"}});f.appendChild(C);if(r!==""){if(n!==""){C.appendChild(BX.create("A",{attrs:{href:n},text:r}))}else{C.appendChild(BX.create("SPAN",{text:r}))}}if(a!==""){if(r!==""){C.appendChild(BX.create("SPAN",{text:" "}))}C.appendChild(BX.create("SPAN",{attrs:{className:"crm-entity-stream-content-detail-email-address"},text:a}))}var X=this.prepareAuthorLayout();if(X){y.appendChild(X)}this._actionContainer=BX.create("SPAN",{attrs:{className:"crm-entity-stream-content-detail-action"}});y.appendChild(this._actionContainer);return u};BX.CrmHistoryItemCall.prototype.prepareActions=function(){if(this.isReadOnly()){return}this._actions.push(BX.CrmHistoryCallAction.create("call",{item:this,container:this._actionContainer,entityData:this.getAssociatedEntityData(),activityEditor:this._activityEditor,ownerInfo:this._history.getOwnerInfo()}))};BX.CrmHistoryItemCall.prototype.onPlayerDummyClick=function(t){var e=this._playerWrapper.querySelector(".crm-audio-cap-wrap");if(e){BX.addClass(e,"crm-audio-cap-wrap-loader")}this._history.getManager().loadMediaPlayer("history_"+this.getId(),this._mediaFileInfo["URL"],this._mediaFileInfo["TYPE"],this._playerWrapper)};BX.CrmHistoryItemCall.create=function(t,e){var i=new BX.CrmHistoryItemCall;i.initialize(t,e);return i}}if(typeof BX.CrmHistoryItemMeeting==="undefined"){BX.CrmHistoryItemMeeting=function(){BX.CrmHistoryItemMeeting.superclass.constructor.apply(this)};BX.extend(BX.CrmHistoryItemMeeting,BX.CrmHistoryItemActivity);BX.CrmHistoryItemMeeting.prototype.prepareHeaderLayout=function(){var t=BX.create("DIV",{attrs:{className:"crm-entity-stream-content-header"}});t.appendChild(this.prepareTitleLayout());var e=this.prepareMarkLayout();if(e){t.appendChild(e)}t.appendChild(this.prepareTimeLayout());return t};BX.CrmHistoryItemMeeting.prototype.prepareContent=function(){var t=this.getAssociatedEntityData();var e=BX.prop.getString(t,"DESCRIPTION_RAW","");if(e!==""){e=e.replace(/^\s+/,"")}var i=BX.prop.getObject(t,"COMMUNICATION",{});var r=BX.prop.getString(i,"TITLE","");var n=BX.prop.getString(i,"SHOW_URL","");var s=BX.prop.getString(i,"VALUE","");var a=BX.create("DIV",{attrs:{className:"crm-entity-stream-section crm-entity-stream-section-history crm-entity-stream-section-meeting"}});a.appendChild(BX.create("DIV",{attrs:{className:"crm-entity-stream-section-icon crm-entity-stream-section-icon-meeting"}}));var o=BX.create("DIV",{attrs:{className:"crm-entity-stream-content-event"}});a.appendChild(BX.create("DIV",{attrs:{className:"crm-entity-stream-section-content"},children:[o]}));var c=this.prepareHeaderLayout();o.appendChild(c);var m=BX.create("DIV",{attrs:{className:"crm-entity-stream-content-detail"}});o.appendChild(m);m.appendChild(BX.create("DIV",{attrs:{className:"crm-entity-stream-content-detail-title"},children:[BX.create("A",{attrs:{href:"#"},events:{click:this._headerClickHandler},text:this.getTitle()})]}));m.appendChild(BX.create("DIV",{attrs:{className:"crm-entity-stream-content-detail-description"},children:this.prepareCutOffElements(e,128,this._headerClickHandler)}));var l=BX.create("DIV",{attrs:{className:"crm-entity-stream-content-detail-contact-info"}});m.appendChild(l);if(r!==""){l.appendChild(BX.create("SPAN",{text:this.getMessage("reciprocal")+": "}));if(n!==""){l.appendChild(BX.create("A",{attrs:{href:n},text:r}))}else{l.appendChild(BX.create("SPAN",{text:r}))}}l.appendChild(BX.create("SPAN",{text:" "+s}));var p=this.prepareAuthorLayout();if(p){o.appendChild(p)}this._actionContainer=BX.create("SPAN",{attrs:{className:"crm-entity-stream-content-detail-action"}});o.appendChild(this._actionContainer);return a};BX.CrmHistoryItemMeeting.prototype.prepareActions=function(){};BX.CrmHistoryItemMeeting.prototype.showActions=function(t){if(this._actionContainer){this._actionContainer.style.display=t?"":"none"}};BX.CrmHistoryItemMeeting.create=function(t,e){var i=new BX.CrmHistoryItemMeeting;i.initialize(t,e);return i}}if(typeof BX.CrmHistoryItemTask==="undefined"){BX.CrmHistoryItemTask=function(){BX.CrmHistoryItemTask.superclass.constructor.apply(this)};BX.extend(BX.CrmHistoryItemTask,BX.CrmHistoryItemActivity);BX.CrmHistoryItemTask.prototype.prepareHeaderLayout=function(){var t=BX.create("DIV",{attrs:{className:"crm-entity-stream-content-header"}});t.appendChild(this.prepareTitleLayout());var e=this.prepareMarkLayout();if(e){t.appendChild(e)}t.appendChild(this.prepareTimeLayout());return t};BX.CrmHistoryItemTask.prototype.prepareContent=function(){var t=this.getAssociatedEntityData();var e=BX.prop.getString(t,"DESCRIPTION_RAW","");if(e!==""){e=e.replace(/^\s+/,"")}var i=BX.prop.getObject(t,"COMMUNICATION",{});var r=BX.prop.getString(i,"TITLE","");var n=BX.prop.getString(i,"SHOW_URL","");var s=BX.create("DIV",{attrs:{className:"crm-entity-stream-section crm-entity-stream-section-history crm-entity-stream-section-task"}});s.appendChild(BX.create("DIV",{attrs:{className:"crm-entity-stream-section-icon crm-entity-stream-section-icon-task"}}));var a=BX.create("DIV",{attrs:{className:"crm-entity-stream-content-event"}});s.appendChild(BX.create("DIV",{attrs:{className:"crm-entity-stream-section-content"},children:[a]}));var o=this.prepareHeaderLayout();a.appendChild(o);var c=BX.create("DIV",{attrs:{className:"crm-entity-stream-content-detail"}});a.appendChild(c);c.appendChild(BX.create("DIV",{attrs:{className:"crm-entity-stream-content-detail-title"},children:[BX.create("A",{attrs:{href:"#"},events:{click:this._headerClickHandler},text:this.getTitle()})]}));c.appendChild(BX.create("DIV",{attrs:{className:"crm-entity-stream-content-detail-description"},children:this.prepareCutOffElements(e,128,this._headerClickHandler)}));var m=BX.create("DIV",{attrs:{className:"crm-entity-stream-content-detail-contact-info"}});c.appendChild(m);if(r!==""){m.appendChild(BX.create("SPAN",{text:this.getMessage("reciprocal")+": "}));if(n!==""){m.appendChild(BX.create("A",{attrs:{href:n},text:r}))}else{m.appendChild(BX.create("SPAN",{text:r}))}}var l=this.prepareAuthorLayout();if(l){a.appendChild(l)}this._actionContainer=BX.create("SPAN",{attrs:{className:"crm-entity-stream-content-detail-action"}});a.appendChild(this._actionContainer);return s};BX.CrmHistoryItemTask.prototype.prepareActions=function(){};BX.CrmHistoryItemTask.prototype.showActions=function(t){if(this._actionContainer){this._actionContainer.style.display=t?"":"none"}};BX.CrmHistoryItemTask.create=function(t,e){var i=new BX.CrmHistoryItemTask;i.initialize(t,e);return i}}if(typeof BX.CrmHistoryItemWebForm==="undefined"){BX.CrmHistoryItemWebForm=function(){BX.CrmHistoryItemWebForm.superclass.constructor.apply(this)};BX.extend(BX.CrmHistoryItemWebForm,BX.CrmHistoryItemActivity);BX.CrmHistoryItemWebForm.prototype.prepareHeaderLayout=function(){var t=BX.create("DIV",{attrs:{className:"crm-entity-stream-content-header"}});t.appendChild(this.prepareTitleLayout());t.appendChild(this.prepareTimeLayout());return t};BX.CrmHistoryItemWebForm.prototype.prepareContent=function(){var t=this.getAssociatedEntityData();var e=BX.create("DIV",{attrs:{className:"crm-entity-stream-section crm-entity-stream-section-history crm-entity-stream-section-crmForm"}});e.appendChild(BX.create("DIV",{attrs:{className:"crm-entity-stream-section-icon crm-entity-stream-section-icon-crmForm"}}));var i=BX.create("DIV",{attrs:{className:"crm-entity-stream-content-event"}});e.appendChild(BX.create("DIV",{attrs:{className:"crm-entity-stream-section-content"},children:[i]}));var r=this.prepareHeaderLayout();i.appendChild(r);var n=BX.create("DIV",{attrs:{className:"crm-entity-stream-content-detail"}});i.appendChild(n);n.appendChild(BX.create("DIV",{attrs:{className:"crm-entity-stream-content-detail-title"},children:[BX.create("A",{attrs:{href:"#"},events:{click:this._headerClickHandler},text:this.getTitle()})]}));var s=this.prepareAuthorLayout();if(s){i.appendChild(s)}this._actionContainer=BX.create("SPAN",{attrs:{className:"crm-entity-stream-content-detail-action"}});i.appendChild(this._actionContainer);return e};BX.CrmHistoryItemWebForm.prototype.prepareActions=function(){};BX.CrmHistoryItemWebForm.prototype.showActions=function(t){if(this._actionContainer){this._actionContainer.style.display=t?"":"none"}};BX.CrmHistoryItemWebForm.create=function(t,e){var i=new BX.CrmHistoryItemWebForm;i.initialize(t,e);return i}}if(typeof BX.CrmHistoryItemWait==="undefined"){BX.CrmHistoryItemWait=function(){BX.CrmHistoryItemWait.superclass.constructor.apply(this)};BX.extend(BX.CrmHistoryItemWait,BX.CrmHistoryItem);BX.CrmHistoryItemWait.prototype.getTitle=function(){return this.getMessage("wait")};BX.CrmHistoryItemWait.prototype.prepareTitleLayout=function(){return BX.create("SPAN",{attrs:{className:"crm-entity-stream-content-event-title"},children:[BX.create("A",{attrs:{href:"#"},events:{click:this._headerClickHandler},text:this.getTitle()})]})};BX.CrmHistoryItemWait.prototype.prepareTimeLayout=function(){return BX.create("SPAN",{attrs:{className:"crm-entity-stream-content-event-time"},text:this.formatTime(this.getCreatedTime())})};BX.CrmHistoryItemWait.prototype.prepareHeaderLayout=function(){var t=BX.create("DIV",{attrs:{className:"crm-entity-stream-content-header"}});t.appendChild(this.prepareTitleLayout());t.appendChild(this.prepareTimeLayout());return t};BX.CrmHistoryItemWait.prototype.prepareContent=function(){var t=this.getAssociatedEntityData();var e=BX.prop.getString(t,"DESCRIPTION_RAW","");if(e!==""){e=BX.util.trim(e);e=BX.util.strip_tags(e);e=BX.util.nl2br(e)}var i=BX.create("DIV",{attrs:{className:"crm-entity-stream-section crm-entity-stream-section-history crm-entity-stream-section-wait"}});i.appendChild(BX.create("DIV",{attrs:{className:"crm-entity-stream-section-icon crm-entity-stream-section-icon-complete"}}));var r=BX.create("DIV",{attrs:{className:"crm-entity-stream-content-event"}});i.appendChild(BX.create("DIV",{attrs:{className:"crm-entity-stream-section-content"},children:[r]}));var n=this.prepareHeaderLayout();r.appendChild(n);var s=BX.create("DIV",{attrs:{className:"crm-entity-stream-content-detail"},html:e});r.appendChild(s);var a=this.prepareAuthorLayout();if(a){r.appendChild(a)}this._actionContainer=BX.create("SPAN",{attrs:{className:"crm-entity-stream-content-detail-action"}});r.appendChild(this._actionContainer);return i};BX.CrmHistoryItemWait.prototype.prepareActions=function(){};BX.CrmHistoryItemWait.prototype.showActions=function(t){if(this._actionContainer){this._actionContainer.style.display=t?"":"none"}};BX.CrmHistoryItemWait.create=function(t,e){var i=new BX.CrmHistoryItemWait;i.initialize(t,e);return i}}if(typeof BX.CrmHistoryItemSender==="undefined"){BX.CrmHistoryItemSender=function(){BX.CrmHistoryItemSender.superclass.constructor.apply(this)};BX.extend(BX.CrmHistoryItemSender,BX.CrmHistoryItem);BX.CrmHistoryItemSender.prototype.getDataSetting=function(t){var e=this.getObjectDataParam("SETTINGS")||{};return e[t]||null};BX.CrmHistoryItemSender.prototype.getMessage=function(t){var e=BX.CrmHistoryItemSender.messages;return e.hasOwnProperty(t)?e[t]:t};BX.CrmHistoryItemSender.prototype.getTitle=function(){return this.getDataSetting("messageName")};BX.CrmHistoryItemSender.prototype.prepareTitleLayout=function(){var t=this;return BX.create("SPAN",{attrs:{className:"crm-entity-stream-content-event-title"},children:[BX.create("A",{attrs:{href:""},events:{click:function(e){if(BX.SidePanel){BX.SidePanel.Instance.open(t.getDataSetting("path"))}else{top.location.href=t.getDataSetting("path")}e.preventDefault();e.stopPropagation()}},text:this.getTitle()})]})};BX.CrmHistoryItemSender.prototype.prepareTimeLayout=function(){return BX.create("SPAN",{attrs:{className:"crm-entity-stream-content-event-time"},text:this.formatTime(this.getCreatedTime())})};BX.CrmHistoryItemWait.prototype.prepareHeaderLayout=function(){var t=BX.create("DIV",{attrs:{className:"crm-entity-stream-content-header"}});t.appendChild(this.prepareTitleLayout());t.appendChild(this.prepareTimeLayout());return t};BX.CrmHistoryItemSender.prototype.prepareContent=function(){var t=this.getAssociatedEntityData();var e=this.getMessage("title")+": "+this.getDataSetting("letterTitle");var i=BX.create("DIV",{attrs:{className:"crm-entity-stream-section crm-entity-stream-section-history crm-entity-stream-section-wait"}});i.appendChild(BX.create("DIV",{attrs:{className:"crm-entity-stream-section-icon crm-entity-stream-section-icon-complete"}}));var r=BX.create("DIV",{attrs:{className:"crm-entity-stream-content-event"}});i.appendChild(BX.create("DIV",{attrs:{className:"crm-entity-stream-section-content"},children:[r]}));var n=this.prepareHeaderLayout();r.appendChild(n);var s=BX.create("DIV",{attrs:{className:"crm-entity-stream-content-detail"},html:e});r.appendChild(s);var a=this.prepareAuthorLayout();if(a){r.appendChild(a)}return i};BX.CrmHistoryItemSender.create=function(t,e){var i=new BX.CrmHistoryItemSender;i.initialize(t,e);return i}}if(typeof BX.CrmHistoryItemBizproc==="undefined"){BX.CrmHistoryItemBizproc=function(){BX.CrmHistoryItemBizproc.superclass.constructor.apply(this)};BX.extend(BX.CrmHistoryItemBizproc,BX.CrmHistoryItem);BX.CrmHistoryItemBizproc.prototype.getTitle=function(){return this.getMessage("bizproc")};BX.CrmHistoryItemBizproc.prototype.prepareContent=function(){var t=BX.create("DIV",{attrs:{className:"crm-entity-stream-section crm-entity-stream-section-history crm-entity-stream-section-bp"}});t.appendChild(BX.create("DIV",{attrs:{className:"crm-entity-stream-section-icon crm-entity-stream-section-icon-bp"}}));var e=BX.create("DIV",{attrs:{className:"crm-entity-stream-content-event"}});var i=this.prepareHeaderLayout();e.appendChild(i);e.appendChild(BX.create("DIV",{attrs:{className:"crm-entity-stream-content-detail"},children:[BX.create("DIV",{attrs:{className:"crm-entity-stream-content-detail-description"},html:this.prepareContentTextHtml()})]}));var r=this.prepareAuthorLayout();if(r){e.appendChild(r)}t.appendChild(BX.create("DIV",{attrs:{className:"crm-entity-stream-section-content"},children:[e]}));return t};BX.CrmHistoryItemBizproc.prototype.prepareContentTextHtml=function(){var t=this.getTextDataParam("WORKFLOW_TEMPLATE_NAME");var e=this.getTextDataParam("WORKFLOW_STATUS_NAME");if(!t||e!=="Created"&&e!=="Completed"&&e!=="Terminated"){return BX.util.htmlspecialchars(this.getTextDataParam("COMMENT"))}var i=BX.message("CRM_TIMELINE_BIZPROC_CREATED");if(e==="Completed"){i=BX.message("CRM_TIMELINE_BIZPROC_COMPLETED")}else if(e==="Terminated"){i=BX.message("CRM_TIMELINE_BIZPROC_TERMINATED")}return BX.util.htmlspecialchars(i).replace("#NAME#","<strong>"+BX.util.htmlspecialchars(t)+"</strong>")};BX.CrmHistoryItemBizproc.create=function(t,e){var i=new BX.CrmHistoryItemBizproc;i.initialize(t,e);return i}}if(typeof BX.CrmHistoryItemSms==="undefined"){BX.CrmHistoryItemSms=function(){BX.CrmHistoryItemSms.superclass.constructor.apply(this)};BX.extend(BX.CrmHistoryItemSms,BX.CrmHistoryItemActivity);BX.CrmHistoryItemSms.prototype.prepareHeaderLayout=function(){var t=BX.create("DIV",{attrs:{className:"crm-entity-stream-content-header"}});t.appendChild(this.prepareTitleLayout());t.appendChild(this.prepareMessageStatusLayout());t.appendChild(this.prepareTimeLayout());return t};BX.CrmHistoryItemSms.prototype.prepareMessageStatusLayout=function(){return this._messageStatusNode=BX.create("SPAN")};BX.CrmHistoryItemSms.prototype.prepareContent=function(){var t=this.getAssociatedEntityData();var e=BX.prop.getObject(t,"COMMUNICATION",{});var i=BX.prop.getString(e,"TITLE","");var r=BX.prop.getString(e,"SHOW_URL","");var n=BX.prop.getString(e,"VALUE","");var s=BX.prop.getObject(t,"SMS_INFO",{});var a="crm-entity-stream-section-sms";var o=BX.create("DIV",{attrs:{className:"crm-entity-stream-section crm-entity-stream-section-history"+" "+a}});o.appendChild(BX.create("DIV",{attrs:{className:"crm-entity-stream-section-icon crm-entity-stream-section-icon-sms"}}));var c=BX.create("DIV",{attrs:{className:"crm-entity-stream-content-event"}});o.appendChild(BX.create("DIV",{attrs:{className:"crm-entity-stream-section-content"},children:[c]}));var m=this.prepareHeaderLayout();c.appendChild(m);var l=BX.create("DIV",{attrs:{className:"crm-entity-stream-content-detail"}});c.appendChild(l);var p=BX.create("DIV",{attrs:{className:"crm-entity-stream-content-detail-sms"}});if(s.sender){var h=s.senderId;var d=s.senderShortName;if(h==="rest"&&s.fromName){d=s.fromName}var u=BX.create("DIV",{attrs:{className:"crm-entity-stream-content-detail-sms-status"},children:[BX.message("CRM_TIMELINE_SMS_SENDER")+" ",BX.create("STRONG",{text:d})]});if(h!=="rest"&&s.fromName){u.innerHTML+=" "+BX.message("CRM_TIMELINE_SMS_FROM")+" ";u.appendChild(BX.create("STRONG",{text:s.fromName}))}p.appendChild(u)}if(s.statusId!==""){this.setMessageStatus(s.statusId,s.errorText)}var y=BX.util.htmlspecialchars(t["DESCRIPTION_RAW"]).replace(/\r\n|\r|\n/g,"<br/>");var B=BX.create("DIV",{attrs:{className:"crm-entity-stream-content-detail-sms-fragment"}});B.appendChild(BX.create("SPAN",{html:y}));p.appendChild(B);l.appendChild(p);var f=BX.create("DIV",{attrs:{className:"crm-entity-stream-content-detail-contact-info"},text:BX.message("CRM_TIMELINE_SMS_TO")+" "});l.appendChild(f);if(i!==""){if(r!==""){f.appendChild(BX.create("A",{attrs:{href:r},text:i}))}else{f.appendChild(BX.create("SPAN",{text:i}))}}f.appendChild(BX.create("SPAN",{text:" "+n}));var g=this.prepareAuthorLayout();if(g){c.appendChild(g)}this._actionContainer=BX.create("SPAN",{attrs:{className:"crm-entity-stream-content-detail-action"}});c.appendChild(this._actionContainer);return o};BX.CrmHistoryItemSms.prototype.prepareActions=function(){};BX.CrmHistoryItemSms.prototype.showActions=function(t){if(this._actionContainer){this._actionContainer.style.display=t?"":"none"}};BX.CrmHistoryItemSms.prototype.setMessageStatus=function(t,e){t=parseInt(t);if(isNaN(t)||!this._messageStatusNode)return;var i=this.getSetting("smsStatusDescriptions",{});if(i.hasOwnProperty(t)){this._messageStatusNode.textContent=i[t];this.setMessageStatusErrorText(e);var r=this.getMessageStatusSemantic(t);this.setMessageStatusSemantic(r)}};BX.CrmHistoryItemSms.prototype.setMessageStatusSemantic=function(t){var e={process:"crm-entity-stream-content-event-process",success:"crm-entity-stream-content-event-successful",failure:"crm-entity-stream-content-event-missing"};for(var i in e){var r=i===t?"addClass":"removeClass";BX[r](this._messageStatusNode,e[i])}};BX.CrmHistoryItemSms.prototype.setMessageStatusErrorText=function(t){if(!t){this._messageStatusNode.removeAttribute("title");BX.removeClass(this._messageStatusNode,"crm-entity-stream-content-event-error-tip")}else{this._messageStatusNode.setAttribute("title",t);BX.addClass(this._messageStatusNode,"crm-entity-stream-content-event-error-tip")}};BX.CrmHistoryItemSms.prototype.getMessageStatusSemantic=function(t){var e=this.getSetting("smsStatusSemantics",{});return e.hasOwnProperty(t)?e[t]:"failure"};BX.CrmHistoryItemSms.prototype.subscribe=function(){if(!BX.CrmSmsWatcher)return;var t=this.getAssociatedEntityData();var e=BX.prop.getObject(t,"SMS_INFO",{});if(e.id){BX.CrmSmsWatcher.subscribeOnMessageUpdate(e.id,this.onMessageUpdate.bind(this))}};BX.CrmHistoryItemSms.prototype.onMessageUpdate=function(t){if(t.STATUS_ID){this.setMessageStatus(t.STATUS_ID,t.EXEC_ERROR)}};BX.CrmHistoryItemSms.create=function(t,e){var i=new BX.CrmHistoryItemSms;i.initialize(t,e);i.subscribe();return i}}if(typeof BX.CrmHistoryItemActivityRequest==="undefined"){BX.CrmHistoryItemActivityRequest=function(){BX.CrmHistoryItemActivityRequest.superclass.constructor.apply(this)};BX.extend(BX.CrmHistoryItemActivityRequest,BX.CrmHistoryItemActivity);BX.CrmHistoryItemActivityRequest.prototype.prepareHeaderLayout=function(){var t=BX.create("DIV",{attrs:{className:"crm-entity-stream-content-header"}});t.appendChild(this.prepareTitleLayout());t.appendChild(this.prepareTimeLayout());return t};BX.CrmHistoryItemActivityRequest.prototype.prepareContent=function(){var t=this.getAssociatedEntityData();var e=BX.prop.getString(t,"DESCRIPTION_RAW","");if(e!==""){e=e.replace(/^\s+/,"")}var i=BX.create("DIV",{attrs:{className:"crm-entity-stream-section crm-entity-stream-section-today crm-entity-stream-section-robot"}});i.appendChild(BX.create("DIV",{attrs:{className:"crm-entity-stream-section-icon crm-entity-stream-section-icon-robot"}}));var r=BX.create("DIV",{attrs:{className:"crm-entity-stream-content-event"}});i.appendChild(BX.create("DIV",{attrs:{className:"crm-entity-stream-section-content"},children:[r]}));var n=this.prepareHeaderLayout();r.appendChild(n);var s=BX.create("DIV",{attrs:{className:"crm-entity-stream-content-detail"}});r.appendChild(s);s.appendChild(BX.create("DIV",{attrs:{className:"crm-entity-stream-content-detail-title"},children:[BX.create("A",{attrs:{href:"#"},events:{click:this._headerClickHandler},text:this.getTitle()})]}));s.appendChild(BX.create("DIV",{attrs:{className:"crm-entity-stream-content-detail-description"},children:this.prepareCutOffElements(e,128,this._headerClickHandler)}));var a=this.prepareAuthorLayout();if(a){r.appendChild(a)}this._actionContainer=BX.create("SPAN",{attrs:{className:"crm-entity-stream-content-detail-action"}});r.appendChild(this._actionContainer);return i};BX.CrmHistoryItemActivityRequest.prototype.prepareActions=function(){};BX.CrmHistoryItemActivityRequest.prototype.showActions=function(t){if(this._actionContainer){this._actionContainer.style.display=t?"":"none"}};BX.CrmHistoryItemActivityRequest.create=function(t,e){var i=new BX.CrmHistoryItemActivityRequest;i.initialize(t,e);return i}}if(typeof BX.CrmHistoryItemActivityRestApplication==="undefined"){BX.CrmHistoryItemActivityRestApplication=function(){BX.CrmHistoryItemActivityRestApplication.superclass.constructor.apply(this)};BX.extend(BX.CrmHistoryItemActivityRestApplication,BX.CrmHistoryItemActivity);BX.CrmHistoryItemActivityRestApplication.prototype.prepareHeaderLayout=function(){var t=BX.create("DIV",{attrs:{className:"crm-entity-stream-content-header"}});t.appendChild(this.prepareTitleLayout());t.appendChild(this.prepareTimeLayout());return t};BX.CrmHistoryItemActivityRestApplication.prototype.prepareContent=function(){var t=this.getAssociatedEntityData();var e=BX.prop.getString(t,"DESCRIPTION_RAW","");if(e!==""){e=e.replace(/^\s+/,"")}var i=BX.create("DIV",{attrs:{className:"crm-entity-stream-section crm-entity-stream-section-today crm-entity-stream-section-rest"}});i.appendChild(BX.create("DIV",{attrs:{className:"crm-entity-stream-section-icon crm-entity-stream-section-icon-rest"}}));var r=BX.create("DIV",{attrs:{className:"crm-entity-stream-content-event"}});i.appendChild(BX.create("DIV",{attrs:{className:"crm-entity-stream-section-content"},children:[r]}));var n=this.prepareHeaderLayout();r.appendChild(n);var s=BX.create("DIV",{attrs:{className:"crm-entity-stream-content-detail"}});r.appendChild(s);s.appendChild(BX.create("DIV",{attrs:{className:"crm-entity-stream-content-detail-title"},children:[BX.create("A",{attrs:{href:"#"},events:{click:this._headerClickHandler},text:this.getTitle()})]}));s.appendChild(BX.create("DIV",{attrs:{className:"crm-entity-stream-content-detail-description"},children:this.prepareCutOffElements(e,128,this._headerClickHandler)}));var a=this.prepareAuthorLayout();if(a){r.appendChild(a)}this._actionContainer=BX.create("SPAN",{attrs:{className:"crm-entity-stream-content-detail-action"}});r.appendChild(this._actionContainer);return i};BX.CrmHistoryItemActivityRestApplication.prototype.prepareActions=function(){};BX.CrmHistoryItemActivityRestApplication.prototype.showActions=function(t){if(this._actionContainer){this._actionContainer.style.display=t?"":"none"}};BX.CrmHistoryItemActivityRestApplication.create=function(t,e){var i=new BX.CrmHistoryItemActivityRestApplication;i.initialize(t,e);return i}}if(typeof BX.CrmHistoryItemOpenLine==="undefined"){BX.CrmHistoryItemOpenLine=function(){BX.CrmHistoryItemOpenLine.superclass.constructor.apply(this)};BX.extend(BX.CrmHistoryItemOpenLine,BX.CrmHistoryItemActivity);BX.CrmHistoryItemOpenLine.prototype.prepareHeaderLayout=function(){var t=BX.create("DIV",{attrs:{className:"crm-entity-stream-content-header"}});t.appendChild(this.prepareTitleLayout());t.appendChild(this.prepareTimeLayout());return t};BX.CrmHistoryItemOpenLine.prototype.prepareContent=function(){var t=this.getAssociatedEntityData();var e=BX.prop.getString(t,"DESCRIPTION_RAW","");if(e!==""){e=e.replace(/^\s+/,"")}var i=BX.prop.getObject(t,"COMMUNICATION",{});var r=BX.prop.getString(i,"TITLE","");var n=BX.prop.getString(i,"SHOW_URL","");var s=BX.create("DIV",{attrs:{className:"crm-entity-stream-section crm-entity-stream-section-history crm-entity-stream-section-IM"}});s.appendChild(BX.create("DIV",{attrs:{className:"crm-entity-stream-section-icon crm-entity-stream-section-icon-IM"}}));var a=BX.create("DIV",{attrs:{className:"crm-entity-stream-content-event"}});s.appendChild(BX.create("DIV",{attrs:{className:"crm-entity-stream-section-content"},children:[a]}));var o=this.prepareHeaderLayout();a.appendChild(o);var c=BX.create("DIV",{attrs:{className:"crm-entity-stream-content-detail"}});a.appendChild(c);c.appendChild(BX.create("DIV",{attrs:{className:"crm-entity-stream-content-detail-title"},children:[BX.create("A",{attrs:{href:"#"},events:{click:this._headerClickHandler},text:this.getTitle()})]}));var m=BX.create("DIV",{attrs:{className:"crm-entity-stream-content-detail-IM"}});c.appendChild(m);var l=BX.create("DIV",{attrs:{className:"crm-entity-stream-content-detail-IM-messages"}});m.appendChild(l);var p=BX.prop.getObject(this.getAssociatedEntityData(),"OPENLINE_INFO",null);if(p){var h=BX.prop.getArray(p,"MESSAGES",[]);for(var d=0,u=h.length;d<u;d++){var y=h[d];var B=BX.prop.getBoolean(y,"IS_EXTERNAL",true);l.appendChild(BX.create("DIV",{attrs:{className:B?"crm-entity-stream-content-detail-IM-message-incoming":"crm-entity-stream-content-detail-IM-message-outgoing"},text:BX.prop.getString(y,"MESSAGE","")}))}}var f=BX.create("DIV",{attrs:{className:"crm-entity-stream-content-detail-contact-info"}});c.appendChild(f);if(r!==""){f.appendChild(BX.create("SPAN",{text:this.getMessage("reciprocal")+": "}));if(n!==""){f.appendChild(BX.create("A",{attrs:{href:n},text:r}))}else{f.appendChild(BX.create("SPAN",{text:r}))}}var g=this.prepareAuthorLayout();if(g){a.appendChild(g)}this._actionContainer=BX.create("SPAN",{attrs:{className:"crm-entity-stream-content-detail-action"}});a.appendChild(this._actionContainer);return s};BX.CrmHistoryItemOpenLine.prototype.prepareActions=function(){if(this.isReadOnly()){return}this._actions.push(BX.CrmHistoryOpenLineAction.create("openline",{item:this,container:this._actionContainer,entityData:this.getAssociatedEntityData(),activityEditor:this._activityEditor,ownerInfo:this._history.getOwnerInfo()}))};BX.CrmHistoryItemOpenLine.prototype.view=function(){if(typeof window.top["BXIM"]==="undefined"){window.alert(this.getMessage("openLineNotSupported"));return}var t="";var e=BX.prop.getObject(this.getAssociatedEntityData(),"COMMUNICATION",null);if(e){if(BX.prop.getString(e,"TYPE")==="IM"){t=BX.prop.getString(e,"VALUE")}}if(t!==""){window.top["BXIM"].openMessenger(t)}};BX.CrmHistoryItemOpenLine.create=function(t,e){var i=new BX.CrmHistoryItemOpenLine;i.initialize(t,e);return i}}if(typeof BX.CrmHistoryItemConversion==="undefined"){BX.CrmHistoryItemConversion=function(){BX.CrmHistoryItemConversion.superclass.constructor.apply(this)};BX.extend(BX.CrmHistoryItemConversion,BX.CrmHistoryItem);BX.CrmHistoryItemConversion.prototype.getMessage=function(t){var e=BX.CrmHistoryItemConversion.messages;return e.hasOwnProperty(t)?e[t]:t};BX.CrmHistoryItemConversion.prototype.getTitle=function(){return this.getTextDataParam("TITLE")};BX.CrmHistoryItemConversion.prototype.prepareContent=function(){var t=BX.create("DIV",{attrs:{className:"crm-entity-stream-section crm-entity-stream-section-convert crm-entity-stream-section-history"}});t.appendChild(BX.create("DIV",{attrs:{className:"crm-entity-stream-section-icon crm-entity-stream-section-icon-convert"}}));var e=BX.create("DIV",{attrs:{className:"crm-entity-stream-content-event"}});var i=this.prepareHeaderLayout();e.appendChild(i);var r=[];var n=this.getArrayDataParam("ENTITIES");for(var s=0,a=n.length;s<a;s++){var o=n[s];var c=BX.create("DIV",{attrs:{className:"crm-entity-stream-content-detail-convert"},children:[BX.create("DIV",{attrs:{className:"crm-entity-stream-content-detain-convert-status"},children:[BX.create("SPAN",{attrs:{className:"crm-entity-stream-content-detail-status-text"},text:BX.CrmEntityType.getCaption(o["ENTITY_TYPE_ID"])})]}),BX.create("SPAN",{attrs:{className:"crm-entity-stream-content-detail-convert-separator-icon"}}),BX.create("DIV",{attrs:{className:"crm-entity-stream-content-detain-convert-status"},children:[BX.create("A",{attrs:{className:"crm-entity-stream-content-detail-target",href:o["SHOW_URL"]},text:o["TITLE"]})]})]});r.push(c)}e.appendChild(BX.create("DIV",{attrs:{className:"crm-entity-stream-content-detail"},children:r}));var m=this.prepareAuthorLayout();if(m){e.appendChild(m)}t.appendChild(BX.create("DIV",{attrs:{className:"crm-entity-stream-section-content"},children:[e]}));return t};if(typeof BX.CrmHistoryItemConversion.messages==="undefined"){BX.CrmHistoryItemConversion.messages={}}BX.CrmHistoryItemConversion.create=function(t,e){var i=new BX.CrmHistoryItemConversion;i.initialize(t,e);return i}}if(typeof BX.CrmHistoryItemVisit==="undefined"){BX.CrmHistoryItemVisit=function(){BX.CrmHistoryItemVisit.superclass.constructor.apply(this);this._playerDummyClickHandler=BX.delegate(this.onPlayerDummyClick,this);this._playerWrapper=null;this._transcriptWrapper=null;this._mediaFileInfo=null};BX.extend(BX.CrmHistoryItemVisit,BX.CrmHistoryItemActivity);BX.CrmHistoryItemVisit.prototype.prepareHeaderLayout=function(){var t=BX.create("DIV",{attrs:{className:"crm-entity-stream-content-header"}});t.appendChild(this.prepareTitleLayout());var e=this.getAssociatedEntityData();var i=BX.prop.getObject(e,"VISIT_INFO",{});var r=BX.prop.getInteger(i,"RECORD_LENGTH",0);var n=BX.prop.getString(i,"RECORD_LENGTH_FORMATTED_FULL","");t.appendChild(BX.create("SPAN",{attrs:{className:"crm-entity-stream-content-event-time"},text:(r>0?n+", "+BX.message("CRM_TIMELINE_VISIT_AT")+" ":"")+this.formatTime(this.getCreatedTime())}));return t};BX.CrmHistoryItemVisit.prototype.prepareContent=function(){var t=this.getAssociatedEntityData();var e=BX.prop.getObject(t,"COMMUNICATION",{});var i=BX.prop.getString(e,"TITLE","");var r=BX.prop.getString(e,"SHOW_URL","");var n=BX.prop.getString(e,"VALUE","");var s=BX.prop.getString(e,"FORMATTED_VALUE",n);var a=BX.prop.getObject(t,"VISIT_INFO",{});var o=BX.prop.getInteger(a,"RECORD_LENGTH",0);var c=BX.prop.getString(a,"RECORD_LENGTH_FORMATTED_SHORT","");var m=BX.prop.getString(a,"VK_PROFILE","");var l=BX.create("DIV",{attrs:{className:"crm-entity-stream-section crm-entity-stream-section-history crm-entity-stream-section-visit"}});l.appendChild(BX.create("DIV",{attrs:{className:"crm-entity-stream-section-icon crm-entity-stream-section-icon-visit"}}));var p=BX.create("DIV",{attrs:{className:"crm-entity-stream-content-event"}});l.appendChild(BX.create("DIV",{attrs:{className:"crm-entity-stream-section-content"},children:[p]}));var h=this.prepareHeaderLayout();p.appendChild(h);var d=BX.create("DIV",{attrs:{className:"crm-entity-stream-content-detail"}});p.appendChild(d);this._mediaFileInfo=BX.prop.getObject(t,"MEDIA_FILE_INFO",null);if(this._mediaFileInfo!==null&&o>0){this._playerWrapper=BX.create("DIV",{attrs:{className:"crm-audio-cap-wrap-container"}});this._playerWrapper.appendChild(BX.create("DIV",{attrs:{className:"crm-audio-cap-wrap"},children:[BX.create("DIV",{attrs:{className:"crm-audio-cap-time"},text:c})],events:{click:this._playerDummyClickHandler}}));d.appendChild(this._playerWrapper)}var u=BX.create("DIV",{attrs:{className:"crm-entity-stream-content-detail-contact-info"}});d.appendChild(u);if(i!==""){u.appendChild(document.createTextNode(BX.message("CRM_TIMELINE_VISIT_WITH")+" "));if(r!==""){u.appendChild(BX.create("A",{attrs:{href:r},text:i}))}else{u.appendChild(BX.create("SPAN",{text:i}))}}if(BX.type.isNotEmptyString(m)){u.appendChild(document.createTextNode(" "));u.appendChild(BX.create("a",{attrs:{className:"crm-entity-stream-content-detail-additional",target:"_blank",href:this.getVkProfileUrl(m)},text:BX.message("CRM_TIMELINE_VISIT_VKONTAKTE_PROFILE")}))}var y=this.prepareAuthorLayout();if(y){p.appendChild(y)}return l};BX.CrmHistoryItemVisit.prototype.onPlayerDummyClick=function(t){var e=this._playerWrapper.querySelector(".crm-audio-cap-wrap");if(e){BX.addClass(e,"crm-audio-cap-wrap-loader")}this._history.getManager().loadMediaPlayer("history_"+this.getId(),this._mediaFileInfo["URL"],this._mediaFileInfo["TYPE"],this._playerWrapper)};BX.CrmHistoryItemVisit.prototype.getVkProfileUrl=function(t){return"https://vk.com/"+BX.util.htmlspecialchars(t)};BX.CrmHistoryItemVisit.create=function(t,e){var i=new BX.CrmHistoryItemVisit;i.initialize(t,e);return i}}if(typeof BX.CrmScheduleItem==="undefined"){BX.CrmScheduleItem=function(){BX.CrmScheduleItem.superclass.constructor.apply(this);this._schedule=null;this._deadlineNode=null;this._isContextMenuShown=false;this._contextMenuButton=null;this._headerClickHandler=BX.delegate(this.onHeaderClick,this);this._setAsDoneButtonHandler=BX.delegate(this.onSetAsDoneButtonClick,this)};BX.extend(BX.CrmScheduleItem,BX.CrmTimelineItem);BX.CrmScheduleItem.prototype.doInitialize=function(){this._schedule=this.getSetting("schedule")};BX.CrmScheduleItem.prototype.getDeadline=function(){return null};BX.CrmScheduleItem.prototype.hasDeadline=function(){return BX.type.isDate(this.getDeadline())};BX.CrmScheduleItem.prototype.isCounterEnabled=function(){var t=this.getDeadline();return t&&BX.CrmHistoryItem.isCounterEnabled(t)};BX.CrmScheduleItem.prototype.getSourceId=function(){return BX.prop.getInteger(this.getAssociatedEntityData(),"ID",0)};BX.CrmScheduleItem.prototype.onSetAsDoneCompleted=function(t){if(!BX.prop.getBoolean(t,"COMPLETED")){return}this.markAsDone(true);this._schedule.onItemMarkedAsDone(this,{historyItemData:BX.prop.getObject(t,"HISTORY_ITEM")})};BX.CrmScheduleItem.prototype.onPosponeCompleted=function(t){};BX.CrmScheduleItem.prototype.refreshDeadline=function(){this._deadlineNode.innerHTML=this.formatDateTime(this.getDeadline())};BX.CrmScheduleItem.prototype.formatDateTime=function(t){return this._schedule.formatDateTime(t)};BX.CrmScheduleItem.prototype.getWrapperClassName=function(){return""};BX.CrmScheduleItem.prototype.getIconClassName=function(){return"crm-entity-stream-section-icon"};BX.CrmScheduleItem.prototype.prepareContextMenuButton=function(){this._contextMenuButton=BX.create("DIV",{attrs:{className:"crm-entity-stream-section-context-menu"},events:{click:BX.delegate(this.onContextMenuButtonClick,this)}});return this._contextMenuButton};BX.CrmScheduleItem.prototype.isReadOnly=function(){return this._schedule.isReadOnly()};BX.CrmScheduleItem.prototype.canPostpone=function(){if(this.isReadOnly()){return false}var t=BX.prop.getObject(this.getAssociatedEntityData(),"PERMISSIONS",{});return BX.prop.getBoolean(t,"POSTPONE",false)};BX.CrmScheduleItem.prototype.isDone=function(){return BX.CrmActivityStatus.isFinal(BX.prop.getInteger(this.getAssociatedEntityData(),"STATUS",0))};BX.CrmScheduleItem.prototype.canComplete=function(){if(this.isReadOnly()){return false}var t=BX.prop.getObject(this.getAssociatedEntityData(),"PERMISSIONS",{});return BX.prop.getBoolean(t,"COMPLETE",false)};BX.CrmScheduleItem.prototype.setAsDone=function(t){};BX.CrmScheduleItem.prototype.prepareContent=function(t){return null};BX.CrmScheduleItem.prototype.prepareLayout=function(t){this._wrapper=this.prepareContent(t);if(this._wrapper){var e=BX.type.isPlainObject(t)?BX.prop.getBoolean(t,"add",true):true;if(e){var i=BX.type.isPlainObject(t)&&BX.type.isElementNode(t["anchor"])?t["anchor"]:null;if(i&&i.nextSibling){this._container.insertBefore(this._wrapper,i.nextSibling)}else{this._container.appendChild(this._wrapper)}}this.markAsTerminated(this._schedule.checkItemForTermination(this))}};BX.CrmScheduleItem.prototype.onHeaderClick=function(t){this.view();t.preventDefault?t.preventDefault():t.returnValue=false};BX.CrmScheduleItem.prototype.onSetAsDoneButtonClick=function(t){if(this.canComplete()){this.setAsDone(!this.isDone())}};BX.CrmScheduleItem.prototype.onActivityCreate=function(t,e){this._schedule.getManager().onActivityCreated(t,e)};BX.CrmScheduleItem.prototype.onContextMenuButtonClick=function(t){if(!this._isContextMenuShown){this.openContextMenu()}else{this.closeContextMenu()}};BX.CrmScheduleItem.prototype.openContextMenu=function(){var t=this.prepareContextMenuItems();if(t.length===0){return}BX.PopupMenu.show(this._id,this._contextMenuButton,t,{offsetTop:0,offsetLeft:16,angle:{position:"top",offset:0},events:{onPopupShow:BX.delegate(this.onContextMenuShow,this),onPopupClose:BX.delegate(this.onContextMenuClose,this),onPopupDestroy:BX.delegate(this.onContextMenuDestroy,this)}});this._contextMenu=BX.PopupMenu.currentItem};BX.CrmScheduleItem.prototype.closeContextMenu=function(){if(this._contextMenu){this._contextMenu.close()}};BX.CrmScheduleItem.prototype.prepareContextMenuItems=function(){return[]};BX.CrmScheduleItem.prototype.onContextMenuShow=function(){this._isContextMenuShown=true;BX.addClass(this._contextMenuButton,"active")};BX.CrmScheduleItem.prototype.onContextMenuClose=function(){if(this._contextMenu){this._contextMenu.popupWindow.destroy()}};BX.CrmScheduleItem.prototype.onContextMenuDestroy=function(){this._isContextMenuShown=false;BX.removeClass(this._contextMenuButton,"active");this._contextMenu=null;if(typeof BX.PopupMenu.Data[this._id]!=="undefined"){delete BX.PopupMenu.Data[this._id]}};BX.CrmScheduleItem.isDone=function(t){var e=BX.prop.getObject(t,"ASSOCIATED_ENTITY",{});return BX.CrmActivityStatus.isFinal(BX.prop.getInteger(e,"STATUS",0))};BX.CrmScheduleItem.create=function(t,e){var i=new BX.CrmScheduleItem;i.initialize(t,e);return i}}if(typeof BX.CrmScheduleItemActivity==="undefined"){BX.CrmScheduleItemActivity=function(){BX.CrmScheduleItemActivity.superclass.constructor.apply(this);this._postponeController=null};BX.extend(BX.CrmScheduleItemActivity,BX.CrmScheduleItem);BX.CrmScheduleItemActivity.prototype.getTypeId=function(){return BX.CrmTimelineType.activity};BX.CrmScheduleItemActivity.prototype.isDone=function(){var t=BX.prop.getInteger(this.getAssociatedEntityData(),"STATUS");return t===BX.CrmActivityStatus.completed||t===BX.CrmActivityStatus.autoCompleted};BX.CrmScheduleItemActivity.prototype.setAsDone=function(t){t=!!t;if(this.isDone()===t){return}var e=BX.prop.getInteger(this.getAssociatedEntityData(),"ID",0);if(e>0){this._activityEditor.setActivityCompleted(e,t,BX.delegate(this.onSetAsDoneCompleted,this))}};BX.CrmScheduleItemActivity.prototype.postpone=function(t){var e=this.getSourceId();if(e>0&&t>0){this._activityEditor.postponeActivity(e,t,BX.delegate(this.onPosponeCompleted,this))}};BX.CrmScheduleItemActivity.prototype.view=function(){var t=BX.prop.getInteger(this.getAssociatedEntityData(),"ID",0);if(t>0){this._activityEditor.viewActivity(t)}};BX.CrmScheduleItemActivity.prototype.getDeadline=function(){var t=this.getAssociatedEntityData();var e=BX.parseDate(t["DEADLINE_SERVER"],false,"YYYY-MM-DD","YYYY-MM-DD HH:MI:SS");if(!e){return null}return new Date(e.getTime()+1e3*BX.CrmTimelineItem.getUserTimezoneOffset())};BX.CrmScheduleItemActivity.prototype.markAsDone=function(t){t=!!t;this.getAssociatedEntityData()["STATUS"]=t?BX.CrmActivityStatus.completed:BX.CrmActivityStatus.waiting};BX.CrmScheduleItemActivity.prototype.getPrepositionText=function(t){return this.getMessage(t===BX.CrmActivityDirection.incoming?"from":"to")};BX.CrmScheduleItemActivity.prototype.getTypeDescription=function(t){return""};BX.CrmScheduleItemActivity.prototype.isContextMenuEnabled=function(){return!!this.getDeadline()&&this.canPostpone()};BX.CrmScheduleItemActivity.prototype.prepareContent=function(t){var e=this.getDeadline();var i=e?this.formatDateTime(e):this.getMessage("termless");var r=this.getAssociatedEntityData();var n=BX.prop.getInteger(r,"DIRECTION",0);var s=this.isDone();var a=BX.prop.getString(r,"SUBJECT","");var o=BX.prop.getString(r,"DESCRIPTION_RAW","");var c=BX.prop.getObject(r,"COMMUNICATION",{});var m=BX.prop.getString(c,"TITLE","");var l=BX.prop.getString(c,"SHOW_URL","");var p=BX.prop.getString(c,"TYPE","")!==""?BX.prop.getString(c,"VALUE",""):"";var h=this.getWrapperClassName();if(h!==""){h="crm-entity-stream-section crm-entity-stream-section-planned"+" "+h}else{h="crm-entity-stream-section crm-entity-stream-section-planned"}var d=BX.create("DIV",{attrs:{className:h}});var u=this.getIconClassName();if(this.isCounterEnabled()){u+=" crm-entity-stream-section-counter"}d.appendChild(BX.create("DIV",{attrs:{className:u}}));if(this.isContextMenuEnabled()){d.appendChild(this.prepareContextMenuButton())}var y=BX.create("DIV",{attrs:{className:"crm-entity-stream-section-content"}});d.appendChild(y);if(o!==""){o=o.replace(/^\s+/,"")}var B=BX.create("DIV",{attrs:{className:"crm-entity-stream-content-event"}});y.appendChild(B);this._deadlineNode=BX.create("SPAN",{attrs:{className:"crm-entity-stream-content-event-time"},text:i});var f=BX.create("DIV",{attrs:{className:"crm-entity-stream-content-header"},children:[BX.create("SPAN",{attrs:{className:"crm-entity-stream-content-event-title"},text:this.getTypeDescription(n)}),this._deadlineNode]});B.appendChild(f);var g=BX.create("DIV",{attrs:{className:"crm-entity-stream-content-detail"}});B.appendChild(g);g.appendChild(BX.create("DIV",{attrs:{className:"crm-entity-stream-content-detail-title"},children:[BX.create("A",{attrs:{href:"#"},events:{click:this._headerClickHandler},text:a})]}));g.appendChild(BX.create("DIV",{attrs:{className:"crm-entity-stream-content-detail-description"},html:this.cutOffText(o,128)}));var C=this.prepareDetailNodes();if(BX.type.isArray(C)){for(var X=0,_=C.length;X<_;X++){g.appendChild(C[X])}}var I=BX.create("DIV",{attrs:{className:"crm-entity-stream-content-detail-contact-info"}});if(m!==""){I.appendChild(BX.create("SPAN",{text:this.getPrepositionText(n)+": "}));if(l!==""){I.appendChild(BX.create("A",{attrs:{href:l},text:m}))}else{I.appendChild(BX.create("SPAN",{text:m}))}}if(p!==""){var v=this.prepareCommunicationNode(p);if(v){I.appendChild(v)}}g.appendChild(I);var T=BX.create("INPUT",{attrs:{type:"checkbox",className:"crm-entity-stream-planned-apply-btn",checked:s},events:{change:this._setAsDoneButtonHandler}});if(!this.canComplete()){T.disabled=true}var S=BX.create("DIV",{attrs:{className:"crm-entity-stream-content-detail-planned-action"},children:[T]});B.appendChild(S);var E=this.prepareAuthorLayout();if(E){B.appendChild(E)}this._actionContainer=BX.create("DIV",{attrs:{className:"crm-entity-stream-content-detail-action"}});B.appendChild(this._actionContainer);return d};BX.CrmScheduleItemActivity.prototype.prepareCommunicationNode=function(t){return BX.create("SPAN",{text:" "+t})};BX.CrmScheduleItemActivity.prototype.prepareDetailNodes=function(){return[]};BX.CrmScheduleItemActivity.prototype.prepareContextMenuItems=function(){var t=[];var e=BX.delegate(this.onContextMenuItemSelect,this);if(!this._postponeController){this._postponeController=BX.CrmSchedulePostponeController.create("",{item:this})}var i={id:"postpone",text:this._postponeController.getTitle(),items:[]};var r=this._postponeController.getCommandList();for(var n=0,s=r.length;n<s;n++){var a=r[n];i.items.push({id:a["name"],text:a["title"],onclick:e})}t.push(i);return t};BX.CrmScheduleItemActivity.prototype.onContextMenuItemSelect=function(t,e){this.closeContextMenu();if(this._postponeController){this._postponeController.processCommand(e.id)}}}if(typeof BX.CrmScheduleItemEmail==="undefined"){BX.CrmScheduleItemEmail=function(){BX.CrmScheduleItemEmail.superclass.constructor.apply(this)};BX.extend(BX.CrmScheduleItemEmail,BX.CrmScheduleItemActivity);BX.CrmScheduleItemEmail.prototype.getWrapperClassName=function(){return"crm-entity-stream-section-email"};BX.CrmScheduleItemEmail.prototype.getIconClassName=function(){return"crm-entity-stream-section-icon crm-entity-stream-section-icon-email"};BX.CrmScheduleItemEmail.prototype.prepareActions=function(){if(this.isReadOnly()){return}this._actions.push(BX.CrmScheduleEmailAction.create("email",{item:this,container:this._actionContainer,entityData:this.getAssociatedEntityData(),activityEditor:this._activityEditor}))};BX.CrmScheduleItemEmail.prototype.getTypeDescription=function(t){return this.getMessage(t===BX.CrmActivityDirection.incoming?"incomingEmail":"outgoingEmail")};BX.CrmScheduleItemEmail.create=function(t,e){var i=new BX.CrmScheduleItemEmail;i.initialize(t,e);return i}}if(typeof BX.CrmScheduleItemCall==="undefined"){BX.CrmScheduleItemCall=function(){BX.CrmScheduleItemCall.superclass.constructor.apply(this)};BX.extend(BX.CrmScheduleItemCall,BX.CrmScheduleItemActivity);BX.CrmScheduleItemCall.prototype.getWrapperClassName=function(){return"crm-entity-stream-section-call"};BX.CrmScheduleItemCall.prototype.getIconClassName=function(){return"crm-entity-stream-section-icon crm-entity-stream-section-icon-call"};BX.CrmScheduleItemCall.prototype.prepareActions=function(){if(this.isReadOnly()){return}this._actions.push(BX.CrmScheduleCallAction.create("call",{item:this,container:this._actionContainer,entityData:this.getAssociatedEntityData(),activityEditor:this._activityEditor,ownerInfo:this._schedule.getOwnerInfo()}))};BX.CrmScheduleItemCall.prototype.getTypeDescription=function(t){var e=this.getAssociatedEntityData();var i=BX.prop.getObject(e,"CALL_INFO",null);var r=i!==null?BX.prop.getString(i,"CALL_TYPE_TEXT",""):"";if(r!==""){return r}return this.getMessage(t===BX.CrmActivityDirection.incoming?"incomingCall":"outgoingCall")};BX.CrmScheduleItemCall.create=function(t,e){var i=new BX.CrmScheduleItemCall;i.initialize(t,e);return i}}if(typeof BX.CrmScheduleItemMeeting==="undefined"){BX.CrmScheduleItemMeeting=function(){BX.CrmScheduleItemMeeting.superclass.constructor.apply(this)};BX.extend(BX.CrmScheduleItemMeeting,BX.CrmScheduleItemActivity);BX.CrmScheduleItemMeeting.prototype.getWrapperClassName=function(){return""};BX.CrmScheduleItemMeeting.prototype.getIconClassName=function(){return"crm-entity-stream-section-icon crm-entity-stream-section-icon-meeting"};BX.CrmScheduleItemMeeting.prototype.prepareActions=function(){};BX.CrmScheduleItemMeeting.prototype.getPrepositionText=function(){return this.getMessage("reciprocal")};BX.CrmScheduleItemMeeting.prototype.getTypeDescription=function(){return this.getMessage("meeting")};BX.CrmScheduleItemMeeting.create=function(t,e){var i=new BX.CrmScheduleItemMeeting;i.initialize(t,e);return i}}if(typeof BX.CrmScheduleItemTask==="undefined"){BX.CrmScheduleItemTask=function(){BX.CrmScheduleItemTask.superclass.constructor.apply(this)};BX.extend(BX.CrmScheduleItemTask,BX.CrmScheduleItemActivity);BX.CrmScheduleItemTask.prototype.getWrapperClassName=function(){return"crm-entity-stream-section-planned-task"};BX.CrmScheduleItemTask.prototype.getIconClassName=function(){return"crm-entity-stream-section-icon crm-entity-stream-section-icon-task"};BX.CrmScheduleItemTask.prototype.getTypeDescription=function(){return this.getMessage("task")};BX.CrmScheduleItemTask.prototype.getPrepositionText=function(t){return this.getMessage("reciprocal")};BX.CrmScheduleItemTask.create=function(t,e){var i=new BX.CrmScheduleItemTask;i.initialize(t,e);return i}}if(typeof BX.CrmScheduleItemWebForm==="undefined"){BX.CrmScheduleItemWebForm=function(){BX.CrmScheduleItemWebForm.superclass.constructor.apply(this)};BX.extend(BX.CrmScheduleItemWebForm,BX.CrmScheduleItemActivity);BX.CrmScheduleItemWebForm.prototype.getWrapperClassName=function(){return""};BX.CrmScheduleItemWebForm.prototype.getIconClassName=function(){return"crm-entity-stream-section-icon crm-entity-stream-section-icon-crmForm"};BX.CrmScheduleItemWebForm.prototype.prepareActions=function(){};BX.CrmScheduleItemWebForm.prototype.getPrepositionText=function(){return this.getMessage("from")};BX.CrmScheduleItemWebForm.prototype.getTypeDescription=function(){return this.getMessage("webform")};BX.CrmScheduleItemWebForm.create=function(t,e){var i=new BX.CrmScheduleItemWebForm;i.initialize(t,e);return i}}if(typeof BX.CrmScheduleItemWait==="undefined"){BX.CrmScheduleItemWait=function(){BX.CrmScheduleItemWait.superclass.constructor.apply(this);this._postponeController=null};BX.extend(BX.CrmScheduleItemWait,BX.CrmScheduleItem);BX.CrmScheduleItemWait.prototype.getWrapperClassName=function(){return"crm-entity-stream-section-wait"};BX.CrmScheduleItemWait.prototype.getIconClassName=function(){return"crm-entity-stream-section-icon crm-entity-stream-section-icon-wait"};BX.CrmScheduleItemWait.prototype.prepareActions=function(){};BX.CrmScheduleItemWait.prototype.isCounterEnabled=function(){return false};BX.CrmScheduleItemWait.prototype.getDeadline=function(){var t=this.getAssociatedEntityData();var e=BX.parseDate(t["DEADLINE_SERVER"],false,"YYYY-MM-DD","YYYY-MM-DD HH:MI:SS");if(!e){return null}return new Date(e.getTime()+1e3*BX.CrmTimelineItem.getUserTimezoneOffset())};BX.CrmScheduleItemWait.prototype.isDone=function(){return BX.prop.getString(this.getAssociatedEntityData(),"COMPLETED","N")==="Y"};BX.CrmScheduleItemWait.prototype.setAsDone=function(t){t=!!t;if(this.isDone()===t){return}var e=this.getAssociatedEntityId();if(e>0){var i=this._schedule.getManager().getWaitEditor();if(i){i.complete(e,t,BX.delegate(this.onSetAsDoneCompleted,this))}}};BX.CrmScheduleItemWait.prototype.postpone=function(t){var e=this.getAssociatedEntityId();if(e>0&&t>0){var i=this._schedule.getManager().getWaitEditor();if(i){i.postpone(e,t,BX.delegate(this.onPosponeCompleted,this))}}};BX.CrmScheduleItemWait.prototype.isContextMenuEnabled=function(){return!!this.getDeadline()&&this.canPostpone()};BX.CrmScheduleItemWait.prototype.prepareContent=function(){var t=this.getDeadline();var e=t?this.formatDateTime(t):this.getMessage("termless");var i=this.getAssociatedEntityData();var r=this.isDone();var n=BX.prop.getString(i,"DESCRIPTION_RAW","");var s=this.getWrapperClassName();if(s!==""){s="crm-entity-stream-section crm-entity-stream-section-planned"+" "+s}else{s="crm-entity-stream-section crm-entity-stream-section-planned"}var a=BX.create("DIV",{attrs:{className:s}});var o=this.getIconClassName();if(this.isCounterEnabled()){o+=" crm-entity-stream-section-counter"}a.appendChild(BX.create("DIV",{attrs:{className:o}}));if(this.isContextMenuEnabled()){a.appendChild(this.prepareContextMenuButton())}var c=BX.create("DIV",{attrs:{className:"crm-entity-stream-section-content"}});a.appendChild(c);if(n!==""){n=BX.util.trim(n);n=BX.util.strip_tags(n);n=this.cutOffText(n,512);n=BX.util.nl2br(n)}var m=BX.create("DIV",{attrs:{className:"crm-entity-stream-content-event"}});c.appendChild(m);this._deadlineNode=BX.create("SPAN",{attrs:{className:"crm-entity-stream-content-event-time"},text:e});var l=BX.create("DIV",{attrs:{className:"crm-entity-stream-content-header"},children:[BX.create("SPAN",{attrs:{className:"crm-entity-stream-content-event-title"},text:this.getMessage("wait")}),this._deadlineNode]});m.appendChild(l);var p=BX.create("DIV",{attrs:{className:"crm-entity-stream-content-detail"}});m.appendChild(p);p.appendChild(BX.create("DIV",{attrs:{className:"crm-entity-stream-content-detail-description"},html:n}));var h=BX.create("DIV",{attrs:{className:"crm-entity-stream-content-detail-contact-info"}});p.appendChild(h);var d=BX.create("INPUT",{attrs:{type:"checkbox",className:"crm-entity-stream-planned-apply-btn",checked:r},events:{change:this._setAsDoneButtonHandler}});if(!this.canComplete()){d.disabled=true}var u=BX.create("DIV",{attrs:{className:"crm-entity-stream-content-detail-planned-action"},children:[d]});m.appendChild(u);var y=this.prepareAuthorLayout();if(y){m.appendChild(y)}this._actionContainer=BX.create("DIV",{attrs:{className:"crm-entity-stream-content-detail-action"}});m.appendChild(this._actionContainer);return a};BX.CrmScheduleItemWait.prototype.prepareContextMenuItems=function(){var t=[];var e=BX.delegate(this.onContextMenuItemSelect,this);if(!this._postponeController){this._postponeController=BX.CrmSchedulePostponeController.create("",{item:this})}var i={id:"postpone",text:this._postponeController.getTitle(),items:[]};var r=this._postponeController.getCommandList();for(var n=0,s=r.length;n<s;n++){var a=r[n];i.items.push({id:a["name"],text:a["title"],onclick:e})}t.push(i);return t};BX.CrmScheduleItemWait.prototype.onContextMenuItemSelect=function(t,e){this.closeContextMenu();if(this._postponeController){this._postponeController.processCommand(e.id)}};BX.CrmScheduleItemWait.prototype.getTypeDescription=function(){return this.getMessage("wait")};BX.CrmScheduleItemWait.create=function(t,e){var i=new BX.CrmScheduleItemWait;i.initialize(t,e);return i}}if(typeof BX.CrmScheduleItemActivityRequest==="undefined"){BX.CrmScheduleItemActivityRequest=function(){BX.CrmScheduleItemActivityRequest.superclass.constructor.apply(this)};BX.extend(BX.CrmScheduleItemActivityRequest,BX.CrmScheduleItemActivity);BX.CrmScheduleItemActivityRequest.prototype.getWrapperClassName=function(){return""};BX.CrmScheduleItemActivityRequest.prototype.getIconClassName=function(){return"crm-entity-stream-section-icon crm-entity-stream-section-icon-robot"};BX.CrmScheduleItemActivityRequest.prototype.getTypeDescription=function(){return this.getMessage("activityRequest")};BX.CrmScheduleItemActivityRequest.create=function(t,e){var i=new BX.CrmScheduleItemActivityRequest;i.initialize(t,e);return i}}if(typeof BX.CrmScheduleItemActivityRestApplication==="undefined"){BX.CrmScheduleItemActivityRestApplication=function(){BX.CrmScheduleItemActivityRestApplication.superclass.constructor.apply(this)};BX.extend(BX.CrmScheduleItemActivityRestApplication,BX.CrmScheduleItemActivity);BX.CrmScheduleItemActivityRestApplication.prototype.getWrapperClassName=function(){return""};BX.CrmScheduleItemActivityRestApplication.prototype.getIconClassName=function(){return"crm-entity-stream-section-icon crm-entity-stream-section-icon-rest"};BX.CrmScheduleItemActivityRestApplication.prototype.getTypeDescription=function(){return this.getMessage("restApplication")};BX.CrmScheduleItemActivityRestApplication.create=function(t,e){var i=new BX.CrmScheduleItemActivityRestApplication;i.initialize(t,e);return i}}if(typeof BX.CrmScheduleItemActivityOpenLine==="undefined"){BX.CrmScheduleItemActivityOpenLine=function(){BX.CrmScheduleItemActivityOpenLine.superclass.constructor.apply(this)};BX.extend(BX.CrmScheduleItemActivityOpenLine,BX.CrmScheduleItemActivity);BX.CrmScheduleItemActivityOpenLine.prototype.getWrapperClassName=function(){return"crm-entity-stream-section-IM"};BX.CrmScheduleItemActivityOpenLine.prototype.getIconClassName=function(){return"crm-entity-stream-section-icon crm-entity-stream-section-icon-IM"};BX.CrmScheduleItemActivityOpenLine.prototype.prepareActions=function(){if(this.isReadOnly()){return}this._actions.push(BX.CrmScheduleOpenLineAction.create("openline",{item:this,container:this._actionContainer,entityData:this.getAssociatedEntityData(),activityEditor:this._activityEditor,ownerInfo:this._schedule.getOwnerInfo()}))};BX.CrmScheduleItemActivityOpenLine.prototype.getTypeDescription=function(){return this.getMessage("openLine")};BX.CrmScheduleItemActivityOpenLine.prototype.getPrepositionText=function(t){return this.getMessage("reciprocal")};BX.CrmScheduleItemActivityOpenLine.prototype.prepareCommunicationNode=function(t){return null};BX.CrmScheduleItemActivityOpenLine.prototype.prepareDetailNodes=function(){var t=BX.create("DIV",{attrs:{className:"crm-entity-stream-content-detail-IM"}});var e=BX.create("DIV",{attrs:{className:"crm-entity-stream-content-detail-IM-messages"}});t.appendChild(e);var i=BX.prop.getObject(this.getAssociatedEntityData(),"OPENLINE_INFO",null);if(i){var r=BX.prop.getArray(i,"MESSAGES",[]);for(var n=0,s=r.length;n<s;n++){var a=r[n];var o=BX.prop.getBoolean(a,"IS_EXTERNAL",true);e.appendChild(BX.create("DIV",{attrs:{className:o?"crm-entity-stream-content-detail-IM-message-incoming":"crm-entity-stream-content-detail-IM-message-outgoing"},text:BX.prop.getString(a,"MESSAGE","")}))}}return[t]};BX.CrmScheduleItemActivityOpenLine.prototype.view=function(){if(typeof window.top["BXIM"]==="undefined"){window.alert(this.getMessage("openLineNotSupported"));return}var t="";var e=BX.prop.getObject(this.getAssociatedEntityData(),"COMMUNICATION",null);if(e){if(BX.prop.getString(e,"TYPE")==="IM"){t=BX.prop.getString(e,"VALUE")}}if(t!==""){window.top["BXIM"].openMessenger(t)}};BX.CrmScheduleItemActivityOpenLine.create=function(t,e){var i=new BX.CrmScheduleItemActivityOpenLine;i.initialize(t,e);return i}}if(typeof BX.CrmTimelineItemAnimation==="undefined"){BX.CrmTimelineItemAnimation=function(){this._id="";this._settings={};this._initialItem=null;this._finalItem=null;this._events=null};BX.CrmTimelineItemAnimation.prototype={initialize:function(t,e){this._id=BX.type.isNotEmptyString(t)?t:BX.util.getRandomString(4);this._settings=e?e:{};this._initialItem=this.getSetting("initialItem");this._finalItem=this.getSetting("finalItem");this._anchor=this.getSetting("anchor");this._events=this.getSetting("events",{})},getId:function(){return this._id},getSetting:function(t,e){return this._settings.hasOwnProperty(t)?this._settings[t]:e},run:function(){this._node=this._initialItem.getWrapper();var t=BX.pos(this._node);this._initialYPosition=t.top;this._initialXPosition=t.left;this._initialWidth=this._node.offsetWidth;this._initialHeight=this._node.offsetHeight;this._anchorYPosition=BX.pos(this._anchor).top;this.createStub();this.createGhost();this.moveGhost()},createStub:function(){this._stub=BX.create("DIV",{attrs:{className:"crm-entity-stream-section crm-entity-stream-section-planned crm-entity-stream-section-shadow"},children:[BX.create("DIV",{attrs:{className:"crm-entity-stream-section-icon"}}),BX.create("DIV",{props:{className:"crm-entity-stream-section-content"},style:{height:this._initialHeight+"px"}})]});this._node.parentNode.insertBefore(this._stub,this._node)},createGhost:function(){this._ghostNode=this._node;this._ghostNode.style.position="absolute";this._ghostNode.style.width=this._initialWidth+"px";this._ghostNode.style.height=this._initialHeight+"px";this._ghostNode.style.top=this._initialYPosition+"px";this._ghostNode.style.left=this._initialXPosition+"px";document.body.appendChild(this._ghostNode);setTimeout(BX.proxy(function(){BX.addClass(this._ghostNode,"crm-entity-stream-section-casper")},this),20)},moveGhost:function(){var t=this._ghostNode;var e=new BX.easing({duration:500,start:{top:this._initialYPosition},finish:{top:this._anchorYPosition},transition:BX.easing.makeEaseOut(BX.easing.transitions.quart),step:BX.proxy(function(e){t.style.top=e.top+"px"},this)});setTimeout(BX.proxy(function(){e.animate();t.style.boxShadow=""},this),500);var i=new BX.easing({duration:500,start:{height:0},finish:{height:this._initialHeight+20},transition:BX.easing.makeEaseOut(BX.easing.transitions.quart),step:BX.proxy(function(t){this._anchor.style.height=t.height+"px"},this),complete:BX.proxy(function(){if(BX.type.isFunction(this._events["complete"])){this._events["complete"]()}this.addHistoryItem();this.removeGhost()},this)});setTimeout(function(){i.animate()},500)},addHistoryItem:function(){var t=this._finalItem.getWrapper();this._anchor.parentNode.insertBefore(t,this._anchor.nextSibling);this._finalItemHeight=this._anchor.offsetHeight-t.offsetHeight;this._anchor.style.height=0;t.style.marginBottom=this._finalItemHeight+"px"},removeGhost:function(){var t=this._ghostNode;var e=this._finalItem.getWrapper();t.style.overflow="hidden";var i=new BX.easing({duration:70,start:{opacity:100,height:t.offsetHeight,marginBottom:this._finalItemHeight},finish:{opacity:0,height:e.offsetHeight,marginBottom:20},step:BX.proxy(function(i){t.style.opacity=i.opacity/100;t.style.height=i.height+"px";e.style.marginBottom=i.marginBottom+"px"},this),complete:BX.proxy(function(){t.remove();e.style.marginBottom="";this.collapseStub()},this)});i.animate()},collapseStub:function(){var t=new BX.easing({duration:500,start:{opacity:100,height:this._initialHeight,marginBottom:15},finish:{opacity:0,height:0,marginBottom:0},transition:BX.easing.makeEaseOut(BX.easing.transitions.quart),step:BX.proxy(function(t){this._stub.style.height=t.height+"px";this._stub.style.marginBottom=t.marginBottom+"px";this._stub.style.opacity=t.opacity/100},this),complete:BX.proxy(function(){this.inited=false},this)});t.animate()}};BX.CrmTimelineItemAnimation.create=function(t,e){var i=new BX.CrmTimelineItemAnimation;i.initialize(t,e);return i}}if(typeof BX.CrmTimelineItemAnimationNew==="undefined"){BX.CrmTimelineItemAnimationNew=function(){this._id="";this._settings={};this._initialItem=null;this._finalItem=null;this._events=null};BX.CrmTimelineItemAnimationNew.prototype={initialize:function(t,e){this._id=BX.type.isNotEmptyString(t)?t:BX.util.getRandomString(4);this._settings=e?e:{};this._initialItem=this.getSetting("initialItem");this._finalItem=this.getSetting("finalItem");this._anchor=this.getSetting("anchor");this._events=this.getSetting("events",{})},getId:function(){return this._id},getSetting:function(t,e){return this._settings.hasOwnProperty(t)?this._settings[t]:e},addHistoryItem:function(){var t=this._finalItem.getWrapper();this._anchor.parentNode.insertBefore(t,this._anchor.nextSibling)},run:function(){this._node=this._initialItem.getWrapper();this.createStub();BX.addClass(this._node,"crm-entity-stream-section-animate-start");this._startPosition=BX.pos(this._stub);this._node.style.position="absolute";this._node.style.width=this._startPosition.width+"px";this._node.style.height=this._startPosition.height+"px";this._node.style.top=this._startPosition.top+"px";this._node.style.left=this._startPosition.left+"px";this._node.style.zIndex=1100;document.body.appendChild(this._node);var t=BX.CrmTimelineItemShift.create(this._node,this._anchor,this._startPosition,this._stub,{complete:BX.delegate(this.finish,this)});t.run()},createStub:function(){this._stub=BX.create("DIV",{attrs:{className:"crm-entity-stream-section crm-entity-stream-section-planned crm-entity-stream-section-shadow"},children:[BX.create("DIV",{attrs:{className:"crm-entity-stream-section-icon"}}),BX.create("DIV",{props:{className:"crm-entity-stream-section-content"},style:{height:this._initialItem._wrapper.clientHeight+"px"}})]});this._node.parentNode.insertBefore(this._stub,this._node)},finish:function(){var t=this._stub.querySelector(".crm-entity-stream-section-content");this._anchor.style.height=0;setTimeout(BX.delegate(function(){BX.removeClass(this._node,"crm-entity-stream-section-animate-start")},this),0);this._node.style.opacity=0;setTimeout(BX.delegate(function(){t.style.height=0;t.style.opacity=0;t.style.paddingTop=0;t.style.paddingBottom=0},this),120);setTimeout(BX.delegate(function(){BX.remove(this._stub);BX.remove(this._node);this.addHistoryItem();if(BX.type.isFunction(this._events["complete"])){this._events["complete"]()}},this),420)}};BX.CrmTimelineItemAnimationNew.create=function(t,e){var i=new BX.CrmTimelineItemAnimationNew;i.initialize(t,e);return i}}if(typeof BX.CrmTimelineItemExpand==="undefined"){BX.CrmTimelineItemExpand=function(){this._node=null;this._callback=null};BX.CrmTimelineItemExpand.prototype={initialize:function(t,e){this._node=t;this._callback=BX.type.isFunction(e)?e:null},run:function(){var t=BX.pos(this._node);this._node.style.height=0;this._node.style.opacity=0;this._node.style.overflow="hidden";new BX.easing({duration:150,start:{height:0},finish:{height:t.height},transition:BX.easing.makeEaseOut(BX.easing.transitions.quart),step:BX.delegate(this.onNodeHeightStep,this),complete:BX.delegate(this.onNodeHeightComplete,this)}).animate()},onNodeHeightStep:function(t){this._node.style.height=t.height+"px"},onNodeHeightComplete:function(){this._node.style.overflow="";new BX.easing({duration:150,start:{opacity:0},finish:{opacity:100},transition:BX.easing.makeEaseOut(BX.easing.transitions.quart),step:BX.delegate(this.onNodeOpacityStep,this),complete:BX.delegate(this.onNodeOpacityComplete,this)}).animate()},onNodeOpacityStep:function(t){this._node.style.opacity=t.opacity/100},onNodeOpacityComplete:function(){this._node.style.height="";this._node.style.opacity="";if(this._callback){this._callback()}}};BX.CrmTimelineItemExpand.create=function(t,e){var i=new BX.CrmTimelineItemExpand;i.initialize(t,e);return i}}if(typeof BX.CrmTimelineItemExtract==="undefined"){BX.CrmTimelineItemExtract=function(){this._node=null;this._shadowNode=null;this._events=null};BX.CrmTimelineItemExtract.prototype={initialize:function(t,e,i){this._node=t;this._shadowNode=e;this._events=BX.type.isPlainObject(i)?i:{}},run:function(){},finish:function(){}};BX.CrmTimelineItemExtract.create=function(t,e,i){var r=new BX.CrmTimelineItemExtract;r.initialize(t,e,i);return r}}if(typeof BX.CrmTimelineItemShift==="undefined"){BX.CrmTimelineItemShift=function(){this._node=null;this._anchor=null;this._nodeParent=null;this._startPosition=null;this._events=null};BX.CrmTimelineItemShift.prototype={initialize:function(t,e,i,r,n){this._node=t;this._shadowNode=r;this._anchor=e;this._nodeParent=t.parentNode;this._startPosition=i;this._events=BX.type.isPlainObject(n)?n:{}},run:function(){this._anchorPosition=BX.pos(this._anchor);setTimeout(BX.proxy(function(){BX.addClass(this._node,"crm-entity-stream-section-casper")},this),0);var t=new BX.easing({duration:1500,start:{top:this._startPosition.top,height:0},finish:{top:this._anchorPosition.top,height:this._startPosition.height+20},transition:BX.easing.makeEaseOut(BX.easing.transitions.quart),step:BX.proxy(function(t){this._node.style.top=t.top+"px";this._anchor.style.height=t.height+"px"},this),complete:BX.proxy(function(){this.finish()},this)});t.animate()},finish:function(){if(BX.type.isFunction(this._events["complete"])){this._events["complete"]()}if(this._shadowNode!==false){}}};BX.CrmTimelineItemShift.create=function(t,e,i,r,n){var s=new BX.CrmTimelineItemShift;s.initialize(t,e,i,r,n);return s}}if(typeof BX.CrmCommentAnimation==="undefined"){BX.CrmCommentAnimation=function(){this._node=null;this._anchor=null;this._nodeParent=null;this._startPosition=null;this._events=null};BX.CrmCommentAnimation.prototype={initialize:function(t,e,i,r){this._node=t;this._anchor=e;this._nodeParent=t.parentNode;this._startPosition=i;this._events=BX.type.isPlainObject(r)?r:{}},run:function(){BX.addClass(this._node,"crm-entity-stream-section-animate-start");this._node.style.position="absolute";this._node.style.width=this._startPosition.width+"px";this._node.style.height=this._startPosition.height+"px";this._node.style.top=this._startPosition.top-30+"px";this._node.style.left=this._startPosition.left+"px";this._node.style.opacity=0;this._node.style.zIndex=1100;document.body.appendChild(this._node);var t=new BX.easing({duration:350,start:{opacity:0},finish:{opacity:100},transition:BX.easing.makeEaseOut(BX.easing.transitions.quart),step:BX.proxy(function(t){this._node.style.opacity=t.opacity/100},this),complete:BX.proxy(function(){if(BX.type.isFunction(this._events["start"])){this._events["start"]()}var t=BX.CrmTimelineItemShift.create(this._node,this._anchor,this._startPosition,false,{complete:BX.delegate(this.finish,this)});t.run()},this)});t.animate();if(BX.type.isFunction(this._events["complete"])){this._events["complete"]()}},finish:function(){this._node.style.position="";this._node.style.width="";this._node.style.height="";this._node.style.top="";this._node.style.left="";this._node.style.opacity="";this._node.style.zIndex="";this._anchor.style.height="";this._anchor.parentNode.insertBefore(this._node,this._anchor.nextSibling);setTimeout(BX.delegate(function(){BX.removeClass(this._node,"crm-entity-stream-section-animate-start")},this),0)}};BX.CrmCommentAnimation.create=function(t,e,i,r){var n=new BX.CrmCommentAnimation;n.initialize(t,e,i,r);return n}}if(typeof BX.CrmTimelineMenuBar==="undefined"){BX.CrmTimelineMenuBar=function(){this._id="";this._ownerInfo=null;this._container=null;this._items=null;this._moreButton=null;this._activityEditor=null;this._commentEditor=null;this._waitEditor=null;this._smsEditor=null;this._readOnly=false;this._menu=null;this._isMenuShown=false;this._manager=null};BX.CrmTimelineMenuBar.prototype={initialize:function(t,e){this._id=BX.type.isNotEmptyString(t)?t:BX.util.getRandomString(4);this._settings=e?e:{};this._ownerInfo=BX.prop.getObject(this._settings,"ownerInfo");if(!this._ownerInfo){throw"BX.CrmTimelineMenuBar. A required parameter 'ownerInfo' is missing."}this._activityEditor=BX.prop.get(this._settings,"activityEditor");if(!(this._activityEditor instanceof BX.CrmActivityEditor)){throw"BX.CrmTimelineMenuBar. A required parameter 'activityEditor' is missing."}this._commentEditor=BX.prop.get(this._settings,"commentEditor");this._waitEditor=BX.prop.get(this._settings,"waitEditor");this._smsEditor=BX.prop.get(this._settings,"smsEditor");this._restEditor=BX.prop.get(this._settings,"restEditor");this._manager=BX.prop.get(this._settings,"manager");if(!(this._manager instanceof BX.CrmTimelineManager)){throw"BX.CrmTimeline. Manager instance is not found."}this._container=BX.prop.getElementNode(this._settings,"container");if(!this._container){throw"BX.CrmTimelineMenuBar. A required parameter 'container' is missing."}this._readOnly=BX.prop.getBoolean(this._settings,"readOnly",false);this._items=[];var i=this._container.querySelectorAll(".crm-entity-stream-section-new-action");for(var r=0,n=i.length;r<n;r++){var s=i[r];var a=BX.CrmTimelineMenuBarItem.create(s.getAttribute("data-item-id"),{container:s,owner:this});this._items.push(a)}this._moreButton=this._container.querySelector(".crm-entity-stream-section-new-action-more");if(this._moreButton){BX.bind(this._moreButton,"click",BX.delegate(this.onMoreButtonClick,this))}this.adjust();BX.bind(window,"resize",BX.delegate(this.onResize,this))},getId:function(){return this._id},getItemById:function(t){for(var e=0,i=this._items.length;e<i;e++){var r=this._items[e];if(r.getId()===t){return r}}return null},setActiveItemById:function(t){for(var e=0,i=this._items.length;e<i;e++){var r=this._items[e];r.setActive(r.getId()===t)}},setActiveItem:function(t){for(var e=0,i=this._items.length;e<i;e++){var r=this._items[e];r.setActive(r===t)}},adjust:function(){if(this._moreButton){this._moreButton.style.display=this.getInvisibleItems().length>0?"":"none"}},processItemSelection:function(t){if(this._readOnly){return}var e=null;var i=t.getId();if(i==="call"){e=new BX.Crm.Activity.Planner;e.showEdit({TYPE_ID:BX.CrmActivityType.call,OWNER_TYPE_ID:this._ownerInfo["ENTITY_TYPE_ID"],OWNER_ID:this._ownerInfo["ENTITY_ID"]})}if(i==="meeting"){e=new BX.Crm.Activity.Planner;e.showEdit({TYPE_ID:BX.CrmActivityType.meeting,OWNER_TYPE_ID:this._ownerInfo["ENTITY_TYPE_ID"],OWNER_ID:this._ownerInfo["ENTITY_ID"]})}else if(i==="email"){this._activityEditor.addEmail({ownerType:this._ownerInfo["ENTITY_TYPE_NAME"],ownerID:this._ownerInfo["ENTITY_ID"],ownerUrl:this._ownerInfo["SHOW_URL"],ownerTitle:this._ownerInfo["TITLE"],subject:""})}else if(i==="task"){this._activityEditor.addTask({ownerType:this._ownerInfo["ENTITY_TYPE_NAME"],ownerID:this._ownerInfo["ENTITY_ID"]})}else if(i==="comment"&&this._commentEditor){if(this._waitEditor){this._waitEditor.setVisible(false)}if(this._smsEditor){this._smsEditor.setVisible(false)}this._commentEditor.setVisible(true);this.setActiveItem(t)}else if(i==="wait"&&this._waitEditor){if(this._commentEditor){this._commentEditor.setVisible(false)}if(this._smsEditor){this._smsEditor.setVisible(false)}this._waitEditor.setVisible(true);this.setActiveItem(t)}else if(i==="sms"&&this._smsEditor){if(this._commentEditor){this._commentEditor.setVisible(false)}if(this._waitEditor){this._waitEditor.setVisible(false)}this._smsEditor.setVisible(true);this.setActiveItem(t)}else if(i==="visit"){var r=this._manager.getSetting("visitParameters");r["OWNER_TYPE"]=this._ownerInfo["ENTITY_TYPE_NAME"];r["OWNER_ID"]=this._ownerInfo["ENTITY_ID"];BX.CrmActivityVisit.create(r).showEdit()}else if(i.match(/^activity_rest_/)){if(this._restEditor){this._restEditor.action(i)}}},getInvisibleItems:function(){var t=[];for(var e=0,i=this._items.length;e<i;e++){var r=this._items[e];if(!r.isVisible()){t.push(r)}}return t},openMenu:function(){var t=this.getInvisibleItems();if(t.length===0){return}var e=BX.delegate(this.onMenuItemSelect,this);var i=[];for(var r=0,n=t.length;r<n;r++){var s=t[r];i.push({id:s.getId(),text:s.getTitle(),onclick:e})}BX.PopupMenu.show(this._id,this._moreButton,i,{offsetTop:0,offsetLeft:16,angle:{position:"top",offset:0},events:{onPopupShow:BX.delegate(this.onContextMenuShow,this),onPopupClose:BX.delegate(this.onContextMenuClose,this),onPopupDestroy:BX.delegate(this.onContextMenuDestroy,this)}});this._menu=BX.PopupMenu.currentItem},closeMenu:function(){if(this._menu){this._menu.close()}},onMoreButtonClick:function(t){if(!this._isMenuShown){this.openMenu()}else{this.closeMenu()}t.preventDefault?t.preventDefault():t.returnValue=false},onMenuItemSelect:function(t,e){var i=this.getItemById(e.id);if(i){this.processItemSelection(i)}this.closeMenu()},onContextMenuShow:function(){this._isMenuShown=true},onContextMenuClose:function(){if(this._menu){this._menu.popupWindow.destroy()}},onContextMenuDestroy:function(){this._isMenuShown=false;this._menu=null;if(typeof BX.PopupMenu.Data[this._id]!=="undefined"){delete BX.PopupMenu.Data[this._id]}},onResize:function(t){if(this._isMenuShown){this.closeMenu()}this.adjust()}};BX.CrmTimelineMenuBar.create=function(t,e){var i=new BX.CrmTimelineMenuBar;i.initialize(t,e);return i}}if(typeof BX.CrmTimelineMenuBarItem==="undefined"){BX.CrmTimelineMenuBarItem=function(){this._id="";this._owner=null;this._container=null;this._isActive=false};BX.CrmTimelineMenuBarItem.prototype={initialize:function(t,e){this._id=BX.type.isNotEmptyString(t)?t:BX.util.getRandomString(4);this._settings=e?e:{};this._container=BX.prop.getElementNode(this._settings,"container");if(!this._container){throw"BX.CrmTimelineMenuBarItem. Container node is not found."}BX.bind(this._container,"click",BX.delegate(this.onClick,this));this._isActive=BX.hasClass(this._container,"crm-entity-stream-section-new-action-active");this._owner=BX.prop.get(this._settings,"owner");if(!this._owner){throw"BX.CrmTimelineMenuBarItem. Owner is not found."}},getId:function(){return this._id},isActive:function(){return this._isActive},setActive:function(t){t=!!t;this._isActive=t;if(t){BX.addClass(this._container,"crm-entity-stream-section-new-action-active")}else{BX.removeClass(this._container,"crm-entity-stream-section-new-action-active")}},isVisible:function(){return this._container.offsetTop===0},getTitle:function(){var t=this._container.getAttribute("data-item-title");if(!BX.type.isNotEmptyString(t)){t=this._container.innerHTML}return BX.util.htmlspecialcharsback(t)},onClick:function(t){this._owner.processItemSelection(this);t.preventDefault?t.preventDefault():t.returnValue=false}};BX.CrmTimelineMenuBarItem.create=function(t,e){var i=new BX.CrmTimelineMenuBarItem;i.initialize(t,e);return i}}if(typeof BX.CrmSmsWatcher==="undefined"){BX.CrmSmsWatcher={_pullTagName:"MESSAGESERVICE",_pullInited:false,_listeners:{},initPull:function(){if(this._pullInited)return;BX.addCustomEvent("onPullEvent-messageservice",this.onPullEvent.bind(this));this.extendWatch();this._pullInited=true},subscribeOnMessageUpdate:function(t,e){this.initPull();this._listeners[t]=e},fireExternalStatusUpdate:function(t,e){var i=this._listeners[t];if(i){i(e)}},onPullEvent:function(t,e){if(t==="message_update"){for(var i=0;i<e.messages.length;++i){var r=e.messages[i];this.fireExternalStatusUpdate(r["ID"],r)}}},extendWatch:function(){if(BX.type.isFunction(BX.PULL)){BX.PULL.extendWatch(this._pullTagName);window.setTimeout(this.extendWatch.bind(this),6e4)}}}}
/* End */
;
; /* Start:"a:4:{s:4:"full";s:72:"/bitrix/components/bitrix/player/js/fileman_player.min.js?15185961927529";s:6:"source";s:53:"/bitrix/components/bitrix/player/js/fileman_player.js";s:3:"min";s:0:"";s:3:"map";s:0:"";}"*/
(function(){BX.namespace("BX.Fileman");if(window.BX.Fileman.PlayerManager){return}BX.Fileman.PlayerManager={isStarted:false,players:[],playing:false,addPlayer:function(t){this.players.push(t);this.bindPlayerEvents(t);if(t.autostart||t.lazyload){this.init()}},init:function(){if(this.isStarted){return}this.isStarted=true;BX.ready(function(){BX.bind(window,"scroll",BX.throttle(BX.Fileman.PlayerManager.onScroll,300,BX.Fileman.PlayerManager));setTimeout(BX.delegate(BX.Fileman.PlayerManager.onScroll,BX.Fileman.PlayerManager),50)})},bindPlayerEvents:function(t){var e=t.getEventList();if(e){for(var i=0;i<e.length;i++){BX.addCustomEvent(t,e[i],BX.proxy(function(t,e){BX.onCustomEvent(BX.Fileman.PlayerManager,"PlayerManager."+e,[t])},this))}}},onScroll:function(){if(this.players.length==0){return}var t=false;var e=false;for(var i in this.players){var a=this.players[i];if(!BX(a.id)){this.players.splice(i,1);continue}if(a.lazyload&&!a.inited){if(this.isVisibleOnScreen(a.id,2)){a.init()}}if(!a.autostart){continue}if(a.active){continue}if(a.isEnded()){continue}if(this.isVisibleOnScreen(a.id,1)){if(t===false){t=a}}else{if(a.isPlaying()){a.pause()}}if(a.isPlaying()){e=true}}if(e){return}if(t!==false){if(!t.inited){t.autostart=true}else if(t.isReady()&&!t.isEnded()){t.mute(true);BX.addCustomEvent(t,"Player:onClick",BX.proxy(t.disableMute,t));t.play()}}},getElementCoords:function(t){var e=.25;var i=BX(t).getBoundingClientRect();var a=i.bottom-i.top;var r=i.top+e*a;var s=i.bottom-e*a;var n=i.right-i.left;var o=i.left+e*n;var l=i.right-e*n;coords={top:r+window.pageYOffset,bottom:s+window.pageYOffset,left:o+window.pageXOffset,right:l+window.pageXOffset,originTop:r,originLeft:o,originBottom:s,originRight:l};return coords},isVisibleOnScreen:function(t,e){var i,a=false;var r=this.getElementCoords(t);var s=document.documentElement.clientHeight;var n=window.pageYOffset||document.documentElement.scrollTop;var o=n+s;if(e){e=parseInt(e)}if(e>1){n-=s*(e-1);o+=s*(e-1)}var l=r.top>n&&r.top<o;var y=r.bottom<o&&r.bottom>n;i=l||y;if(i&&e>1){return true}if(!i){return false}var h=BX(t);var f=r.originLeft+(r.originRight-r.originLeft)/2;var p=r.originTop+(r.originBottom-r.originTop)/2+20;var u=document.elementFromPoint(f,p);if(!!u){if(u===h||u.parentNode===h||u.parentNode.parentNode===h){a=true}}return i&&a},getPlayerById:function(t){if(!t){return null}for(var e in this.players){if(this.players[e].id===t){return this.players[e]}}return null}};BX.Fileman.Player=function(t,e){this.inited=false;this.id=t;this.fillParameters(e);BX.Fileman.PlayerManager.addPlayer(this);this.fireEvent("onCreate");BX.bind(BX(this.id),"click",BX.proxy(this.onClick,this));BX.bind(BX(this.id),"keydown",BX.proxy(this.onKeyDown,this))};BX.Fileman.Player.prototype.onClick=function(){var t=BX.findChildByClassName(this.getElement(),"vjs-play-control");if(t){t.focus()}this.active=true;this.fireEvent("onClick")};BX.Fileman.Player.prototype.isPlaying=function(){if(this.vjsPlayer){return this.vjsPlayer.isReady_&&!this.vjsPlayer.paused()}return false};BX.Fileman.Player.prototype.pause=function(){try{this.vjsPlayer.pause()}catch(t){}this.fireEvent("onPause")};BX.Fileman.Player.prototype.isEnded=function(){if(this.vjsPlayer){return this.vjsPlayer.ended()}return false};BX.Fileman.Player.prototype.isReady=function(){return this.vjsPlayer.isReady_};BX.Fileman.Player.prototype.play=function(){this.setPlayedState();try{this.vjsPlayer.play()}catch(t){}this.fireEvent("onPlay")};BX.Fileman.Player.prototype.setPlayedState=function(){var t=this.__getStorageHash();BX.localStorage.set(t,"played",1209600)};BX.Fileman.Player.prototype.isPlayed=function(){var t=this.__getStorageHash();return BX.localStorage.get(t)==="played"};BX.Fileman.Player.prototype.__getStorageHash=function(){var t=this.id;if(this.params.sources&&BX.type.isArray(this.params.sources)&&this.params.sources[0].src){t=this.params.sources[0].src}return"player_"+t};BX.Fileman.Player.prototype.getElement=function(){return BX(this.id)};BX.Fileman.Player.prototype.createElement=function(){var t=this.getElement();if(t){return t}if(!this.id){return null}var e="video";if(this.isAudio){e="audio"}var i="video-js vjs-big-play-centered";if(this.skin){i+=" "+this.skin}var a={id:this.id,className:i,width:this.width,height:this.height,controls:true};if(this.muted){a["muted"]=true}t=BX.create(e,{attrs:a});if(this.params.sources){if(BX.type.isArray(this.params.sources)){for(var r in this.params.sources){if(!this.params.sources[r].src||!this.params.sources[r].type){continue}var s=BX.create("source",{attrs:{src:this.params.sources[r].src,type:this.params.sources[r].type}});BX.append(s,t)}}}return t};BX.Fileman.Player.prototype.fillParameters=function(t){this.autostart=t.autostart||false;this.width=t.width||400;this.height=t.height||300;this.hasFlash=t.hasFlash||false;if(t.playbackRate&&!t.hasFlash){t.playbackRate=parseInt(t.playbackRate);if(t.playbackRate!=1){if(t.playbackRate<=0){t.playbackRate=1}if(t.playbackRate>3){t.playbackRate=3}}if(t.playbackRate!=1){this.playbackRate=t.playbackRate}}this.volume=t.volume||.8;this.playlistParams=t.playlistParams||false;this.startTime=t.startTime||0;this.wmvConfig=t.wmvConfig||false;this.onInit=t.onInit;this.lazyload=t.lazyload;this.skin=t.skin||"";this.params=t;this.active=this.isPlayed()};BX.Fileman.Player.prototype.onKeyDown=function(t){if(t.which==32){this.onClick();if(this.isPlaying()){this.pause()}else{this.play()}t.preventDefault();t.stopPropagation();return false}this.fireEvent("onKeyDown")};BX.Fileman.Player.prototype.setSource=function(t){if(!t){return false}this.vjsPlayer.src(t);this.fireEvent("onSetSource")};BX.Fileman.Player.prototype.getSource=function(){return this.vjsPlayer.src()};BX.Fileman.Player.prototype.init=function(){this.fireEvent("onBeforeInit");if(videojs.players[this.id]){delete videojs.players[this.id]}this.vjsPlayer=videojs(this.id,this.params);this.vjsPlayer.on("error",BX.proxy(function(){this.fireEvent("onError")},this));if(this.hasFlash){setTimeout(BX.proxy(function(){if(!this.inited){this.vjsPlayer.error(BX.message("PLAYER_FLASH_REQUIRED"));this.inited=true}},this),2e3)}this.vjsPlayer.ready(BX.proxy(function(){var t=BX.findChildByClassName(BX(this.id),"vjs-play-control");if(t){t.addEventListener("click",BX.proxy(this.onClick,this))}this.vjsPlayer.volume(this.volume);this.vjsPlayer.one("play",BX.proxy(function(){if(this.playbackRate!=1){this.vjsPlayer.playbackRate(this.playbackRate)}if(this.volume){this.vjsPlayer.volume(this.volume)}if(this.startTime>0){try{this.vjsPlayer.currentTime(this.startTime);var t=BX.findChild(BX(this.id),{class:"vjs-loading-spinner"},false);if(t){t.remove()}}catch(t){}}},this));if(this.playlistParams){this.vjsPlayer.playlist(this.playlistParams)}if(this.wmvConfig){this.vjsPlayer.wmvConfig=this.wmvConfig}this.inited=true;if(BX.type.isFunction(this.onInit)){this.onInit(this)}this.fireEvent("onAfterInit")},this))};BX.Fileman.Player.prototype.getEventList=function(){return["Player:onBeforeInit","Player:onAfterInit","Player:onCreate","Player:onSetSource","Player:onKeyDown","Player:onPlay","Player:onPause","Player:onClick","Player:onError"]};BX.Fileman.Player.prototype.fireEvent=function(t){if(BX.type.isNotEmptyString(t)){t="Player:"+t;BX.onCustomEvent(this,t,[this,t])}};BX.Fileman.Player.prototype.mute=function(t){return this.vjsPlayer.muted(t)};BX.Fileman.Player.prototype.disableMute=function(){BX.removeCustomEvent(this,"Player:onClick",BX.proxy(this.disableMute,this));setTimeout(BX.proxy(function(){this.mute(false)},this),100)}})(window);
/* End */
;
; /* Start:"a:4:{s:4:"full";s:70:"/bitrix/components/bitrix/player/videojs/video.min.js?1518596192269082";s:6:"source";s:49:"/bitrix/components/bitrix/player/videojs/video.js";s:3:"min";s:53:"/bitrix/components/bitrix/player/videojs/video.min.js";s:3:"map";s:53:"/bitrix/components/bitrix/player/videojs/video.map.js";}"*/
(function(e){if(typeof exports==="object"&&typeof module!=="undefined"){module.exports=e()}else if(typeof define==="function"&&define.amd){define([],e)}else{var t;if(typeof window!=="undefined"){t=window}else if(typeof global!=="undefined"){t=global}else if(typeof self!=="undefined"){t=self}else{t=this}t.videojs=e()}})(function(){var e,t,r;return function n(e,t,r){function o(a,s){if(!t[a]){if(!e[a]){var u=typeof require=="function"&&require;if(!s&&u)return u(a,!0);if(i)return i(a,!0);var l=new Error("Cannot find module '"+a+"'");throw l.code="MODULE_NOT_FOUND",l}var c=t[a]={exports:{}};e[a][0].call(c.exports,function(t){var r=e[a][1][t];return o(r?r:t)},c,c.exports,n,e,t,r)}return t[a].exports}var i=typeof require=="function"&&require;for(var a=0;a<r.length;a++)o(r[a]);return o}({1:[function(e,t,r){"use strict";r.__esModule=true;var n=e(2);var o=s(n);var i=e(5);var a=s(i);function s(e){return e&&e.__esModule?e:{"default":e}}function u(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}function l(e,t){if(!e){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return t&&(typeof t==="object"||typeof t==="function")?t:e}function c(e,t){if(typeof t!=="function"&&t!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof t)}e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:false,writable:true,configurable:true}});if(t)Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t}var f=function(e){c(t,e);function t(){u(this,t);return l(this,e.apply(this,arguments))}t.prototype.buildCSSClass=function r(){return"vjs-big-play-button"};t.prototype.handleClick=function n(e){this.player_.play()};return t}(o["default"]);f.prototype.controlText_="Play Video";a["default"].registerComponent("BigPlayButton",f);r["default"]=f},{2:2,5:5}],2:[function(e,t,r){"use strict";r.__esModule=true;var n=e(3);var o=c(n);var i=e(5);var a=c(i);var s=e(86);var u=c(s);var l=e(88);function c(e){return e&&e.__esModule?e:{"default":e}}function f(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}function p(e,t){if(!e){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return t&&(typeof t==="object"||typeof t==="function")?t:e}function h(e,t){if(typeof t!=="function"&&t!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof t)}e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:false,writable:true,configurable:true}});if(t)Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t}var d=function(e){h(t,e);function t(){f(this,t);return p(this,e.apply(this,arguments))}t.prototype.createEl=function r(){var e=arguments.length>0&&arguments[0]!==undefined?arguments[0]:"button";var t=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};var r=arguments.length>2&&arguments[2]!==undefined?arguments[2]:{};t=(0,l.assign)({className:this.buildCSSClass()},t);if(e!=="button"){u["default"].warn("Creating a Button with an HTML element of "+e+" is deprecated; use ClickableComponent instead.");t=(0,l.assign)({tabIndex:0},t);r=(0,l.assign)({role:"button"},r)}r=(0,l.assign)({type:"button","aria-live":"polite"},r);var n=a["default"].prototype.createEl.call(this,e,t,r);this.createControlTextEl(n);return n};t.prototype.addChild=function n(e){var t=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};var r=this.constructor.name;u["default"].warn("Adding an actionable (user controllable) child to a Button ("+r+") is not supported; use a ClickableComponent instead.");return a["default"].prototype.addChild.call(this,e,t)};t.prototype.enable=function o(){e.prototype.enable.call(this);this.el_.removeAttribute("disabled")};t.prototype.disable=function i(){e.prototype.disable.call(this);this.el_.setAttribute("disabled","disabled")};t.prototype.handleKeyPress=function s(t){if(t.which===32||t.which===13){return}e.prototype.handleKeyPress.call(this,t)};return t}(o["default"]);a["default"].registerComponent("Button",d);r["default"]=d},{3:3,5:5,86:86,88:88}],3:[function(e,t,r){"use strict";r.__esModule=true;var n=e(5);var o=g(n);var i=e(81);var a=y(i);var s=e(82);var u=y(s);var l=e(83);var c=y(l);var f=e(86);var p=g(f);var h=e(94);var d=g(h);var v=e(88);function y(e){if(e&&e.__esModule){return e}else{var t={};if(e!=null){for(var r in e){if(Object.prototype.hasOwnProperty.call(e,r))t[r]=e[r]}}t["default"]=e;return t}}function g(e){return e&&e.__esModule?e:{"default":e}}function _(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}function m(e,t){if(!e){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return t&&(typeof t==="object"||typeof t==="function")?t:e}function b(e,t){if(typeof t!=="function"&&t!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof t)}e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:false,writable:true,configurable:true}});if(t)Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t}var T=function(e){b(t,e);function t(r,n){_(this,t);var o=m(this,e.call(this,r,n));o.emitTapEvents();o.enable();return o}t.prototype.createEl=function r(){var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:"div";var r=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};var n=arguments.length>2&&arguments[2]!==undefined?arguments[2]:{};r=(0,v.assign)({className:this.buildCSSClass(),tabIndex:0},r);if(t==="button"){p["default"].error("Creating a ClickableComponent with an HTML element of "+t+" is not supported; use a Button instead.")}n=(0,v.assign)({role:"button","aria-live":"polite"},n);this.tabIndex_=r.tabIndex;var o=e.prototype.createEl.call(this,t,r,n);this.createControlTextEl(o);return o};t.prototype.createControlTextEl=function n(e){this.controlTextEl_=a.createEl("span",{className:"vjs-control-text"});if(e){e.appendChild(this.controlTextEl_)}this.controlText(this.controlText_,e);return this.controlTextEl_};t.prototype.controlText=function o(e){var t=arguments.length>1&&arguments[1]!==undefined?arguments[1]:this.el();if(!e){return this.controlText_||"Need Text"}var r=this.localize(e);this.controlText_=e;this.controlTextEl_.innerHTML=r;t.setAttribute("title",r);return this};t.prototype.buildCSSClass=function i(){return"vjs-control vjs-button "+e.prototype.buildCSSClass.call(this)};t.prototype.enable=function s(){this.removeClass("vjs-disabled");this.el_.setAttribute("aria-disabled","false");if(typeof this.tabIndex_!=="undefined"){this.el_.setAttribute("tabIndex",this.tabIndex_)}this.on("tap",this.handleClick);this.on("click",this.handleClick);this.on("focus",this.handleFocus);this.on("blur",this.handleBlur);return this};t.prototype.disable=function l(){this.addClass("vjs-disabled");this.el_.setAttribute("aria-disabled","true");if(typeof this.tabIndex_!=="undefined"){this.el_.removeAttribute("tabIndex")}this.off("tap",this.handleClick);this.off("click",this.handleClick);this.off("focus",this.handleFocus);this.off("blur",this.handleBlur);return this};t.prototype.handleClick=function f(e){};t.prototype.handleFocus=function h(e){u.on(d["default"],"keydown",c.bind(this,this.handleKeyPress))};t.prototype.handleKeyPress=function y(t){if(t.which===32||t.which===13){t.preventDefault();this.handleClick(t)}else if(e.prototype.handleKeyPress){e.prototype.handleKeyPress.call(this,t)}};t.prototype.handleBlur=function g(e){u.off(d["default"],"keydown",c.bind(this,this.handleKeyPress))};return t}(o["default"]);o["default"].registerComponent("ClickableComponent",T);r["default"]=T},{5:5,81:81,82:82,83:83,86:86,88:88,94:94}],4:[function(e,t,r){"use strict";r.__esModule=true;var n=e(2);var o=s(n);var i=e(5);var a=s(i);function s(e){return e&&e.__esModule?e:{"default":e}}function u(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}function l(e,t){if(!e){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return t&&(typeof t==="object"||typeof t==="function")?t:e}function c(e,t){if(typeof t!=="function"&&t!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof t)}e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:false,writable:true,configurable:true}});if(t)Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t}var f=function(e){c(t,e);function t(r,n){u(this,t);var o=l(this,e.call(this,r,n));o.controlText(n&&n.controlText||o.localize("Close"));return o}t.prototype.buildCSSClass=function r(){return"vjs-close-button "+e.prototype.buildCSSClass.call(this)};t.prototype.handleClick=function n(e){this.trigger({type:"close",bubbles:false})};return t}(o["default"]);a["default"].registerComponent("CloseButton",f);r["default"]=f},{2:2,5:5}],5:[function(e,t,r){"use strict";r.__esModule=true;var n=e(95);var o=b(n);var i=e(81);var a=m(i);var s=e(83);var u=m(s);var l=e(85);var c=m(l);var f=e(82);var p=m(f);var h=e(86);var d=b(h);var v=e(91);var y=b(v);var g=e(87);var _=b(g);function m(e){if(e&&e.__esModule){return e}else{var t={};if(e!=null){for(var r in e){if(Object.prototype.hasOwnProperty.call(e,r))t[r]=e[r]}}t["default"]=e;return t}}function b(e){return e&&e.__esModule?e:{"default":e}}function T(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}var w=function(){function e(t,r,n){T(this,e);if(!t&&this.play){this.player_=t=this}else{this.player_=t}this.options_=(0,_["default"])({},this.options_);r=this.options_=(0,_["default"])(this.options_,r);this.id_=r.id||r.el&&r.el.id;if(!this.id_){var o=t&&t.id&&t.id()||"no_player";this.id_=o+"_component_"+c.newGUID()}this.name_=r.name||null;if(r.el){this.el_=r.el}else if(r.createEl!==false){this.el_=this.createEl()}this.children_=[];this.childIndex_={};this.childNameIndex_={};if(r.initChildren!==false){this.initChildren()}this.ready(n);if(r.reportTouchActivity!==false){this.enableTouchActivity()}}e.prototype.dispose=function t(){this.trigger({type:"dispose",bubbles:false});if(this.children_){for(var e=this.children_.length-1;e>=0;e--){if(this.children_[e].dispose){this.children_[e].dispose()}}}this.children_=null;this.childIndex_=null;this.childNameIndex_=null;this.off();if(this.el_.parentNode){this.el_.parentNode.removeChild(this.el_)}a.removeElData(this.el_);this.el_=null};e.prototype.player=function r(){return this.player_};e.prototype.options=function n(e){d["default"].warn("this.options() has been deprecated and will be moved to the constructor in 6.0");if(!e){return this.options_}this.options_=(0,_["default"])(this.options_,e);return this.options_};e.prototype.el=function i(){return this.el_};e.prototype.createEl=function s(e,t,r){return a.createEl(e,t,r)};e.prototype.localize=function l(e){var t=this.player_.language&&this.player_.language();var r=this.player_.languages&&this.player_.languages();if(!t||!r){return e}var n=r[t];if(n&&n[e]){return n[e]}var o=t.split("-")[0];var i=r[o];if(i&&i[e]){return i[e]}return e};e.prototype.contentEl=function f(){return this.contentEl_||this.el_};e.prototype.id=function h(){return this.id_};e.prototype.name=function v(){return this.name_};e.prototype.children=function g(){return this.children_};e.prototype.getChildById=function m(e){return this.childIndex_[e]};e.prototype.getChild=function b(e){if(!e){return}e=(0,y["default"])(e);return this.childNameIndex_[e]};e.prototype.addChild=function w(t){var r=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};var n=arguments.length>2&&arguments[2]!==undefined?arguments[2]:this.children_.length;var o=void 0;var i=void 0;if(typeof t==="string"){i=(0,y["default"])(t);if(!r){r={}}if(r===true){d["default"].warn("Initializing a child component with `true` is deprecated."+"Children should be defined in an array when possible, "+"but if necessary use an object instead of `true`.");r={}}var a=r.componentClass||i;r.name=i;var s=e.getComponent(a);if(!s){throw new Error("Component "+a+" does not exist")}if(typeof s!=="function"){return null}o=new s(this.player_||this,r)}else{o=t}this.children_.splice(n,0,o);if(typeof o.id==="function"){this.childIndex_[o.id()]=o}i=i||o.name&&o.name();if(i){this.childNameIndex_[i]=o}if(typeof o.el==="function"&&o.el()){var u=this.contentEl().children;var l=u[n]||null;this.contentEl().insertBefore(o.el(),l)}return o};e.prototype.removeChild=function E(e){if(typeof e==="string"){e=this.getChild(e)}if(!e||!this.children_){return}var t=false;for(var r=this.children_.length-1;r>=0;r--){if(this.children_[r]===e){t=true;this.children_.splice(r,1);break}}if(!t){return}this.childIndex_[e.id()]=null;this.childNameIndex_[e.name()]=null;var n=e.el();if(n&&n.parentNode===this.contentEl()){this.contentEl().removeChild(e.el())}};e.prototype.initChildren=function C(){var t=this;var r=this.options_.children;if(r){(function(){var n=t.options_;var o=function s(e){var r=e.name;var o=e.opts;if(n[r]!==undefined){o=n[r]}if(o===false){return}if(o===true){o={}}o.playerOptions=t.options_.playerOptions;var i=t.addChild(r,o);if(i){t[r]=i}};var i=void 0;var a=e.getComponent("Tech");if(Array.isArray(r)){i=r}else{i=Object.keys(r)}i.concat(Object.keys(t.options_).filter(function(e){return!i.some(function(t){if(typeof t==="string"){return e===t}return e===t.name})})).map(function(e){var n=void 0;var o=void 0;if(typeof e==="string"){n=e;o=r[n]||t.options_[n]||{}}else{n=e.name;o=e}return{name:n,opts:o}}).filter(function(t){var r=e.getComponent(t.opts.componentClass||(0,y["default"])(t.name));return r&&!a.isTech(r)}).forEach(o)})()}};e.prototype.buildCSSClass=function k(){return""};e.prototype.on=function O(e,t,r){var n=this;if(typeof e==="string"||Array.isArray(e)){p.on(this.el_,e,u.bind(this,t))}else{(function(){var o=e;var i=t;var a=u.bind(n,r);var s=function c(){return n.off(o,i,a)};s.guid=a.guid;n.on("dispose",s);var l=function f(){return n.off("dispose",s)};l.guid=a.guid;if(e.nodeName){p.on(o,i,a);p.on(o,"dispose",l)}else if(typeof e.on==="function"){o.on(i,a);o.on("dispose",l)}})()}return this};e.prototype.off=function S(e,t,r){if(!e||typeof e==="string"||Array.isArray(e)){p.off(this.el_,e,t)}else{var n=e;var o=t;var i=u.bind(this,r);this.off("dispose",i);if(e.nodeName){p.off(n,o,i);p.off(n,"dispose",i)}else{n.off(o,i);n.off("dispose",i)}}return this};e.prototype.one=function j(e,t,r){var n=this,o=arguments;if(typeof e==="string"||Array.isArray(e)){p.one(this.el_,e,u.bind(this,t))}else{(function(){var i=e;var a=t;var s=u.bind(n,r);var l=function c(){n.off(i,a,c);s.apply(null,o)};l.guid=s.guid;n.on(i,a,l)})()}return this};e.prototype.trigger=function x(e,t){p.trigger(this.el_,e,t);return this};e.prototype.ready=function P(e){var t=arguments.length>1&&arguments[1]!==undefined?arguments[1]:false;if(e){if(this.isReady_){if(t){e.call(this)}else{this.setTimeout(e,1)}}else{this.readyQueue_=this.readyQueue_||[];this.readyQueue_.push(e)}}return this};e.prototype.triggerReady=function M(){this.isReady_=true;this.setTimeout(function(){var e=this.readyQueue_;this.readyQueue_=[];if(e&&e.length>0){e.forEach(function(e){e.call(this)},this)}this.trigger("ready")},1)};e.prototype.$=function A(e,t){return a.$(e,t||this.contentEl())};e.prototype.$$=function I(e,t){return a.$$(e,t||this.contentEl())};e.prototype.hasClass=function R(e){return a.hasElClass(this.el_,e)};e.prototype.addClass=function N(e){a.addElClass(this.el_,e);return this};e.prototype.removeClass=function D(e){a.removeElClass(this.el_,e);return this};e.prototype.toggleClass=function L(e,t){a.toggleElClass(this.el_,e,t);return this};e.prototype.show=function F(){this.removeClass("vjs-hidden");return this};e.prototype.hide=function B(){this.addClass("vjs-hidden");return this};e.prototype.lockShowing=function H(){this.addClass("vjs-lock-showing");return this};e.prototype.unlockShowing=function V(){this.removeClass("vjs-lock-showing");return this};e.prototype.getAttribute=function U(e){return a.getAttribute(this.el_,e)};e.prototype.setAttribute=function W(e,t){a.setAttribute(this.el_,e,t);return this};e.prototype.removeAttribute=function z(e){a.removeAttribute(this.el_,e);return this};e.prototype.width=function X(e,t){return this.dimension("width",e,t)};e.prototype.height=function q(e,t){return this.dimension("height",e,t)};e.prototype.dimensions=function $(e,t){return this.width(e,true).height(t)};e.prototype.dimension=function G(e,t,r){if(t!==undefined){if(t===null||t!==t){t=0}if((""+t).indexOf("%")!==-1||(""+t).indexOf("px")!==-1){this.el_.style[e]=t}else if(t==="auto"){this.el_.style[e]=""}else{this.el_.style[e]=t+"px"}if(!r){this.trigger("resize")}return this}if(!this.el_){return 0}var n=this.el_.style[e];var o=n.indexOf("px");if(o!==-1){return parseInt(n.slice(0,o),10)}return parseInt(this.el_["offset"+(0,y["default"])(e)],10)};e.prototype.currentDimension=function K(e){var t=0;if(e!=="width"&&e!=="height"){throw new Error("currentDimension only accepts width or height value")}if(typeof o["default"].getComputedStyle==="function"){var r=o["default"].getComputedStyle(this.el_);t=r.getPropertyValue(e)||r[e]}t=parseFloat(t);if(t===0){var n="offset"+(0,y["default"])(e);t=this.el_[n]}return t};e.prototype.currentDimensions=function Y(){return{width:this.currentDimension("width"),height:this.currentDimension("height")}};e.prototype.currentWidth=function J(){return this.currentDimension("width")};e.prototype.currentHeight=function Q(){return this.currentDimension("height")};e.prototype.emitTapEvents=function Z(){var e=0;var t=null;var r=10;var n=200;var o=void 0;this.on("touchstart",function(r){if(r.touches.length===1){t={pageX:r.touches[0].pageX,pageY:r.touches[0].pageY};e=(new Date).getTime();o=true}});this.on("touchmove",function(e){if(e.touches.length>1){o=false}else if(t){var n=e.touches[0].pageX-t.pageX;var i=e.touches[0].pageY-t.pageY;var a=Math.sqrt(n*n+i*i);if(a>r){o=false}}});var i=function a(){o=false};this.on("touchleave",i);this.on("touchcancel",i);this.on("touchend",function(r){t=null;if(o===true){var i=(new Date).getTime()-e;if(i<n){r.preventDefault();this.trigger("tap")}}})};e.prototype.enableTouchActivity=function ee(){if(!this.player()||!this.player().reportUserActivity){return}var e=u.bind(this.player(),this.player().reportUserActivity);var t=void 0;this.on("touchstart",function(){e();this.clearInterval(t);t=this.setInterval(e,250)});var r=function n(r){e();this.clearInterval(t)};this.on("touchmove",e);this.on("touchend",r);this.on("touchcancel",r)};e.prototype.setTimeout=function te(e,t){e=u.bind(this,e);var r=o["default"].setTimeout(e,t);var n=function i(){this.clearTimeout(r)};n.guid="vjs-timeout-"+r;this.on("dispose",n);return r};e.prototype.clearTimeout=function re(e){o["default"].clearTimeout(e);var t=function r(){};t.guid="vjs-timeout-"+e;this.off("dispose",t);return e};e.prototype.setInterval=function ne(e,t){e=u.bind(this,e);var r=o["default"].setInterval(e,t);var n=function i(){this.clearInterval(r)};n.guid="vjs-interval-"+r;this.on("dispose",n);return r};e.prototype.clearInterval=function oe(e){o["default"].clearInterval(e);var t=function r(){};t.guid="vjs-interval-"+e;this.off("dispose",t);return e};e.registerComponent=function ie(t,r){if(!t){return}t=(0,y["default"])(t);if(!e.components_){e.components_={}}if(t==="Player"&&e.components_[t]){(function(){var r=e.components_[t];if(r.players&&Object.keys(r.players).length>0&&Object.keys(r.players).map(function(e){return r.players[e]}).every(Boolean)){throw new Error("Can not register Player component after player has been created")}})()}e.components_[t]=r;return r};e.getComponent=function ae(t){if(!t){return}t=(0,y["default"])(t);if(e.components_&&e.components_[t]){return e.components_[t]}if(o["default"]&&o["default"].videojs&&o["default"].videojs[t]){d["default"].warn("The "+t+" component was added to the videojs object when it should be registered using videojs.registerComponent(name, component)");return o["default"].videojs[t]}};e.extend=function se(t){t=t||{};d["default"].warn("Component.extend({}) has been deprecated, "+" use videojs.extend(Component, {}) instead");var r=t.init||t.init||this.prototype.init||this.prototype.init||function(){};var n=function i(){r.apply(this,arguments)};n.prototype=Object.create(this.prototype);n.prototype.constructor=n;n.extend=e.extend;for(var o in t){if(t.hasOwnProperty(o)){n.prototype[o]=t[o]}}return n};return e}();w.registerComponent("Component",w);r["default"]=w},{81:81,82:82,83:83,85:85,86:86,87:87,91:91,95:95}],6:[function(e,t,r){"use strict";r.__esModule=true;var n=e(36);var o=l(n);var i=e(5);var a=l(i);var s=e(7);var u=l(s);function l(e){return e&&e.__esModule?e:{"default":e}}function c(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}function f(e,t){if(!e){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return t&&(typeof t==="object"||typeof t==="function")?t:e}function p(e,t){if(typeof t!=="function"&&t!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof t)}e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:false,writable:true,configurable:true}});if(t)Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t}var h=function(e){p(t,e);function t(r){var n=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};c(this,t);n.tracks=r.audioTracks&&r.audioTracks();var o=f(this,e.call(this,r,n));o.el_.setAttribute("aria-label","Audio Menu");return o}t.prototype.buildCSSClass=function r(){return"vjs-audio-button "+e.prototype.buildCSSClass.call(this)};t.prototype.createItems=function n(){var e=arguments.length>0&&arguments[0]!==undefined?arguments[0]:[];var t=this.player_.audioTracks&&this.player_.audioTracks();if(!t){return e}for(var r=0;r<t.length;r++){var n=t[r];e.push(new u["default"](this.player_,{track:n,selectable:true}))}return e};return t}(o["default"]);h.prototype.controlText_="Audio Track";a["default"].registerComponent("AudioTrackButton",h);r["default"]=h},{36:36,5:5,7:7}],7:[function(e,t,r){"use strict";r.__esModule=true;var n=e(48);var o=c(n);var i=e(5);var a=c(i);var s=e(83);var u=l(s);function l(e){if(e&&e.__esModule){return e}else{var t={};if(e!=null){for(var r in e){if(Object.prototype.hasOwnProperty.call(e,r))t[r]=e[r]}}t["default"]=e;return t}}function c(e){return e&&e.__esModule?e:{"default":e}}function f(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}function p(e,t){if(!e){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return t&&(typeof t==="object"||typeof t==="function")?t:e}function h(e,t){if(typeof t!=="function"&&t!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof t)}e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:false,writable:true,configurable:true}});if(t)Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t}var d=function(e){h(t,e);function t(r,n){f(this,t);var o=n.track;var i=r.audioTracks();n.label=o.label||o.language||"Unknown";n.selected=o.enabled;var a=p(this,e.call(this,r,n));a.track=o;if(i){(function(){var e=u.bind(a,a.handleTracksChange);i.addEventListener("change",e);a.on("dispose",function(){i.removeEventListener("change",e)})})()}return a}t.prototype.handleClick=function r(t){var r=this.player_.audioTracks();e.prototype.handleClick.call(this,t);if(!r){return}for(var n=0;n<r.length;n++){var o=r[n];o.enabled=o===this.track}};t.prototype.handleTracksChange=function n(e){this.selected(this.track.enabled)};return t}(o["default"]);a["default"].registerComponent("AudioTrackMenuItem",d);r["default"]=d},{48:48,5:5,83:83}],8:[function(e,t,r){"use strict";r.__esModule=true;var n=e(5);var o=i(n);e(12);e(32);e(33);e(35);e(34);e(10);e(18);e(9);e(38);e(40);e(11);e(25);e(27);e(29);e(24);e(6);e(13);e(21);function i(e){return e&&e.__esModule?e:{"default":e}}function a(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}function s(e,t){if(!e){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return t&&(typeof t==="object"||typeof t==="function")?t:e}function u(e,t){if(typeof t!=="function"&&t!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof t)}e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:false,writable:true,configurable:true}});if(t)Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t}var l=function(e){u(t,e);function t(){a(this,t);return s(this,e.apply(this,arguments))}t.prototype.createEl=function r(){return e.prototype.createEl.call(this,"div",{className:"vjs-control-bar",dir:"ltr"},{role:"group"})};return t}(o["default"]);l.prototype.options_={children:["playToggle","volumeMenuButton","currentTimeDisplay","timeDivider","durationDisplay","progressControl","liveDisplay","remainingTimeDisplay","customControlSpacer","playbackRateMenuButton","chaptersButton","descriptionsButton","subtitlesButton","captionsButton","audioTrackButton","fullscreenToggle"]};o["default"].registerComponent("ControlBar",l);r["default"]=l},{10:10,11:11,12:12,13:13,18:18,21:21,24:24,25:25,27:27,29:29,32:32,33:33,34:34,35:35,38:38,40:40,5:5,6:6,9:9}],9:[function(e,t,r){"use strict";r.__esModule=true;var n=e(2);var o=s(n);var i=e(5);var a=s(i);function s(e){return e&&e.__esModule?e:{"default":e}}function u(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}function l(e,t){if(!e){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return t&&(typeof t==="object"||typeof t==="function")?t:e}function c(e,t){if(typeof t!=="function"&&t!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof t)}e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:false,writable:true,configurable:true}});if(t)Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t}var f=function(e){c(t,e);function t(r,n){u(this,t);var o=l(this,e.call(this,r,n));o.on(r,"fullscreenchange",o.handleFullscreenChange);return o}t.prototype.buildCSSClass=function r(){return"vjs-fullscreen-control "+e.prototype.buildCSSClass.call(this)};t.prototype.handleFullscreenChange=function n(e){if(this.player_.isFullscreen()){this.controlText("Non-Fullscreen")}else{this.controlText("Fullscreen")}};t.prototype.handleClick=function o(e){if(!this.player_.isFullscreen()){this.player_.requestFullscreen()}else{this.player_.exitFullscreen()}};return t}(o["default"]);f.prototype.controlText_="Fullscreen";a["default"].registerComponent("FullscreenToggle",f);r["default"]=f},{2:2,5:5}],10:[function(e,t,r){"use strict";r.__esModule=true;var n=e(5);var o=u(n);var i=e(81);var a=s(i);function s(e){if(e&&e.__esModule){return e}else{var t={};if(e!=null){for(var r in e){if(Object.prototype.hasOwnProperty.call(e,r))t[r]=e[r]}}t["default"]=e;return t}}function u(e){return e&&e.__esModule?e:{"default":e}}function l(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}function c(e,t){if(!e){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return t&&(typeof t==="object"||typeof t==="function")?t:e}function f(e,t){if(typeof t!=="function"&&t!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof t)}e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:false,writable:true,configurable:true}});if(t)Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t}var p=function(e){f(t,e);function t(r,n){l(this,t);var o=c(this,e.call(this,r,n));o.updateShowing();o.on(o.player(),"durationchange",o.updateShowing);return o}t.prototype.createEl=function r(){var t=e.prototype.createEl.call(this,"div",{className:"vjs-live-control vjs-control"});this.contentEl_=a.createEl("div",{className:"vjs-live-display",innerHTML:'<span class="vjs-control-text">'+this.localize("Stream Type")+"</span>"+this.localize("LIVE")},{"aria-live":"off"});t.appendChild(this.contentEl_);return t};t.prototype.updateShowing=function n(e){if(this.player().duration()===Infinity){this.show()}else{this.hide()}};return t}(o["default"]);o["default"].registerComponent("LiveDisplay",p);r["default"]=p},{5:5,81:81}],11:[function(e,t,r){"use strict";r.__esModule=true;var n=e(2);var o=c(n);var i=e(5);var a=c(i);var s=e(81);var u=l(s);function l(e){if(e&&e.__esModule){return e}else{var t={};if(e!=null){for(var r in e){if(Object.prototype.hasOwnProperty.call(e,r))t[r]=e[r]}}t["default"]=e;return t}}function c(e){return e&&e.__esModule?e:{"default":e}}function f(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}function p(e,t){if(!e){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return t&&(typeof t==="object"||typeof t==="function")?t:e}function h(e,t){if(typeof t!=="function"&&t!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof t)}e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:false,writable:true,configurable:true}});if(t)Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t}var d=function(e){h(t,e);function t(r,n){f(this,t);var o=p(this,e.call(this,r,n));o.on(r,"volumechange",o.update);if(r.tech_&&r.tech_.featuresVolumeControl===false){o.addClass("vjs-hidden")}o.on(r,"loadstart",function(){this.update();if(r.tech_.featuresVolumeControl===false){this.addClass("vjs-hidden")}else{this.removeClass("vjs-hidden")}});return o}t.prototype.buildCSSClass=function r(){return"vjs-mute-control "+e.prototype.buildCSSClass.call(this)};t.prototype.handleClick=function n(e){this.player_.muted(this.player_.muted()?false:true)};t.prototype.update=function o(e){var t=this.player_.volume();var r=3;if(t===0||this.player_.muted()){r=0}else if(t<.33){r=1}else if(t<.67){r=2}var n=this.player_.muted()?"Unmute":"Mute";if(this.controlText()!==n){this.controlText(n)}for(var o=0;o<4;o++){u.removeElClass(this.el_,"vjs-vol-"+o)}u.addElClass(this.el_,"vjs-vol-"+r)};return t}(o["default"]);d.prototype.controlText_="Mute";a["default"].registerComponent("MuteToggle",d);r["default"]=d},{2:2,5:5,81:81}],12:[function(e,t,r){"use strict";r.__esModule=true;var n=e(2);var o=s(n);var i=e(5);var a=s(i);function s(e){return e&&e.__esModule?e:{"default":e}}function u(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}function l(e,t){if(!e){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return t&&(typeof t==="object"||typeof t==="function")?t:e}function c(e,t){if(typeof t!=="function"&&t!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof t)}e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:false,writable:true,configurable:true}});if(t)Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t}var f=function(e){c(t,e);function t(r,n){u(this,t);var o=l(this,e.call(this,r,n));o.on(r,"play",o.handlePlay);o.on(r,"pause",o.handlePause);return o}t.prototype.buildCSSClass=function r(){return"vjs-play-control "+e.prototype.buildCSSClass.call(this)};t.prototype.handleClick=function n(e){if(this.player_.paused()){this.player_.play()}else{this.player_.pause()}};t.prototype.handlePlay=function o(e){this.removeClass("vjs-paused");this.addClass("vjs-playing");this.controlText("Pause")};t.prototype.handlePause=function i(e){this.removeClass("vjs-playing");this.addClass("vjs-paused");this.controlText("Play")};return t}(o["default"]);f.prototype.controlText_="Play";a["default"].registerComponent("PlayToggle",f);r["default"]=f},{2:2,5:5}],13:[function(e,t,r){"use strict";r.__esModule=true;var n=e(47);var o=d(n);var i=e(49);var a=d(i);var s=e(14);var u=d(s);var l=e(5);var c=d(l);var f=e(81);var p=h(f);function h(e){if(e&&e.__esModule){return e}else{var t={};if(e!=null){for(var r in e){if(Object.prototype.hasOwnProperty.call(e,r))t[r]=e[r];

}}t["default"]=e;return t}}function d(e){return e&&e.__esModule?e:{"default":e}}function v(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}function y(e,t){if(!e){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return t&&(typeof t==="object"||typeof t==="function")?t:e}function g(e,t){if(typeof t!=="function"&&t!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof t)}e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:false,writable:true,configurable:true}});if(t)Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t}var _=function(e){g(t,e);function t(r,n){v(this,t);var o=y(this,e.call(this,r,n));o.updateVisibility();o.updateLabel();o.on(r,"loadstart",o.updateVisibility);o.on(r,"ratechange",o.updateLabel);return o}t.prototype.createEl=function r(){var t=e.prototype.createEl.call(this);this.labelEl_=p.createEl("div",{className:"vjs-playback-rate-value",innerHTML:1});t.appendChild(this.labelEl_);return t};t.prototype.buildCSSClass=function n(){return"vjs-playback-rate "+e.prototype.buildCSSClass.call(this)};t.prototype.createMenu=function o(){var e=new a["default"](this.player());var t=this.playbackRates();if(t){for(var r=t.length-1;r>=0;r--){e.addChild(new u["default"](this.player(),{rate:t[r]+"x"}))}}return e};t.prototype.updateARIAAttributes=function i(){this.el().setAttribute("aria-valuenow",this.player().playbackRate())};t.prototype.handleClick=function s(e){var t=this.player().playbackRate();var r=this.playbackRates();var n=r[0];for(var o=0;o<r.length;o++){if(r[o]>t){n=r[o];break}}this.player().playbackRate(n)};t.prototype.playbackRates=function l(){return this.options_.playbackRates||this.options_.playerOptions&&this.options_.playerOptions.playbackRates};t.prototype.playbackRateSupported=function c(){return this.player().tech_&&this.player().tech_.featuresPlaybackRate&&this.playbackRates()&&this.playbackRates().length>0};t.prototype.updateVisibility=function f(e){if(this.playbackRateSupported()){this.removeClass("vjs-hidden")}else{this.addClass("vjs-hidden")}};t.prototype.updateLabel=function h(e){if(this.playbackRateSupported()){this.labelEl_.innerHTML=this.player().playbackRate()+"x"}};return t}(o["default"]);_.prototype.controlText_="Playback Rate";c["default"].registerComponent("PlaybackRateMenuButton",_);r["default"]=_},{14:14,47:47,49:49,5:5,81:81}],14:[function(e,t,r){"use strict";r.__esModule=true;var n=e(48);var o=s(n);var i=e(5);var a=s(i);function s(e){return e&&e.__esModule?e:{"default":e}}function u(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}function l(e,t){if(!e){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return t&&(typeof t==="object"||typeof t==="function")?t:e}function c(e,t){if(typeof t!=="function"&&t!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof t)}e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:false,writable:true,configurable:true}});if(t)Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t}var f=function(e){c(t,e);function t(r,n){u(this,t);var o=n.rate;var i=parseFloat(o,10);n.label=o;n.selected=i===1;var a=l(this,e.call(this,r,n));a.label=o;a.rate=i;a.on(r,"ratechange",a.update);return a}t.prototype.handleClick=function r(t){e.prototype.handleClick.call(this);this.player().playbackRate(this.rate)};t.prototype.update=function n(e){this.selected(this.player().playbackRate()===this.rate)};return t}(o["default"]);f.prototype.contentElType="button";a["default"].registerComponent("PlaybackRateMenuItem",f);r["default"]=f},{48:48,5:5}],15:[function(e,t,r){"use strict";r.__esModule=true;var n=e(5);var o=u(n);var i=e(81);var a=s(i);function s(e){if(e&&e.__esModule){return e}else{var t={};if(e!=null){for(var r in e){if(Object.prototype.hasOwnProperty.call(e,r))t[r]=e[r]}}t["default"]=e;return t}}function u(e){return e&&e.__esModule?e:{"default":e}}function l(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}function c(e,t){if(!e){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return t&&(typeof t==="object"||typeof t==="function")?t:e}function f(e,t){if(typeof t!=="function"&&t!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof t)}e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:false,writable:true,configurable:true}});if(t)Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t}var p=function(e){f(t,e);function t(r,n){l(this,t);var o=c(this,e.call(this,r,n));o.partEls_=[];o.on(r,"progress",o.update);return o}t.prototype.createEl=function r(){return e.prototype.createEl.call(this,"div",{className:"vjs-load-progress",innerHTML:'<span class="vjs-control-text"><span>'+this.localize("Loaded")+"</span>: 0%</span>"})};t.prototype.update=function n(e){var t=this.player_.buffered();var r=this.player_.duration();var n=this.player_.bufferedEnd();var o=this.partEls_;var i=function p(e,t){var r=e/t||0;return(r>=1?1:r)*100+"%"};this.el_.style.width=i(n,r);for(var s=0;s<t.length;s++){var u=t.start(s);var l=t.end(s);var c=o[s];if(!c){c=this.el_.appendChild(a.createEl());o[s]=c}c.style.left=i(u,n);c.style.width=i(l-u,n)}for(var f=o.length;f>t.length;f--){this.el_.removeChild(o[f-1])}o.length=t.length};return t}(o["default"]);o["default"].registerComponent("LoadProgressBar",p);r["default"]=p},{5:5,81:81}],16:[function(e,t,r){"use strict";r.__esModule=true;var n=e(5);var o=d(n);var i=e(81);var a=h(i);var s=e(83);var u=h(s);var l=e(84);var c=d(l);var f=e(80);var p=d(f);function h(e){if(e&&e.__esModule){return e}else{var t={};if(e!=null){for(var r in e){if(Object.prototype.hasOwnProperty.call(e,r))t[r]=e[r]}}t["default"]=e;return t}}function d(e){return e&&e.__esModule?e:{"default":e}}function v(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}function y(e,t){if(!e){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return t&&(typeof t==="object"||typeof t==="function")?t:e}function g(e,t){if(typeof t!=="function"&&t!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof t)}e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:false,writable:true,configurable:true}});if(t)Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t}var _=function(e){g(t,e);function t(r,n){v(this,t);var o=y(this,e.call(this,r,n));if(n.playerOptions&&n.playerOptions.controlBar&&n.playerOptions.controlBar.progressControl&&n.playerOptions.controlBar.progressControl.keepTooltipsInside){o.keepTooltipsInside=n.playerOptions.controlBar.progressControl.keepTooltipsInside}if(o.keepTooltipsInside){o.tooltip=a.createEl("div",{className:"vjs-time-tooltip"});o.el().appendChild(o.tooltip);o.addClass("vjs-keep-tooltips-inside")}o.update(0,0);r.on("ready",function(){o.on(r.controlBar.progressControl.el(),"mousemove",u.throttle(u.bind(o,o.handleMouseMove),25))});return o}t.prototype.createEl=function r(){return e.prototype.createEl.call(this,"div",{className:"vjs-mouse-display"})};t.prototype.handleMouseMove=function n(e){var t=this.player_.duration();var r=this.calculateDistance(e)*t;var n=e.pageX-a.findElPosition(this.el().parentNode).left;this.update(r,n)};t.prototype.update=function o(e,t){var r=(0,c["default"])(e,this.player_.duration());this.el().style.left=t+"px";this.el().setAttribute("data-current-time",r);if(this.keepTooltipsInside){var n=this.clampPosition_(t);var o=t-n+1;var i=parseFloat((0,p["default"])(this.tooltip,"width"));var a=i/2;this.tooltip.innerHTML=r;this.tooltip.style.right="-"+(a-o)+"px"}};t.prototype.calculateDistance=function i(e){return a.getPointerPosition(this.el().parentNode,e).x};t.prototype.clampPosition_=function s(e){if(!this.keepTooltipsInside){return e}var t=parseFloat((0,p["default"])(this.player().el(),"width"));var r=parseFloat((0,p["default"])(this.tooltip,"width"));var n=r/2;var o=e;if(e<n){o=Math.ceil(n)}else if(e>t-n){o=Math.floor(t-n)}return o};return t}(o["default"]);o["default"].registerComponent("MouseTimeDisplay",_);r["default"]=_},{5:5,80:80,81:81,83:83,84:84}],17:[function(e,t,r){"use strict";r.__esModule=true;var n=e(5);var o=c(n);var i=e(83);var a=l(i);var s=e(84);var u=c(s);function l(e){if(e&&e.__esModule){return e}else{var t={};if(e!=null){for(var r in e){if(Object.prototype.hasOwnProperty.call(e,r))t[r]=e[r]}}t["default"]=e;return t}}function c(e){return e&&e.__esModule?e:{"default":e}}function f(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}function p(e,t){if(!e){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return t&&(typeof t==="object"||typeof t==="function")?t:e}function h(e,t){if(typeof t!=="function"&&t!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof t)}e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:false,writable:true,configurable:true}});if(t)Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t}var d=function(e){h(t,e);function t(r,n){f(this,t);var o=p(this,e.call(this,r,n));o.updateDataAttr();o.on(r,"timeupdate",o.updateDataAttr);r.ready(a.bind(o,o.updateDataAttr));if(n.playerOptions&&n.playerOptions.controlBar&&n.playerOptions.controlBar.progressControl&&n.playerOptions.controlBar.progressControl.keepTooltipsInside){o.keepTooltipsInside=n.playerOptions.controlBar.progressControl.keepTooltipsInside}if(o.keepTooltipsInside){o.addClass("vjs-keep-tooltips-inside")}return o}t.prototype.createEl=function r(){return e.prototype.createEl.call(this,"div",{className:"vjs-play-progress vjs-slider-bar",innerHTML:'<span class="vjs-control-text"><span>'+this.localize("Progress")+"</span>: 0%</span>"})};t.prototype.updateDataAttr=function n(e){var t=this.player_.scrubbing()?this.player_.getCache().currentTime:this.player_.currentTime();this.el_.setAttribute("data-current-time",(0,u["default"])(t,this.player_.duration()))};return t}(o["default"]);o["default"].registerComponent("PlayProgressBar",d);r["default"]=d},{5:5,83:83,84:84}],18:[function(e,t,r){"use strict";r.__esModule=true;var n=e(5);var o=i(n);e(19);e(16);function i(e){return e&&e.__esModule?e:{"default":e}}function a(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}function s(e,t){if(!e){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return t&&(typeof t==="object"||typeof t==="function")?t:e}function u(e,t){if(typeof t!=="function"&&t!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof t)}e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:false,writable:true,configurable:true}});if(t)Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t}var l=function(e){u(t,e);function t(){a(this,t);return s(this,e.apply(this,arguments))}t.prototype.createEl=function r(){return e.prototype.createEl.call(this,"div",{className:"vjs-progress-control vjs-control"})};return t}(o["default"]);l.prototype.options_={children:["seekBar"]};o["default"].registerComponent("ProgressControl",l);r["default"]=l},{16:16,19:19,5:5}],19:[function(e,t,r){"use strict";r.__esModule=true;var n=e(57);var o=d(n);var i=e(5);var a=d(i);var s=e(83);var u=h(s);var l=e(84);var c=d(l);var f=e(80);var p=d(f);e(15);e(17);e(20);function h(e){if(e&&e.__esModule){return e}else{var t={};if(e!=null){for(var r in e){if(Object.prototype.hasOwnProperty.call(e,r))t[r]=e[r]}}t["default"]=e;return t}}function d(e){return e&&e.__esModule?e:{"default":e}}function v(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}function y(e,t){if(!e){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return t&&(typeof t==="object"||typeof t==="function")?t:e}function g(e,t){if(typeof t!=="function"&&t!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof t)}e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:false,writable:true,configurable:true}});if(t)Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t}var _=function(e){g(t,e);function t(r,n){v(this,t);var o=y(this,e.call(this,r,n));o.on(r,"timeupdate",o.updateProgress);o.on(r,"ended",o.updateProgress);r.ready(u.bind(o,o.updateProgress));if(n.playerOptions&&n.playerOptions.controlBar&&n.playerOptions.controlBar.progressControl&&n.playerOptions.controlBar.progressControl.keepTooltipsInside){o.keepTooltipsInside=n.playerOptions.controlBar.progressControl.keepTooltipsInside}if(o.keepTooltipsInside){o.tooltipProgressBar=o.addChild("TooltipProgressBar")}return o}t.prototype.createEl=function r(){return e.prototype.createEl.call(this,"div",{className:"vjs-progress-holder"},{"aria-label":"progress bar"})};t.prototype.updateProgress=function n(e){this.updateAriaAttributes(this.el_);if(this.keepTooltipsInside){this.updateAriaAttributes(this.tooltipProgressBar.el_);this.tooltipProgressBar.el_.style.width=this.bar.el_.style.width;var t=parseFloat((0,p["default"])(this.player().el(),"width"));var r=parseFloat((0,p["default"])(this.tooltipProgressBar.tooltip,"width"));var n=this.tooltipProgressBar.el().style;n.maxWidth=Math.floor(t-r/2)+"px";n.minWidth=Math.ceil(r/2)+"px";n.right="-"+r/2+"px"}};t.prototype.updateAriaAttributes=function o(e){var t=this.player_.scrubbing()?this.player_.getCache().currentTime:this.player_.currentTime();e.setAttribute("aria-valuenow",(this.getPercent()*100).toFixed(2));e.setAttribute("aria-valuetext",(0,c["default"])(t,this.player_.duration()))};t.prototype.getPercent=function i(){var e=this.player_.currentTime()/this.player_.duration();return e>=1?1:e};t.prototype.handleMouseDown=function a(t){this.player_.scrubbing(true);this.videoWasPlaying=!this.player_.paused();this.player_.pause();e.prototype.handleMouseDown.call(this,t)};t.prototype.handleMouseMove=function s(e){var t=this.calculateDistance(e)*this.player_.duration();if(t===this.player_.duration()){t=t-.1}this.player_.currentTime(t)};t.prototype.handleMouseUp=function l(t){e.prototype.handleMouseUp.call(this,t);this.player_.scrubbing(false);if(this.videoWasPlaying){this.player_.play()}};t.prototype.stepForward=function f(){this.player_.currentTime(this.player_.currentTime()+5)};t.prototype.stepBack=function h(){this.player_.currentTime(this.player_.currentTime()-5)};return t}(o["default"]);_.prototype.options_={children:["loadProgressBar","mouseTimeDisplay","playProgressBar"],barName:"playProgressBar"};_.prototype.playerEvent="timeupdate";a["default"].registerComponent("SeekBar",_);r["default"]=_},{15:15,17:17,20:20,5:5,57:57,80:80,83:83,84:84}],20:[function(e,t,r){"use strict";r.__esModule=true;var n=e(5);var o=c(n);var i=e(83);var a=l(i);var s=e(84);var u=c(s);function l(e){if(e&&e.__esModule){return e}else{var t={};if(e!=null){for(var r in e){if(Object.prototype.hasOwnProperty.call(e,r))t[r]=e[r]}}t["default"]=e;return t}}function c(e){return e&&e.__esModule?e:{"default":e}}function f(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}function p(e,t){if(!e){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return t&&(typeof t==="object"||typeof t==="function")?t:e}function h(e,t){if(typeof t!=="function"&&t!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof t)}e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:false,writable:true,configurable:true}});if(t)Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t}var d=function(e){h(t,e);function t(r,n){f(this,t);var o=p(this,e.call(this,r,n));o.updateDataAttr();o.on(r,"timeupdate",o.updateDataAttr);r.ready(a.bind(o,o.updateDataAttr));return o}t.prototype.createEl=function r(){var t=e.prototype.createEl.call(this,"div",{className:"vjs-tooltip-progress-bar vjs-slider-bar",innerHTML:'<div class="vjs-time-tooltip"></div>\n        <span class="vjs-control-text"><span>'+this.localize("Progress")+"</span>: 0%</span>"});this.tooltip=t.querySelector(".vjs-time-tooltip");return t};t.prototype.updateDataAttr=function n(e){var t=this.player_.scrubbing()?this.player_.getCache().currentTime:this.player_.currentTime();var r=(0,u["default"])(t,this.player_.duration());this.el_.setAttribute("data-current-time",r);this.tooltip.innerHTML=r};return t}(o["default"]);o["default"].registerComponent("TooltipProgressBar",d);r["default"]=d},{5:5,83:83,84:84}],21:[function(e,t,r){"use strict";r.__esModule=true;var n=e(22);var o=s(n);var i=e(5);var a=s(i);function s(e){return e&&e.__esModule?e:{"default":e}}function u(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}function l(e,t){if(!e){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return t&&(typeof t==="object"||typeof t==="function")?t:e}function c(e,t){if(typeof t!=="function"&&t!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof t)}e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:false,writable:true,configurable:true}});if(t)Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t}var f=function(e){c(t,e);function t(){u(this,t);return l(this,e.apply(this,arguments))}t.prototype.buildCSSClass=function r(){return"vjs-custom-control-spacer "+e.prototype.buildCSSClass.call(this)};t.prototype.createEl=function n(){var t=e.prototype.createEl.call(this,{className:this.buildCSSClass()});t.innerHTML="&nbsp;";return t};return t}(o["default"]);a["default"].registerComponent("CustomControlSpacer",f);r["default"]=f},{22:22,5:5}],22:[function(e,t,r){"use strict";r.__esModule=true;var n=e(5);var o=i(n);function i(e){return e&&e.__esModule?e:{"default":e}}function a(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}function s(e,t){if(!e){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return t&&(typeof t==="object"||typeof t==="function")?t:e}function u(e,t){if(typeof t!=="function"&&t!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof t)}e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:false,writable:true,configurable:true}});if(t)Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t}var l=function(e){u(t,e);function t(){a(this,t);return s(this,e.apply(this,arguments))}t.prototype.buildCSSClass=function r(){return"vjs-spacer "+e.prototype.buildCSSClass.call(this)};t.prototype.createEl=function n(){return e.prototype.createEl.call(this,"div",{className:this.buildCSSClass()})};return t}(o["default"]);o["default"].registerComponent("Spacer",l);r["default"]=l},{5:5}],23:[function(e,t,r){"use strict";r.__esModule=true;var n=e(31);var o=s(n);var i=e(5);var a=s(i);function s(e){return e&&e.__esModule?e:{"default":e}}function u(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}function l(e,t){if(!e){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return t&&(typeof t==="object"||typeof t==="function")?t:e}function c(e,t){if(typeof t!=="function"&&t!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof t)}e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:false,writable:true,configurable:true}});if(t)Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t}var f=function(e){c(t,e);function t(r,n){u(this,t);n.track={player:r,kind:n.kind,label:n.kind+" settings",selectable:false,"default":false,mode:"disabled"};n.selectable=false;var o=l(this,e.call(this,r,n));o.addClass("vjs-texttrack-settings");o.controlText(", opens "+n.kind+" settings dialog");return o}t.prototype.handleClick=function r(e){this.player().getChild("textTrackSettings").show();this.player().getChild("textTrackSettings").el_.focus()};return t}(o["default"]);a["default"].registerComponent("CaptionSettingsMenuItem",f);r["default"]=f},{31:31,5:5}],24:[function(e,t,r){"use strict";r.__esModule=true;var n=e(30);var o=l(n);var i=e(5);var a=l(i);var s=e(23);var u=l(s);function l(e){return e&&e.__esModule?e:{"default":e}}function c(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}function f(e,t){if(!e){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return t&&(typeof t==="object"||typeof t==="function")?t:e}function p(e,t){if(typeof t!=="function"&&t!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof t)}e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:false,writable:true,configurable:true}});if(t)Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t}var h=function(e){p(t,e);function t(r,n,o){c(this,t);var i=f(this,e.call(this,r,n,o));i.el_.setAttribute("aria-label","Captions Menu");return i}t.prototype.buildCSSClass=function r(){return"vjs-captions-button "+e.prototype.buildCSSClass.call(this)};t.prototype.update=function n(t){var r=2;e.prototype.update.call(this);if(this.player().tech_&&this.player().tech_.featuresNativeTextTracks){r=1}if(this.items&&this.items.length>r){this.show()}else{this.hide()}};t.prototype.createItems=function o(){var t=[];if(!(this.player().tech_&&this.player().tech_.featuresNativeTextTracks)){t.push(new u["default"](this.player_,{kind:this.kind_}))}return e.prototype.createItems.call(this,t)};return t}(o["default"]);h.prototype.kind_="captions";h.prototype.controlText_="Captions";a["default"].registerComponent("CaptionsButton",h);r["default"]=h},{23:23,30:30,5:5}],25:[function(e,t,r){"use strict";r.__esModule=true;var n=e(30);var o=f(n);var i=e(5);var a=f(i);var s=e(26);var u=f(s);var l=e(91);var c=f(l);function f(e){return e&&e.__esModule?e:{"default":e}}function p(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}function h(e,t){if(!e){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return t&&(typeof t==="object"||typeof t==="function")?t:e}function d(e,t){if(typeof t!=="function"&&t!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof t)}e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:false,writable:true,configurable:true}});if(t)Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t}var v=function(e){d(t,e);function t(r,n,o){p(this,t);var i=h(this,e.call(this,r,n,o));i.el_.setAttribute("aria-label","Chapters Menu");return i}t.prototype.buildCSSClass=function r(){return"vjs-chapters-button "+e.prototype.buildCSSClass.call(this)};t.prototype.update=function n(t){if(!this.track_||t&&(t.type==="addtrack"||t.type==="removetrack")){this.setTrack(this.findChaptersTrack())}e.prototype.update.call(this)};t.prototype.setTrack=function o(e){if(this.track_===e){return}if(!this.updateHandler_){this.updateHandler_=this.update.bind(this)}if(this.track_){var t=this.player_.remoteTextTrackEls().getTrackElementByTrack_(this.track_);if(t){t.removeEventListener("load",this.updateHandler_)}this.track_=null}this.track_=e;if(this.track_){this.track_.mode="hidden";var r=this.player_.remoteTextTrackEls().getTrackElementByTrack_(this.track_);if(r){r.addEventListener("load",this.updateHandler_)}}};t.prototype.findChaptersTrack=function i(){var e=this.player_.textTracks()||[];for(var t=e.length-1;t>=0;t--){var r=e[t];if(r.kind===this.kind_){return r}}};t.prototype.getMenuCaption=function a(){if(this.track_&&this.track_.label){return this.track_.label}return this.localize((0,c["default"])(this.kind_))};t.prototype.createMenu=function s(){this.options_.title=this.getMenuCaption();return e.prototype.createMenu.call(this)};t.prototype.createItems=function l(){var e=[];if(!this.track_){return e}var t=this.track_.cues;if(!t){return e}for(var r=0,n=t.length;r<n;r++){var o=t[r];var i=new u["default"](this.player_,{track:this.track_,cue:o});e.push(i)}return e};return t}(o["default"]);v.prototype.kind_="chapters";v.prototype.controlText_="Chapters";a["default"].registerComponent("ChaptersButton",v);r["default"]=v},{26:26,30:30,5:5,91:91}],26:[function(e,t,r){"use strict";r.__esModule=true;var n=e(48);var o=c(n);var i=e(5);var a=c(i);var s=e(83);var u=l(s);function l(e){if(e&&e.__esModule){return e}else{var t={};if(e!=null){for(var r in e){if(Object.prototype.hasOwnProperty.call(e,r))t[r]=e[r]}}t["default"]=e;return t}}function c(e){return e&&e.__esModule?e:{"default":e}}function f(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}function p(e,t){if(!e){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return t&&(typeof t==="object"||typeof t==="function")?t:e}function h(e,t){if(typeof t!=="function"&&t!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof t)}e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:false,writable:true,configurable:true}});if(t)Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t}var d=function(e){h(t,e);function t(r,n){f(this,t);var o=n.track;var i=n.cue;var a=r.currentTime();n.selectable=true;n.label=i.text;n.selected=i.startTime<=a&&a<i.endTime;var s=p(this,e.call(this,r,n));s.track=o;s.cue=i;o.addEventListener("cuechange",u.bind(s,s.update));return s}t.prototype.handleClick=function r(t){e.prototype.handleClick.call(this);this.player_.currentTime(this.cue.startTime);this.update(this.cue.startTime)};t.prototype.update=function n(e){var t=this.cue;var r=this.player_.currentTime();this.selected(t.startTime<=r&&r<t.endTime)};return t}(o["default"]);a["default"].registerComponent("ChaptersTrackMenuItem",d);r["default"]=d},{48:48,5:5,83:83}],27:[function(e,t,r){"use strict";r.__esModule=true;var n=e(30);var o=c(n);var i=e(5);var a=c(i);var s=e(83);var u=l(s);function l(e){if(e&&e.__esModule){return e}else{var t={};if(e!=null){for(var r in e){if(Object.prototype.hasOwnProperty.call(e,r))t[r]=e[r]}}t["default"]=e;return t}}function c(e){return e&&e.__esModule?e:{"default":e}}function f(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}function p(e,t){if(!e){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return t&&(typeof t==="object"||typeof t==="function")?t:e}function h(e,t){if(typeof t!=="function"&&t!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof t)}e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:false,writable:true,configurable:true}});if(t)Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t}var d=function(e){h(t,e);function t(r,n,o){f(this,t);var i=p(this,e.call(this,r,n,o));i.el_.setAttribute("aria-label","Descriptions Menu");var a=r.textTracks();if(a){(function(){var e=u.bind(i,i.handleTracksChange);a.addEventListener("change",e);i.on("dispose",function(){a.removeEventListener("change",e)})})()}return i}t.prototype.handleTracksChange=function r(e){var t=this.player().textTracks();var r=false;for(var n=0,o=t.length;n<o;n++){var i=t[n];if(i.kind!==this.kind_&&i.mode==="showing"){r=true;break}}if(r){this.disable()}else{this.enable()}};t.prototype.buildCSSClass=function n(){return"vjs-descriptions-button "+e.prototype.buildCSSClass.call(this)};return t}(o["default"]);d.prototype.kind_="descriptions";d.prototype.controlText_="Descriptions";a["default"].registerComponent("DescriptionsButton",d);r["default"]=d},{30:30,5:5,83:83}],28:[function(e,t,r){"use strict";r.__esModule=true;var n=e(31);var o=s(n);var i=e(5);var a=s(i);function s(e){return e&&e.__esModule?e:{"default":e}}function u(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}function l(e,t){if(!e){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return t&&(typeof t==="object"||typeof t==="function")?t:e}function c(e,t){if(typeof t!=="function"&&t!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof t)}e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:false,writable:true,configurable:true}});if(t)Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t}var f=function(e){c(t,e);function t(r,n){u(this,t);n.track={player:r,kind:n.kind,label:n.kind+" off","default":false,mode:"disabled"};n.selectable=true;var o=l(this,e.call(this,r,n));o.selected(true);return o}t.prototype.handleTracksChange=function r(e){var t=this.player().textTracks();var r=true;for(var n=0,o=t.length;n<o;n++){var i=t[n];if(i.kind===this.track.kind&&i.mode==="showing"){r=false;break}}this.selected(r)};return t}(o["default"]);a["default"].registerComponent("OffTextTrackMenuItem",f);r["default"]=f},{31:31,5:5}],29:[function(e,t,r){"use strict";r.__esModule=true;var n=e(30);var o=s(n);var i=e(5);var a=s(i);function s(e){return e&&e.__esModule?e:{"default":e}}function u(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}function l(e,t){if(!e){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return t&&(typeof t==="object"||typeof t==="function")?t:e}function c(e,t){if(typeof t!=="function"&&t!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof t)}e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:false,writable:true,configurable:true}});if(t)Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t}var f=function(e){c(t,e);function t(r,n,o){u(this,t);var i=l(this,e.call(this,r,n,o));i.el_.setAttribute("aria-label","Subtitles Menu");return i}t.prototype.buildCSSClass=function r(){return"vjs-subtitles-button "+e.prototype.buildCSSClass.call(this)};return t}(o["default"]);f.prototype.kind_="subtitles";f.prototype.controlText_="Subtitles";a["default"].registerComponent("SubtitlesButton",f);r["default"]=f},{30:30,5:5}],30:[function(e,t,r){"use strict";r.__esModule=true;var n=e(36);var o=f(n);var i=e(5);var a=f(i);var s=e(31);var u=f(s);var l=e(28);var c=f(l);function f(e){return e&&e.__esModule?e:{"default":e}}function p(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}function h(e,t){if(!e){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return t&&(typeof t==="object"||typeof t==="function")?t:e}function d(e,t){if(typeof t!=="function"&&t!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof t)}e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:false,writable:true,configurable:true}});if(t)Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t}var v=function(e){d(t,e);function t(r){var n=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};p(this,t);n.tracks=r.textTracks();return h(this,e.call(this,r,n))}t.prototype.createItems=function r(){var e=arguments.length>0&&arguments[0]!==undefined?arguments[0]:[];e.push(new c["default"](this.player_,{kind:this.kind_}));var t=this.player_.textTracks();if(!t){return e}for(var r=0;r<t.length;r++){var n=t[r];if(n.kind===this.kind_){e.push(new u["default"](this.player_,{track:n,selectable:true}))}}return e};return t}(o["default"]);a["default"].registerComponent("TextTrackButton",v);r["default"]=v},{28:28,31:31,36:36,5:5}],31:[function(e,t,r){"use strict";r.__esModule=true;var n=typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol==="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};var o=e(48);var i=v(o);var a=e(5);var s=v(a);var u=e(83);var l=d(u);var c=e(95);

var f=v(c);var p=e(94);var h=v(p);function d(e){if(e&&e.__esModule){return e}else{var t={};if(e!=null){for(var r in e){if(Object.prototype.hasOwnProperty.call(e,r))t[r]=e[r]}}t["default"]=e;return t}}function v(e){return e&&e.__esModule?e:{"default":e}}function y(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}function g(e,t){if(!e){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return t&&(typeof t==="object"||typeof t==="function")?t:e}function _(e,t){if(typeof t!=="function"&&t!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof t)}e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:false,writable:true,configurable:true}});if(t)Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t}var m=function(e){_(t,e);function t(r,o){y(this,t);var i=o.track;var a=r.textTracks();o.label=i.label||i.language||"Unknown";o.selected=i["default"]||i.mode==="showing";var s=g(this,e.call(this,r,o));s.track=i;if(a){(function(){var e=l.bind(s,s.handleTracksChange);a.addEventListener("change",e);s.on("dispose",function(){a.removeEventListener("change",e)})})()}if(a&&a.onchange===undefined){(function(){var e=void 0;s.on(["tap","click"],function(){if(n(f["default"].Event)!=="object"){try{e=new f["default"].Event("change")}catch(t){}}if(!e){e=h["default"].createEvent("Event");e.initEvent("change",true,true)}a.dispatchEvent(e)})})()}return s}t.prototype.handleClick=function r(t){var r=this.track.kind;var n=this.player_.textTracks();e.prototype.handleClick.call(this,t);if(!n){return}for(var o=0;o<n.length;o++){var i=n[o];if(i.kind!==r){continue}if(i===this.track){i.mode="showing"}else{i.mode="disabled"}}};t.prototype.handleTracksChange=function o(e){this.selected(this.track.mode==="showing")};return t}(i["default"]);s["default"].registerComponent("TextTrackMenuItem",m);r["default"]=m},{48:48,5:5,83:83,94:94,95:95}],32:[function(e,t,r){"use strict";r.__esModule=true;var n=e(5);var o=c(n);var i=e(81);var a=l(i);var s=e(84);var u=c(s);function l(e){if(e&&e.__esModule){return e}else{var t={};if(e!=null){for(var r in e){if(Object.prototype.hasOwnProperty.call(e,r))t[r]=e[r]}}t["default"]=e;return t}}function c(e){return e&&e.__esModule?e:{"default":e}}function f(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}function p(e,t){if(!e){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return t&&(typeof t==="object"||typeof t==="function")?t:e}function h(e,t){if(typeof t!=="function"&&t!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof t)}e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:false,writable:true,configurable:true}});if(t)Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t}var d=function(e){h(t,e);function t(r,n){f(this,t);var o=p(this,e.call(this,r,n));o.on(r,"timeupdate",o.updateContent);return o}t.prototype.createEl=function r(){var t=e.prototype.createEl.call(this,"div",{className:"vjs-current-time vjs-time-control vjs-control"});this.contentEl_=a.createEl("div",{className:"vjs-current-time-display",innerHTML:'<span class="vjs-control-text">Current Time </span>'+"0:00"},{"aria-live":"off"});t.appendChild(this.contentEl_);return t};t.prototype.updateContent=function n(e){var t=this.player_.scrubbing()?this.player_.getCache().currentTime:this.player_.currentTime();var r=this.localize("Current Time");var n=(0,u["default"])(t,this.player_.duration());if(n!==this.formattedTime_){this.formattedTime_=n;this.contentEl_.innerHTML='<span class="vjs-control-text">'+r+"</span> "+n}};return t}(o["default"]);o["default"].registerComponent("CurrentTimeDisplay",d);r["default"]=d},{5:5,81:81,84:84}],33:[function(e,t,r){"use strict";r.__esModule=true;var n=e(5);var o=c(n);var i=e(81);var a=l(i);var s=e(84);var u=c(s);function l(e){if(e&&e.__esModule){return e}else{var t={};if(e!=null){for(var r in e){if(Object.prototype.hasOwnProperty.call(e,r))t[r]=e[r]}}t["default"]=e;return t}}function c(e){return e&&e.__esModule?e:{"default":e}}function f(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}function p(e,t){if(!e){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return t&&(typeof t==="object"||typeof t==="function")?t:e}function h(e,t){if(typeof t!=="function"&&t!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof t)}e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:false,writable:true,configurable:true}});if(t)Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t}var d=function(e){h(t,e);function t(r,n){f(this,t);var o=p(this,e.call(this,r,n));o.on(r,"durationchange",o.updateContent);o.on(r,"timeupdate",o.updateContent);o.on(r,"loadedmetadata",o.updateContent);return o}t.prototype.createEl=function r(){var t=e.prototype.createEl.call(this,"div",{className:"vjs-duration vjs-time-control vjs-control"});this.contentEl_=a.createEl("div",{className:"vjs-duration-display",innerHTML:'<span class="vjs-control-text">'+this.localize("Duration Time")+"</span> 0:00"},{"aria-live":"off"});t.appendChild(this.contentEl_);return t};t.prototype.updateContent=function n(e){var t=this.player_.duration();if(t&&this.duration_!==t){this.duration_=t;var r=this.localize("Duration Time");var n=(0,u["default"])(t);this.contentEl_.innerHTML='<span class="vjs-control-text">'+r+"</span> "+n}};return t}(o["default"]);o["default"].registerComponent("DurationDisplay",d);r["default"]=d},{5:5,81:81,84:84}],34:[function(e,t,r){"use strict";r.__esModule=true;var n=e(5);var o=c(n);var i=e(81);var a=l(i);var s=e(84);var u=c(s);function l(e){if(e&&e.__esModule){return e}else{var t={};if(e!=null){for(var r in e){if(Object.prototype.hasOwnProperty.call(e,r))t[r]=e[r]}}t["default"]=e;return t}}function c(e){return e&&e.__esModule?e:{"default":e}}function f(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}function p(e,t){if(!e){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return t&&(typeof t==="object"||typeof t==="function")?t:e}function h(e,t){if(typeof t!=="function"&&t!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof t)}e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:false,writable:true,configurable:true}});if(t)Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t}var d=function(e){h(t,e);function t(r,n){f(this,t);var o=p(this,e.call(this,r,n));o.on(r,"timeupdate",o.updateContent);o.on(r,"durationchange",o.updateContent);return o}t.prototype.createEl=function r(){var t=e.prototype.createEl.call(this,"div",{className:"vjs-remaining-time vjs-time-control vjs-control"});this.contentEl_=a.createEl("div",{className:"vjs-remaining-time-display",innerHTML:'<span class="vjs-control-text">'+this.localize("Remaining Time")+"</span> -0:00"},{"aria-live":"off"});t.appendChild(this.contentEl_);return t};t.prototype.updateContent=function n(e){if(this.player_.duration()){var t=this.localize("Remaining Time");var r=(0,u["default"])(this.player_.remainingTime());if(r!==this.formattedTime_){this.formattedTime_=r;this.contentEl_.innerHTML='<span class="vjs-control-text">'+t+"</span> -"+r}}};return t}(o["default"]);o["default"].registerComponent("RemainingTimeDisplay",d);r["default"]=d},{5:5,81:81,84:84}],35:[function(e,t,r){"use strict";r.__esModule=true;var n=e(5);var o=i(n);function i(e){return e&&e.__esModule?e:{"default":e}}function a(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}function s(e,t){if(!e){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return t&&(typeof t==="object"||typeof t==="function")?t:e}function u(e,t){if(typeof t!=="function"&&t!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof t)}e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:false,writable:true,configurable:true}});if(t)Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t}var l=function(e){u(t,e);function t(){a(this,t);return s(this,e.apply(this,arguments))}t.prototype.createEl=function r(){return e.prototype.createEl.call(this,"div",{className:"vjs-time-control vjs-time-divider",innerHTML:"<div><span>/</span></div>"})};return t}(o["default"]);o["default"].registerComponent("TimeDivider",l);r["default"]=l},{5:5}],36:[function(e,t,r){"use strict";r.__esModule=true;var n=e(47);var o=c(n);var i=e(5);var a=c(i);var s=e(83);var u=l(s);function l(e){if(e&&e.__esModule){return e}else{var t={};if(e!=null){for(var r in e){if(Object.prototype.hasOwnProperty.call(e,r))t[r]=e[r]}}t["default"]=e;return t}}function c(e){return e&&e.__esModule?e:{"default":e}}function f(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}function p(e,t){if(!e){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return t&&(typeof t==="object"||typeof t==="function")?t:e}function h(e,t){if(typeof t!=="function"&&t!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof t)}e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:false,writable:true,configurable:true}});if(t)Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t}var d=function(e){h(t,e);function t(r,n){f(this,t);var o=n.tracks;var i=p(this,e.call(this,r,n));if(i.items.length<=1){i.hide()}if(!o){return p(i)}var a=u.bind(i,i.update);o.addEventListener("removetrack",a);o.addEventListener("addtrack",a);i.player_.on("dispose",function(){o.removeEventListener("removetrack",a);o.removeEventListener("addtrack",a)});return i}return t}(o["default"]);a["default"].registerComponent("TrackButton",d);r["default"]=d},{47:47,5:5,83:83}],37:[function(e,t,r){"use strict";r.__esModule=true;var n=e(57);var o=c(n);var i=e(5);var a=c(i);var s=e(83);var u=l(s);e(39);function l(e){if(e&&e.__esModule){return e}else{var t={};if(e!=null){for(var r in e){if(Object.prototype.hasOwnProperty.call(e,r))t[r]=e[r]}}t["default"]=e;return t}}function c(e){return e&&e.__esModule?e:{"default":e}}function f(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}function p(e,t){if(!e){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return t&&(typeof t==="object"||typeof t==="function")?t:e}function h(e,t){if(typeof t!=="function"&&t!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof t)}e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:false,writable:true,configurable:true}});if(t)Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t}var d=function(e){h(t,e);function t(r,n){f(this,t);var o=p(this,e.call(this,r,n));o.on(r,"volumechange",o.updateARIAAttributes);r.ready(u.bind(o,o.updateARIAAttributes));return o}t.prototype.createEl=function r(){return e.prototype.createEl.call(this,"div",{className:"vjs-volume-bar vjs-slider-bar"},{"aria-label":"volume level"})};t.prototype.handleMouseMove=function n(e){this.checkMuted();this.player_.volume(this.calculateDistance(e))};t.prototype.checkMuted=function o(){if(this.player_.muted()){this.player_.muted(false)}};t.prototype.getPercent=function i(){if(this.player_.muted()){return 0}return this.player_.volume()};t.prototype.stepForward=function a(){this.checkMuted();this.player_.volume(this.player_.volume()+.1)};t.prototype.stepBack=function s(){this.checkMuted();this.player_.volume(this.player_.volume()-.1)};t.prototype.updateARIAAttributes=function l(e){var t=(this.player_.volume()*100).toFixed(2);this.el_.setAttribute("aria-valuenow",t);this.el_.setAttribute("aria-valuetext",t+"%")};return t}(o["default"]);d.prototype.options_={children:["volumeLevel"],barName:"volumeLevel"};d.prototype.playerEvent="volumechange";a["default"].registerComponent("VolumeBar",d);r["default"]=d},{39:39,5:5,57:57,83:83}],38:[function(e,t,r){"use strict";r.__esModule=true;var n=e(5);var o=i(n);e(37);function i(e){return e&&e.__esModule?e:{"default":e}}function a(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}function s(e,t){if(!e){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return t&&(typeof t==="object"||typeof t==="function")?t:e}function u(e,t){if(typeof t!=="function"&&t!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof t)}e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:false,writable:true,configurable:true}});if(t)Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t}var l=function(e){u(t,e);function t(r,n){a(this,t);var o=s(this,e.call(this,r,n));if(r.tech_&&r.tech_.featuresVolumeControl===false){o.addClass("vjs-hidden")}o.on(r,"loadstart",function(){if(r.tech_.featuresVolumeControl===false){this.addClass("vjs-hidden")}else{this.removeClass("vjs-hidden")}});return o}t.prototype.createEl=function r(){return e.prototype.createEl.call(this,"div",{className:"vjs-volume-control vjs-control"})};return t}(o["default"]);l.prototype.options_={children:["volumeBar"]};o["default"].registerComponent("VolumeControl",l);r["default"]=l},{37:37,5:5}],39:[function(e,t,r){"use strict";r.__esModule=true;var n=e(5);var o=i(n);function i(e){return e&&e.__esModule?e:{"default":e}}function a(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}function s(e,t){if(!e){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return t&&(typeof t==="object"||typeof t==="function")?t:e}function u(e,t){if(typeof t!=="function"&&t!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof t)}e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:false,writable:true,configurable:true}});if(t)Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t}var l=function(e){u(t,e);function t(){a(this,t);return s(this,e.apply(this,arguments))}t.prototype.createEl=function r(){return e.prototype.createEl.call(this,"div",{className:"vjs-volume-level",innerHTML:'<span class="vjs-control-text"></span>'})};return t}(o["default"]);o["default"].registerComponent("VolumeLevel",l);r["default"]=l},{5:5}],40:[function(e,t,r){"use strict";r.__esModule=true;var n=e(83);var o=y(n);var i=e(5);var a=v(i);var s=e(54);var u=v(s);var l=e(53);var c=v(l);var f=e(11);var p=v(f);var h=e(37);var d=v(h);function v(e){return e&&e.__esModule?e:{"default":e}}function y(e){if(e&&e.__esModule){return e}else{var t={};if(e!=null){for(var r in e){if(Object.prototype.hasOwnProperty.call(e,r))t[r]=e[r]}}t["default"]=e;return t}}function g(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}function _(e,t){if(!e){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return t&&(typeof t==="object"||typeof t==="function")?t:e}function m(e,t){if(typeof t!=="function"&&t!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof t)}e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:false,writable:true,configurable:true}});if(t)Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t}var b=function(e){m(t,e);function t(r){var n=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};g(this,t);if(n.inline===undefined){n.inline=true}if(n.vertical===undefined){if(n.inline){n.vertical=false}else{n.vertical=true}}n.volumeBar=n.volumeBar||{};n.volumeBar.vertical=!!n.vertical;var o=_(this,e.call(this,r,n));o.on(r,"volumechange",o.volumeUpdate);o.on(r,"loadstart",o.volumeUpdate);function i(){if(r.tech_&&r.tech_.featuresVolumeControl===false){this.addClass("vjs-hidden")}else{this.removeClass("vjs-hidden")}}i.call(o);o.on(r,"loadstart",i);o.on(o.volumeBar,["slideractive","focus"],function(){this.addClass("vjs-slider-active")});o.on(o.volumeBar,["sliderinactive","blur"],function(){this.removeClass("vjs-slider-active")});o.on(o.volumeBar,["focus"],function(){this.addClass("vjs-lock-showing")});o.on(o.volumeBar,["blur"],function(){this.removeClass("vjs-lock-showing")});return o}t.prototype.buildCSSClass=function r(){var t="";if(this.options_.vertical){t="vjs-volume-menu-button-vertical"}else{t="vjs-volume-menu-button-horizontal"}return"vjs-volume-menu-button "+e.prototype.buildCSSClass.call(this)+" "+t};t.prototype.createPopup=function n(){var e=new u["default"](this.player_,{contentElType:"div"});var t=new d["default"](this.player_,this.options_.volumeBar);e.addChild(t);this.menuContent=e;this.volumeBar=t;this.attachVolumeBarEvents();return e};t.prototype.handleClick=function i(t){p["default"].prototype.handleClick.call(this);e.prototype.handleClick.call(this)};t.prototype.attachVolumeBarEvents=function a(){this.menuContent.on(["mousedown","touchdown"],o.bind(this,this.handleMouseDown))};t.prototype.handleMouseDown=function s(e){this.on(["mousemove","touchmove"],o.bind(this.volumeBar,this.volumeBar.handleMouseMove));this.on(this.el_.ownerDocument,["mouseup","touchend"],this.handleMouseUp)};t.prototype.handleMouseUp=function l(e){this.off(["mousemove","touchmove"],o.bind(this.volumeBar,this.volumeBar.handleMouseMove))};return t}(c["default"]);b.prototype.volumeUpdate=p["default"].prototype.update;b.prototype.controlText_="Mute";a["default"].registerComponent("VolumeMenuButton",b);r["default"]=b},{11:11,37:37,5:5,53:53,54:54,83:83}],41:[function(e,t,r){"use strict";r.__esModule=true;var n=e(5);var o=l(n);var i=e(50);var a=l(i);var s=e(87);var u=l(s);function l(e){return e&&e.__esModule?e:{"default":e}}function c(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}function f(e,t){if(!e){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return t&&(typeof t==="object"||typeof t==="function")?t:e}function p(e,t){if(typeof t!=="function"&&t!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof t)}e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:false,writable:true,configurable:true}});if(t)Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t}var h=function(e){p(t,e);function t(r,n){c(this,t);var o=f(this,e.call(this,r,n));o.on(r,"error",o.open);return o}t.prototype.buildCSSClass=function r(){return"vjs-error-display "+e.prototype.buildCSSClass.call(this)};t.prototype.content=function n(){var e=this.player().error();return e?this.localize(e.message):""};return t}(a["default"]);h.prototype.options_=(0,u["default"])(a["default"].prototype.options_,{fillAlways:true,temporary:false,uncloseable:true});o["default"].registerComponent("ErrorDisplay",h);r["default"]=h},{5:5,50:50,87:87}],42:[function(e,t,r){"use strict";r.__esModule=true;var n=e(82);var o=i(n);function i(e){if(e&&e.__esModule){return e}else{var t={};if(e!=null){for(var r in e){if(Object.prototype.hasOwnProperty.call(e,r))t[r]=e[r]}}t["default"]=e;return t}}var a=function s(){};a.prototype.allowedEvents_={};a.prototype.on=function(e,t){var r=this.addEventListener;this.addEventListener=function(){};o.on(this,e,t);this.addEventListener=r};a.prototype.addEventListener=a.prototype.on;a.prototype.off=function(e,t){o.off(this,e,t)};a.prototype.removeEventListener=a.prototype.off;a.prototype.one=function(e,t){var r=this.addEventListener;this.addEventListener=function(){};o.one(this,e,t);this.addEventListener=r};a.prototype.trigger=function(e){var t=e.type||e;if(typeof e==="string"){e={type:t}}e=o.fixEvent(e);if(this.allowedEvents_[t]&&this["on"+t]){this["on"+t](e)}o.trigger(this,e)};a.prototype.dispatchEvent=a.prototype.trigger;r["default"]=a},{82:82}],43:[function(e,t,r){"use strict";r.__esModule=true;var n=typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol==="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};var o=e(86);var i=s(o);var a=e(88);function s(e){return e&&e.__esModule?e:{"default":e}}var u=function c(e,t){if(typeof t!=="function"&&t!==null){throw new TypeError("Super expression must either be null or a function, not "+(typeof t==="undefined"?"undefined":n(t)))}e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:false,writable:true,configurable:true}});if(t){e.super_=t}};var l=function f(e){var t=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};var r=function s(){e.apply(this,arguments)};var n={};if((0,a.isObject)(t)){if(typeof t.init==="function"){i["default"].warn("Constructor logic via init() is deprecated; please use constructor() instead.");t.constructor=t.init}if(t.constructor!==Object.prototype.constructor){r=t.constructor}n=t}else if(typeof t==="function"){r=t}u(r,e);for(var o in n){if(n.hasOwnProperty(o)){r.prototype[o]=n[o]}}return r};r["default"]=l},{86:86,88:88}],44:[function(e,t,r){"use strict";r.__esModule=true;var n=e(94);var o=i(n);function i(e){return e&&e.__esModule?e:{"default":e}}var a={};var s=[["requestFullscreen","exitFullscreen","fullscreenElement","fullscreenEnabled","fullscreenchange","fullscreenerror"],["webkitRequestFullscreen","webkitExitFullscreen","webkitFullscreenElement","webkitFullscreenEnabled","webkitfullscreenchange","webkitfullscreenerror"],["webkitRequestFullScreen","webkitCancelFullScreen","webkitCurrentFullScreenElement","webkitCancelFullScreen","webkitfullscreenchange","webkitfullscreenerror"],["mozRequestFullScreen","mozCancelFullScreen","mozFullScreenElement","mozFullScreenEnabled","mozfullscreenchange","mozfullscreenerror"],["msRequestFullscreen","msExitFullscreen","msFullscreenElement","msFullscreenEnabled","MSFullscreenChange","MSFullscreenError"]];var u=s[0];var l=void 0;for(var c=0;c<s.length;c++){if(s[c][1]in o["default"]){l=s[c];break}}if(l){for(var f=0;f<l.length;f++){a[u[f]]=l[f]}}r["default"]=a},{94:94}],45:[function(e,t,r){"use strict";r.__esModule=true;var n=e(5);var o=i(n);function i(e){return e&&e.__esModule?e:{"default":e}}function a(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}function s(e,t){if(!e){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return t&&(typeof t==="object"||typeof t==="function")?t:e}function u(e,t){if(typeof t!=="function"&&t!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof t)}e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:false,writable:true,configurable:true}});if(t)Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t}var l=function(e){u(t,e);function t(){a(this,t);return s(this,e.apply(this,arguments))}t.prototype.createEl=function r(){return e.prototype.createEl.call(this,"div",{className:"vjs-loading-spinner",dir:"ltr"})};return t}(o["default"]);o["default"].registerComponent("LoadingSpinner",l);r["default"]=l},{5:5}],46:[function(e,t,r){"use strict";r.__esModule=true;var n=e(88);function o(e){if(e instanceof o){return e}if(typeof e==="number"){this.code=e}else if(typeof e==="string"){this.message=e}else if((0,n.isObject)(e)){if(typeof e.code==="number"){this.code=e.code}(0,n.assign)(this,e)}if(!this.message){this.message=o.defaultMessages[this.code]||""}}o.prototype.code=0;o.prototype.message="";o.prototype.status=null;o.errorTypes=["MEDIA_ERR_CUSTOM","MEDIA_ERR_ABORTED","MEDIA_ERR_NETWORK","MEDIA_ERR_DECODE","MEDIA_ERR_SRC_NOT_SUPPORTED","MEDIA_ERR_ENCRYPTED"];o.defaultMessages={1:"You aborted the media playback",2:"A network error caused the media download to fail part-way.",3:"The media playback was aborted due to a corruption problem or because the media used features your browser did not support.",4:"The media could not be loaded, either because the server or network failed or because the format is not supported.",5:"The media is encrypted and we do not have the keys to decrypt it."};for(var i=0;i<o.errorTypes.length;i++){o[o.errorTypes[i]]=i;o.prototype[o.errorTypes[i]]=i}r["default"]=o},{88:88}],47:[function(e,t,r){"use strict";r.__esModule=true;var n=e(3);var o=y(n);var i=e(5);var a=y(i);var s=e(49);var u=y(s);var l=e(81);var c=v(l);var f=e(83);var p=v(f);var h=e(91);var d=y(h);function v(e){if(e&&e.__esModule){return e}else{var t={};if(e!=null){for(var r in e){if(Object.prototype.hasOwnProperty.call(e,r))t[r]=e[r]}}t["default"]=e;return t}}function y(e){return e&&e.__esModule?e:{"default":e}}function g(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}function _(e,t){if(!e){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return t&&(typeof t==="object"||typeof t==="function")?t:e}function m(e,t){if(typeof t!=="function"&&t!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof t)}e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:false,writable:true,configurable:true}});if(t)Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t}var b=function(e){m(t,e);function t(r){var n=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};g(this,t);var o=_(this,e.call(this,r,n));o.update();o.enabled_=true;o.el_.setAttribute("aria-haspopup","true");o.el_.setAttribute("role","menuitem");o.on("keydown",o.handleSubmenuKeyPress);return o}t.prototype.update=function r(){var e=this.createMenu();if(this.menu){this.removeChild(this.menu)}this.menu=e;this.addChild(e);this.buttonPressed_=false;this.el_.setAttribute("aria-expanded","false");if(this.items&&this.items.length===0){this.hide()}else if(this.items&&this.items.length>1){this.show()}};t.prototype.createMenu=function n(){var e=new u["default"](this.player_);if(this.options_.title){var t=c.createEl("li",{className:"vjs-menu-title",innerHTML:(0,d["default"])(this.options_.title),tabIndex:-1});e.children_.unshift(t);c.insertElFirst(t,e.contentEl())}this.items=this.createItems();if(this.items){for(var r=0;r<this.items.length;r++){e.addItem(this.items[r])}}return e};t.prototype.createItems=function o(){};t.prototype.createEl=function i(){return e.prototype.createEl.call(this,"div",{className:this.buildCSSClass()})};t.prototype.buildCSSClass=function a(){var t="vjs-menu-button";if(this.options_.inline===true){t+="-inline"}else{t+="-popup"}return"vjs-menu-button "+t+" "+e.prototype.buildCSSClass.call(this)};t.prototype.handleClick=function s(e){this.one(this.menu.contentEl(),"mouseleave",p.bind(this,function(e){this.unpressButton();this.el_.blur()}));if(this.buttonPressed_){this.unpressButton()}else{this.pressButton()}};t.prototype.handleKeyPress=function l(t){if(t.which===27||t.which===9){if(this.buttonPressed_){this.unpressButton()}if(t.which!==9){t.preventDefault()}}else if(t.which===38||t.which===40){if(!this.buttonPressed_){this.pressButton();t.preventDefault()}}else{e.prototype.handleKeyPress.call(this,t)}};t.prototype.handleSubmenuKeyPress=function f(e){if(e.which===27||e.which===9){if(this.buttonPressed_){this.unpressButton()}if(e.which!==9){e.preventDefault()}}};t.prototype.pressButton=function h(){if(this.enabled_){this.buttonPressed_=true;this.menu.lockShowing();this.el_.setAttribute("aria-expanded","true");this.menu.focus()}};t.prototype.unpressButton=function v(){if(this.enabled_){this.buttonPressed_=false;this.menu.unlockShowing();this.el_.setAttribute("aria-expanded","false");this.el_.focus()}};t.prototype.disable=function y(){this.buttonPressed_=false;this.menu.unlockShowing();this.el_.setAttribute("aria-expanded","false");this.enabled_=false;return e.prototype.disable.call(this)};t.prototype.enable=function b(){this.enabled_=true;return e.prototype.enable.call(this)};return t}(o["default"]);a["default"].registerComponent("MenuButton",b);r["default"]=b},{3:3,49:49,5:5,81:81,83:83,91:91}],48:[function(e,t,r){"use strict";r.__esModule=true;var n=e(3);var o=u(n);var i=e(5);var a=u(i);var s=e(88);function u(e){return e&&e.__esModule?e:{"default":e}}function l(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}function c(e,t){if(!e){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return t&&(typeof t==="object"||typeof t==="function")?t:e}function f(e,t){if(typeof t!=="function"&&t!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof t)}e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:false,writable:true,configurable:true}});if(t)Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t}var p=function(e){f(t,e);function t(r,n){l(this,t);var o=c(this,e.call(this,r,n));o.selectable=n.selectable;o.selected(n.selected);if(o.selectable){o.el_.setAttribute("role","menuitemcheckbox")}else{o.el_.setAttribute("role","menuitem")}return o}t.prototype.createEl=function r(t,n,o){return e.prototype.createEl.call(this,"li",(0,s.assign)({className:"vjs-menu-item",innerHTML:this.localize(this.options_.label),tabIndex:-1},n),o)};t.prototype.handleClick=function n(e){this.selected(true)};t.prototype.selected=function o(e){if(this.selectable){if(e){this.addClass("vjs-selected");this.el_.setAttribute("aria-checked","true");this.controlText(", selected")}else{this.removeClass("vjs-selected");this.el_.setAttribute("aria-checked","false");this.controlText(" ")}}};return t}(o["default"]);a["default"].registerComponent("MenuItem",p);r["default"]=p},{3:3,5:5,88:88}],49:[function(e,t,r){"use strict";r.__esModule=true;var n=e(5);var o=p(n);var i=e(81);var a=f(i);var s=e(83);var u=f(s);var l=e(82);var c=f(l);function f(e){if(e&&e.__esModule){return e}else{var t={};if(e!=null){for(var r in e){if(Object.prototype.hasOwnProperty.call(e,r))t[r]=e[r]}}t["default"]=e;return t}}function p(e){return e&&e.__esModule?e:{"default":e}}function h(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}function d(e,t){if(!e){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return t&&(typeof t==="object"||typeof t==="function")?t:e}function v(e,t){if(typeof t!=="function"&&t!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof t)}e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:false,writable:true,configurable:true}});if(t)Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t}var y=function(e){v(t,e);function t(r,n){h(this,t);var o=d(this,e.call(this,r,n));o.focusedChild_=-1;o.on("keydown",o.handleKeyPress);return o}t.prototype.addItem=function r(e){this.addChild(e);e.on("click",u.bind(this,function(e){this.unlockShowing()}))};t.prototype.createEl=function n(){var t=this.options_.contentElType||"ul";this.contentEl_=a.createEl(t,{className:"vjs-menu-content"});this.contentEl_.setAttribute("role","menu");var r=e.prototype.createEl.call(this,"div",{append:this.contentEl_,className:"vjs-menu"});r.setAttribute("role","presentation");r.appendChild(this.contentEl_);c.on(r,"click",function(e){e.preventDefault();e.stopImmediatePropagation()});return r};t.prototype.handleKeyPress=function o(e){if(e.which===37||e.which===40){e.preventDefault();this.stepForward()}else if(e.which===38||e.which===39){e.preventDefault();this.stepBack()}};t.prototype.stepForward=function i(){var e=0;if(this.focusedChild_!==undefined){e=this.focusedChild_+1}this.focus(e)};t.prototype.stepBack=function s(){var e=0;if(this.focusedChild_!==undefined){e=this.focusedChild_-1}this.focus(e)};t.prototype.focus=function l(){var e=arguments.length>0&&arguments[0]!==undefined?arguments[0]:0;var t=this.children().slice();var r=t.length&&t[0].className&&/vjs-menu-title/.test(t[0].className);if(r){t.shift()}if(t.length>0){if(e<0){e=0}else if(e>=t.length){e=t.length-1}this.focusedChild_=e;t[e].el_.focus();

}};return t}(o["default"]);o["default"].registerComponent("Menu",y);r["default"]=y},{5:5,81:81,82:82,83:83}],50:[function(e,t,r){"use strict";r.__esModule=true;var n=e(81);var o=c(n);var i=e(83);var a=c(i);var s=e(5);var u=l(s);function l(e){return e&&e.__esModule?e:{"default":e}}function c(e){if(e&&e.__esModule){return e}else{var t={};if(e!=null){for(var r in e){if(Object.prototype.hasOwnProperty.call(e,r))t[r]=e[r]}}t["default"]=e;return t}}function f(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}function p(e,t){if(!e){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return t&&(typeof t==="object"||typeof t==="function")?t:e}function h(e,t){if(typeof t!=="function"&&t!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof t)}e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:false,writable:true,configurable:true}});if(t)Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t}var d="vjs-modal-dialog";var v=27;var y=function(e){h(t,e);function t(r,n){f(this,t);var i=p(this,e.call(this,r,n));i.opened_=i.hasBeenOpened_=i.hasBeenFilled_=false;i.closeable(!i.options_.uncloseable);i.content(i.options_.content);i.contentEl_=o.createEl("div",{className:d+"-content"},{role:"document"});i.descEl_=o.createEl("p",{className:d+"-description vjs-offscreen",id:i.el().getAttribute("aria-describedby")});o.textContent(i.descEl_,i.description());i.el_.appendChild(i.descEl_);i.el_.appendChild(i.contentEl_);return i}t.prototype.createEl=function r(){return e.prototype.createEl.call(this,"div",{className:this.buildCSSClass(),tabIndex:-1},{"aria-describedby":this.id()+"_description","aria-hidden":"true","aria-label":this.label(),role:"dialog"})};t.prototype.buildCSSClass=function n(){return d+" vjs-hidden "+e.prototype.buildCSSClass.call(this)};t.prototype.handleKeyPress=function i(e){if(e.which===v&&this.closeable()){this.close()}};t.prototype.label=function s(){return this.options_.label||this.localize("Modal Window")};t.prototype.description=function u(){var e=this.options_.description||this.localize("This is a modal window.");if(this.closeable()){e+=" "+this.localize("This modal can be closed by pressing the Escape key or activating the close button.")}return e};t.prototype.open=function l(){if(!this.opened_){var e=this.player();this.trigger("beforemodalopen");this.opened_=true;if(this.options_.fillAlways||!this.hasBeenOpened_&&!this.hasBeenFilled_){this.fill()}this.wasPlaying_=!e.paused();if(this.wasPlaying_){e.pause()}if(this.closeable()){this.on(this.el_.ownerDocument,"keydown",a.bind(this,this.handleKeyPress))}e.controls(false);this.show();this.el().setAttribute("aria-hidden","false");this.trigger("modalopen");this.hasBeenOpened_=true}return this};t.prototype.opened=function c(e){if(typeof e==="boolean"){this[e?"open":"close"]()}return this.opened_};t.prototype.close=function y(){if(this.opened_){var e=this.player();this.trigger("beforemodalclose");this.opened_=false;if(this.wasPlaying_){e.play()}if(this.closeable()){this.off(this.el_.ownerDocument,"keydown",a.bind(this,this.handleKeyPress))}e.controls(true);this.hide();this.el().setAttribute("aria-hidden","true");this.trigger("modalclose");if(this.options_.temporary){this.dispose()}}return this};t.prototype.closeable=function g(e){if(typeof e==="boolean"){var g=this.closeable_=!!e;var t=this.getChild("closeButton");if(g&&!t){var r=this.contentEl_;this.contentEl_=this.el_;t=this.addChild("closeButton",{controlText:"Close Modal Dialog"});this.contentEl_=r;this.on(t,"close",this.close)}if(!g&&t){this.off(t,"close",this.close);this.removeChild(t);t.dispose()}}return this.closeable_};t.prototype.fill=function _(){return this.fillWith(this.content())};t.prototype.fillWith=function m(e){var t=this.contentEl();var r=t.parentNode;var n=t.nextSibling;this.trigger("beforemodalfill");this.hasBeenFilled_=true;r.removeChild(t);this.empty();o.insertContent(t,e);this.trigger("modalfill");if(n){r.insertBefore(t,n)}else{r.appendChild(t)}return this};t.prototype.empty=function b(){this.trigger("beforemodalempty");o.emptyEl(this.contentEl());this.trigger("modalempty");return this};t.prototype.content=function T(e){if(typeof e!=="undefined"){this.content_=e}return this.content_};return t}(u["default"]);y.prototype.options_={temporary:true};u["default"].registerComponent("ModalDialog",y);r["default"]=y},{5:5,81:81,83:83}],51:[function(e,t,r){"use strict";r.__esModule=true;var n=e(5);var o=$(n);var i=e(94);var a=$(i);var s=e(95);var u=$(s);var l=e(82);var c=q(l);var f=e(81);var p=q(f);var h=e(83);var d=q(h);var v=e(85);var y=q(v);var g=e(78);var _=q(g);var m=e(86);var b=$(m);var T=e(91);var w=$(T);var E=e(90);var C=e(79);var k=e(89);var O=q(k);var S=e(44);var j=$(S);var x=e(46);var P=$(x);var M=e(97);var A=$(M);var I=e(88);var R=e(87);var N=$(R);var D=e(69);var L=$(D);var F=e(50);var B=$(F);var H=e(62);var V=$(H);var U=e(63);var W=$(U);var z=e(76);var X=$(z);e(61);e(59);e(55);e(68);e(45);e(1);e(4);e(8);e(41);e(71);e(60);function q(e){if(e&&e.__esModule){return e}else{var t={};if(e!=null){for(var r in e){if(Object.prototype.hasOwnProperty.call(e,r))t[r]=e[r]}}t["default"]=e;return t}}function $(e){return e&&e.__esModule?e:{"default":e}}function G(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}function K(e,t){if(!e){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return t&&(typeof t==="object"||typeof t==="function")?t:e}function Y(e,t){if(typeof t!=="function"&&t!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof t)}e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:false,writable:true,configurable:true}});if(t)Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t}var J=["progress","abort","suspend","emptied","stalled","loadedmetadata","loadeddata","timeupdate","ratechange","volumechange","texttrackchange"];var Q=function(e){Y(t,e);function t(r,n,o){G(this,t);r.id=r.id||"vjs_video_"+y.newGUID();n=(0,I.assign)(t.getTagSettings(r),n);n.initChildren=false;n.createEl=false;n.reportTouchActivity=false;if(!n.language){if(typeof r.closest==="function"){var i=r.closest("[lang]");if(i){n.language=i.getAttribute("lang")}}else{var a=r;while(a&&a.nodeType===1){if(p.getElAttributes(a).hasOwnProperty("lang")){n.language=a.getAttribute("lang");break}a=a.parentNode}}}var s=K(this,e.call(this,null,n,o));if(!s.options_||!s.options_.techOrder||!s.options_.techOrder.length){throw new Error("No techOrder specified. Did you overwrite "+"videojs.options instead of just changing the "+"properties you want to override?")}s.tag=r;s.tagAttributes=r&&p.getElAttributes(r);s.language(s.options_.language);if(n.languages){(function(){var e={};Object.getOwnPropertyNames(n.languages).forEach(function(t){e[t.toLowerCase()]=n.languages[t]});s.languages_=e})()}else{s.languages_=t.prototype.options_.languages}s.cache_={};s.poster_=n.poster||"";s.controls_=!!n.controls;r.controls=false;s.scrubbing_=false;s.el_=s.createEl();var u=(0,N["default"])(s.options_);if(n.plugins){(function(){var e=n.plugins;Object.getOwnPropertyNames(e).forEach(function(t){if(typeof this[t]==="function"){this[t](e[t])}else{b["default"].error("Unable to find plugin:",t)}},s)})()}s.options_.playerOptions=u;s.initChildren();s.isAudio(r.nodeName.toLowerCase()==="audio");if(s.controls()){s.addClass("vjs-controls-enabled")}else{s.addClass("vjs-controls-disabled")}s.el_.setAttribute("role","region");if(s.isAudio()){s.el_.setAttribute("aria-label","audio player")}else{s.el_.setAttribute("aria-label","video player")}if(s.isAudio()){s.addClass("vjs-audio")}if(s.flexNotSupported_()){s.addClass("vjs-no-flex")}if(!_.IS_IOS){s.addClass("vjs-workinghover")}t.players[s.id_]=s;s.userActive(true);s.reportUserActivity();s.listenForUserActivity_();s.on("fullscreenchange",s.handleFullscreenChange_);s.on("stageclick",s.handleStageClick_);return s}t.prototype.dispose=function r(){this.trigger("dispose");this.off("dispose");if(this.styleEl_&&this.styleEl_.parentNode){this.styleEl_.parentNode.removeChild(this.styleEl_)}t.players[this.id_]=null;if(this.tag&&this.tag.player){this.tag.player=null}if(this.el_&&this.el_.player){this.el_.player=null}if(this.tech_){this.tech_.dispose()}e.prototype.dispose.call(this)};t.prototype.createEl=function n(){var t=this.tag;var r=void 0;var n=this.playerElIngest_=t.parentNode&&t.parentNode.hasAttribute&&t.parentNode.hasAttribute("data-vjs-player");if(n){r=this.el_=t.parentNode}else{r=this.el_=e.prototype.createEl.call(this,"div")}t.removeAttribute("width");t.removeAttribute("height");var o=p.getElAttributes(t);Object.getOwnPropertyNames(o).forEach(function(e){if(e==="class"){r.className+=" "+o[e]}else{r.setAttribute(e,o[e])}});t.playerId=t.id;t.id+="_html5_api";t.className="vjs-tech";t.player=r.player=this;this.addClass("vjs-paused");if(u["default"].VIDEOJS_NO_DYNAMIC_STYLE!==true){this.styleEl_=O.createStyleElement("vjs-styles-dimensions");var i=p.$(".vjs-styles-defaults");var a=p.$("head");a.insertBefore(this.styleEl_,i?i.nextSibling:a.firstChild)}this.width(this.options_.width);this.height(this.options_.height);this.fluid(this.options_.fluid);this.aspectRatio(this.options_.aspectRatio);var s=t.getElementsByTagName("a");for(var l=0;l<s.length;l++){var c=s.item(l);p.addElClass(c,"vjs-hidden");c.setAttribute("hidden","hidden")}t.initNetworkState_=t.networkState;if(t.parentNode&&!n){t.parentNode.insertBefore(r,t)}p.insertElFirst(t,r);this.children_.unshift(t);this.el_=r;return r};t.prototype.width=function i(e){return this.dimension("width",e)};t.prototype.height=function s(e){return this.dimension("height",e)};t.prototype.dimension=function l(e,t){var r=e+"_";if(t===undefined){return this[r]||0}if(t===""){this[r]=undefined}else{var n=parseFloat(t);if(isNaN(n)){b["default"].error('Improper value "'+t+'" supplied for for '+e);return this}this[r]=n}this.updateStyleEl_();return this};t.prototype.fluid=function f(e){if(e===undefined){return!!this.fluid_}this.fluid_=!!e;if(e){this.addClass("vjs-fluid")}else{this.removeClass("vjs-fluid")}this.updateStyleEl_()};t.prototype.aspectRatio=function h(e){if(e===undefined){return this.aspectRatio_}if(!/^\d+\:\d+$/.test(e)){throw new Error("Improper value supplied for aspect ratio. The format should be width:height, for example 16:9.")}this.aspectRatio_=e;this.fluid(true);this.updateStyleEl_()};t.prototype.updateStyleEl_=function v(){if(u["default"].VIDEOJS_NO_DYNAMIC_STYLE===true){var e=typeof this.width_==="number"?this.width_:this.options_.width;var t=typeof this.height_==="number"?this.height_:this.options_.height;var r=this.tech_&&this.tech_.el();if(r){if(e>=0){r.width=e}if(t>=0){r.height=t}}return}var n=void 0;var o=void 0;var i=void 0;var a=void 0;if(this.aspectRatio_!==undefined&&this.aspectRatio_!=="auto"){i=this.aspectRatio_}else if(this.videoWidth()>0){i=this.videoWidth()+":"+this.videoHeight()}else{i="16:9"}var s=i.split(":");var l=s[1]/s[0];if(this.width_!==undefined){n=this.width_}else if(this.height_!==undefined){n=this.height_/l}else{n=this.videoWidth()||300}if(this.height_!==undefined){o=this.height_}else{o=n*l}if(/^[^a-zA-Z]/.test(this.id())){a="dimensions-"+this.id()}else{a=this.id()+"-dimensions"}this.addClass(a);O.setTextContent(this.styleEl_,"\n      ."+a+" {\n        width: "+n+"px;\n        height: "+o+"px;\n      }\n\n      ."+a+".vjs-fluid {\n        padding-top: "+l*100+"%;\n      }\n    ")};t.prototype.loadTech_=function g(e,t){var r=this;if(this.tech_){this.unloadTech_()}if(e!=="Html5"&&this.tag){V["default"].getTech("Html5").disposeMediaElement(this.tag);this.tag.player=null;this.tag=null}this.techName_=e;this.isReady_=false;var n=(0,I.assign)({source:t,nativeControlsForTouch:this.options_.nativeControlsForTouch,playerId:this.id(),techId:this.id()+"_"+e+"_api",videoTracks:this.videoTracks_,textTracks:this.textTracks_,audioTracks:this.audioTracks_,autoplay:this.options_.autoplay,preload:this.options_.preload,loop:this.options_.loop,muted:this.options_.muted,poster:this.poster(),language:this.language(),playerElIngest:this.playerElIngest_||false,"vtt.js":this.options_["vtt.js"]},this.options_[e.toLowerCase()]);if(this.tag){n.tag=this.tag}if(t){this.currentType_=t.type;if(t.src===this.cache_.src&&this.cache_.currentTime>0){n.startTime=this.cache_.currentTime}this.cache_.sources=null;this.cache_.source=t;this.cache_.src=t.src}var i=V["default"].getTech(e);if(!i){i=o["default"].getComponent(e)}this.tech_=new i(n);this.tech_.ready(d.bind(this,this.handleTechReady_),true);L["default"].jsonToTextTracks(this.textTracksJson_||[],this.tech_);J.forEach(function(e){r.on(r.tech_,e,r["handleTech"+(0,w["default"])(e)+"_"])});this.on(this.tech_,"loadstart",this.handleTechLoadStart_);this.on(this.tech_,"waiting",this.handleTechWaiting_);this.on(this.tech_,"canplay",this.handleTechCanPlay_);this.on(this.tech_,"canplaythrough",this.handleTechCanPlayThrough_);this.on(this.tech_,"playing",this.handleTechPlaying_);this.on(this.tech_,"ended",this.handleTechEnded_);this.on(this.tech_,"seeking",this.handleTechSeeking_);this.on(this.tech_,"seeked",this.handleTechSeeked_);this.on(this.tech_,"play",this.handleTechPlay_);this.on(this.tech_,"firstplay",this.handleTechFirstPlay_);this.on(this.tech_,"pause",this.handleTechPause_);this.on(this.tech_,"durationchange",this.handleTechDurationChange_);this.on(this.tech_,"fullscreenchange",this.handleTechFullscreenChange_);this.on(this.tech_,"error",this.handleTechError_);this.on(this.tech_,"loadedmetadata",this.updateStyleEl_);this.on(this.tech_,"posterchange",this.handleTechPosterChange_);this.on(this.tech_,"textdata",this.handleTechTextData_);this.usingNativeControls(this.techGet_("controls"));if(this.controls()&&!this.usingNativeControls()){this.addTechControlsListeners_()}if(this.tech_.el().parentNode!==this.el()&&(e!=="Html5"||!this.tag)){p.insertElFirst(this.tech_.el(),this.el())}if(this.tag){this.tag.player=null;this.tag=null}};t.prototype.unloadTech_=function m(){this.videoTracks_=this.videoTracks();this.textTracks_=this.textTracks();this.audioTracks_=this.audioTracks();this.textTracksJson_=L["default"].textTracksToJson(this.tech_);this.isReady_=false;this.tech_.dispose();this.tech_=false};t.prototype.tech=function T(e){if(e&&e.IWillNotUseThisInPlugins){return this.tech_}var t="\n      Please make sure that you are not using this inside of a plugin.\n      To disable this alert and error, please pass in an object with\n      `IWillNotUseThisInPlugins` to the `tech` method. See\n      https://github.com/videojs/video.js/issues/2617 for more info.\n    ";u["default"].alert(t);throw new Error(t)};t.prototype.addTechControlsListeners_=function k(){this.removeTechControlsListeners_();this.on(this.tech_,"mousedown",this.handleTechClick_);this.on(this.tech_,"touchstart",this.handleTechTouchStart_);this.on(this.tech_,"touchmove",this.handleTechTouchMove_);this.on(this.tech_,"touchend",this.handleTechTouchEnd_);this.on(this.tech_,"tap",this.handleTechTap_)};t.prototype.removeTechControlsListeners_=function S(){this.off(this.tech_,"tap",this.handleTechTap_);this.off(this.tech_,"touchstart",this.handleTechTouchStart_);this.off(this.tech_,"touchmove",this.handleTechTouchMove_);this.off(this.tech_,"touchend",this.handleTechTouchEnd_);this.off(this.tech_,"mousedown",this.handleTechClick_)};t.prototype.handleTechReady_=function x(){this.triggerReady();if(this.cache_.volume){this.techCall_("setVolume",this.cache_.volume)}this.handleTechPosterChange_();this.handleTechDurationChange_();if((this.src()||this.currentSrc())&&this.tag&&this.options_.autoplay&&this.paused()){try{delete this.tag.poster}catch(e){(0,b["default"])("deleting tag.poster throws in some browsers",e)}this.play()}};t.prototype.handleTechLoadStart_=function M(){this.removeClass("vjs-ended");this.removeClass("vjs-seeking");this.error(null);if(!this.paused()){this.trigger("loadstart");this.trigger("firstplay")}else{this.hasStarted(false);this.trigger("loadstart")}};t.prototype.hasStarted=function R(e){if(e!==undefined){if(this.hasStarted_!==e){this.hasStarted_=e;if(e){this.addClass("vjs-has-started");this.trigger("firstplay")}else{this.removeClass("vjs-has-started")}}return this}return!!this.hasStarted_};t.prototype.handleTechPlay_=function D(){this.removeClass("vjs-ended");this.removeClass("vjs-paused");this.addClass("vjs-playing");this.hasStarted(true);this.trigger("play")};t.prototype.handleTechWaiting_=function F(){var e=this;this.addClass("vjs-waiting");this.trigger("waiting");this.one("timeupdate",function(){return e.removeClass("vjs-waiting")})};t.prototype.handleTechCanPlay_=function H(){this.removeClass("vjs-waiting");this.trigger("canplay")};t.prototype.handleTechCanPlayThrough_=function U(){this.removeClass("vjs-waiting");this.trigger("canplaythrough")};t.prototype.handleTechPlaying_=function z(){this.removeClass("vjs-waiting");this.trigger("playing")};t.prototype.handleTechSeeking_=function q(){this.addClass("vjs-seeking");this.trigger("seeking")};t.prototype.handleTechSeeked_=function $(){this.removeClass("vjs-seeking");this.trigger("seeked")};t.prototype.handleTechFirstPlay_=function Q(){if(this.options_.starttime){b["default"].warn("Passing the `starttime` option to the player will be deprecated in 6.0");this.currentTime(this.options_.starttime)}this.addClass("vjs-has-started");this.trigger("firstplay")};t.prototype.handleTechPause_=function Z(){this.removeClass("vjs-playing");this.addClass("vjs-paused");this.trigger("pause")};t.prototype.handleTechEnded_=function ee(){this.addClass("vjs-ended");if(this.options_.loop){this.currentTime(0);this.play()}else if(!this.paused()){this.pause()}this.trigger("ended")};t.prototype.handleTechDurationChange_=function te(){this.duration(this.techGet_("duration"))};t.prototype.handleTechClick_=function re(e){if(e.button!==0){return}if(this.controls()){if(this.paused()){this.play()}else{this.pause()}}};t.prototype.handleTechTap_=function ne(){this.userActive(!this.userActive())};t.prototype.handleTechTouchStart_=function oe(){this.userWasActive=this.userActive()};t.prototype.handleTechTouchMove_=function ie(){if(this.userWasActive){this.reportUserActivity()}};t.prototype.handleTechTouchEnd_=function ae(e){e.preventDefault()};t.prototype.handleFullscreenChange_=function se(){if(this.isFullscreen()){this.addClass("vjs-fullscreen")}else{this.removeClass("vjs-fullscreen")}};t.prototype.handleStageClick_=function ue(){this.reportUserActivity()};t.prototype.handleTechFullscreenChange_=function le(e,t){if(t){this.isFullscreen(t.isFullscreen)}this.trigger("fullscreenchange")};t.prototype.handleTechError_=function ce(){var e=this.tech_.error();this.error(e)};t.prototype.handleTechTextData_=function fe(){var e=null;if(arguments.length>1){e=arguments[1]}this.trigger("textdata",e)};t.prototype.getCache=function pe(){return this.cache_};t.prototype.techCall_=function he(e,t){if(this.tech_&&!this.tech_.isReady_){this.tech_.ready(function(){this[e](t)},true)}else{try{if(this.tech_){this.tech_[e](t)}}catch(r){(0,b["default"])(r);throw r}}};t.prototype.techGet_=function de(e){if(this.tech_&&this.tech_.isReady_){try{return this.tech_[e]()}catch(t){if(this.tech_[e]===undefined){(0,b["default"])("Video.js: "+e+" method not defined for "+this.techName_+" playback technology.",t)}else if(t.name==="TypeError"){(0,b["default"])("Video.js: "+e+" unavailable on "+this.techName_+" playback technology element.",t);this.tech_.isReady_=false}else{(0,b["default"])(t)}throw t}}return};t.prototype.play=function ve(){if(this.src()||this.currentSrc()){this.techCall_("play")}else{this.tech_.one("loadstart",function(){this.play()})}return this};t.prototype.pause=function ye(){this.techCall_("pause");return this};t.prototype.paused=function ge(){return this.techGet_("paused")===false?false:true};t.prototype.scrubbing=function _e(e){if(e!==undefined){this.scrubbing_=!!e;if(e){this.addClass("vjs-scrubbing")}else{this.removeClass("vjs-scrubbing")}return this}return this.scrubbing_};t.prototype.currentTime=function me(e){if(e!==undefined){this.techCall_("setCurrentTime",e);return this}this.cache_.currentTime=this.techGet_("currentTime")||0;return this.cache_.currentTime};t.prototype.duration=function be(e){if(e===undefined){return this.cache_.duration||0}e=parseFloat(e)||0;if(e<0){e=Infinity}if(e!==this.cache_.duration){this.cache_.duration=e;if(e===Infinity){this.addClass("vjs-live")}else{this.removeClass("vjs-live")}this.trigger("durationchange")}return this};t.prototype.remainingTime=function Te(){return this.duration()-this.currentTime()};t.prototype.buffered=function we(){var we=this.techGet_("buffered");if(!we||!we.length){we=(0,E.createTimeRange)(0,0)}return we};t.prototype.bufferedPercent=function Ee(){return(0,C.bufferedPercent)(this.buffered(),this.duration())};t.prototype.bufferedEnd=function Ce(){var e=this.buffered();var t=this.duration();var r=e.end(e.length-1);if(r>t){r=t}return r};t.prototype.volume=function ke(e){var t=void 0;if(e!==undefined){t=Math.max(0,Math.min(1,parseFloat(e)));this.cache_.volume=t;this.techCall_("setVolume",t);return this}t=parseFloat(this.techGet_("volume"));return isNaN(t)?1:t};t.prototype.muted=function Oe(e){if(e!==undefined){this.techCall_("setMuted",e);return this}return this.techGet_("muted")||false};t.prototype.supportsFullScreen=function Se(){return this.techGet_("supportsFullScreen")||false};t.prototype.isFullscreen=function je(e){if(e!==undefined){this.isFullscreen_=!!e;return this}return!!this.isFullscreen_};t.prototype.requestFullscreen=function xe(){var e=j["default"];this.isFullscreen(true);if(e.requestFullscreen){c.on(a["default"],e.fullscreenchange,d.bind(this,function t(r){this.isFullscreen(a["default"][e.fullscreenElement]);if(this.isFullscreen()===false){c.off(a["default"],e.fullscreenchange,t)}this.trigger("fullscreenchange")}));this.el_[e.requestFullscreen]()}else if(this.tech_.supportsFullScreen()){this.techCall_("enterFullScreen")}else{this.enterFullWindow();this.trigger("fullscreenchange")}return this};t.prototype.exitFullscreen=function Pe(){var e=j["default"];this.isFullscreen(false);if(e.requestFullscreen){a["default"][e.exitFullscreen]()}else if(this.tech_.supportsFullScreen()){this.techCall_("exitFullScreen")}else{this.exitFullWindow();this.trigger("fullscreenchange")}return this};t.prototype.enterFullWindow=function Me(){this.isFullWindow=true;this.docOrigOverflow=a["default"].documentElement.style.overflow;c.on(a["default"],"keydown",d.bind(this,this.fullWindowOnEscKey));a["default"].documentElement.style.overflow="hidden";p.addElClass(a["default"].body,"vjs-full-window");this.trigger("enterFullWindow")};t.prototype.fullWindowOnEscKey=function Ae(e){if(e.keyCode===27){if(this.isFullscreen()===true){this.exitFullscreen()}else{this.exitFullWindow()}}};t.prototype.exitFullWindow=function Ie(){this.isFullWindow=false;c.off(a["default"],"keydown",this.fullWindowOnEscKey);a["default"].documentElement.style.overflow=this.docOrigOverflow;p.removeElClass(a["default"].body,"vjs-full-window");this.trigger("exitFullWindow")};t.prototype.canPlayType=function Re(e){var t=void 0;for(var r=0,n=this.options_.techOrder;r<n.length;r++){var i=(0,w["default"])(n[r]);var a=V["default"].getTech(i);if(!a){a=o["default"].getComponent(i)}if(!a){b["default"].error('The "'+i+'" tech is undefined. Skipped browser support check for that tech.');continue}if(a.isSupported()){t=a.canPlayType(e);if(t){return t}}}return""};t.prototype.selectSource=function Ne(e){var t=this;var r=this.options_.techOrder.map(w["default"]).map(function(e){return[e,V["default"].getTech(e)||o["default"].getComponent(e)]}).filter(function(e){var t=e[0],r=e[1];if(r){return r.isSupported()}b["default"].error('The "'+t+'" tech is undefined. Skipped browser support check for that tech.');return false});var n=function u(e,t,r){var n=void 0;e.some(function(e){return t.some(function(t){n=r(e,t);if(n){return true}})});return n};var i=void 0;var a=function l(e){return function(t,r){return e(r,t)}};var s=function c(e,r){var n=e[0],o=e[1];if(o.canPlaySource(r,t.options_[n.toLowerCase()])){return{source:r,tech:n}}};if(this.options_.sourceOrder){i=n(e,r,a(s))}else{i=n(r,e,s)}return i||false};t.prototype.src=function De(e){if(e===undefined){return this.techGet_("src")}var t=V["default"].getTech(this.techName_);if(!t){t=o["default"].getComponent(this.techName_)}if(Array.isArray(e)){this.sourceList_(e)}else if(typeof e==="string"){this.src({src:e})}else if(e instanceof Object){if(e.type&&!t.canPlaySource(e,this.options_[this.techName_.toLowerCase()])){this.sourceList_([e])}else{this.cache_.sources=null;this.cache_.source=e;this.cache_.src=e.src;this.currentType_=e.type||"";this.ready(function(){if(t.prototype.hasOwnProperty("setSource")){this.techCall_("setSource",e)}else{this.techCall_("src",e.src)}if(this.options_.preload==="auto"){this.load()}if(this.options_.autoplay){this.play()}},true)}}return this};t.prototype.sourceList_=function Le(e){var t=this.selectSource(e);if(t){if(t.tech===this.techName_){this.src(t.source)}else{this.loadTech_(t.tech,t.source)}this.cache_.sources=e}else{this.setTimeout(function(){this.error({code:4,message:this.localize(this.options_.notSupportedMessage)})},0);this.triggerReady()}};t.prototype.load=function Fe(){this.techCall_("load");return this};t.prototype.reset=function Be(){this.loadTech_((0,w["default"])(this.options_.techOrder[0]),null);this.techCall_("reset");return this};t.prototype.currentSources=function He(){var e=this.currentSource();var t=[];if(Object.keys(e).length!==0){t.push(e)}return this.cache_.sources||t};t.prototype.currentSource=function Ve(){var e={};var t=this.currentSrc();if(t){e.src=t}return this.cache_.source||e};t.prototype.currentSrc=function Ue(){return this.techGet_("currentSrc")||this.cache_.src||""};t.prototype.currentType=function We(){return this.currentType_||""};t.prototype.preload=function ze(e){if(e!==undefined){this.techCall_("setPreload",e);this.options_.preload=e;return this}return this.techGet_("preload")};t.prototype.autoplay=function Xe(e){if(e!==undefined){this.techCall_("setAutoplay",e);this.options_.autoplay=e;return this}return this.techGet_("autoplay",e)};t.prototype.loop=function qe(e){if(e!==undefined){this.techCall_("setLoop",e);this.options_.loop=e;return this}return this.techGet_("loop")};t.prototype.poster=function $e(e){if(e===undefined){return this.poster_}if(!e){e=""}this.poster_=e;this.techCall_("setPoster",e);this.trigger("posterchange");return this};t.prototype.handleTechPosterChange_=function Ge(){if(!this.poster_&&this.tech_&&this.tech_.poster){this.poster_=this.tech_.poster()||"";this.trigger("posterchange")}};t.prototype.controls=function Ke(e){if(e!==undefined){e=!!e;if(this.controls_!==e){this.controls_=e;if(this.usingNativeControls()){this.techCall_("setControls",e)}if(e){this.removeClass("vjs-controls-disabled");this.addClass("vjs-controls-enabled");this.trigger("controlsenabled");if(!this.usingNativeControls()){this.addTechControlsListeners_()}}else{this.removeClass("vjs-controls-enabled");this.addClass("vjs-controls-disabled");this.trigger("controlsdisabled");if(!this.usingNativeControls()){this.removeTechControlsListeners_()}}}return this}return!!this.controls_};t.prototype.usingNativeControls=function Ye(e){if(e!==undefined){e=!!e;if(this.usingNativeControls_!==e){this.usingNativeControls_=e;if(e){this.addClass("vjs-using-native-controls");this.trigger("usingnativecontrols")}else{this.removeClass("vjs-using-native-controls");this.trigger("usingcustomcontrols")}}return this}return!!this.usingNativeControls_};t.prototype.error=function Je(e){if(e===undefined){return this.error_||null}if(e===null){this.error_=e;this.removeClass("vjs-error");if(this.errorDisplay){this.errorDisplay.close()}return this}this.error_=new P["default"](e);this.addClass("vjs-error");b["default"].error("(CODE:"+this.error_.code+" "+P["default"].errorTypes[this.error_.code]+")",this.error_.message,this.error_);this.trigger("error");return this};t.prototype.reportUserActivity=function Qe(e){this.userActivity_=true};t.prototype.userActive=function Ze(e){if(e!==undefined){e=!!e;if(e!==this.userActive_){this.userActive_=e;if(e){this.userActivity_=true;this.removeClass("vjs-user-inactive");this.addClass("vjs-user-active");this.trigger("useractive")}else{this.userActivity_=false;if(this.tech_){this.tech_.one("mousemove",function(e){e.stopPropagation();e.preventDefault()})}this.removeClass("vjs-user-active");this.addClass("vjs-user-inactive");this.trigger("userinactive")}}return this}return this.userActive_};t.prototype.listenForUserActivity_=function et(){var e=void 0;var t=void 0;var r=void 0;var n=d.bind(this,this.reportUserActivity);var o=function u(e){if(e.screenX!==t||e.screenY!==r){t=e.screenX;r=e.screenY;n()}};var i=function l(){n();this.clearInterval(e);e=this.setInterval(n,250)};var a=function c(t){n();this.clearInterval(e)};this.on("mousedown",i);this.on("mousemove",o);this.on("mouseup",a);this.on("keydown",n);this.on("keyup",n);var s=void 0;this.setInterval(function(){if(this.userActivity_){this.userActivity_=false;this.userActive(true);this.clearTimeout(s);var e=this.options_.inactivityTimeout;if(e>0){s=this.setTimeout(function(){if(!this.userActivity_){this.userActive(false)}},e)}}},250)};t.prototype.playbackRate=function tt(e){if(e!==undefined){this.techCall_("setPlaybackRate",e);return this}if(this.tech_&&this.tech_.featuresPlaybackRate){return this.techGet_("playbackRate")}return 1};t.prototype.isAudio=function rt(e){if(e!==undefined){this.isAudio_=!!e;return this}return!!this.isAudio_};t.prototype.videoTracks=function nt(){if(!this.tech_){this.videoTracks_=this.videoTracks_||new X["default"];return this.videoTracks_}return this.tech_.videoTracks()};t.prototype.audioTracks=function ot(){if(!this.tech_){this.audioTracks_=this.audioTracks_||new W["default"];return this.audioTracks_}return this.tech_.audioTracks()};t.prototype.textTracks=function it(){if(this.tech_){return this.tech_.textTracks()}};t.prototype.remoteTextTracks=function at(){if(this.tech_){return this.tech_.remoteTextTracks()}};t.prototype.remoteTextTrackEls=function st(){if(this.tech_){return this.tech_.remoteTextTrackEls()}};t.prototype.addTextTrack=function ut(e,t,r){if(this.tech_){return this.tech_.addTextTrack(e,t,r)}};t.prototype.addRemoteTextTrack=function lt(e,t){if(this.tech_){return this.tech_.addRemoteTextTrack(e,t)}};t.prototype.removeRemoteTextTrack=function ct(){var e=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{},t=e.track,r=t===undefined?arguments[0]:t;if(this.tech_){return this.tech_.removeRemoteTextTrack(r)}};t.prototype.videoWidth=function ft(){return this.tech_&&this.tech_.videoWidth&&this.tech_.videoWidth()||0};t.prototype.videoHeight=function pt(){return this.tech_&&this.tech_.videoHeight&&this.tech_.videoHeight()||0};t.prototype.language=function ht(e){if(e===undefined){return this.language_}this.language_=String(e).toLowerCase();return this};t.prototype.languages=function dt(){return(0,N["default"])(t.prototype.options_.languages,this.languages_)};t.prototype.toJSON=function vt(){var e=(0,N["default"])(this.options_);var t=e.tracks;e.tracks=[];for(var r=0;r<t.length;r++){var n=t[r];n=(0,N["default"])(n);n.player=undefined;e.tracks[r]=n}return e};t.prototype.createModal=function yt(e,t){var r=this;t=t||{};t.content=e||"";var n=new B["default"](this,t);this.addChild(n);n.on("dispose",function(){r.removeChild(n)});return n.open()};t.getTagSettings=function gt(e){var t={sources:[],tracks:[]};var r=p.getElAttributes(e);var n=r["data-setup"];if(p.hasElClass(e,"vjs-fluid")){r.fluid=true}if(n!==null){var o=(0,A["default"])(n||"{}"),i=o[0],a=o[1];if(i){b["default"].error(i)}(0,I.assign)(r,a)}(0,I.assign)(t,r);if(e.hasChildNodes()){var s=e.childNodes;for(var u=0,l=s.length;u<l;u++){var c=s[u];var f=c.nodeName.toLowerCase();if(f==="source"){t.sources.push(p.getElAttributes(c))}else if(f==="track"){t.tracks.push(p.getElAttributes(c));

}}}return t};t.prototype.flexNotSupported_=function _t(){var e=a["default"].createElement("i");return!("flexBasis"in e.style||"webkitFlexBasis"in e.style||"mozFlexBasis"in e.style||"msFlexBasis"in e.style||"msFlexOrder"in e.style)};return t}(o["default"]);Q.players={};var Z=u["default"].navigator;Q.prototype.options_={techOrder:["html5","flash"],html5:{},flash:{},defaultVolume:0,inactivityTimeout:2e3,playbackRates:[],children:["mediaLoader","posterImage","textTrackDisplay","loadingSpinner","bigPlayButton","controlBar","errorDisplay","textTrackSettings"],language:Z&&(Z.languages&&Z.languages[0]||Z.userLanguage||Z.language)||"en",languages:{},notSupportedMessage:"No compatible source was found for this media."};["ended","seeking","seekable","networkState","readyState"].forEach(function(e){Q.prototype[e]=function(){return this.techGet_(e)}});J.forEach(function(e){Q.prototype["handleTech"+(0,w["default"])(e)+"_"]=function(){return this.trigger(e)}});o["default"].registerComponent("Player",Q);r["default"]=Q},{1:1,4:4,41:41,44:44,45:45,46:46,5:5,50:50,55:55,59:59,60:60,61:61,62:62,63:63,68:68,69:69,71:71,76:76,78:78,79:79,8:8,81:81,82:82,83:83,85:85,86:86,87:87,88:88,89:89,90:90,91:91,94:94,95:95,97:97}],52:[function(e,t,r){"use strict";r.__esModule=true;var n=e(51);var o=i(n);function i(e){return e&&e.__esModule?e:{"default":e}}var a=function s(e,t){o["default"].prototype[e]=t};r["default"]=a},{51:51}],53:[function(e,t,r){"use strict";r.__esModule=true;var n=e(3);var o=s(n);var i=e(5);var a=s(i);function s(e){return e&&e.__esModule?e:{"default":e}}function u(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}function l(e,t){if(!e){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return t&&(typeof t==="object"||typeof t==="function")?t:e}function c(e,t){if(typeof t!=="function"&&t!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof t)}e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:false,writable:true,configurable:true}});if(t)Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t}var f=function(e){c(t,e);function t(r){var n=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};u(this,t);var o=l(this,e.call(this,r,n));o.update();return o}t.prototype.update=function r(){var e=this.createPopup();if(this.popup){this.removeChild(this.popup)}this.popup=e;this.addChild(e);if(this.items&&this.items.length===0){this.hide()}else if(this.items&&this.items.length>1){this.show()}};t.prototype.createPopup=function n(){};t.prototype.createEl=function o(){return e.prototype.createEl.call(this,"div",{className:this.buildCSSClass()})};t.prototype.buildCSSClass=function i(){var t="vjs-menu-button";if(this.options_.inline===true){t+="-inline"}else{t+="-popup"}return"vjs-menu-button "+t+" "+e.prototype.buildCSSClass.call(this)};return t}(o["default"]);a["default"].registerComponent("PopupButton",f);r["default"]=f},{3:3,5:5}],54:[function(e,t,r){"use strict";r.__esModule=true;var n=e(5);var o=p(n);var i=e(81);var a=f(i);var s=e(83);var u=f(s);var l=e(82);var c=f(l);function f(e){if(e&&e.__esModule){return e}else{var t={};if(e!=null){for(var r in e){if(Object.prototype.hasOwnProperty.call(e,r))t[r]=e[r]}}t["default"]=e;return t}}function p(e){return e&&e.__esModule?e:{"default":e}}function h(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}function d(e,t){if(!e){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return t&&(typeof t==="object"||typeof t==="function")?t:e}function v(e,t){if(typeof t!=="function"&&t!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof t)}e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:false,writable:true,configurable:true}});if(t)Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t}var y=function(e){v(t,e);function t(){h(this,t);return d(this,e.apply(this,arguments))}t.prototype.addItem=function r(e){this.addChild(e);e.on("click",u.bind(this,function(){this.unlockShowing()}))};t.prototype.createEl=function n(){var t=this.options_.contentElType||"ul";this.contentEl_=a.createEl(t,{className:"vjs-menu-content"});var r=e.prototype.createEl.call(this,"div",{append:this.contentEl_,className:"vjs-menu"});r.appendChild(this.contentEl_);c.on(r,"click",function(e){e.preventDefault();e.stopImmediatePropagation()});return r};return t}(o["default"]);o["default"].registerComponent("Popup",y);r["default"]=y},{5:5,81:81,82:82,83:83}],55:[function(e,t,r){"use strict";r.__esModule=true;var n=e(3);var o=d(n);var i=e(5);var a=d(i);var s=e(83);var u=h(s);var l=e(81);var c=h(l);var f=e(78);var p=h(f);function h(e){if(e&&e.__esModule){return e}else{var t={};if(e!=null){for(var r in e){if(Object.prototype.hasOwnProperty.call(e,r))t[r]=e[r]}}t["default"]=e;return t}}function d(e){return e&&e.__esModule?e:{"default":e}}function v(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}function y(e,t){if(!e){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return t&&(typeof t==="object"||typeof t==="function")?t:e}function g(e,t){if(typeof t!=="function"&&t!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof t)}e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:false,writable:true,configurable:true}});if(t)Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t}var _=function(e){g(t,e);function t(r,n){v(this,t);var o=y(this,e.call(this,r,n));o.update();r.on("posterchange",u.bind(o,o.update));return o}t.prototype.dispose=function r(){this.player().off("posterchange",this.update);e.prototype.dispose.call(this)};t.prototype.createEl=function n(){var e=c.createEl("div",{className:"vjs-poster",tabIndex:-1});if(!p.BACKGROUND_SIZE_SUPPORTED){this.fallbackImg_=c.createEl("img");e.appendChild(this.fallbackImg_)}return e};t.prototype.update=function o(e){var t=this.player().poster();this.setSrc(t);if(t){this.show()}else{this.hide()}};t.prototype.setSrc=function i(e){if(this.fallbackImg_){this.fallbackImg_.src=e}else{var t="";if(e){t='url("'+e+'")'}this.el_.style.backgroundImage=t}};t.prototype.handleClick=function a(e){if(!this.player_.controls()){return}if(this.player_.paused()){this.player_.play()}else{this.player_.pause()}};return t}(o["default"]);a["default"].registerComponent("PosterImage",_);r["default"]=_},{3:3,5:5,78:78,81:81,83:83}],56:[function(e,t,r){"use strict";r.__esModule=true;r.hasLoaded=r.autoSetupTimeout=r.autoSetup=undefined;var n=e(81);var o=p(n);var i=e(82);var a=p(i);var s=e(94);var u=f(s);var l=e(95);var c=f(l);function f(e){return e&&e.__esModule?e:{"default":e}}function p(e){if(e&&e.__esModule){return e}else{var t={};if(e!=null){for(var r in e){if(Object.prototype.hasOwnProperty.call(e,r))t[r]=e[r]}}t["default"]=e;return t}}var h=false;var d=void 0;var v=function _(){if(!o.isReal()){return}var e=u["default"].getElementsByTagName("video");var t=u["default"].getElementsByTagName("audio");var r=[];if(e&&e.length>0){for(var n=0,i=e.length;n<i;n++){r.push(e[n])}}if(t&&t.length>0){for(var a=0,s=t.length;a<s;a++){r.push(t[a])}}if(r&&r.length>0){for(var l=0,c=r.length;l<c;l++){var f=r[l];if(f&&f.getAttribute){if(f.player===undefined){var p=f.getAttribute("data-setup");if(p!==null){d(f)}}}else{y(1);break}}}else if(!h){y(1)}};function y(e,t){if(t){d=t}c["default"].setTimeout(v,e)}if(o.isReal()&&u["default"].readyState==="complete"){h=true}else{a.one(c["default"],"load",function(){h=true})}var g=function m(){return h};r.autoSetup=v;r.autoSetupTimeout=y;r.hasLoaded=g},{81:81,82:82,94:94,95:95}],57:[function(e,t,r){"use strict";r.__esModule=true;var n=e(5);var o=l(n);var i=e(81);var a=u(i);var s=e(88);function u(e){if(e&&e.__esModule){return e}else{var t={};if(e!=null){for(var r in e){if(Object.prototype.hasOwnProperty.call(e,r))t[r]=e[r]}}t["default"]=e;return t}}function l(e){return e&&e.__esModule?e:{"default":e}}function c(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}function f(e,t){if(!e){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return t&&(typeof t==="object"||typeof t==="function")?t:e}function p(e,t){if(typeof t!=="function"&&t!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof t)}e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:false,writable:true,configurable:true}});if(t)Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t}var h=function(e){p(t,e);function t(r,n){c(this,t);var o=f(this,e.call(this,r,n));o.bar=o.getChild(o.options_.barName);o.vertical(!!o.options_.vertical);o.on("mousedown",o.handleMouseDown);o.on("touchstart",o.handleMouseDown);o.on("focus",o.handleFocus);o.on("blur",o.handleBlur);o.on("click",o.handleClick);o.on(r,"controlsvisible",o.update);o.on(r,o.playerEvent,o.update);return o}t.prototype.createEl=function r(t){var r=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};var n=arguments.length>2&&arguments[2]!==undefined?arguments[2]:{};r.className=r.className+" vjs-slider";r=(0,s.assign)({tabIndex:0},r);n=(0,s.assign)({role:"slider","aria-valuenow":0,"aria-valuemin":0,"aria-valuemax":100,tabIndex:0},n);return e.prototype.createEl.call(this,t,r,n)};t.prototype.handleMouseDown=function n(e){var t=this.bar.el_.ownerDocument;e.preventDefault();a.blockTextSelection();this.addClass("vjs-sliding");this.trigger("slideractive");this.on(t,"mousemove",this.handleMouseMove);this.on(t,"mouseup",this.handleMouseUp);this.on(t,"touchmove",this.handleMouseMove);this.on(t,"touchend",this.handleMouseUp);this.handleMouseMove(e)};t.prototype.handleMouseMove=function o(e){};t.prototype.handleMouseUp=function i(){var e=this.bar.el_.ownerDocument;a.unblockTextSelection();this.removeClass("vjs-sliding");this.trigger("sliderinactive");this.off(e,"mousemove",this.handleMouseMove);this.off(e,"mouseup",this.handleMouseUp);this.off(e,"touchmove",this.handleMouseMove);this.off(e,"touchend",this.handleMouseUp);this.update()};t.prototype.update=function u(){if(!this.el_){return}var e=this.getPercent();var t=this.bar;if(!t){return}if(typeof e!=="number"||e!==e||e<0||e===Infinity){e=0}var r=(e*100).toFixed(2)+"%";if(this.vertical()){t.el().style.height=r}else{t.el().style.width=r}};t.prototype.calculateDistance=function l(e){var t=a.getPointerPosition(this.el_,e);if(this.vertical()){return t.y}return t.x};t.prototype.handleFocus=function h(){this.on(this.bar.el_.ownerDocument,"keydown",this.handleKeyPress)};t.prototype.handleKeyPress=function d(e){if(e.which===37||e.which===40){e.preventDefault();this.stepBack()}else if(e.which===38||e.which===39){e.preventDefault();this.stepForward()}};t.prototype.handleBlur=function v(){this.off(this.bar.el_.ownerDocument,"keydown",this.handleKeyPress)};t.prototype.handleClick=function y(e){e.stopImmediatePropagation();e.preventDefault()};t.prototype.vertical=function g(e){if(e===undefined){return this.vertical_||false}this.vertical_=!!e;if(this.vertical_){this.addClass("vjs-slider-vertical")}else{this.addClass("vjs-slider-horizontal")}return this};return t}(o["default"]);o["default"].registerComponent("Slider",h);r["default"]=h},{5:5,81:81,88:88}],58:[function(e,t,r){"use strict";r.__esModule=true;function n(e){e.streamingFormats={"rtmp/mp4":"MP4","rtmp/flv":"FLV"};e.streamFromParts=function(e,t){return e+"&"+t};e.streamToParts=function(e){var t={connection:"",stream:""};if(!e){return t}var r=e.search(/&(?!\w+=)/);var n=void 0;if(r!==-1){n=r+1}else{r=n=e.lastIndexOf("/")+1;if(r===0){r=n=e.length}}t.connection=e.substring(0,r);t.stream=e.substring(n,e.length);return t};e.isStreamingType=function(t){return t in e.streamingFormats};e.RTMP_RE=/^rtmp[set]?:\/\//i;e.isStreamingSrc=function(t){return e.RTMP_RE.test(t)};e.rtmpSourceHandler={};e.rtmpSourceHandler.canPlayType=function(t){if(e.isStreamingType(t)){return"maybe"}return""};e.rtmpSourceHandler.canHandleSource=function(t,r){var n=e.rtmpSourceHandler.canPlayType(t.type);if(n){return n}if(e.isStreamingSrc(t.src)){return"maybe"}return""};e.rtmpSourceHandler.handleSource=function(t,r,n){var o=e.streamToParts(t.src);r.setRtmpConnection(o.connection);r.setRtmpStream(o.stream)};e.registerSourceHandler(e.rtmpSourceHandler);return e}r["default"]=n},{}],59:[function(e,t,r){"use strict";r.__esModule=true;var n=e(62);var o=_(n);var i=e(81);var a=g(i);var s=e(92);var u=g(s);var l=e(90);var c=e(58);var f=_(c);var p=e(5);var h=_(p);var d=e(95);var v=_(d);var y=e(88);function g(e){if(e&&e.__esModule){return e}else{var t={};if(e!=null){for(var r in e){if(Object.prototype.hasOwnProperty.call(e,r))t[r]=e[r]}}t["default"]=e;return t}}function _(e){return e&&e.__esModule?e:{"default":e}}function m(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}function b(e,t){if(!e){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return t&&(typeof t==="object"||typeof t==="function")?t:e}function T(e,t){if(typeof t!=="function"&&t!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof t)}e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:false,writable:true,configurable:true}});if(t)Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t}var w=v["default"].navigator;var E=function(e){T(t,e);function t(r,n){m(this,t);var o=b(this,e.call(this,r,n));if(r.source){o.ready(function(){this.setSource(r.source)},true)}if(r.startTime){o.ready(function(){this.load();this.play();this.currentTime(r.startTime)},true)}v["default"].videojs=v["default"].videojs||{};v["default"].videojs.Flash=v["default"].videojs.Flash||{};v["default"].videojs.Flash.onReady=t.onReady;v["default"].videojs.Flash.onEvent=t.onEvent;v["default"].videojs.Flash.onError=t.onError;o.on("seeked",function(){this.lastSeekTarget_=undefined});return o}t.prototype.createEl=function r(){var e=this.options_;if(!e.swf){var r="5.1.0";e.swf="//vjs.zencdn.net/swf/"+r+"/video-js.swf"}var n=e.techId;var o=(0,y.assign)({readyFunction:"videojs.Flash.onReady",eventProxyFunction:"videojs.Flash.onEvent",errorEventProxyFunction:"videojs.Flash.onError",autoplay:e.autoplay,preload:e.preload,loop:e.loop,muted:e.muted},e.flashVars);var i=(0,y.assign)({wmode:"opaque",bgcolor:"#000000"},e.params);var a=(0,y.assign)({id:n,name:n,"class":"vjs-tech"},e.attributes);this.el_=t.embed(e.swf,o,i,a);this.el_.tech=this;return this.el_};t.prototype.play=function n(){if(this.ended()){this.setCurrentTime(0)}this.el_.vjs_play()};t.prototype.pause=function o(){this.el_.vjs_pause()};t.prototype.src=function i(e){if(e===undefined){return this.currentSrc()}return this.setSrc(e)};t.prototype.setSrc=function a(e){var t=this;e=u.getAbsoluteURL(e);this.el_.vjs_src(e);if(this.autoplay()){this.setTimeout(function(){return t.play()},0)}};t.prototype.seeking=function s(){return this.lastSeekTarget_!==undefined};t.prototype.setCurrentTime=function c(t){var r=this.seekable();if(r.length){t=t>r.start(0)?t:r.start(0);t=t<r.end(r.length-1)?t:r.end(r.length-1);this.lastSeekTarget_=t;this.trigger("seeking");this.el_.vjs_setProperty("currentTime",t);e.prototype.setCurrentTime.call(this)}};t.prototype.currentTime=function f(){if(this.seeking()){return this.lastSeekTarget_||0}return this.el_.vjs_getProperty("currentTime")};t.prototype.currentSrc=function p(){if(this.currentSource_){return this.currentSource_.src}return this.el_.vjs_getProperty("currentSrc")};t.prototype.duration=function h(){if(this.readyState()===0){return NaN}var h=this.el_.vjs_getProperty("duration");return h>=0?h:Infinity};t.prototype.load=function d(){this.el_.vjs_load()};t.prototype.poster=function g(){this.el_.vjs_getProperty("poster")};t.prototype.setPoster=function _(){};t.prototype.seekable=function w(){var e=this.duration();if(e===0){return(0,l.createTimeRange)()}return(0,l.createTimeRange)(0,e)};t.prototype.buffered=function E(){var e=this.el_.vjs_getProperty("buffered");if(e.length===0){return(0,l.createTimeRange)()}return(0,l.createTimeRange)(e[0][0],e[0][1])};t.prototype.supportsFullScreen=function C(){return false};t.prototype.enterFullScreen=function k(){return false};return t}(o["default"]);var C=E.prototype;var k="rtmpConnection,rtmpStream,preload,defaultPlaybackRate,playbackRate,autoplay,loop,mediaGroup,controller,controls,volume,muted,defaultMuted".split(",");var O="networkState,readyState,initialTime,startOffsetTime,paused,ended,videoWidth,videoHeight".split(",");function S(e){var t=e.charAt(0).toUpperCase()+e.slice(1);C["set"+t]=function(t){return this.el_.vjs_setProperty(e,t)}}function j(e){C[e]=function(){return this.el_.vjs_getProperty(e)}}for(var x=0;x<k.length;x++){j(k[x]);S(k[x])}for(var P=0;P<O.length;P++){j(O[P])}E.isSupported=function(){return E.version()[0]>=10};o["default"].withSourceHandlers(E);E.nativeSourceHandler={};E.nativeSourceHandler.canPlayType=function(e){if(e in E.formats){return"maybe"}return""};E.nativeSourceHandler.canHandleSource=function(e,t){var r=void 0;function n(e){var t=u.getFileExtension(e);if(t){return"video/"+t}return""}if(!e.type){r=n(e.src)}else{r=e.type.replace(/;.*/,"").toLowerCase()}return E.nativeSourceHandler.canPlayType(r)};E.nativeSourceHandler.handleSource=function(e,t,r){t.setSrc(e.src)};E.nativeSourceHandler.dispose=function(){};E.registerSourceHandler(E.nativeSourceHandler);E.formats={"video/flv":"FLV","video/x-flv":"FLV","video/mp4":"MP4","video/m4v":"MP4"};E.onReady=function(e){var t=a.getEl(e);var r=t&&t.tech;if(r&&r.el()){E.checkReady(r)}};E.checkReady=function(e){if(!e.el()){return}if(e.el().vjs_getProperty){e.triggerReady()}else{this.setTimeout(function(){E.checkReady(e)},50)}};E.onEvent=function(e,t){var r=a.getEl(e).tech;var n=Array.prototype.slice.call(arguments,2);r.setTimeout(function(){r.trigger(t,n)},1)};E.onError=function(e,t){var r=a.getEl(e).tech;if(t==="srcnotfound"){return r.error(4)}r.error("FLASH: "+t)};E.version=function(){var e="0,0,0";try{e=new v["default"].ActiveXObject("ShockwaveFlash.ShockwaveFlash").GetVariable("$version").replace(/\D+/g,",").match(/^,?(.+),?$/)[1]}catch(t){try{if(w.mimeTypes["application/x-shockwave-flash"].enabledPlugin){e=(w.plugins["Shockwave Flash 2.0"]||w.plugins["Shockwave Flash"]).description.replace(/\D+/g,",").match(/^,?(.+),?$/)[1]}}catch(r){}}return e.split(",")};E.embed=function(e,t,r,n){var o=E.getEmbedCode(e,t,r,n);var i=a.createEl("div",{innerHTML:o}).childNodes[0];return i};E.getEmbedCode=function(e,t,r,n){var o='<object type="application/x-shockwave-flash" ';var i="";var a="";var s="";if(t){Object.getOwnPropertyNames(t).forEach(function(e){i+=e+"="+t[e]+"&amp;"})}r=(0,y.assign)({movie:e,flashvars:i,allowScriptAccess:"always",allowNetworking:"all"},r);Object.getOwnPropertyNames(r).forEach(function(e){a+='<param name="'+e+'" value="'+r[e]+'" />'});n=(0,y.assign)({data:e,width:"100%",height:"100%"},n);Object.getOwnPropertyNames(n).forEach(function(e){s+=e+'="'+n[e]+'" '});return""+o+s+">"+a+"</object>"};(0,f["default"])(E);h["default"].registerComponent("Flash",E);o["default"].registerTech("Flash",E);r["default"]=E},{5:5,58:58,62:62,81:81,88:88,90:90,92:92,95:95}],60:[function(e,t,r){"use strict";r.__esModule=true;var n=typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol==="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};var o=A(["Text Tracks are being loaded from another origin but the crossorigin attribute isn't used.\n            This may prevent text tracks from loading."],["Text Tracks are being loaded from another origin but the crossorigin attribute isn't used.\n            This may prevent text tracks from loading."]);var i=e(62);var a=M(i);var s=e(5);var u=M(s);var l=e(81);var c=P(l);var f=e(92);var p=P(f);var h=e(83);var d=P(h);var v=e(86);var y=M(v);var g=e(98);var _=M(g);var m=e(78);var b=P(m);var T=e(94);var w=M(T);var E=e(95);var C=M(E);var k=e(88);var O=e(87);var S=M(O);var j=e(91);var x=M(j);function P(e){if(e&&e.__esModule){return e}else{var t={};if(e!=null){for(var r in e){if(Object.prototype.hasOwnProperty.call(e,r))t[r]=e[r]}}t["default"]=e;return t}}function M(e){return e&&e.__esModule?e:{"default":e}}function A(e,t){e.raw=t;return e}function I(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}function R(e,t){if(!e){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return t&&(typeof t==="object"||typeof t==="function")?t:e}function N(e,t){if(typeof t!=="function"&&t!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof t)}e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:false,writable:true,configurable:true}});if(t)Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t}var D=function(e){N(t,e);function t(r,n){I(this,t);var i=R(this,e.call(this,r,n));var a=r.source;var s=false;if(a&&(i.el_.currentSrc!==a.src||r.tag&&r.tag.initNetworkState_===3)){i.setSource(a)}else{i.handleLateInit_(i.el_)}if(i.el_.hasChildNodes()){var u=i.el_.childNodes;var l=u.length;var c=[];while(l--){var f=u[l];var h=f.nodeName.toLowerCase();if(h==="track"){if(!i.featuresNativeTextTracks){c.push(f)}else{i.remoteTextTrackEls().addTrackElement_(f);i.remoteTextTracks().addTrack_(f.track);if(!s&&!i.el_.hasAttribute("crossorigin")&&p.isCrossOrigin(f.src)){s=true}}}}for(var v=0;v<c.length;v++){i.el_.removeChild(c[v])}}var g=["audio","video"];g.forEach(function(e){var t=i.el()[e+"Tracks"];var r=i[e+"Tracks"]();var n=(0,x["default"])(e);if(!i["featuresNative"+n+"Tracks"]||!t||!t.addEventListener){return}i["handle"+n+"TrackChange_"]=function(e){r.trigger({type:"change",target:r,currentTarget:r,srcElement:r})};i["handle"+n+"TrackAdd_"]=function(e){return r.addTrack(e.track)};i["handle"+n+"TrackRemove_"]=function(e){return r.removeTrack(e.track)};t.addEventListener("change",i["handle"+n+"TrackChange_"]);t.addEventListener("addtrack",i["handle"+n+"TrackAdd_"]);t.addEventListener("removetrack",i["handle"+n+"TrackRemove_"]);i["removeOld"+n+"Tracks_"]=function(e){return i.removeOldTracks_(r,t)};i.on("loadstart",i["removeOld"+n+"Tracks_"])});if(i.featuresNativeTextTracks){if(s){y["default"].warn((0,_["default"])(o))}i.handleTextTrackChange_=d.bind(i,i.handleTextTrackChange);i.handleTextTrackAdd_=d.bind(i,i.handleTextTrackAdd);i.handleTextTrackRemove_=d.bind(i,i.handleTextTrackRemove);i.proxyNativeTextTracks_()}if((b.TOUCH_ENABLED||b.IS_IPHONE||b.IS_NATIVE_ANDROID)&&r.nativeControlsForTouch===true){i.setControls(true)}i.proxyWebkitFullscreen_();i.triggerReady();return i}t.prototype.dispose=function r(){var r=this;["audio","video","text"].forEach(function(e){var t=(0,x["default"])(e);var n=r.el_[e+"Tracks"];if(n&&n.removeEventListener){n.removeEventListener("change",r["handle"+t+"TrackChange_"]);n.removeEventListener("addtrack",r["handle"+t+"TrackAdd_"]);n.removeEventListener("removetrack",r["handle"+t+"TrackRemove_"])}if(n){r.off("loadstart",r["removeOld"+t+"Tracks_"])}});t.disposeMediaElement(this.el_);e.prototype.dispose.call(this)};t.prototype.createEl=function i(){var e=this.options_.tag;if(!e||!(this.options_.playerElIngest||this.movingMediaElementInDOM)){if(e){var r=e.cloneNode(true);if(e.parentNode){e.parentNode.insertBefore(r,e)}t.disposeMediaElement(e);e=r}else{e=w["default"].createElement("video");var n=this.options_.tag&&c.getElAttributes(this.options_.tag);var o=(0,S["default"])({},n);if(!b.TOUCH_ENABLED||this.options_.nativeControlsForTouch!==true){delete o.controls}c.setElAttributes(e,(0,k.assign)(o,{id:this.options_.techId,"class":"vjs-tech"}))}e.playerId=this.options_.playerId}var i=["autoplay","preload","loop","muted"];for(var a=i.length-1;a>=0;a--){var s=i[a];var u={};if(typeof this.options_[s]!=="undefined"){u[s]=this.options_[s]}c.setElAttributes(e,u)}return e};t.prototype.handleLateInit_=function a(e){var t=this;if(e.networkState===0||e.networkState===3){return}if(e.readyState===0){var r=function(){var e=false;var r=function o(){e=true};t.on("loadstart",r);var n=function i(){if(!e){this.trigger("loadstart")}};t.on("loadedmetadata",n);t.ready(function(){this.off("loadstart",r);this.off("loadedmetadata",n);if(!e){this.trigger("loadstart")}});return{v:void 0}}();if((typeof r==="undefined"?"undefined":n(r))==="object")return r.v}var o=["loadstart"];o.push("loadedmetadata");if(e.readyState>=2){o.push("loadeddata")}if(e.readyState>=3){o.push("canplay")}if(e.readyState>=4){o.push("canplaythrough")}this.ready(function(){o.forEach(function(e){this.trigger(e)},this)})};t.prototype.proxyNativeTextTracks_=function s(){var e=this.el().textTracks;if(e){for(var t=0;t<e.length;t++){this.textTracks().addTrack_(e[t])}if(e.addEventListener){e.addEventListener("change",this.handleTextTrackChange_);e.addEventListener("addtrack",this.handleTextTrackAdd_);e.addEventListener("removetrack",this.handleTextTrackRemove_)}this.on("loadstart",this.removeOldTextTracks_)}};t.prototype.handleTextTrackChange=function u(e){var t=this.textTracks();this.textTracks().trigger({type:"change",target:t,currentTarget:t,srcElement:t})};t.prototype.handleTextTrackAdd=function l(e){this.textTracks().addTrack_(e.track)};t.prototype.handleTextTrackRemove=function f(e){this.textTracks().removeTrack_(e.track)};t.prototype.removeOldTracks_=function h(e,t){var r=[];if(!t){return}for(var n=0;n<e.length;n++){var o=e[n];var i=false;for(var a=0;a<t.length;a++){if(t[a]===o){i=true;break}}if(!i){r.push(o)}}for(var s=0;s<r.length;s++){var u=r[s];e.removeTrack_(u)}};t.prototype.removeOldTextTracks_=function v(e){var t=this.textTracks();var r=this.el().textTracks;this.removeOldTracks_(t,r)};t.prototype.play=function g(){var e=this.el_.play();if(e!==undefined&&typeof e.then==="function"){e.then(null,function(e){})}};t.prototype.setCurrentTime=function m(e){try{this.el_.currentTime=e}catch(t){(0,y["default"])(t,"Video is not ready. (Video.js)")}};t.prototype.duration=function T(){var e=this;if(this.el_.duration===Infinity&&b.IS_ANDROID&&b.IS_CHROME){if(this.el_.currentTime===0){var t=function(){var t=function r(){if(e.el_.currentTime>0){if(e.el_.duration===Infinity){e.trigger("durationchange")}e.off("timeupdate",r)}};e.on("timeupdate",t);return{v:NaN}}();if((typeof t==="undefined"?"undefined":n(t))==="object")return t.v}}return this.el_.duration||NaN};t.prototype.width=function E(){return this.el_.offsetWidth};t.prototype.height=function O(){return this.el_.offsetHeight};t.prototype.proxyWebkitFullscreen_=function j(){var e=this;if(!("webkitDisplayingFullscreen"in this.el_)){return}var t=function n(){this.trigger("fullscreenchange",{isFullscreen:false})};var r=function o(){this.one("webkitendfullscreen",t);this.trigger("fullscreenchange",{isFullscreen:true})};this.on("webkitbeginfullscreen",r);this.on("dispose",function(){e.off("webkitbeginfullscreen",r);e.off("webkitendfullscreen",t)})};t.prototype.supportsFullScreen=function P(){if(typeof this.el_.webkitEnterFullScreen==="function"){var e=C["default"].navigator&&C["default"].navigator.userAgent||"";if(/Android/.test(e)||!/Chrome|Mac OS X 10.5/.test(e)){return true}}return false};t.prototype.enterFullScreen=function M(){var e=this.el_;if(e.paused&&e.networkState<=e.HAVE_METADATA){this.el_.play();this.setTimeout(function(){e.pause();e.webkitEnterFullScreen()},0)}else{e.webkitEnterFullScreen()}};t.prototype.exitFullScreen=function A(){this.el_.webkitExitFullScreen()};t.prototype.src=function D(e){if(e===undefined){return this.el_.src}this.setSrc(e)};t.prototype.reset=function L(){t.resetMediaElement(this.el_)};t.prototype.currentSrc=function F(){if(this.currentSource_){return this.currentSource_.src}return this.el_.currentSrc};t.prototype.setControls=function B(e){this.el_.controls=!!e};t.prototype.addTextTrack=function H(t,r,n){if(!this.featuresNativeTextTracks){return e.prototype.addTextTrack.call(this,t,r,n)}return this.el_.addTextTrack(t,r,n)};t.prototype.createRemoteTextTrack=function V(t){if(!this.featuresNativeTextTracks){return e.prototype.createRemoteTextTrack.call(this,t)}var r=w["default"].createElement("track");if(t.kind){r.kind=t.kind}if(t.label){r.label=t.label}if(t.language||t.srclang){r.srclang=t.language||t.srclang}if(t["default"]){r["default"]=t["default"]}if(t.id){r.id=t.id}if(t.src){r.src=t.src}return r};t.prototype.addRemoteTextTrack=function U(t,r){var n=e.prototype.addRemoteTextTrack.call(this,t,r);if(this.featuresNativeTextTracks){this.el().appendChild(n)}return n};t.prototype.removeRemoteTextTrack=function W(t){e.prototype.removeRemoteTextTrack.call(this,t);if(this.featuresNativeTextTracks){var r=this.$$("track");var n=r.length;while(n--){if(t===r[n]||t===r[n].track){this.el().removeChild(r[n])}}}};return t}(a["default"]);if(c.isReal()){D.TEST_VID=w["default"].createElement("video");var L=w["default"].createElement("track");L.kind="captions";L.srclang="en";L.label="English";D.TEST_VID.appendChild(L)}D.isSupported=function(){try{D.TEST_VID.volume=.5}catch(e){return false}return!!(D.TEST_VID&&D.TEST_VID.canPlayType)};D.canControlVolume=function(){try{var e=D.TEST_VID.volume;D.TEST_VID.volume=e/2+.1;return e!==D.TEST_VID.volume}catch(t){return false}};D.canControlPlaybackRate=function(){if(b.IS_ANDROID&&b.IS_CHROME){return false}try{var e=D.TEST_VID.playbackRate;D.TEST_VID.playbackRate=e/2+.1;return e!==D.TEST_VID.playbackRate}catch(t){return false}};D.supportsNativeTextTracks=function(){return b.IS_ANY_SAFARI};D.supportsNativeVideoTracks=function(){return!!(D.TEST_VID&&D.TEST_VID.videoTracks)};D.supportsNativeAudioTracks=function(){return!!(D.TEST_VID&&D.TEST_VID.audioTracks)};D.Events=["loadstart","suspend","abort","error","emptied","stalled","loadedmetadata","loadeddata","canplay","canplaythrough","playing","waiting","seeking","seeked","ended","durationchange","timeupdate","progress","play","pause","ratechange","volumechange"];D.prototype.featuresVolumeControl=D.canControlVolume();D.prototype.featuresPlaybackRate=D.canControlPlaybackRate();D.prototype.movingMediaElementInDOM=!b.IS_IOS;D.prototype.featuresFullscreenResize=true;D.prototype.featuresProgressEvents=true;D.prototype.featuresTimeupdateEvents=true;D.prototype.featuresNativeTextTracks=D.supportsNativeTextTracks();D.prototype.featuresNativeVideoTracks=D.supportsNativeVideoTracks();D.prototype.featuresNativeAudioTracks=D.supportsNativeAudioTracks();var F=D.TEST_VID&&D.TEST_VID.constructor.prototype.canPlayType;var B=/^application\/(?:x-|vnd\.apple\.)mpegurl/i;var H=/^video\/mp4/i;D.patchCanPlayType=function(){if(b.ANDROID_VERSION>=4&&!b.IS_FIREFOX){D.TEST_VID.constructor.prototype.canPlayType=function(e){if(e&&B.test(e)){return"maybe"}return F.call(this,e)}}else if(b.IS_OLD_ANDROID){D.TEST_VID.constructor.prototype.canPlayType=function(e){if(e&&H.test(e)){return"maybe"}return F.call(this,e)}}};D.unpatchCanPlayType=function(){var e=D.TEST_VID.constructor.prototype.canPlayType;D.TEST_VID.constructor.prototype.canPlayType=F;return e};D.patchCanPlayType();D.disposeMediaElement=function(e){if(!e){return}if(e.parentNode){e.parentNode.removeChild(e)}while(e.hasChildNodes()){e.removeChild(e.firstChild)}e.removeAttribute("src");if(typeof e.load==="function"){(function(){try{e.load()}catch(t){}})()}};D.resetMediaElement=function(e){if(!e){return}var t=e.querySelectorAll("source");var r=t.length;while(r--){e.removeChild(t[r])}e.removeAttribute("src");if(typeof e.load==="function"){(function(){try{e.load()}catch(t){}})()}};["paused","currentTime","buffered","volume","muted","poster","preload","autoplay","controls","loop","error","seeking","seekable","ended","defaultMuted","playbackRate","played","networkState","readyState","videoWidth","videoHeight"].forEach(function(e){D.prototype[e]=function(){return this.el_[e]}});["volume","muted","src","poster","preload","autoplay","loop","playbackRate"].forEach(function(e){D.prototype["set"+(0,
x["default"])(e)]=function(t){this.el_[e]=t}});["pause","load"].forEach(function(e){D.prototype[e]=function(){return this.el_[e]()}});a["default"].withSourceHandlers(D);D.nativeSourceHandler={};D.nativeSourceHandler.canPlayType=function(e){try{return D.TEST_VID.canPlayType(e)}catch(t){return""}};D.nativeSourceHandler.canHandleSource=function(e,t){if(e.type){return D.nativeSourceHandler.canPlayType(e.type)}else if(e.src){var r=p.getFileExtension(e.src);return D.nativeSourceHandler.canPlayType("video/"+r)}return""};D.nativeSourceHandler.handleSource=function(e,t,r){t.setSrc(e.src)};D.nativeSourceHandler.dispose=function(){};D.registerSourceHandler(D.nativeSourceHandler);u["default"].registerComponent("Html5",D);a["default"].registerTech("Html5",D);r["default"]=D},{5:5,62:62,78:78,81:81,83:83,86:86,87:87,88:88,91:91,92:92,94:94,95:95,98:98}],61:[function(e,t,r){"use strict";r.__esModule=true;var n=e(5);var o=l(n);var i=e(62);var a=l(i);var s=e(91);var u=l(s);function l(e){return e&&e.__esModule?e:{"default":e}}function c(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}function f(e,t){if(!e){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return t&&(typeof t==="object"||typeof t==="function")?t:e}function p(e,t){if(typeof t!=="function"&&t!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof t)}e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:false,writable:true,configurable:true}});if(t)Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t}var h=function(e){p(t,e);function t(r,n,i){c(this,t);var s=f(this,e.call(this,r,n,i));if(!n.playerOptions.sources||n.playerOptions.sources.length===0){for(var l=0,p=n.playerOptions.techOrder;l<p.length;l++){var h=(0,u["default"])(p[l]);var d=a["default"].getTech(h);if(!h){d=o["default"].getComponent(h)}if(d&&d.isSupported()){r.loadTech_(h);break}}}else{r.src(n.playerOptions.sources)}return s}return t}(o["default"]);o["default"].registerComponent("MediaLoader",h);r["default"]=h},{5:5,62:62,91:91}],62:[function(e,t,r){"use strict";r.__esModule=true;var n=typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol==="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};var o=e(5);var i=R(o);var a=e(66);var s=R(a);var u=e(65);var l=R(u);var c=e(87);var f=R(c);var p=e(72);var h=R(p);var d=e(70);var v=R(d);var y=e(76);var g=R(y);var _=e(63);var m=R(_);var b=e(83);var T=I(b);var w=e(86);var E=R(w);var C=e(90);var k=e(79);var O=e(46);var S=R(O);var j=e(95);var x=R(j);var P=e(94);var M=R(P);var A=e(88);function I(e){if(e&&e.__esModule){return e}else{var t={};if(e!=null){for(var r in e){if(Object.prototype.hasOwnProperty.call(e,r))t[r]=e[r]}}t["default"]=e;return t}}function R(e){return e&&e.__esModule?e:{"default":e}}function N(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}function D(e,t){if(!e){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return t&&(typeof t==="object"||typeof t==="function")?t:e}function L(e,t){if(typeof t!=="function"&&t!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof t)}e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:false,writable:true,configurable:true}});if(t)Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t}function F(e,t,r,n){var o=arguments.length>4&&arguments[4]!==undefined?arguments[4]:{};var i=e.textTracks();o.kind=t;if(r){o.label=r}if(n){o.language=n}o.tech=e;var a=new h["default"](o);i.addTrack_(a);return a}var B=function(t){L(r,t);function r(){var e=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};var n=arguments.length>1&&arguments[1]!==undefined?arguments[1]:function(){};N(this,r);e.reportTouchActivity=false;var o=D(this,t.call(this,null,e,n));o.hasStarted_=false;o.on("playing",function(){this.hasStarted_=true});o.on("loadstart",function(){this.hasStarted_=false});o.textTracks_=e.textTracks;o.videoTracks_=e.videoTracks;o.audioTracks_=e.audioTracks;if(!o.featuresProgressEvents){o.manualProgressOn()}if(!o.featuresTimeupdateEvents){o.manualTimeUpdatesOn()}["Text","Audio","Video"].forEach(function(t){if(e["native"+t+"Tracks"]===false){o["featuresNative"+t+"Tracks"]=false}});if(e.nativeCaptions===false){o.featuresNativeTextTracks=false}if(!o.featuresNativeTextTracks){o.emulateTextTracks()}o.autoRemoteTextTracks_=new v["default"];o.initTextTrackListeners();o.initTrackListeners();if(!e.nativeControlsForTouch){o.emitTapEvents()}if(o.constructor){o.name_=o.constructor.name||"Unknown Tech"}return o}r.prototype.manualProgressOn=function o(){this.on("durationchange",this.onDurationChange);this.manualProgress=true;this.one("ready",this.trackProgress)};r.prototype.manualProgressOff=function i(){this.manualProgress=false;this.stopTrackingProgress();this.off("durationchange",this.onDurationChange)};r.prototype.trackProgress=function a(e){this.stopTrackingProgress();this.progressInterval=this.setInterval(T.bind(this,function(){var e=this.bufferedPercent();if(this.bufferedPercent_!==e){this.trigger("progress")}this.bufferedPercent_=e;if(e===1){this.stopTrackingProgress()}}),500)};r.prototype.onDurationChange=function u(e){this.duration_=this.duration()};r.prototype.buffered=function c(){return(0,C.createTimeRange)(0,0)};r.prototype.bufferedPercent=function p(){return(0,k.bufferedPercent)(this.buffered(),this.duration_)};r.prototype.stopTrackingProgress=function h(){this.clearInterval(this.progressInterval)};r.prototype.manualTimeUpdatesOn=function d(){this.manualTimeUpdates=true;this.on("play",this.trackCurrentTime);this.on("pause",this.stopTrackingCurrentTime)};r.prototype.manualTimeUpdatesOff=function y(){this.manualTimeUpdates=false;this.stopTrackingCurrentTime();this.off("play",this.trackCurrentTime);this.off("pause",this.stopTrackingCurrentTime)};r.prototype.trackCurrentTime=function _(){if(this.currentTimeInterval){this.stopTrackingCurrentTime()}this.currentTimeInterval=this.setInterval(function(){this.trigger({type:"timeupdate",target:this,manuallyTriggered:true})},250)};r.prototype.stopTrackingCurrentTime=function b(){this.clearInterval(this.currentTimeInterval);this.trigger({type:"timeupdate",target:this,manuallyTriggered:true})};r.prototype.dispose=function w(){this.clearTracks(["audio","video","text"]);if(this.manualProgress){this.manualProgressOff()}if(this.manualTimeUpdates){this.manualTimeUpdatesOff()}t.prototype.dispose.call(this)};r.prototype.clearTracks=function O(e){var t=this;e=[].concat(e);e.forEach(function(e){var r=t[e+"Tracks"]()||[];var n=r.length;while(n--){var o=r[n];if(e==="text"){t.removeRemoteTextTrack(o)}r.removeTrack_(o)}})};r.prototype.cleanupAutoTextTracks=function j(){var e=this.autoRemoteTextTracks_||[];var t=e.length;while(t--){var r=e[t];this.removeRemoteTextTrack(r)}};r.prototype.reset=function P(){};r.prototype.error=function I(e){if(e!==undefined){this.error_=new S["default"](e);this.trigger("error")}return this.error_};r.prototype.played=function R(){if(this.hasStarted_){return(0,C.createTimeRange)(0,0)}return(0,C.createTimeRange)()};r.prototype.setCurrentTime=function B(){if(this.manualTimeUpdates){this.trigger({type:"timeupdate",target:this,manuallyTriggered:true})}};r.prototype.initTextTrackListeners=function H(){var e=T.bind(this,function(){this.trigger("texttrackchange")});var t=this.textTracks();if(!t){return}t.addEventListener("removetrack",e);t.addEventListener("addtrack",e);this.on("dispose",T.bind(this,function(){t.removeEventListener("removetrack",e);t.removeEventListener("addtrack",e)}))};r.prototype.initTrackListeners=function V(){var e=this;var t=["video","audio"];t.forEach(function(t){var r=function o(){e.trigger(t+"trackchange")};var n=e[t+"Tracks"]();n.addEventListener("removetrack",r);n.addEventListener("addtrack",r);e.on("dispose",function(){n.removeEventListener("removetrack",r);n.removeEventListener("addtrack",r)})})};r.prototype.addWebVttScript_=function U(){var t=this;if(!x["default"].WebVTT&&this.el().parentNode!==null&&this.el().parentNode!==undefined){var r=function(){var r=e(99);if(!t.options_["vtt.js"]&&(0,A.isPlain)(r)&&Object.keys(r).length>0){Object.keys(r).forEach(function(e){x["default"][e]=r[e]});t.trigger("vttjsloaded");return{v:void 0}}var n=M["default"].createElement("script");n.src=t.options_["vtt.js"]||"https://cdn.rawgit.com/gkatsev/vtt.js/vjs-v0.12.1/dist/vtt.min.js";n.onload=function(){t.trigger("vttjsloaded")};n.onerror=function(){t.trigger("vttjserror")};t.on("dispose",function(){n.onload=null;n.onerror=null});x["default"].WebVTT=true;t.el().parentNode.appendChild(n)}();if((typeof r==="undefined"?"undefined":n(r))==="object")return r.v}};r.prototype.emulateTextTracks=function W(){var e=this;var t=this.textTracks();if(!t){return}this.remoteTextTracks().on("addtrack",function(t){e.textTracks().addTrack_(t.track)});this.remoteTextTracks().on("removetrack",function(t){e.textTracks().removeTrack_(t.track)});this.on("ready",this.addWebVttScript_);var r=function o(){return e.trigger("texttrackchange")};var n=function i(){r();for(var e=0;e<t.length;e++){var n=t[e];n.removeEventListener("cuechange",r);if(n.mode==="showing"){n.addEventListener("cuechange",r)}}};n();t.addEventListener("change",n);this.on("dispose",function(){t.removeEventListener("change",n)})};r.prototype.videoTracks=function z(){this.videoTracks_=this.videoTracks_||new g["default"];return this.videoTracks_};r.prototype.audioTracks=function X(){this.audioTracks_=this.audioTracks_||new m["default"];return this.audioTracks_};r.prototype.textTracks=function q(){this.textTracks_=this.textTracks_||new v["default"];return this.textTracks_};r.prototype.remoteTextTracks=function $(){this.remoteTextTracks_=this.remoteTextTracks_||new v["default"];return this.remoteTextTracks_};r.prototype.remoteTextTrackEls=function G(){this.remoteTextTrackEls_=this.remoteTextTrackEls_||new l["default"];return this.remoteTextTrackEls_};r.prototype.addTextTrack=function K(e,t,r){if(!e){throw new Error("TextTrack kind is required but was not provided")}return F(this,e,t,r)};r.prototype.createRemoteTextTrack=function Y(e){var t=(0,f["default"])(e,{tech:this});return new s["default"](t)};r.prototype.addRemoteTextTrack=function J(){var e=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};var t=arguments[1];var r=this.createRemoteTextTrack(e);if(t!==true&&t!==false){E["default"].warn('Calling addRemoteTextTrack without explicitly setting the "manualCleanup" parameter to `true` is deprecated and default to `false` in future version of video.js');t=true}this.remoteTextTrackEls().addTrackElement_(r);this.remoteTextTracks().addTrack_(r.track);if(t!==true){this.autoRemoteTextTracks_.addTrack_(r.track)}return r};r.prototype.removeRemoteTextTrack=function Q(e){var t=this.remoteTextTrackEls().getTrackElementByTrack_(e);this.remoteTextTrackEls().removeTrackElement_(t);this.remoteTextTracks().removeTrack_(e);this.autoRemoteTextTracks_.removeTrack_(e)};r.prototype.setPoster=function Z(){};r.prototype.canPlayType=function ee(){return""};r.isTech=function te(e){return e.prototype instanceof r||e instanceof r||e===r};r.registerTech=function re(e,t){if(!r.techs_){r.techs_={}}if(!r.isTech(t)){throw new Error("Tech "+e+" must be a Tech")}r.techs_[e]=t;return t};r.getTech=function ne(e){if(r.techs_&&r.techs_[e]){return r.techs_[e]}if(x["default"]&&x["default"].videojs&&x["default"].videojs[e]){E["default"].warn("The "+e+" tech was added to the videojs object when it should be registered using videojs.registerTech(name, tech)");return x["default"].videojs[e]}};return r}(i["default"]);B.prototype.textTracks_;B.prototype.audioTracks_;B.prototype.videoTracks_;B.prototype.featuresVolumeControl=true;B.prototype.featuresFullscreenResize=false;B.prototype.featuresPlaybackRate=false;B.prototype.featuresProgressEvents=false;B.prototype.featuresTimeupdateEvents=false;B.prototype.featuresNativeTextTracks=false;B.withSourceHandlers=function(e){e.registerSourceHandler=function(t,r){var n=e.sourceHandlers;if(!n){n=e.sourceHandlers=[]}if(r===undefined){r=n.length}n.splice(r,0,t)};e.canPlayType=function(t){var r=e.sourceHandlers||[];var n=void 0;for(var o=0;o<r.length;o++){n=r[o].canPlayType(t);if(n){return n}}return""};e.selectSourceHandler=function(t,r){var n=e.sourceHandlers||[];var o=void 0;for(var i=0;i<n.length;i++){o=n[i].canHandleSource(t,r);if(o){return n[i]}}return null};e.canPlaySource=function(t,r){var n=e.selectSourceHandler(t,r);if(n){return n.canHandleSource(t,r)}return""};var t=["seekable","duration"];t.forEach(function(e){var t=this[e];if(typeof t!=="function"){return}this[e]=function(){if(this.sourceHandler_&&this.sourceHandler_[e]){return this.sourceHandler_[e].apply(this.sourceHandler_,arguments)}return t.apply(this,arguments)}},e.prototype);e.prototype.setSource=function(t){var r=e.selectSourceHandler(t,this.options_);if(!r){if(e.nativeSourceHandler){r=e.nativeSourceHandler}else{E["default"].error("No source hander found for the current source.")}}this.disposeSourceHandler();this.off("dispose",this.disposeSourceHandler);if(r!==e.nativeSourceHandler){this.currentSource_=t;this.off(this.el_,"loadstart",e.prototype.firstLoadStartListener_);this.off(this.el_,"loadstart",e.prototype.successiveLoadStartListener_);this.one(this.el_,"loadstart",e.prototype.firstLoadStartListener_)}this.sourceHandler_=r.handleSource(t,this,this.options_);this.on("dispose",this.disposeSourceHandler);return this};e.prototype.firstLoadStartListener_=function(){this.one(this.el_,"loadstart",e.prototype.successiveLoadStartListener_)};e.prototype.successiveLoadStartListener_=function(){this.disposeSourceHandler();this.one(this.el_,"loadstart",e.prototype.successiveLoadStartListener_)};e.prototype.disposeSourceHandler=function(){if(this.currentSource_){this.clearTracks(["audio","video"]);this.currentSource_=null}this.cleanupAutoTextTracks();if(this.sourceHandler_){this.off(this.el_,"loadstart",e.prototype.firstLoadStartListener_);this.off(this.el_,"loadstart",e.prototype.successiveLoadStartListener_);if(this.sourceHandler_.dispose){this.sourceHandler_.dispose()}this.sourceHandler_=null}}};i["default"].registerComponent("Tech",B);i["default"].registerComponent("MediaTechController",B);B.registerTech("Tech",B);r["default"]=B},{46:46,5:5,63:63,65:65,66:66,70:70,72:72,76:76,79:79,83:83,86:86,87:87,88:88,90:90,94:94,95:95,99:99}],63:[function(e,t,r){"use strict";r.__esModule=true;var n=e(74);var o=c(n);var i=e(78);var a=l(i);var s=e(94);var u=c(s);function l(e){if(e&&e.__esModule){return e}else{var t={};if(e!=null){for(var r in e){if(Object.prototype.hasOwnProperty.call(e,r))t[r]=e[r]}}t["default"]=e;return t}}function c(e){return e&&e.__esModule?e:{"default":e}}function f(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}function p(e,t){if(!e){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return t&&(typeof t==="object"||typeof t==="function")?t:e}function h(e,t){if(typeof t!=="function"&&t!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof t)}e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:false,writable:true,configurable:true}});if(t)Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t}var d=function y(e,t){for(var r=0;r<e.length;r++){if(t.id===e[r].id){continue}e[r].enabled=false}};var v=function(e){h(t,e);function t(){var r,n;var i=arguments.length>0&&arguments[0]!==undefined?arguments[0]:[];f(this,t);var s=void 0;for(var l=i.length-1;l>=0;l--){if(i[l].enabled){d(i,i[l]);break}}if(a.IS_IE8){s=u["default"].createElement("custom");for(var c in o["default"].prototype){if(c!=="constructor"){s[c]=o["default"].prototype[c]}}for(var h in t.prototype){if(h!=="constructor"){s[h]=t.prototype[h]}}}s=(r=p(this,e.call(this,i,s)),r);s.changing_=false;return n=s,p(r,n)}t.prototype.addTrack_=function r(t){var r=this;if(t.enabled){d(this,t)}e.prototype.addTrack_.call(this,t);if(!t.addEventListener){return}t.addEventListener("enabledchange",function(){if(r.changing_){return}r.changing_=true;d(r,t);r.changing_=false;r.trigger("change")})};t.prototype.addTrack=function n(e){this.addTrack_(e)};t.prototype.removeTrack=function i(t){e.prototype.removeTrack_.call(this,t)};return t}(o["default"]);r["default"]=v},{74:74,78:78,94:94}],64:[function(e,t,r){"use strict";r.__esModule=true;var n=e(73);var o=e(75);var i=f(o);var a=e(87);var s=f(a);var u=e(78);var l=c(u);function c(e){if(e&&e.__esModule){return e}else{var t={};if(e!=null){for(var r in e){if(Object.prototype.hasOwnProperty.call(e,r))t[r]=e[r]}}t["default"]=e;return t}}function f(e){return e&&e.__esModule?e:{"default":e}}function p(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}function h(e,t){if(!e){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return t&&(typeof t==="object"||typeof t==="function")?t:e}function d(e,t){if(typeof t!=="function"&&t!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof t)}e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:false,writable:true,configurable:true}});if(t)Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t}var v=function(e){d(t,e);function t(){var r,o;var i=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};p(this,t);var a=(0,s["default"])(i,{kind:n.AudioTrackKind[i.kind]||""});var u=(r=h(this,e.call(this,a)),r);var c=false;if(l.IS_IE8){for(var f in t.prototype){if(f!=="constructor"){u[f]=t.prototype[f]}}}Object.defineProperty(u,"enabled",{get:function d(){return c},set:function v(e){if(typeof e!=="boolean"||e===c){return}c=e;this.trigger("enabledchange")}});if(a.enabled){u.enabled=a.enabled}u.loaded_=true;return o=u,h(r,o)}return t}(i["default"]);r["default"]=v},{73:73,75:75,78:78,87:87}],65:[function(e,t,r){"use strict";r.__esModule=true;var n=e(78);var o=u(n);var i=e(94);var a=s(i);function s(e){return e&&e.__esModule?e:{"default":e}}function u(e){if(e&&e.__esModule){return e}else{var t={};if(e!=null){for(var r in e){if(Object.prototype.hasOwnProperty.call(e,r))t[r]=e[r]}}t["default"]=e;return t}}function l(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}var c=function(){function e(){var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:[];l(this,e);var r=this;if(o.IS_IE8){r=a["default"].createElement("custom");for(var n in e.prototype){if(n!=="constructor"){r[n]=e.prototype[n]}}}r.trackElements_=[];Object.defineProperty(r,"length",{get:function u(){return this.trackElements_.length}});for(var i=0,s=t.length;i<s;i++){r.addTrackElement_(t[i])}if(o.IS_IE8){return r}}e.prototype.addTrackElement_=function t(e){var t=this.trackElements_.length;if(!(""+t in this)){Object.defineProperty(this,t,{get:function r(){return this.trackElements_[t]}})}if(this.trackElements_.indexOf(e)===-1){this.trackElements_.push(e)}};e.prototype.getTrackElementByTrack_=function r(e){var t=void 0;for(var r=0,n=this.trackElements_.length;r<n;r++){if(e===this.trackElements_[r].track){t=this.trackElements_[r];break}}return t};e.prototype.removeTrackElement_=function n(e){for(var t=0,r=this.trackElements_.length;t<r;t++){if(e===this.trackElements_[t]){this.trackElements_.splice(t,1);break}}};return e}();r["default"]=c},{78:78,94:94}],66:[function(e,t,r){"use strict";r.__esModule=true;var n=e(78);var o=p(n);var i=e(94);var a=f(i);var s=e(42);var u=f(s);var l=e(72);var c=f(l);function f(e){return e&&e.__esModule?e:{"default":e}}function p(e){if(e&&e.__esModule){return e}else{var t={};if(e!=null){for(var r in e){if(Object.prototype.hasOwnProperty.call(e,r))t[r]=e[r]}}t["default"]=e;return t}}function h(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}function d(e,t){if(!e){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return t&&(typeof t==="object"||typeof t==="function")?t:e}function v(e,t){if(typeof t!=="function"&&t!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof t)}e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:false,writable:true,configurable:true}});if(t)Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t}var y=0;var g=1;var _=2;var m=3;var b=function(e){v(t,e);function t(){var r=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};h(this,t);var n=d(this,e.call(this));var i=void 0;var s=n;if(o.IS_IE8){s=a["default"].createElement("custom");for(var u in t.prototype){if(u!=="constructor"){s[u]=t.prototype[u]}}}var l=new c["default"](r);s.kind=l.kind;s.src=l.src;s.srclang=l.language;s.label=l.label;s["default"]=l["default"];Object.defineProperty(s,"readyState",{get:function p(){return i}});Object.defineProperty(s,"track",{get:function v(){return l}});i=y;l.addEventListener("loadeddata",function(){i=_;s.trigger({type:"load",target:s})});if(o.IS_IE8){var f;return f=s,d(n,f)}return n}return t}(u["default"]);b.prototype.allowedEvents_={load:"load"};b.NONE=y;b.LOADING=g;b.LOADED=_;b.ERROR=m;r["default"]=b},{42:42,72:72,78:78,94:94}],67:[function(e,t,r){"use strict";r.__esModule=true;var n=e(78);var o=u(n);var i=e(94);var a=s(i);function s(e){return e&&e.__esModule?e:{"default":e}}function u(e){if(e&&e.__esModule){return e}else{var t={};if(e!=null){for(var r in e){if(Object.prototype.hasOwnProperty.call(e,r))t[r]=e[r]}}t["default"]=e;return t}}function l(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}var c=function(){function e(t){l(this,e);var r=this;if(o.IS_IE8){r=a["default"].createElement("custom");for(var n in e.prototype){if(n!=="constructor"){r[n]=e.prototype[n]}}}e.prototype.setCues_.call(r,t);Object.defineProperty(r,"length",{get:function i(){return this.length_}});if(o.IS_IE8){return r}}e.prototype.setCues_=function t(e){var t=this.length||0;var r=0;var n=e.length;this.cues_=e;this.length_=e.length;var o=function i(e){if(!(""+e in this)){Object.defineProperty(this,""+e,{get:function t(){return this.cues_[e]}})}};if(t<n){r=t;for(;r<n;r++){o.call(this,r)}}};e.prototype.getCueById=function r(e){var t=null;for(var r=0,n=this.length;r<n;r++){var o=this[r];if(o.id===e){t=o;break}}return t};return e}();r["default"]=c},{78:78,94:94}],68:[function(e,t,r){"use strict";r.__esModule=true;var n=e(5);var o=c(n);var i=e(83);var a=l(i);var s=e(95);var u=c(s);function l(e){if(e&&e.__esModule){return e}else{var t={};if(e!=null){for(var r in e){if(Object.prototype.hasOwnProperty.call(e,r))t[r]=e[r]}}t["default"]=e;return t}}function c(e){return e&&e.__esModule?e:{"default":e}}function f(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}function p(e,t){if(!e){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return t&&(typeof t==="object"||typeof t==="function")?t:e}function h(e,t){if(typeof t!=="function"&&t!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof t)}e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:false,writable:true,configurable:true}});if(t)Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t}var d="#222";var v="#ccc";var y={monospace:"monospace",sansSerif:"sans-serif",serif:"serif",monospaceSansSerif:'"Andale Mono", "Lucida Console", monospace',monospaceSerif:'"Courier New", monospace',proportionalSansSerif:"sans-serif",proportionalSerif:"serif",casual:'"Comic Sans MS", Impact, fantasy',script:'"Monotype Corsiva", cursive',smallcaps:'"Andale Mono", "Lucida Console", monospace, sans-serif'};function g(e,t){return"rgba("+parseInt(e[1]+e[1],16)+","+parseInt(e[2]+e[2],16)+","+parseInt(e[3]+e[3],16)+","+t+")"}function _(e,t,r){try{e.style[t]=r}catch(n){return}}var m=function(e){h(t,e);function t(r,n,o){f(this,t);var i=p(this,e.call(this,r,n,o));r.on("loadstart",a.bind(i,i.toggleDisplay));r.on("texttrackchange",a.bind(i,i.updateDisplay));r.ready(a.bind(i,function(){if(r.tech_&&r.tech_.featuresNativeTextTracks){this.hide();return}r.on("fullscreenchange",a.bind(this,this.updateDisplay));var e=this.options_.playerOptions.tracks||[];for(var t=0;t<e.length;t++){this.player_.addRemoteTextTrack(e[t],true)}var n={captions:1,subtitles:1};var o=this.player_.textTracks();var i=void 0;var s=void 0;if(o){for(var u=0;u<o.length;u++){var l=o[u];if(l["default"]){if(l.kind==="descriptions"&&!i){i=l}else if(l.kind in n&&!s){s=l}}}if(s){s.mode="showing"}else if(i){i.mode="showing"}}}));return i}t.prototype.toggleDisplay=function r(){if(this.player_.tech_&&this.player_.tech_.featuresNativeTextTracks){this.hide()}else{this.show()}};t.prototype.createEl=function n(){return e.prototype.createEl.call(this,"div",{className:"vjs-text-track-display"},{"aria-live":"off","aria-atomic":"true"})};t.prototype.clearDisplay=function o(){if(typeof u["default"].WebVTT==="function"){u["default"].WebVTT.processCues(u["default"],[],this.el_)}};t.prototype.updateDisplay=function i(){var e=this.player_.textTracks();this.clearDisplay();if(!e){return}var t=null;var r=null;var n=e.length;while(n--){var o=e[n];if(o.mode==="showing"){if(o.kind==="descriptions"){t=o}else{r=o}}}if(r){if(this.getAttribute("aria-live")!=="off"){this.setAttribute("aria-live","off")}this.updateForTrack(r)}else if(t){if(this.getAttribute("aria-live")!=="assertive"){this.setAttribute("aria-live","assertive")}this.updateForTrack(t)}};t.prototype.updateForTrack=function s(e){if(typeof u["default"].WebVTT!=="function"||!e.activeCues){return}var t=this.player_.textTrackSettings.getValues();var r=[];for(var n=0;n<e.activeCues.length;n++){r.push(e.activeCues[n])}u["default"].WebVTT.processCues(u["default"],r,this.el_);var o=r.length;while(o--){var i=r[o];if(!i){continue}var a=i.displayState;if(t.color){a.firstChild.style.color=t.color}if(t.textOpacity){_(a.firstChild,"color",g(t.color||"#fff",t.textOpacity))}if(t.backgroundColor){a.firstChild.style.backgroundColor=t.backgroundColor}if(t.backgroundOpacity){_(a.firstChild,"backgroundColor",g(t.backgroundColor||"#000",t.backgroundOpacity))}if(t.windowColor){if(t.windowOpacity){_(a,"backgroundColor",g(t.windowColor,t.windowOpacity))}else{a.style.backgroundColor=t.windowColor}}if(t.edgeStyle){if(t.edgeStyle==="dropshadow"){a.firstChild.style.textShadow="2px 2px 3px "+d+", 2px 2px 4px "+d+", 2px 2px 5px "+d}else if(t.edgeStyle==="raised"){a.firstChild.style.textShadow="1px 1px "+d+", 2px 2px "+d+", 3px 3px "+d}else if(t.edgeStyle==="depressed"){a.firstChild.style.textShadow="1px 1px "+v+", 0 1px "+v+", -1px -1px "+d+", 0 -1px "+d}else if(t.edgeStyle==="uniform"){a.firstChild.style.textShadow="0 0 4px "+d+", 0 0 4px "+d+", 0 0 4px "+d+", 0 0 4px "+d}}if(t.fontPercent&&t.fontPercent!==1){var s=u["default"].parseFloat(a.style.fontSize);a.style.fontSize=s*t.fontPercent+"px";a.style.height="auto";a.style.top="auto";a.style.bottom="2px"}if(t.fontFamily&&t.fontFamily!=="default"){if(t.fontFamily==="small-caps"){a.firstChild.style.fontVariant="small-caps"}else{a.firstChild.style.fontFamily=y[t.fontFamily]}}}};return t}(o["default"]);o["default"].registerComponent("TextTrackDisplay",m);r["default"]=m},{5:5,83:83,95:95}],69:[function(e,t,r){"use strict";r.__esModule=true;var n=function a(e){var t=["kind","label","language","id","inBandMetadataTrackDispatchType","mode","src"].reduce(function(t,r,n){if(e[r]){t[r]=e[r]}return t},{cues:e.cues&&Array.prototype.map.call(e.cues,function(e){return{startTime:e.startTime,endTime:e.endTime,text:e.text,id:e.id}})});return t};var o=function s(e){var t=e.$$("track");var r=Array.prototype.map.call(t,function(e){return e.track});var o=Array.prototype.map.call(t,function(e){var t=n(e.track);if(e.src){t.src=e.src}return t});return o.concat(Array.prototype.filter.call(e.textTracks(),function(e){return r.indexOf(e)===-1}).map(n))};var i=function u(e,t){e.forEach(function(e){var r=t.addRemoteTextTrack(e).track;if(!e.src&&e.cues){e.cues.forEach(function(e){return r.addCue(e)})}});return t.textTracks()};r["default"]={textTracksToJson:o,jsonToTextTracks:i,trackToJson_:n}},{}],70:[function(e,t,r){"use strict";r.__esModule=true;var n=e(74);var o=p(n);var i=e(83);var a=f(i);var s=e(78);var u=f(s);var l=e(94);var c=p(l);function f(e){if(e&&e.__esModule){return e}else{var t={};if(e!=null){for(var r in e){if(Object.prototype.hasOwnProperty.call(e,r))t[r]=e[r]}}t["default"]=e;return t}}function p(e){return e&&e.__esModule?e:{"default":e}}function h(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}function d(e,t){if(!e){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return t&&(typeof t==="object"||typeof t==="function")?t:e}function v(e,t){if(typeof t!=="function"&&t!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof t)}e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:false,writable:true,configurable:true}});if(t)Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t}var y=function(e){v(t,e);function t(){var r,n;var i=arguments.length>0&&arguments[0]!==undefined?arguments[0]:[];h(this,t);var a=void 0;if(u.IS_IE8){a=c["default"].createElement("custom");for(var s in o["default"].prototype){if(s!=="constructor"){a[s]=o["default"].prototype[s]}}for(var l in t.prototype){if(l!=="constructor"){a[l]=t.prototype[l]}}}a=(r=d(this,e.call(this,i,a)),r);return n=a,d(r,n)}t.prototype.addTrack_=function r(t){e.prototype.addTrack_.call(this,t);t.addEventListener("modechange",a.bind(this,function(){this.trigger("change")}))};return t}(o["default"]);r["default"]=y},{74:74,78:78,83:83,94:94}],71:[function(e,t,r){"use strict";r.__esModule=true;var n=e(95);var o=v(n);var i=e(5);var a=v(i);var s=e(81);var u=e(83);var l=d(u);var c=e(88);var f=d(c);var p=e(86);var h=v(p);function d(e){if(e&&e.__esModule){return e}else{var t={};if(e!=null){for(var r in e){if(Object.prototype.hasOwnProperty.call(e,r))t[r]=e[r]}}t["default"]=e;return t}}function v(e){return e&&e.__esModule?e:{"default":e}}function y(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}function g(e,t){if(!e){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return t&&(typeof t==="object"||typeof t==="function")?t:e}function _(e,t){if(typeof t!=="function"&&t!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof t)}e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:false,writable:true,configurable:true}});if(t)Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t}var m="vjs-text-track-settings";var b=["#000","Black"];var T=["#00F","Blue"];var w=["#0FF","Cyan"];var E=["#0F0","Green"];var C=["#F0F","Magenta"];var k=["#F00","Red"];var O=["#FFF","White"];var S=["#FF0","Yellow"];var j=["1","Opaque"];var x=["0.5","Semi-Transparent"];var P=["0","Transparent"];var M={backgroundColor:{selector:".vjs-bg-color > select",id:"captions-background-color-%s",label:"Color",options:[b,O,k,E,T,S,C,w]},backgroundOpacity:{selector:".vjs-bg-opacity > select",id:"captions-background-opacity-%s",label:"Transparency",options:[j,x,P]},color:{selector:".vjs-fg-color > select",id:"captions-foreground-color-%s",label:"Color",options:[O,b,k,E,T,S,C,w]},edgeStyle:{selector:".vjs-edge-style > select",id:"%s",label:"Text Edge Style",options:[["none","None"],["raised","Raised"],["depressed","Depressed"],["uniform","Uniform"],["dropshadow","Dropshadow"]]},fontFamily:{selector:".vjs-font-family > select",id:"captions-font-family-%s",label:"Font Family",options:[["proportionalSansSerif","Proportional Sans-Serif"],["monospaceSansSerif","Monospace Sans-Serif"],["proportionalSerif","Proportional Serif"],["monospaceSerif","Monospace Serif"],["casual","Casual"],["script","Script"],["small-caps","Small Caps"]]
},fontPercent:{selector:".vjs-font-percent > select",id:"captions-font-size-%s",label:"Font Size",options:[["0.50","50%"],["0.75","75%"],["1.00","100%"],["1.25","125%"],["1.50","150%"],["1.75","175%"],["2.00","200%"],["3.00","300%"],["4.00","400%"]],"default":2,parser:function D(e){return e==="1.00"?null:Number(e)}},textOpacity:{selector:".vjs-text-opacity > select",id:"captions-foreground-opacity-%s",label:"Transparency",options:[j,x]},windowColor:{selector:".vjs-window-color > select",id:"captions-window-color-%s",label:"Color"},windowOpacity:{selector:".vjs-window-opacity > select",id:"captions-window-opacity-%s",label:"Transparency",options:[P,x,j]}};M.windowColor.options=M.backgroundColor.options;function A(e,t){if(t){e=t(e)}if(e&&e!=="none"){return e}}function I(e,t){var r=e.options[e.options.selectedIndex].value;return A(r,t)}function R(e,t,r){if(!t){return}for(var n=0;n<e.options.length;n++){if(A(e.options[n].value,r)===t){e.selectedIndex=n;break}}}var N=function(e){_(t,e);function t(r,n){y(this,t);var o=g(this,e.call(this,r,n));o.setDefaults();o.hide();o.updateDisplay=l.bind(o,o.updateDisplay);if(n.persistTextTrackSettings===undefined){o.options_.persistTextTrackSettings=o.options_.playerOptions.persistTextTrackSettings}o.on(o.$(".vjs-done-button"),"click",function(){o.saveSettings();o.hide()});o.on(o.$(".vjs-default-button"),"click",function(){o.setDefaults();o.updateDisplay()});f.each(M,function(e){o.on(o.$(e.selector),"change",o.updateDisplay)});if(o.options_.persistTextTrackSettings){o.restoreSettings()}return o}t.prototype.createElSelect_=function r(e){var t=this;var r=M[e];var n=r.id.replace("%s",this.id_);return[(0,s.createEl)("label",{className:"vjs-label",textContent:r.label},{"for":n}),(0,s.createEl)("select",{id:n},undefined,r.options.map(function(e){return(0,s.createEl)("option",{textContent:t.localize(e[1]),value:e[0]})}))]};t.prototype.createElFgColor_=function n(){var e=(0,s.createEl)("legend",{textContent:this.localize("Text")});var t=this.createElSelect_("color");var r=(0,s.createEl)("span",{className:"vjs-text-opacity vjs-opacity"},undefined,this.createElSelect_("textOpacity"));return(0,s.createEl)("fieldset",{className:"vjs-fg-color vjs-tracksetting"},undefined,[e].concat(t,r))};t.prototype.createElBgColor_=function i(){var e=(0,s.createEl)("legend",{textContent:this.localize("Background")});var t=this.createElSelect_("backgroundColor");var r=(0,s.createEl)("span",{className:"vjs-bg-opacity vjs-opacity"},undefined,this.createElSelect_("backgroundOpacity"));return(0,s.createEl)("fieldset",{className:"vjs-bg-color vjs-tracksetting"},undefined,[e].concat(t,r))};t.prototype.createElWinColor_=function a(){var e=(0,s.createEl)("legend",{textContent:this.localize("Window")});var t=this.createElSelect_("windowColor");var r=(0,s.createEl)("span",{className:"vjs-window-opacity vjs-opacity"},undefined,this.createElSelect_("windowOpacity"));return(0,s.createEl)("fieldset",{className:"vjs-window-color vjs-tracksetting"},undefined,[e].concat(t,r))};t.prototype.createElColors_=function u(){return(0,s.createEl)("div",{className:"vjs-tracksettings-colors"},undefined,[this.createElFgColor_(),this.createElBgColor_(),this.createElWinColor_()])};t.prototype.createElFont_=function c(){var e=(0,s.createEl)("div",{className:"vjs-font-percent vjs-tracksetting"},undefined,this.createElSelect_("fontPercent"));var t=(0,s.createEl)("div",{className:"vjs-edge-style vjs-tracksetting"},undefined,this.createElSelect_("edgeStyle"));var r=(0,s.createEl)("div",{className:"vjs-font-family vjs-tracksetting"},undefined,this.createElSelect_("fontFamily"));return(0,s.createEl)("div",{className:"vjs-tracksettings-font"},undefined,[e,t,r])};t.prototype.createElControls_=function p(){var e=(0,s.createEl)("button",{className:"vjs-default-button",textContent:this.localize("Defaults")});var t=(0,s.createEl)("button",{className:"vjs-done-button",textContent:"Done"});return(0,s.createEl)("div",{className:"vjs-tracksettings-controls"},undefined,[e,t])};t.prototype.createEl=function d(){var e=(0,s.createEl)("div",{className:"vjs-tracksettings"},undefined,[this.createElColors_(),this.createElFont_(),this.createElControls_()]);var t=(0,s.createEl)("div",{className:"vjs-control-text",id:"TTsettingsDialogLabel-"+this.id_,textContent:"Caption Settings Dialog"},{"aria-level":"1",role:"heading"});var r=(0,s.createEl)("div",{className:"vjs-control-text",id:"TTsettingsDialogDescription-"+this.id_,textContent:"Beginning of dialog window. Escape will cancel and close the window."});var n=(0,s.createEl)("div",undefined,{role:"document"},[t,r,e]);return(0,s.createEl)("div",{className:"vjs-caption-settings vjs-modal-overlay",tabIndex:-1},{role:"dialog","aria-labelledby":t.id,"aria-describedby":r.id},n)};t.prototype.getValues=function v(){var e=this;return f.reduce(M,function(t,r,n){var o=I(e.$(r.selector),r.parser);if(o!==undefined){t[n]=o}return t},{})};t.prototype.setValues=function b(e){var t=this;f.each(M,function(r,n){R(t.$(r.selector),e[n],r.parser)})};t.prototype.setDefaults=function T(){var e=this;f.each(M,function(t){var r=t.hasOwnProperty("default")?t["default"]:0;e.$(t.selector).selectedIndex=r})};t.prototype.restoreSettings=function w(){var e=void 0;try{e=JSON.parse(o["default"].localStorage.getItem(m))}catch(t){h["default"].warn(t)}if(e){this.setValues(e)}};t.prototype.saveSettings=function E(){if(!this.options_.persistTextTrackSettings){return}var e=this.getValues();try{if(Object.keys(e).length){o["default"].localStorage.setItem(m,JSON.stringify(e))}else{o["default"].localStorage.removeItem(m)}}catch(t){h["default"].warn(t)}};t.prototype.updateDisplay=function C(){var e=this.player_.getChild("textTrackDisplay");if(e){e.updateDisplay()}};return t}(a["default"]);a["default"].registerComponent("TextTrackSettings",N);r["default"]=N},{5:5,81:81,83:83,86:86,88:88,95:95}],72:[function(e,t,r){"use strict";r.__esModule=true;var n=e(67);var o=w(n);var i=e(83);var a=T(i);var s=e(73);var u=e(86);var l=w(u);var c=e(95);var f=w(c);var p=e(75);var h=w(p);var d=e(92);var v=e(105);var y=w(v);var g=e(87);var _=w(g);var m=e(78);var b=T(m);function T(e){if(e&&e.__esModule){return e}else{var t={};if(e!=null){for(var r in e){if(Object.prototype.hasOwnProperty.call(e,r))t[r]=e[r]}}t["default"]=e;return t}}function w(e){return e&&e.__esModule?e:{"default":e}}function E(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}function C(e,t){if(!e){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return t&&(typeof t==="object"||typeof t==="function")?t:e}function k(e,t){if(typeof t!=="function"&&t!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof t)}e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:false,writable:true,configurable:true}});if(t)Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t}var O=function x(e,t){var r=new f["default"].WebVTT.Parser(f["default"],f["default"].vttjs,f["default"].WebVTT.StringDecoder());var n=[];r.oncue=function(e){t.addCue(e)};r.onparsingerror=function(e){n.push(e)};r.onflush=function(){t.trigger({type:"loadeddata",target:t})};r.parse(e);if(n.length>0){if(f["default"].console&&f["default"].console.groupCollapsed){f["default"].console.groupCollapsed("Text Track parsing errors for "+t.src)}n.forEach(function(e){return l["default"].error(e)});if(f["default"].console&&f["default"].console.groupEnd){f["default"].console.groupEnd()}}r.flush()};var S=function P(e,t){var r={uri:e};var n=(0,d.isCrossOrigin)(e);if(n){r.cors=n}(0,y["default"])(r,a.bind(this,function(e,r,n){if(e){return l["default"].error(e,r)}t.loaded_=true;if(typeof f["default"].WebVTT!=="function"){if(t.tech_){(function(){var e=function r(){return O(n,t)};t.tech_.on("vttjsloaded",e);t.tech_.on("vttjserror",function(){l["default"].error("vttjs failed to load, stopping trying to process "+t.src);t.tech_.off("vttjsloaded",e)})})()}}else{O(n,t)}}))};var j=function(e){k(t,e);function t(){var r,n;var i=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};E(this,t);if(!i.tech){throw new Error("A tech was not provided.")}var u=(0,_["default"])(i,{kind:s.TextTrackKind[i.kind]||"subtitles",language:i.language||i.srclang||""});var l=s.TextTrackMode[u.mode]||"disabled";var c=u["default"];if(u.kind==="metadata"||u.kind==="chapters"){l="hidden"}var f=(r=C(this,e.call(this,u)),r);f.tech_=u.tech;if(b.IS_IE8){for(var p in t.prototype){if(p!=="constructor"){f[p]=t.prototype[p]}}}f.cues_=[];f.activeCues_=[];var h=new o["default"](f.cues_);var d=new o["default"](f.activeCues_);var v=false;var y=a.bind(f,function(){this.activeCues;if(v){this.trigger("cuechange");v=false}});if(l!=="disabled"){f.tech_.on("timeupdate",y)}Object.defineProperty(f,"default",{get:function g(){return c},set:function m(){}});Object.defineProperty(f,"mode",{get:function T(){return l},set:function w(e){if(!s.TextTrackMode[e]){return}l=e;if(l==="showing"){this.tech_.on("timeupdate",y)}this.trigger("modechange")}});Object.defineProperty(f,"cues",{get:function k(){if(!this.loaded_){return null}return h},set:function O(){}});Object.defineProperty(f,"activeCues",{get:function j(){if(!this.loaded_){return null}if(this.cues.length===0){return d}var e=this.tech_.currentTime();var t=[];for(var r=0,n=this.cues.length;r<n;r++){var o=this.cues[r];if(o.startTime<=e&&o.endTime>=e){t.push(o)}else if(o.startTime===o.endTime&&o.startTime<=e&&o.startTime+.5>=e){t.push(o)}}v=false;if(t.length!==this.activeCues_.length){v=true}else{for(var i=0;i<t.length;i++){if(this.activeCues_.indexOf(t[i])===-1){v=true}}}this.activeCues_=t;d.setCues_(this.activeCues_);return d},set:function x(){}});if(u.src){f.src=u.src;S(u.src,f)}else{f.loaded_=true}return n=f,C(r,n)}t.prototype.addCue=function r(e){var t=this.tech_.textTracks();if(t){for(var r=0;r<t.length;r++){if(t[r]!==this){t[r].removeCue(e)}}}this.cues_.push(e);this.cues.setCues_(this.cues_)};t.prototype.removeCue=function n(e){var t=false;for(var r=0,n=this.cues_.length;r<n;r++){var o=this.cues_[r];if(o===e){this.cues_.splice(r,1);t=true}}if(t){this.cues.setCues_(this.cues_)}};return t}(h["default"]);j.prototype.allowedEvents_={cuechange:"cuechange"};r["default"]=j},{105:105,67:67,73:73,75:75,78:78,83:83,86:86,87:87,92:92,95:95}],73:[function(e,t,r){"use strict";r.__esModule=true;var n=r.VideoTrackKind={alternative:"alternative",captions:"captions",main:"main",sign:"sign",subtitles:"subtitles",commentary:"commentary"};var o=r.AudioTrackKind={alternative:"alternative",descriptions:"descriptions",main:"main","main-desc":"main-desc",translation:"translation",commentary:"commentary"};var i=r.TextTrackKind={subtitles:"subtitles",captions:"captions",descriptions:"descriptions",chapters:"chapters",metadata:"metadata"};var a=r.TextTrackMode={disabled:"disabled",hidden:"hidden",showing:"showing"}},{}],74:[function(e,t,r){"use strict";r.__esModule=true;var n=e(42);var o=c(n);var i=e(78);var a=l(i);var s=e(94);var u=c(s);function l(e){if(e&&e.__esModule){return e}else{var t={};if(e!=null){for(var r in e){if(Object.prototype.hasOwnProperty.call(e,r))t[r]=e[r]}}t["default"]=e;return t}}function c(e){return e&&e.__esModule?e:{"default":e}}function f(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}function p(e,t){if(!e){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return t&&(typeof t==="object"||typeof t==="function")?t:e}function h(e,t){if(typeof t!=="function"&&t!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof t)}e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:false,writable:true,configurable:true}});if(t)Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t}var d=function(e){h(t,e);function t(){var r=arguments.length>0&&arguments[0]!==undefined?arguments[0]:[];var n;var o=arguments.length>1&&arguments[1]!==undefined?arguments[1]:null;f(this,t);var i=p(this,e.call(this));if(!o){o=i;if(a.IS_IE8){o=u["default"].createElement("custom");for(var s in t.prototype){if(s!=="constructor"){o[s]=t.prototype[s]}}}}o.tracks_=[];Object.defineProperty(o,"length",{get:function c(){return this.tracks_.length}});for(var l=0;l<r.length;l++){o.addTrack_(r[l])}return n=o,p(i,n)}t.prototype.addTrack_=function r(e){var t=this.tracks_.length;if(!(""+t in this)){Object.defineProperty(this,t,{get:function r(){return this.tracks_[t]}})}if(this.tracks_.indexOf(e)===-1){this.tracks_.push(e);this.trigger({track:e,type:"addtrack"})}};t.prototype.removeTrack_=function n(e){var t=void 0;for(var r=0,n=this.length;r<n;r++){if(this[r]===e){t=this[r];if(t.off){t.off()}this.tracks_.splice(r,1);break}}if(!t){return}this.trigger({track:t,type:"removetrack"})};t.prototype.getTrackById=function o(e){var t=null;for(var r=0,n=this.length;r<n;r++){var o=this[r];if(o.id===e){t=o;break}}return t};return t}(o["default"]);d.prototype.allowedEvents_={change:"change",addtrack:"addtrack",removetrack:"removetrack"};for(var v in d.prototype.allowedEvents_){d.prototype["on"+v]=null}r["default"]=d},{42:42,78:78,94:94}],75:[function(e,t,r){"use strict";r.__esModule=true;var n=e(78);var o=p(n);var i=e(94);var a=f(i);var s=e(85);var u=p(s);var l=e(42);var c=f(l);function f(e){return e&&e.__esModule?e:{"default":e}}function p(e){if(e&&e.__esModule){return e}else{var t={};if(e!=null){for(var r in e){if(Object.prototype.hasOwnProperty.call(e,r))t[r]=e[r]}}t["default"]=e;return t}}function h(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}function d(e,t){if(!e){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return t&&(typeof t==="object"||typeof t==="function")?t:e}function v(e,t){if(typeof t!=="function"&&t!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof t)}e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:false,writable:true,configurable:true}});if(t)Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t}var y=function(e){v(t,e);function t(){var r;var n=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};h(this,t);var i=d(this,e.call(this));var s=i;if(o.IS_IE8){s=a["default"].createElement("custom");for(var l in t.prototype){if(l!=="constructor"){s[l]=t.prototype[l]}}}var c={id:n.id||"vjs_track_"+u.newGUID(),kind:n.kind||"",label:n.label||"",language:n.language||""};var f=function v(e){Object.defineProperty(s,e,{get:function t(){return c[e]},set:function r(){}})};for(var p in c){f(p)}return r=s,d(i,r)}return t}(c["default"]);r["default"]=y},{42:42,78:78,85:85,94:94}],76:[function(e,t,r){"use strict";r.__esModule=true;var n=e(74);var o=c(n);var i=e(78);var a=l(i);var s=e(94);var u=c(s);function l(e){if(e&&e.__esModule){return e}else{var t={};if(e!=null){for(var r in e){if(Object.prototype.hasOwnProperty.call(e,r))t[r]=e[r]}}t["default"]=e;return t}}function c(e){return e&&e.__esModule?e:{"default":e}}function f(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}function p(e,t){if(!e){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return t&&(typeof t==="object"||typeof t==="function")?t:e}function h(e,t){if(typeof t!=="function"&&t!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof t)}e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:false,writable:true,configurable:true}});if(t)Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t}var d=function y(e,t){for(var r=0;r<e.length;r++){if(t.id===e[r].id){continue}e[r].selected=false}};var v=function(e){h(t,e);function t(){var r,n;var i=arguments.length>0&&arguments[0]!==undefined?arguments[0]:[];f(this,t);var s=void 0;for(var l=i.length-1;l>=0;l--){if(i[l].selected){d(i,i[l]);break}}if(a.IS_IE8){s=u["default"].createElement("custom");for(var c in o["default"].prototype){if(c!=="constructor"){s[c]=o["default"].prototype[c]}}for(var h in t.prototype){if(h!=="constructor"){s[h]=t.prototype[h]}}}s=(r=p(this,e.call(this,i,s)),r);s.changing_=false;Object.defineProperty(s,"selectedIndex",{get:function v(){for(var e=0;e<this.length;e++){if(this[e].selected){return e}}return-1},set:function y(){}});return n=s,p(r,n)}t.prototype.addTrack_=function r(t){var r=this;if(t.selected){d(this,t)}e.prototype.addTrack_.call(this,t);if(!t.addEventListener){return}t.addEventListener("selectedchange",function(){if(r.changing_){return}r.changing_=true;d(r,t);r.changing_=false;r.trigger("change")})};t.prototype.addTrack=function n(e){this.addTrack_(e)};t.prototype.removeTrack=function i(t){e.prototype.removeTrack_.call(this,t)};return t}(o["default"]);r["default"]=v},{74:74,78:78,94:94}],77:[function(e,t,r){"use strict";r.__esModule=true;var n=e(73);var o=e(75);var i=f(o);var a=e(87);var s=f(a);var u=e(78);var l=c(u);function c(e){if(e&&e.__esModule){return e}else{var t={};if(e!=null){for(var r in e){if(Object.prototype.hasOwnProperty.call(e,r))t[r]=e[r]}}t["default"]=e;return t}}function f(e){return e&&e.__esModule?e:{"default":e}}function p(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}function h(e,t){if(!e){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return t&&(typeof t==="object"||typeof t==="function")?t:e}function d(e,t){if(typeof t!=="function"&&t!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof t)}e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:false,writable:true,configurable:true}});if(t)Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t}var v=function(e){d(t,e);function t(){var r,o;var i=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};p(this,t);var a=(0,s["default"])(i,{kind:n.VideoTrackKind[i.kind]||""});var u=(r=h(this,e.call(this,a)),r);var c=false;if(l.IS_IE8){for(var f in t.prototype){if(f!=="constructor"){u[f]=t.prototype[f]}}}Object.defineProperty(u,"selected",{get:function d(){return c},set:function v(e){if(typeof e!=="boolean"||e===c){return}c=e;this.trigger("selectedchange")}});if(a.selected){u.selected=a.selected}return o=u,h(r,o)}return t}(i["default"]);r["default"]=v},{73:73,75:75,78:78,87:87}],78:[function(e,t,r){"use strict";r.__esModule=true;r.BACKGROUND_SIZE_SUPPORTED=r.TOUCH_ENABLED=r.IS_ANY_SAFARI=r.IS_SAFARI=r.IE_VERSION=r.IS_IE8=r.IS_CHROME=r.IS_EDGE=r.IS_FIREFOX=r.IS_NATIVE_ANDROID=r.IS_OLD_ANDROID=r.ANDROID_VERSION=r.IS_ANDROID=r.IOS_VERSION=r.IS_IOS=r.IS_IPOD=r.IS_IPHONE=r.IS_IPAD=undefined;var n=e(81);var o=u(n);var i=e(95);var a=s(i);function s(e){return e&&e.__esModule?e:{"default":e}}function u(e){if(e&&e.__esModule){return e}else{var t={};if(e!=null){for(var r in e){if(Object.prototype.hasOwnProperty.call(e,r))t[r]=e[r]}}t["default"]=e;return t}}var l=a["default"].navigator&&a["default"].navigator.userAgent||"";var c=/AppleWebKit\/([\d.]+)/i.exec(l);var f=c?parseFloat(c.pop()):null;var p=r.IS_IPAD=/iPad/i.test(l);var h=r.IS_IPHONE=/iPhone/i.test(l)&&!p;var d=r.IS_IPOD=/iPod/i.test(l);var v=r.IS_IOS=h||p||d;var y=r.IOS_VERSION=function(){var e=l.match(/OS (\d+)_/i);if(e&&e[1]){return e[1]}return null}();var g=r.IS_ANDROID=/Android/i.test(l);var _=r.ANDROID_VERSION=function(){var e=l.match(/Android (\d+)(?:\.(\d+))?(?:\.(\d+))*/i);if(!e){return null}var t=e[1]&&parseFloat(e[1]);var r=e[2]&&parseFloat(e[2]);if(t&&r){return parseFloat(e[1]+"."+e[2])}else if(t){return t}return null}();var m=r.IS_OLD_ANDROID=g&&/webkit/i.test(l)&&_<2.3;var b=r.IS_NATIVE_ANDROID=g&&_<5&&f<537;var T=r.IS_FIREFOX=/Firefox/i.test(l);var w=r.IS_EDGE=/Edge/i.test(l);var E=r.IS_CHROME=!w&&/Chrome/i.test(l);var C=r.IS_IE8=/MSIE\s8\.0/.test(l);var k=r.IE_VERSION=function(e){return e&&parseFloat(e[1])}(/MSIE\s(\d+)\.\d/.exec(l));var O=r.IS_SAFARI=/Safari/i.test(l)&&!E&&!g&&!w;var S=r.IS_ANY_SAFARI=O||v;var j=r.TOUCH_ENABLED=o.isReal()&&("ontouchstart"in a["default"]||a["default"].DocumentTouch&&a["default"].document instanceof a["default"].DocumentTouch);var x=r.BACKGROUND_SIZE_SUPPORTED=o.isReal()&&"backgroundSize"in a["default"].document.createElement("video").style},{81:81,95:95}],79:[function(e,t,r){"use strict";r.__esModule=true;r.bufferedPercent=o;var n=e(90);function o(e,t){var r=0;var o=void 0;var i=void 0;if(!t){return 0}if(!e||!e.length){e=(0,n.createTimeRange)(0,0)}for(var a=0;a<e.length;a++){o=e.start(a);i=e.end(a);if(i>t){i=t}r+=i-o}return r/t}},{90:90}],80:[function(e,t,r){"use strict";r.__esModule=true;r["default"]=a;var n=e(95);var o=i(n);function i(e){return e&&e.__esModule?e:{"default":e}}function a(e,t){if(!e||!t){return""}if(typeof o["default"].getComputedStyle==="function"){var r=o["default"].getComputedStyle(e);return r?r[t]:""}return e.currentStyle[t]||""}},{95:95}],81:[function(e,t,r){"use strict";r.__esModule=true;r.$$=r.$=undefined;var n=g(["Setting attributes in the second argument of createEl()\n                has been deprecated. Use the third argument instead.\n                createEl(type, properties, attributes). Attempting to set "," to ","."],["Setting attributes in the second argument of createEl()\n                has been deprecated. Use the third argument instead.\n                createEl(type, properties, attributes). Attempting to set "," to ","."]);r.isReal=T;r.isEl=w;r.getEl=C;r.createEl=k;r.textContent=O;r.insertElFirst=S;r.getElData=P;r.hasElData=M;r.removeElData=A;r.hasElClass=I;r.addElClass=R;r.removeElClass=N;r.toggleElClass=D;r.setElAttributes=L;r.getElAttributes=F;r.getAttribute=B;r.setAttribute=H;r.removeAttribute=V;r.blockTextSelection=U;r.unblockTextSelection=W;r.findElPosition=z;r.getPointerPosition=X;r.isTextNode=q;r.emptyEl=$;r.normalizeContent=G;r.appendContent=K;r.insertContent=Y;var o=e(94);var i=y(o);var a=e(95);var s=y(a);var u=e(85);var l=v(u);var c=e(86);var f=y(c);var p=e(98);var h=y(p);var d=e(88);function v(e){if(e&&e.__esModule){return e}else{var t={};if(e!=null){for(var r in e){if(Object.prototype.hasOwnProperty.call(e,r))t[r]=e[r]}}t["default"]=e;return t}}function y(e){return e&&e.__esModule?e:{"default":e}}function g(e,t){e.raw=t;return e}function _(e){return typeof e==="string"&&/\S/.test(e)}function m(e){if(/\s/.test(e)){throw new Error("class has illegal whitespace characters")}}function b(e){return new RegExp("(^|\\s)"+e+"($|\\s)")}function T(){return i["default"]===s["default"].document&&typeof i["default"].createElement!=="undefined"}function w(e){return(0,d.isObject)(e)&&e.nodeType===1}function E(e){return function(t,r){if(!_(t)){return i["default"][e](null)}if(_(r)){r=i["default"].querySelector(r)}var n=w(r)?r:i["default"];return n[e]&&n[e](t)}}function C(e){if(e.indexOf("#")===0){e=e.slice(1)}return i["default"].getElementById(e)}function k(){var e=arguments.length>0&&arguments[0]!==undefined?arguments[0]:"div";var t=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};var r=arguments.length>2&&arguments[2]!==undefined?arguments[2]:{};var o=arguments[3];var a=i["default"].createElement(e);Object.getOwnPropertyNames(t).forEach(function(e){var r=t[e];if(e.indexOf("aria-")!==-1||e==="role"||e==="type"){f["default"].warn((0,h["default"])(n,e,r));a.setAttribute(e,r)}else if(e==="textContent"){O(a,r)}else{a[e]=r}});Object.getOwnPropertyNames(r).forEach(function(e){a.setAttribute(e,r[e])});if(o){K(a,o)}return a}function O(e,t){if(typeof e.textContent==="undefined"){e.innerText=t}else{e.textContent=t}return e}function S(e,t){if(t.firstChild){t.insertBefore(e,t.firstChild)}else{t.appendChild(e)}}var j={};var x="vdata"+(new Date).getTime();function P(e){var t=e[x];if(!t){t=e[x]=l.newGUID()}if(!j[t]){j[t]={}}return j[t]}function M(e){var t=e[x];if(!t){return false}return!!Object.getOwnPropertyNames(j[t]).length}function A(e){var t=e[x];if(!t){return}delete j[t];try{delete e[x]}catch(r){if(e.removeAttribute){e.removeAttribute(x)}else{e[x]=null}}}function I(e,t){m(t);if(e.classList){return e.classList.contains(t)}return b(t).test(e.className)}function R(e,t){if(e.classList){e.classList.add(t)}else if(!I(e,t)){e.className=(e.className+" "+t).trim()}return e}function N(e,t){if(e.classList){e.classList.remove(t)}else{m(t);e.className=e.className.split(/\s+/).filter(function(e){return e!==t}).join(" ")}return e}function D(e,t,r){var n=I(e,t);if(typeof r==="function"){r=r(e,t)}if(typeof r!=="boolean"){r=!n}if(r===n){return}if(r){R(e,t)}else{N(e,t)}return e}function L(e,t){Object.getOwnPropertyNames(t).forEach(function(r){var n=t[r];if(n===null||typeof n==="undefined"||n===false){e.removeAttribute(r)}else{e.setAttribute(r,n===true?"":n)}})}function F(e){var t={};var r=","+"autoplay,controls,loop,muted,default"+",";if(e&&e.attributes&&e.attributes.length>0){var n=e.attributes;for(var o=n.length-1;o>=0;o--){var i=n[o].name;var a=n[o].value;if(typeof e[i]==="boolean"||r.indexOf(","+i+",")!==-1){a=a!==null?true:false}t[i]=a}}return t}function B(e,t){return e.getAttribute(t)}function H(e,t,r){e.setAttribute(t,r)}function V(e,t){e.removeAttribute(t)}function U(){i["default"].body.focus();i["default"].onselectstart=function(){return false}}function W(){i["default"].onselectstart=function(){return true}}function z(e){var t=void 0;if(e.getBoundingClientRect&&e.parentNode){t=e.getBoundingClientRect()}if(!t){return{left:0,top:0}}var r=i["default"].documentElement;var n=i["default"].body;var o=r.clientLeft||n.clientLeft||0;var a=s["default"].pageXOffset||n.scrollLeft;var u=t.left+a-o;var l=r.clientTop||n.clientTop||0;var c=s["default"].pageYOffset||n.scrollTop;var f=t.top+c-l;return{left:Math.round(u),top:Math.round(f)}}function X(e,t){var r={};var n=z(e);var o=e.offsetWidth;var i=e.offsetHeight;var a=n.top;var s=n.left;var u=t.pageY;var l=t.pageX;if(t.changedTouches){l=t.changedTouches[0].pageX;u=t.changedTouches[0].pageY}r.y=Math.max(0,Math.min(1,(a-u+i)/i));r.x=Math.max(0,Math.min(1,(l-s)/o));return r}function q(e){return(0,d.isObject)(e)&&e.nodeType===3}function $(e){while(e.firstChild){e.removeChild(e.firstChild)}return e}function G(e){if(typeof e==="function"){e=e()}return(Array.isArray(e)?e:[e]).map(function(e){if(typeof e==="function"){e=e()}if(w(e)||q(e)){return e}if(typeof e==="string"&&/\S/.test(e)){return i["default"].createTextNode(e)}}).filter(function(e){return e})}function K(e,t){G(t).forEach(function(t){return e.appendChild(t)});return e}function Y(e,t){return K($(e),t)}var J=r.$=E("querySelector");var Q=r.$$=E("querySelectorAll")},{85:85,86:86,88:88,94:94,95:95,98:98}],82:[function(e,t,r){"use strict";r.__esModule=true;r.fixEvent=g;r.on=_;r.off=m;r.trigger=b;r.one=T;var n=e(81);var o=d(n);var i=e(85);var a=d(i);var s=e(86);var u=h(s);var l=e(95);var c=h(l);var f=e(94);var p=h(f);function h(e){return e&&e.__esModule?e:{"default":e}}function d(e){if(e&&e.__esModule){return e}else{var t={};if(e!=null){for(var r in e){if(Object.prototype.hasOwnProperty.call(e,r))t[r]=e[r]}}t["default"]=e;return t}}function v(e,t){var r=o.getElData(e);if(r.handlers[t].length===0){delete r.handlers[t];if(e.removeEventListener){e.removeEventListener(t,r.dispatcher,false)}else if(e.detachEvent){e.detachEvent("on"+t,r.dispatcher)}}if(Object.getOwnPropertyNames(r.handlers).length<=0){delete r.handlers;delete r.dispatcher;delete r.disabled}if(Object.getOwnPropertyNames(r).length===0){o.removeElData(e)}}function y(e,t,r,n){r.forEach(function(r){e(t,r,n)})}function g(e){function t(){return true}function r(){return false}if(!e||!e.isPropagationStopped){(function(){var n=e||c["default"].event;e={};for(var o in n){if(o!=="layerX"&&o!=="layerY"&&o!=="keyLocation"&&o!=="webkitMovementX"&&o!=="webkitMovementY"){if(!(o==="returnValue"&&n.preventDefault)){e[o]=n[o]}}}if(!e.target){e.target=e.srcElement||p["default"]}if(!e.relatedTarget){e.relatedTarget=e.fromElement===e.target?e.toElement:e.fromElement}e.preventDefault=function(){if(n.preventDefault){n.preventDefault()}e.returnValue=false;n.returnValue=false;e.defaultPrevented=true};e.defaultPrevented=false;e.stopPropagation=function(){if(n.stopPropagation){n.stopPropagation()}e.cancelBubble=true;n.cancelBubble=true;e.isPropagationStopped=t};e.isPropagationStopped=r;e.stopImmediatePropagation=function(){if(n.stopImmediatePropagation){n.stopImmediatePropagation()}e.isImmediatePropagationStopped=t;e.stopPropagation()};e.isImmediatePropagationStopped=r;if(e.clientX!==null&&e.clientX!==undefined){var i=p["default"].documentElement;var a=p["default"].body;e.pageX=e.clientX+(i&&i.scrollLeft||a&&a.scrollLeft||0)-(i&&i.clientLeft||a&&a.clientLeft||0);e.pageY=e.clientY+(i&&i.scrollTop||a&&a.scrollTop||0)-(i&&i.clientTop||a&&a.clientTop||0)}e.which=e.charCode||e.keyCode;if(e.button!==null&&e.button!==undefined){e.button=e.button&1?0:e.button&4?1:e.button&2?2:0}})()}return e}function _(e,t,r){if(Array.isArray(t)){return y(_,e,t,r)}var n=o.getElData(e);if(!n.handlers){n.handlers={}}if(!n.handlers[t]){n.handlers[t]=[]}if(!r.guid){r.guid=a.newGUID()}n.handlers[t].push(r);if(!n.dispatcher){n.disabled=false;n.dispatcher=function(t,r){if(n.disabled){return}t=g(t);var o=n.handlers[t.type];if(o){var i=o.slice(0);for(var a=0,s=i.length;a<s;a++){if(t.isImmediatePropagationStopped()){break}else{try{i[a].call(e,t,r)}catch(l){u["default"].error(l)}}}}}}if(n.handlers[t].length===1){if(e.addEventListener){e.addEventListener(t,n.dispatcher,false)}else if(e.attachEvent){e.attachEvent("on"+t,n.dispatcher)}}}function m(e,t,r){if(!o.hasElData(e)){return}var n=o.getElData(e);if(!n.handlers){return}if(Array.isArray(t)){return y(m,e,t,r)}var i=function l(t){n.handlers[t]=[];v(e,t)};if(!t){for(var a in n.handlers){i(a)}return}var s=n.handlers[t];if(!s){return}if(!r){i(t);return}if(r.guid){for(var u=0;u<s.length;u++){if(s[u].guid===r.guid){s.splice(u--,1)}}}v(e,t)}function b(e,t,r){var n=o.hasElData(e)?o.getElData(e):{};var i=e.parentNode||e.ownerDocument;if(typeof t==="string"){t={type:t,target:e}}t=g(t);if(n.dispatcher){n.dispatcher.call(e,t,r)}if(i&&!t.isPropagationStopped()&&t.bubbles===true){b.call(null,i,t,r)}else if(!i&&!t.defaultPrevented){var a=o.getElData(t.target);if(t.target[t.type]){a.disabled=true;if(typeof t.target[t.type]==="function"){t.target[t.type]()}a.disabled=false}}return!t.defaultPrevented}function T(e,t,r){if(Array.isArray(t)){return y(T,e,t,r)}var n=function o(){m(e,t,o);r.apply(this,arguments)};n.guid=r.guid=r.guid||a.newGUID();_(e,t,n)}},{81:81,85:85,86:86,94:94,95:95}],83:[function(e,t,r){"use strict";r.__esModule=true;r.throttle=r.bind=undefined;var n=e(85);var o=r.bind=function a(e,t,r){if(!t.guid){t.guid=(0,n.newGUID)()}var o=function i(){return t.apply(e,arguments)};o.guid=r?r+"_"+t.guid:t.guid;return o};var i=r.throttle=function s(e,t){var r=Date.now();var n=function o(){var n=Date.now();if(n-r>=t){e.apply(undefined,arguments);r=n}};return n}},{85:85}],84:[function(e,t,r){"use strict";r.__esModule=true;function n(e){var t=arguments.length>1&&arguments[1]!==undefined?arguments[1]:e;e=e<0?0:e;var r=Math.floor(e%60);var n=Math.floor(e/60%60);var o=Math.floor(e/3600);var i=Math.floor(t/60%60);var a=Math.floor(t/3600);if(isNaN(e)||e===Infinity){o=n=r="-"}o=o>0||a>0?o+":":"";n=((o||i>=10)&&n<10?"0"+n:n)+":";r=r<10?"0"+r:r;return o+n+r}r["default"]=n},{}],85:[function(e,t,r){"use strict";r.__esModule=true;r.newGUID=o;var n=1;function o(){return n++}},{}],86:[function(e,t,r){"use strict";r.__esModule=true;r.logByType=undefined;var n=e(95);var o=s(n);var i=e(78);var a=e(88);function s(e){return e&&e.__esModule?e:{"default":e}}var u=void 0;var l=r.logByType=function c(e,t){var r=arguments.length>2&&arguments[2]!==undefined?arguments[2]:!!i.IE_VERSION&&i.IE_VERSION<11;if(e!=="log"){t.unshift(e.toUpperCase()+":")}u.history.push(t);t.unshift("VIDEOJS:");var n=o["default"].console&&o["default"].console[e];if(!n){return}if(r){t=t.map(function(e){if((0,a.isObject)(e)||Array.isArray(e)){try{return JSON.stringify(e)}catch(t){return String(e)}}return String(e)}).join(" ")}if(!n.apply){n(t)}else{n[Array.isArray(t)?"apply":"call"](o["default"].console,t)}
};u=function f(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++){t[r]=arguments[r]}l("log",t)};u.history=[];u.error=function(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++){t[r]=arguments[r]}return l("error",t)};u.warn=function(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++){t[r]=arguments[r]}return l("warn",t)};r["default"]=u},{78:78,88:88,95:95}],87:[function(e,t,r){"use strict";r.__esModule=true;r["default"]=o;var n=e(88);function o(){var e={};for(var t=arguments.length,r=Array(t),i=0;i<t;i++){r[i]=arguments[i]}r.forEach(function(t){if(!t){return}(0,n.each)(t,function(t,r){if(!(0,n.isPlain)(t)){e[r]=t;return}if(!(0,n.isPlain)(e[r])){e[r]={}}e[r]=o(e[r],t)})});return e}},{88:88}],88:[function(e,t,r){"use strict";r.__esModule=true;var n=typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol==="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};r.each=i;r.reduce=a;r.assign=s;r.isObject=u;r.isPlain=l;var o=Object.prototype.toString;function i(e,t){Object.keys(e).forEach(function(r){return t(e[r],r)})}function a(e,t){var r=arguments.length>2&&arguments[2]!==undefined?arguments[2]:0;return Object.keys(e).reduce(function(r,n){return t(r,e[n],n)},r)}function s(e){for(var t=arguments.length,r=Array(t>1?t-1:0),n=1;n<t;n++){r[n-1]=arguments[n]}if(Object.assign){return Object.assign.apply(Object,[e].concat(r))}r.forEach(function(t){if(!t){return}i(t,function(t,r){e[r]=t})});return e}function u(e){return!!e&&(typeof e==="undefined"?"undefined":n(e))==="object"}function l(e){return u(e)&&o.call(e)==="[object Object]"&&e.constructor===Object}},{}],89:[function(e,t,r){"use strict";r.__esModule=true;r.setTextContent=r.createStyleElement=undefined;var n=e(94);var o=i(n);function i(e){return e&&e.__esModule?e:{"default":e}}var a=r.createStyleElement=function u(e){var t=o["default"].createElement("style");t.className=e;return t};var s=r.setTextContent=function l(e,t){if(e.styleSheet){e.styleSheet.cssText=t}else{e.textContent=t}}},{94:94}],90:[function(e,t,r){"use strict";r.__esModule=true;r.createTimeRange=undefined;r.createTimeRanges=l;var n=e(86);var o=i(n);function i(e){return e&&e.__esModule?e:{"default":e}}function a(e,t,r){if(t<0||t>r){throw new Error("Failed to execute '"+e+"' on 'TimeRanges': The index provided ("+t+") is greater than or equal to the maximum bound ("+r+").")}}function s(e,t,r,n){if(n===undefined){o["default"].warn("DEPRECATED: Function '"+e+"' on 'TimeRanges' called without an index argument.");n=0}a(e,n,r.length-1);return r[n][t]}function u(e){if(e===undefined||e.length===0){return{length:0,start:function t(){throw new Error("This TimeRanges object is empty")},end:function r(){throw new Error("This TimeRanges object is empty")}}}return{length:e.length,start:s.bind(null,"start",0,e),end:s.bind(null,"end",1,e)}}function l(e,t){if(Array.isArray(e)){return u(e)}else if(e===undefined||t===undefined){return u()}return u([[e,t]])}r.createTimeRange=l},{86:86}],91:[function(e,t,r){"use strict";r.__esModule=true;function n(e){if(typeof e!=="string"){return e}return e.charAt(0).toUpperCase()+e.slice(1)}r["default"]=n},{}],92:[function(e,t,r){"use strict";r.__esModule=true;r.isCrossOrigin=r.getFileExtension=r.getAbsoluteURL=r.parseUrl=undefined;var n=e(94);var o=s(n);var i=e(95);var a=s(i);function s(e){return e&&e.__esModule?e:{"default":e}}var u=r.parseUrl=function p(e){var t=["protocol","hostname","port","pathname","search","hash","host"];var r=o["default"].createElement("a");r.href=e;var n=r.host===""&&r.protocol!=="file:";var i=void 0;if(n){i=o["default"].createElement("div");i.innerHTML='<a href="'+e+'"></a>';r=i.firstChild;i.setAttribute("style","display:none; position:absolute;");o["default"].body.appendChild(i)}var a={};for(var s=0;s<t.length;s++){a[t[s]]=r[t[s]]}if(a.protocol==="http:"){a.host=a.host.replace(/:80$/,"")}if(a.protocol==="https:"){a.host=a.host.replace(/:443$/,"")}if(n){o["default"].body.removeChild(i)}return a};var l=r.getAbsoluteURL=function h(e){if(!e.match(/^https?:\/\//)){var t=o["default"].createElement("div");t.innerHTML='<a href="'+e+'">x</a>';e=t.firstChild.href}return e};var c=r.getFileExtension=function d(e){if(typeof e==="string"){var t=/^(\/?)([\s\S]*?)((?:\.{1,2}|[^\/]+?)(\.([^\.\/\?]+)))(?:[\/]*|[\?].*)$/i;var r=t.exec(e);if(r){return r.pop().toLowerCase()}}return""};var f=r.isCrossOrigin=function v(e){var t=a["default"].location;var r=u(e);var n=r.protocol===":"?t.protocol:r.protocol;var o=n+r.host!==t.protocol+t.host;return o}},{94:94,95:95}],93:[function(t,r,n){"use strict";n.__esModule=true;var o=typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol==="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};var i=t(95);var a=ee(i);var s=t(94);var u=ee(s);var l=t(56);var c=Z(l);var f=t(89);var p=Z(f);var h=t(5);var d=ee(h);var v=t(42);var y=ee(v);var g=t(82);var _=Z(g);var m=t(51);var b=ee(m);var T=t(52);var w=ee(T);var E=t(87);var C=ee(E);var k=t(83);var O=Z(k);var S=t(72);var j=ee(S);var x=t(64);var P=ee(x);var M=t(77);var A=ee(M);var I=t(90);var R=t(84);var N=ee(R);var D=t(86);var L=ee(D);var F=t(81);var B=Z(F);var H=t(78);var V=Z(H);var U=t(92);var W=Z(U);var z=t(88);var X=t(80);var q=ee(X);var $=t(43);var G=ee($);var K=t(105);var Y=ee(K);var J=t(62);var Q=ee(J);function Z(e){if(e&&e.__esModule){return e}else{var t={};if(e!=null){for(var r in e){if(Object.prototype.hasOwnProperty.call(e,r))t[r]=e[r]}}t["default"]=e;return t}}function ee(e){return e&&e.__esModule?e:{"default":e}}if(typeof HTMLVideoElement==="undefined"&&B.isReal()){u["default"].createElement("video");u["default"].createElement("audio");u["default"].createElement("track")}function te(e,t,r){var n=void 0;if(typeof e==="string"){if(e.indexOf("#")===0){e=e.slice(1)}if(te.getPlayers()[e]){if(t){L["default"].warn('Player "'+e+'" is already initialised. Options will not be applied.')}if(r){te.getPlayers()[e].ready(r)}return te.getPlayers()[e]}n=B.getEl(e)}else{n=e}if(!n||!n.nodeName){throw new TypeError("The element or ID supplied is not valid. (videojs)")}if(n.player||b["default"].players[n.playerId]){return n.player||b["default"].players[n.playerId]}t=t||{};te.hooks("beforesetup").forEach(function(e){var r=e(n,(0,C["default"])(t));if(!(0,z.isObject)(r)||Array.isArray(r)){L["default"].error("please return an object in beforesetup hooks");return}t=(0,C["default"])(t,r)});var o=d["default"].getComponent("Player");var i=new o(n,t,r);te.hooks("setup").forEach(function(e){return e(i)});return i}te.hooks_={};te.hooks=function(e,t){te.hooks_[e]=te.hooks_[e]||[];if(t){te.hooks_[e]=te.hooks_[e].concat(t)}return te.hooks_[e]};te.hook=function(e,t){te.hooks(e,t)};te.removeHook=function(e,t){var r=te.hooks(e).indexOf(t);if(r<=-1){return false}te.hooks_[e]=te.hooks_[e].slice();te.hooks_[e].splice(r,1);return true};c.autoSetupTimeout(1,te);te.VERSION="5.16.0";te.options=b["default"].prototype.options_;te.getPlayers=function(){return b["default"].players};te.players=b["default"].players;te.getComponent=d["default"].getComponent;te.registerComponent=function(e,t){if(Q["default"].isTech(t)){L["default"].warn("The "+e+" tech was registered as a component. It should instead be registered using videojs.registerTech(name, tech)")}d["default"].registerComponent.call(d["default"],e,t)};te.getTech=Q["default"].getTech;te.registerTech=Q["default"].registerTech;te.browser=V;te.TOUCH_ENABLED=V.TOUCH_ENABLED;te.extend=G["default"];te.mergeOptions=C["default"];te.bind=O.bind;te.plugin=w["default"];te.addLanguage=function(e,t){var r;e=(""+e).toLowerCase();te.options.languages=(0,C["default"])(te.options.languages,(r={},r[e]=t,r));return te.options.languages[e]};te.log=L["default"];te.createTimeRange=te.createTimeRanges=I.createTimeRanges;te.formatTime=N["default"];te.parseUrl=W.parseUrl;te.isCrossOrigin=W.isCrossOrigin;te.EventTarget=y["default"];te.on=_.on;te.one=_.one;te.off=_.off;te.trigger=_.trigger;te.xhr=Y["default"];te.TextTrack=j["default"];te.AudioTrack=P["default"];te.VideoTrack=A["default"];te.isEl=B.isEl;te.isTextNode=B.isTextNode;te.createEl=B.createEl;te.hasClass=B.hasElClass;te.addClass=B.addElClass;te.removeClass=B.removeElClass;te.toggleClass=B.toggleElClass;te.setAttributes=B.setElAttributes;te.getAttributes=B.getElAttributes;te.emptyEl=B.emptyEl;te.appendContent=B.appendContent;te.insertContent=B.insertContent;te.computedStyle=q["default"];if(typeof e==="function"&&e.amd){e("videojs",[],function(){return te})}else if((typeof n==="undefined"?"undefined":o(n))==="object"&&(typeof r==="undefined"?"undefined":o(r))==="object"){r.exports=te}n["default"]=te},{105:105,42:42,43:43,5:5,51:51,52:52,56:56,62:62,64:64,72:72,77:77,78:78,80:80,81:81,82:82,83:83,84:84,86:86,87:87,88:88,89:89,90:90,92:92,94:94,95:95}],94:[function(e,t,r){(function(r){var n=typeof r!=="undefined"?r:typeof window!=="undefined"?window:{};var o=e(96);if(typeof document!=="undefined"){t.exports=document}else{var i=n["__GLOBAL_DOCUMENT_CACHE@4"];if(!i){i=n["__GLOBAL_DOCUMENT_CACHE@4"]=o}t.exports=i}}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{96:96}],95:[function(e,t,r){(function(e){if(typeof window!=="undefined"){t.exports=window}else if(typeof e!=="undefined"){t.exports=e}else if(typeof self!=="undefined"){t.exports=self}else{t.exports={}}}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{}],96:[function(e,t,r){},{}],97:[function(e,t,r){t.exports=n;function n(e,t){var r;var n=null;try{r=JSON.parse(e,t)}catch(o){n=o}return[n,r]}},{}],98:[function(e,t,r){function n(e){return e.replace(/\n\r?\s*/g,"")}t.exports=function o(e){var t="",r=0;for(;r<arguments.length;r++)t+=n(e[r])+(arguments[r+1]||"");return t}},{}],99:[function(e,t,r){t.exports={WebVTT:e(100).WebVTT,VTTCue:e(101).VTTCue,VTTRegion:e(103).VTTRegion}},{100:100,101:101,103:103}],100:[function(e,t,r){(function(e){var t=Object.create||function(){function e(){}return function(t){if(arguments.length!==1){throw new Error("Object.create shim only accepts one parameter.")}e.prototype=t;return new e}}();function r(e,t){this.name="ParsingError";this.code=e.code;this.message=t||e.message}r.prototype=t(Error.prototype);r.prototype.constructor=r;r.Errors={BadSignature:{code:0,message:"Malformed WebVTT signature."},BadTimeStamp:{code:1,message:"Malformed time stamp."}};function n(e){function t(e,t,r,n){return(e|0)*3600+(t|0)*60+(r|0)+(n|0)/1e3}var r=e.match(/^(\d+):(\d{2})(:\d{2})?\.(\d{3})/);if(!r){return null}if(r[3]){return t(r[1],r[2],r[3].replace(":",""),r[4])}else if(r[1]>59){return t(r[1],r[2],0,r[4])}else{return t(0,r[1],r[2],r[4])}}function o(){this.values=t(null)}o.prototype={set:function(e,t){if(!this.get(e)&&t!==""){this.values[e]=t}},get:function(e,t,r){if(r){return this.has(e)?this.values[e]:t[r]}return this.has(e)?this.values[e]:t},has:function(e){return e in this.values},alt:function(e,t,r){for(var n=0;n<r.length;++n){if(t===r[n]){this.set(e,t);break}}},integer:function(e,t){if(/^-?\d+$/.test(t)){this.set(e,parseInt(t,10))}},percent:function(e,t){var r;if(r=t.match(/^([\d]{1,3})(\.[\d]*)?%$/)){t=parseFloat(t);if(t>=0&&t<=100){this.set(e,t);return true}}return false}};function i(e,t,r,n){var o=n?e.split(n):[e];for(var i in o){if(typeof o[i]!=="string"){continue}var a=o[i].split(r);if(a.length!==2){continue}var s=a[0];var u=a[1];t(s,u)}}function a(e,t,a){var s=e;function u(){var t=n(e);if(t===null){throw new r(r.Errors.BadTimeStamp,"Malformed timestamp: "+s)}e=e.replace(/^[^\sa-zA-Z-]+/,"");return t}function l(e,t){var r=new o;i(e,function(e,t){switch(e){case"region":for(var n=a.length-1;n>=0;n--){if(a[n].id===t){r.set(e,a[n].region);break}}break;case"vertical":r.alt(e,t,["rl","lr"]);break;case"line":var o=t.split(","),i=o[0];r.integer(e,i);r.percent(e,i)?r.set("snapToLines",false):null;r.alt(e,i,["auto"]);if(o.length===2){r.alt("lineAlign",o[1],["start","middle","end"])}break;case"position":o=t.split(",");r.percent(e,o[0]);if(o.length===2){r.alt("positionAlign",o[1],["start","middle","end"])}break;case"size":r.percent(e,t);break;case"align":r.alt(e,t,["start","middle","end","left","right"]);break}},/:/,/\s/);t.region=r.get("region",null);t.vertical=r.get("vertical","");t.line=r.get("line","auto");t.lineAlign=r.get("lineAlign","start");t.snapToLines=r.get("snapToLines",true);t.size=r.get("size",100);t.align=r.get("align","middle");t.position=r.get("position",{start:0,left:0,middle:50,end:100,right:100},t.align);t.positionAlign=r.get("positionAlign",{start:"start",left:"start",middle:"middle",end:"end",right:"end"},t.align)}function c(){e=e.replace(/^\s+/,"")}c();t.startTime=u();c();if(e.substr(0,3)!=="-->"){throw new r(r.Errors.BadTimeStamp,"Malformed time stamp (time stamps must be separated by '-->'): "+s)}e=e.substr(3);c();t.endTime=u();c();l(e,t)}var s={"&amp;":"&","&lt;":"<","&gt;":">","&lrm;":"","&rlm;":"","&nbsp;":"\u00a0"};var u={c:"span",i:"i",b:"b",u:"u",ruby:"ruby",rt:"rt",v:"span",lang:"span"};var l={v:"title",lang:"lang"};var c={rt:"ruby"};function f(e,t){function r(){if(!t){return null}function e(e){t=t.substr(e.length);return e}var r=t.match(/^([^<]*)(<[^>]+>?)?/);return e(r[1]?r[1]:r[2])}function o(e){return s[e]}function i(e){while(_=e.match(/&(amp|lt|gt|lrm|rlm|nbsp);/)){e=e.replace(_[0],o)}return e}function a(e,t){return!c[t.localName]||c[t.localName]===e.localName}function f(t,r){var n=u[t];if(!n){return null}var o=e.document.createElement(n);o.localName=n;var i=l[t];if(i&&r){o[i]=r.trim()}return o}var p=e.document.createElement("div"),h=p,d,v=[];while((d=r())!==null){if(d[0]==="<"){if(d[1]==="/"){if(v.length&&v[v.length-1]===d.substr(2).replace(">","")){v.pop();h=h.parentNode}continue}var y=n(d.substr(1,d.length-2));var g;if(y){g=e.document.createProcessingInstruction("timestamp",y);h.appendChild(g);continue}var _=d.match(/^<([^.\s/0-9>]+)(\.[^\s\\>]+)?([^>\\]+)?(\\?)>?$/);if(!_){continue}g=f(_[1],_[3]);if(!g){continue}if(!a(h,g)){continue}if(_[2]){g.className=_[2].substr(1).replace("."," ")}v.push(_[1]);h.appendChild(g);h=g;continue}h.appendChild(e.document.createTextNode(i(d)))}return p}var p=[1470,1472,1475,1478,1488,1489,1490,1491,1492,1493,1494,1495,1496,1497,1498,1499,1500,1501,1502,1503,1504,1505,1506,1507,1508,1509,1510,1511,1512,1513,1514,1520,1521,1522,1523,1524,1544,1547,1549,1563,1566,1567,1568,1569,1570,1571,1572,1573,1574,1575,1576,1577,1578,1579,1580,1581,1582,1583,1584,1585,1586,1587,1588,1589,1590,1591,1592,1593,1594,1595,1596,1597,1598,1599,1600,1601,1602,1603,1604,1605,1606,1607,1608,1609,1610,1645,1646,1647,1649,1650,1651,1652,1653,1654,1655,1656,1657,1658,1659,1660,1661,1662,1663,1664,1665,1666,1667,1668,1669,1670,1671,1672,1673,1674,1675,1676,1677,1678,1679,1680,1681,1682,1683,1684,1685,1686,1687,1688,1689,1690,1691,1692,1693,1694,1695,1696,1697,1698,1699,1700,1701,1702,1703,1704,1705,1706,1707,1708,1709,1710,1711,1712,1713,1714,1715,1716,1717,1718,1719,1720,1721,1722,1723,1724,1725,1726,1727,1728,1729,1730,1731,1732,1733,1734,1735,1736,1737,1738,1739,1740,1741,1742,1743,1744,1745,1746,1747,1748,1749,1765,1766,1774,1775,1786,1787,1788,1789,1790,1791,1792,1793,1794,1795,1796,1797,1798,1799,1800,1801,1802,1803,1804,1805,1807,1808,1810,1811,1812,1813,1814,1815,1816,1817,1818,1819,1820,1821,1822,1823,1824,1825,1826,1827,1828,1829,1830,1831,1832,1833,1834,1835,1836,1837,1838,1839,1869,1870,1871,1872,1873,1874,1875,1876,1877,1878,1879,1880,1881,1882,1883,1884,1885,1886,1887,1888,1889,1890,1891,1892,1893,1894,1895,1896,1897,1898,1899,1900,1901,1902,1903,1904,1905,1906,1907,1908,1909,1910,1911,1912,1913,1914,1915,1916,1917,1918,1919,1920,1921,1922,1923,1924,1925,1926,1927,1928,1929,1930,1931,1932,1933,1934,1935,1936,1937,1938,1939,1940,1941,1942,1943,1944,1945,1946,1947,1948,1949,1950,1951,1952,1953,1954,1955,1956,1957,1969,1984,1985,1986,1987,1988,1989,1990,1991,1992,1993,1994,1995,1996,1997,1998,1999,2e3,2001,2002,2003,2004,2005,2006,2007,2008,2009,2010,2011,2012,2013,2014,2015,2016,2017,2018,2019,2020,2021,2022,2023,2024,2025,2026,2036,2037,2042,2048,2049,2050,2051,2052,2053,2054,2055,2056,2057,2058,2059,2060,2061,2062,2063,2064,2065,2066,2067,2068,2069,2074,2084,2088,2096,2097,2098,2099,2100,2101,2102,2103,2104,2105,2106,2107,2108,2109,2110,2112,2113,2114,2115,2116,2117,2118,2119,2120,2121,2122,2123,2124,2125,2126,2127,2128,2129,2130,2131,2132,2133,2134,2135,2136,2142,2208,2210,2211,2212,2213,2214,2215,2216,2217,2218,2219,2220,8207,64285,64287,64288,64289,64290,64291,64292,64293,64294,64295,64296,64298,64299,64300,64301,64302,64303,64304,64305,64306,64307,64308,64309,64310,64312,64313,64314,64315,64316,64318,64320,64321,64323,64324,64326,64327,64328,64329,64330,64331,64332,64333,64334,64335,64336,64337,64338,64339,64340,64341,64342,64343,64344,64345,64346,64347,64348,64349,64350,64351,64352,64353,64354,64355,64356,64357,64358,64359,64360,64361,64362,64363,64364,64365,64366,64367,64368,64369,64370,64371,64372,64373,64374,64375,64376,64377,64378,64379,64380,64381,64382,64383,64384,64385,64386,64387,64388,64389,64390,64391,64392,64393,64394,64395,64396,64397,64398,64399,64400,64401,64402,64403,64404,64405,64406,64407,64408,64409,64410,64411,64412,64413,64414,64415,64416,64417,64418,64419,64420,64421,64422,64423,64424,64425,64426,64427,64428,64429,64430,64431,64432,64433,64434,64435,64436,64437,64438,64439,64440,64441,64442,64443,64444,64445,64446,64447,64448,64449,64467,64468,64469,64470,64471,64472,64473,64474,64475,64476,64477,64478,64479,64480,64481,64482,64483,64484,64485,64486,64487,64488,64489,64490,64491,64492,64493,64494,64495,64496,64497,64498,64499,64500,64501,64502,64503,64504,64505,64506,64507,64508,64509,64510,64511,64512,64513,64514,64515,64516,64517,64518,64519,64520,64521,64522,64523,64524,64525,64526,64527,64528,64529,64530,64531,64532,64533,64534,64535,64536,64537,64538,64539,64540,64541,64542,64543,64544,64545,64546,64547,64548,64549,64550,64551,64552,64553,64554,64555,64556,64557,64558,64559,64560,64561,64562,64563,64564,64565,64566,64567,64568,64569,64570,64571,64572,64573,64574,64575,64576,64577,64578,64579,64580,64581,64582,64583,64584,64585,64586,64587,64588,64589,64590,64591,64592,64593,64594,64595,64596,64597,64598,64599,64600,64601,64602,64603,64604,64605,64606,64607,64608,64609,64610,64611,64612,64613,64614,64615,64616,64617,64618,64619,64620,64621,64622,64623,64624,64625,64626,64627,64628,64629,64630,64631,64632,64633,64634,64635,64636,64637,64638,64639,64640,64641,64642,64643,64644,64645,64646,64647,64648,64649,64650,64651,64652,64653,64654,64655,64656,64657,64658,64659,64660,64661,64662,64663,64664,64665,64666,64667,64668,64669,64670,64671,64672,64673,64674,64675,64676,64677,64678,64679,64680,64681,64682,64683,64684,64685,64686,64687,64688,64689,64690,64691,64692,64693,64694,64695,64696,64697,64698,64699,64700,64701,64702,64703,64704,64705,64706,64707,64708,64709,64710,64711,64712,64713,64714,64715,64716,64717,64718,64719,64720,64721,64722,64723,64724,64725,64726,64727,64728,64729,64730,64731,64732,64733,64734,64735,64736,64737,64738,64739,64740,64741,64742,64743,64744,64745,64746,64747,64748,64749,64750,64751,64752,64753,64754,64755,64756,64757,64758,64759,64760,64761,64762,64763,64764,64765,64766,64767,64768,64769,64770,64771,64772,64773,64774,64775,64776,64777,64778,64779,64780,64781,64782,64783,64784,64785,64786,64787,64788,64789,64790,64791,64792,64793,64794,64795,64796,64797,64798,64799,64800,64801,64802,64803,64804,64805,64806,64807,64808,64809,64810,64811,64812,64813,64814,64815,64816,64817,64818,64819,64820,64821,64822,64823,64824,64825,64826,64827,64828,64829,64848,64849,64850,64851,64852,64853,64854,64855,64856,64857,64858,64859,64860,64861,64862,64863,64864,64865,64866,64867,64868,64869,64870,64871,64872,64873,64874,64875,64876,64877,64878,64879,64880,64881,64882,64883,64884,64885,64886,64887,64888,64889,64890,64891,64892,64893,64894,64895,64896,64897,64898,64899,64900,64901,64902,64903,64904,64905,64906,64907,64908,64909,64910,64911,64914,64915,64916,64917,64918,64919,64920,64921,64922,64923,64924,64925,64926,64927,64928,64929,64930,64931,64932,64933,64934,64935,64936,64937,64938,64939,64940,64941,64942,64943,64944,64945,64946,64947,64948,64949,64950,64951,64952,64953,64954,64955,64956,64957,64958,64959,64960,64961,64962,64963,64964,64965,64966,64967,65008,65009,65010,65011,65012,65013,65014,65015,65016,65017,65018,65019,65020,65136,65137,65138,65139,65140,65142,65143,65144,65145,65146,65147,65148,65149,65150,65151,65152,65153,65154,65155,65156,65157,65158,65159,65160,65161,65162,65163,65164,65165,65166,65167,65168,65169,65170,65171,65172,65173,65174,65175,65176,65177,65178,65179,65180,65181,65182,65183,65184,65185,65186,65187,65188,65189,65190,65191,65192,65193,65194,65195,65196,65197,65198,65199,65200,65201,65202,65203,65204,65205,65206,65207,65208,65209,65210,65211,65212,65213,65214,65215,65216,65217,65218,65219,65220,65221,65222,65223,65224,65225,65226,65227,65228,65229,65230,65231,65232,65233,65234,65235,65236,65237,65238,65239,65240,65241,65242,65243,65244,65245,65246,65247,65248,65249,65250,65251,65252,65253,65254,65255,65256,65257,65258,65259,65260,65261,65262,65263,65264,65265,65266,65267,65268,65269,65270,65271,65272,65273,65274,65275,65276,67584,67585,67586,67587,67588,67589,67592,67594,67595,67596,67597,67598,67599,67600,67601,67602,67603,67604,67605,67606,67607,67608,67609,67610,67611,67612,67613,67614,67615,67616,67617,67618,67619,67620,67621,67622,67623,67624,67625,67626,67627,67628,67629,67630,67631,67632,67633,67634,67635,67636,67637,67639,67640,67644,67647,67648,67649,67650,67651,67652,67653,67654,67655,67656,67657,67658,67659,67660,67661,67662,67663,67664,67665,67666,67667,67668,67669,67671,67672,67673,67674,67675,67676,67677,67678,67679,67840,67841,67842,67843,67844,67845,67846,67847,67848,67849,67850,67851,67852,67853,67854,67855,67856,67857,67858,67859,67860,67861,67862,67863,67864,67865,67866,67867,67872,67873,67874,67875,67876,67877,67878,67879,67880,67881,67882,67883,67884,67885,67886,67887,67888,67889,67890,67891,67892,67893,67894,67895,67896,67897,67903,67968,67969,67970,67971,67972,67973,67974,67975,67976,67977,67978,67979,67980,67981,67982,67983,67984,67985,67986,67987,67988,67989,67990,67991,67992,67993,67994,67995,67996,67997,67998,67999,68e3,68001,68002,68003,68004,68005,68006,68007,68008,68009,68010,68011,68012,68013,68014,68015,68016,68017,68018,68019,68020,68021,68022,68023,68030,68031,68096,68112,68113,68114,68115,68117,68118,68119,68121,68122,68123,68124,68125,68126,68127,68128,68129,68130,68131,68132,68133,68134,68135,68136,68137,68138,68139,68140,68141,68142,68143,68144,68145,68146,68147,68160,68161,68162,68163,68164,68165,68166,68167,68176,68177,68178,68179,68180,68181,68182,68183,68184,68192,68193,68194,68195,68196,68197,68198,68199,68200,68201,68202,68203,68204,68205,68206,68207,68208,68209,68210,68211,68212,68213,68214,68215,68216,68217,68218,68219,68220,68221,68222,68223,68352,68353,68354,68355,68356,68357,68358,68359,68360,68361,68362,68363,68364,68365,68366,68367,68368,68369,68370,68371,68372,68373,68374,68375,68376,68377,68378,68379,68380,68381,68382,68383,68384,68385,68386,68387,68388,68389,68390,68391,68392,68393,68394,68395,68396,68397,68398,68399,68400,68401,68402,68403,68404,68405,68416,68417,68418,68419,68420,68421,68422,68423,68424,68425,68426,68427,68428,68429,68430,68431,68432,68433,68434,68435,68436,68437,68440,68441,68442,68443,68444,68445,68446,68447,68448,68449,68450,68451,68452,68453,68454,68455,68456,68457,68458,68459,68460,68461,68462,68463,68464,68465,68466,68472,68473,68474,68475,68476,68477,68478,68479,68608,68609,68610,68611,68612,68613,68614,68615,68616,68617,68618,68619,68620,68621,68622,68623,68624,68625,68626,68627,68628,68629,68630,68631,68632,68633,68634,68635,68636,68637,68638,68639,68640,68641,68642,68643,68644,68645,68646,68647,68648,68649,68650,68651,68652,68653,68654,68655,68656,68657,68658,68659,68660,68661,68662,68663,68664,68665,68666,68667,68668,68669,68670,68671,68672,68673,68674,68675,68676,68677,68678,68679,68680,126464,126465,126466,126467,126469,126470,126471,126472,126473,126474,126475,126476,126477,126478,126479,126480,126481,126482,126483,126484,126485,126486,126487,126488,126489,126490,126491,126492,126493,126494,126495,126497,126498,126500,126503,126505,126506,126507,126508,126509,126510,126511,126512,126513,126514,126516,126517,126518,126519,126521,126523,126530,126535,126537,126539,126541,126542,126543,126545,126546,126548,126551,126553,126555,126557,126559,126561,126562,126564,126567,126568,126569,126570,126572,126573,126574,126575,126576,126577,126578,126580,126581,126582,126583,126585,126586,126587,126588,126590,126592,126593,126594,126595,126596,126597,126598,126599,126600,126601,126603,126604,126605,126606,126607,126608,126609,126610,126611,126612,126613,126614,126615,126616,126617,126618,126619,126625,126626,126627,126629,126630,126631,126632,126633,126635,126636,126637,126638,126639,126640,126641,126642,126643,126644,126645,126646,126647,126648,126649,126650,126651,1114109];function h(e){var t=[],r="",n;if(!e||!e.childNodes){return"ltr"}function o(e,t){for(var r=t.childNodes.length-1;r>=0;r--){e.push(t.childNodes[r])}}function i(e){if(!e||!e.length){return null}var t=e.pop(),r=t.textContent||t.innerText;if(r){var n=r.match(/^.*(\n|\r)/);if(n){e.length=0;return n[0]}return r}if(t.tagName==="ruby"){return i(e)}if(t.childNodes){o(e,t);return i(e)}}o(t,e);while(r=i(t)){for(var a=0;a<r.length;a++){n=r.charCodeAt(a);for(var s=0;s<p.length;s++){if(p[s]===n){return"rtl"}}}}return"ltr"}function d(e){if(typeof e.line==="number"&&(e.snapToLines||e.line>=0&&e.line<=100)){return e.line}if(!e.track||!e.track.textTrackList||!e.track.textTrackList.mediaElement){return-1}var t=e.track,r=t.textTrackList,n=0;for(var o=0;o<r.length&&r[o]!==t;o++){if(r[o].mode==="showing"){n++}}return++n*-1}function v(){}v.prototype.applyStyles=function(e,t){t=t||this.div;for(var r in e){if(e.hasOwnProperty(r)){t.style[r]=e[r]}}};v.prototype.formatStyle=function(e,t){return e===0?0:e+t};function y(e,t,r){var n=/MSIE\s8\.0/.test(navigator.userAgent);var o="rgba(255, 255, 255, 1)";var i="rgba(0, 0, 0, 0.8)";if(n){o="rgb(255, 255, 255)";i="rgb(0, 0, 0)"}v.call(this);this.cue=t;this.cueDiv=f(e,t.text);var a={color:o,backgroundColor:i,position:"relative",left:0,right:0,top:0,bottom:0,display:"inline"};if(!n){a.writingMode=t.vertical===""?"horizontal-tb":t.vertical==="lr"?"vertical-lr":"vertical-rl";a.unicodeBidi="plaintext"}this.applyStyles(a,this.cueDiv);this.div=e.document.createElement("div");a={textAlign:t.align==="middle"?"center":t.align,font:r.font,whiteSpace:"pre-line",position:"absolute"};if(!n){a.direction=h(this.cueDiv);a.writingMode=t.vertical===""?"horizontal-tb":t.vertical==="lr"?"vertical-lr":"vertical-rl".stylesunicodeBidi="plaintext"}this.applyStyles(a);this.div.appendChild(this.cueDiv);var s=0;switch(t.positionAlign){case"start":s=t.position;break;case"middle":s=t.position-t.size/2;break;case"end":s=t.position-t.size;break}if(t.vertical===""){this.applyStyles({left:this.formatStyle(s,"%"),width:this.formatStyle(t.size,"%")})}else{this.applyStyles({top:this.formatStyle(s,"%"),height:this.formatStyle(t.size,"%")})}this.move=function(e){this.applyStyles({top:this.formatStyle(e.top,"px"),bottom:this.formatStyle(e.bottom,"px"),left:this.formatStyle(e.left,"px"),right:this.formatStyle(e.right,"px"),height:this.formatStyle(e.height,"px"),width:this.formatStyle(e.width,"px")})}}y.prototype=t(v.prototype);y.prototype.constructor=y;function g(e){var t=/MSIE\s8\.0/.test(navigator.userAgent);var r,n,o,i;if(e.div){n=e.div.offsetHeight;o=e.div.offsetWidth;i=e.div.offsetTop;var a=(a=e.div.childNodes)&&(a=a[0])&&a.getClientRects&&a.getClientRects();e=e.div.getBoundingClientRect();r=a?Math.max(a[0]&&a[0].height||0,e.height/a.length):0}this.left=e.left;this.right=e.right;this.top=e.top||i;this.height=e.height||n;this.bottom=e.bottom||i+(e.height||n);this.width=e.width||o;this.lineHeight=r!==undefined?r:e.lineHeight;if(t&&!this.lineHeight){this.lineHeight=13}}g.prototype.move=function(e,t){t=t!==undefined?t:this.lineHeight;switch(e){case"+x":this.left+=t;this.right+=t;break;case"-x":this.left-=t;this.right-=t;break;case"+y":this.top+=t;this.bottom+=t;break;case"-y":this.top-=t;this.bottom-=t;break}};g.prototype.overlaps=function(e){return this.left<e.right&&this.right>e.left&&this.top<e.bottom&&this.bottom>e.top};g.prototype.overlapsAny=function(e){for(var t=0;t<e.length;t++){if(this.overlaps(e[t])){return true}}return false};g.prototype.within=function(e){return this.top>=e.top&&this.bottom<=e.bottom&&this.left>=e.left&&this.right<=e.right};g.prototype.overlapsOppositeAxis=function(e,t){switch(t){case"+x":return this.left<e.left;case"-x":return this.right>e.right;case"+y":return this.top<e.top;case"-y":return this.bottom>e.bottom}};g.prototype.intersectPercentage=function(e){var t=Math.max(0,Math.min(this.right,e.right)-Math.max(this.left,e.left)),r=Math.max(0,Math.min(this.bottom,e.bottom)-Math.max(this.top,e.top)),n=t*r;return n/(this.height*this.width)};g.prototype.toCSSCompatValues=function(e){return{top:this.top-e.top,bottom:e.bottom-this.bottom,left:this.left-e.left,right:e.right-this.right,height:this.height,width:this.width}};g.getSimpleBoxPosition=function(e){var t=e.div?e.div.offsetHeight:e.tagName?e.offsetHeight:0;var r=e.div?e.div.offsetWidth:e.tagName?e.offsetWidth:0;var n=e.div?e.div.offsetTop:e.tagName?e.offsetTop:0;e=e.div?e.div.getBoundingClientRect():e.tagName?e.getBoundingClientRect():e;var o={left:e.left,right:e.right,top:e.top||n,height:e.height||t,bottom:e.bottom||n+(e.height||t),width:e.width||r};return o};function _(e,t,r,n){function o(e,t){var o,i=new g(e),a=1;for(var s=0;s<t.length;s++){while(e.overlapsOppositeAxis(r,t[s])||e.within(r)&&e.overlapsAny(n)){e.move(t[s])}if(e.within(r)){return e}var u=e.intersectPercentage(r);if(a>u){o=new g(e);a=u}e=new g(i)}return o||i}var i=new g(t),a=t.cue,s=d(a),u=[];if(a.snapToLines){var l;switch(a.vertical){case"":u=["+y","-y"];l="height";break;case"rl":u=["+x","-x"];l="width";break;case"lr":u=["-x","+x"];l="width";break}var c=i.lineHeight,f=c*Math.round(s),p=r[l]+c,h=u[0];if(Math.abs(f)>p){f=f<0?-1:1;f*=Math.ceil(p/c)*c}if(s<0){f+=a.vertical===""?r.height:r.width;u=u.reverse()}i.move(h,f)}else{var v=i.lineHeight/r.height*100;switch(a.lineAlign){case"middle":s-=v/2;break;case"end":s-=v;break}switch(a.vertical){case"":t.applyStyles({top:t.formatStyle(s,"%")});break;case"rl":t.applyStyles({left:t.formatStyle(s,"%")});break;case"lr":t.applyStyles({right:t.formatStyle(s,"%")});break}u=["+y","-x","+x","-y"];i=new g(t)}var y=o(i,u);t.move(y.toCSSCompatValues(r))}function m(){}m.StringDecoder=function(){return{decode:function(e){if(!e){return""}if(typeof e!=="string"){throw new Error("Error - expected string data.")}return decodeURIComponent(encodeURIComponent(e))}}};m.convertCueToDOMTree=function(e,t){if(!e||!t){return null}return f(e,t)};var b=.05;var T="sans-serif";var w="1.5%";m.processCues=function(e,t,r){if(!e||!t||!r){return null}while(r.firstChild){r.removeChild(r.firstChild)}var n=e.document.createElement("div");n.style.position="absolute";n.style.left="0";n.style.right="0";n.style.top="0";n.style.bottom="0";n.style.margin=w;r.appendChild(n);function o(e){for(var t=0;t<e.length;t++){if(e[t].hasBeenReset||!e[t].displayState){return true}}return false}if(!o(t)){for(var i=0;i<t.length;i++){n.appendChild(t[i].displayState)}return}var a=[],s=g.getSimpleBoxPosition(n),u=Math.round(s.height*b*100)/100;var l={font:u+"px "+T};(function(){var r,o;for(var i=0;i<t.length;i++){o=t[i];r=new y(e,o,l);n.appendChild(r.div);_(e,r,s,a);o.displayState=r.div;a.push(g.getSimpleBoxPosition(r))}})()};m.Parser=function(e,t,r){if(!r){r=t;t={}}if(!t){t={}}this.window=e;this.vttjs=t;this.state="INITIAL";this.buffer="";this.decoder=r||new TextDecoder("utf8");this.regionList=[]};m.Parser.prototype={reportOrThrowError:function(e){if(e instanceof r){this.onparsingerror&&this.onparsingerror(e);

}else{throw e}},parse:function(e){var t=this;if(e){t.buffer+=t.decoder.decode(e,{stream:true})}function n(){var e=t.buffer;var r=0;while(r<e.length&&e[r]!=="\r"&&e[r]!=="\n"){++r}var n=e.substr(0,r);if(e[r]==="\r"){++r}if(e[r]==="\n"){++r}t.buffer=e.substr(r);return n}function s(e){var r=new o;i(e,function(e,t){switch(e){case"id":r.set(e,t);break;case"width":r.percent(e,t);break;case"lines":r.integer(e,t);break;case"regionanchor":case"viewportanchor":var n=t.split(",");if(n.length!==2){break}var i=new o;i.percent("x",n[0]);i.percent("y",n[1]);if(!i.has("x")||!i.has("y")){break}r.set(e+"X",i.get("x"));r.set(e+"Y",i.get("y"));break;case"scroll":r.alt(e,t,["up"]);break}},/=/,/\s/);if(r.has("id")){var n=new(t.vttjs.VTTRegion||t.window.VTTRegion);n.width=r.get("width",100);n.lines=r.get("lines",3);n.regionAnchorX=r.get("regionanchorX",0);n.regionAnchorY=r.get("regionanchorY",100);n.viewportAnchorX=r.get("viewportanchorX",0);n.viewportAnchorY=r.get("viewportanchorY",100);n.scroll=r.get("scroll","");t.onregion&&t.onregion(n);t.regionList.push({id:r.get("id"),region:n})}}function u(e){i(e,function(e,t){switch(e){case"Region":s(t);break}},/:/)}try{var l;if(t.state==="INITIAL"){if(!/\r\n|\n/.test(t.buffer)){return this}l=n();var c=l.match(/^WEBVTT([ \t].*)?$/);if(!c||!c[0]){throw new r(r.Errors.BadSignature)}t.state="HEADER"}var f=false;while(t.buffer){if(!/\r\n|\n/.test(t.buffer)){return this}if(!f){l=n()}else{f=false}switch(t.state){case"HEADER":if(/:/.test(l)){u(l)}else if(!l){t.state="ID"}continue;case"NOTE":if(!l){t.state="ID"}continue;case"ID":if(/^NOTE($|[ \t])/.test(l)){t.state="NOTE";break}if(!l){continue}t.cue=new(t.vttjs.VTTCue||t.window.VTTCue)(0,0,"");t.state="CUE";if(l.indexOf("-->")===-1){t.cue.id=l;continue}case"CUE":try{a(l,t.cue,t.regionList)}catch(p){t.reportOrThrowError(p);t.cue=null;t.state="BADCUE";continue}t.state="CUETEXT";continue;case"CUETEXT":var h=l.indexOf("-->")!==-1;if(!l||h&&(f=true)){t.oncue&&t.oncue(t.cue);t.cue=null;t.state="ID";continue}if(t.cue.text){t.cue.text+="\n"}t.cue.text+=l;continue;case"BADCUE":if(!l){t.state="ID"}continue}}}catch(p){t.reportOrThrowError(p);if(t.state==="CUETEXT"&&t.cue&&t.oncue){t.oncue(t.cue)}t.cue=null;t.state=t.state==="INITIAL"?"BADWEBVTT":"BADCUE"}return this},flush:function(){var e=this;try{e.buffer+=e.decoder.decode();if(e.cue||e.state==="HEADER"){e.buffer+="\n\n";e.parse()}if(e.state==="INITIAL"){throw new r(r.Errors.BadSignature)}}catch(t){e.reportOrThrowError(t)}e.onflush&&e.onflush();return this}};e.WebVTT=m})(this,this.vttjs||{})},{}],101:[function(e,t,r){if(typeof t!=="undefined"&&t.exports){this.VTTCue=this.VTTCue||e(102).VTTCue}(function(e){e.VTTCue.prototype.toJSON=function(){var e={},t=this;Object.keys(this).forEach(function(r){if(r!=="getCueAsHTML"&&r!=="hasBeenReset"&&r!=="displayState"){e[r]=t[r]}});return e};e.VTTCue.create=function(t){if(!t.hasOwnProperty("startTime")||!t.hasOwnProperty("endTime")||!t.hasOwnProperty("text")){throw new Error("You must at least have start time, end time, and text.")}var r=new e.VTTCue(t.startTime,t.endTime,t.text);for(var n in t){if(r.hasOwnProperty(n)){r[n]=t[n]}}return r};e.VTTCue.fromJSON=function(e){return this.create(JSON.parse(e))}})(this)},{102:102}],102:[function(e,t,r){(function(e,t){var r="auto";var n={"":true,lr:true,rl:true};var o={start:true,middle:true,end:true,left:true,right:true};function i(e){if(typeof e!=="string"){return false}var t=n[e.toLowerCase()];return t?e.toLowerCase():false}function a(e){if(typeof e!=="string"){return false}var t=o[e.toLowerCase()];return t?e.toLowerCase():false}function s(e){var t=1;for(;t<arguments.length;t++){var r=arguments[t];for(var n in r){e[n]=r[n]}}return e}function u(e,t,n){var o=this;var u=/MSIE\s8\.0/.test(navigator.userAgent);var l={};if(u){o=document.createElement("custom")}else{l.enumerable=true}o.hasBeenReset=false;var c="";var f=false;var p=e;var h=t;var d=n;var v=null;var y="";var g=true;var _="auto";var m="start";var b=50;var T="middle";var w=50;var E="middle";Object.defineProperty(o,"id",s({},l,{get:function(){return c},set:function(e){c=""+e}}));Object.defineProperty(o,"pauseOnExit",s({},l,{get:function(){return f},set:function(e){f=!!e}}));Object.defineProperty(o,"startTime",s({},l,{get:function(){return p},set:function(e){if(typeof e!=="number"){throw new TypeError("Start time must be set to a number.")}p=e;this.hasBeenReset=true}}));Object.defineProperty(o,"endTime",s({},l,{get:function(){return h},set:function(e){if(typeof e!=="number"){throw new TypeError("End time must be set to a number.")}h=e;this.hasBeenReset=true}}));Object.defineProperty(o,"text",s({},l,{get:function(){return d},set:function(e){d=""+e;this.hasBeenReset=true}}));Object.defineProperty(o,"region",s({},l,{get:function(){return v},set:function(e){v=e;this.hasBeenReset=true}}));Object.defineProperty(o,"vertical",s({},l,{get:function(){return y},set:function(e){var t=i(e);if(t===false){throw new SyntaxError("An invalid or illegal string was specified.")}y=t;this.hasBeenReset=true}}));Object.defineProperty(o,"snapToLines",s({},l,{get:function(){return g},set:function(e){g=!!e;this.hasBeenReset=true}}));Object.defineProperty(o,"line",s({},l,{get:function(){return _},set:function(e){if(typeof e!=="number"&&e!==r){throw new SyntaxError("An invalid number or illegal string was specified.")}_=e;this.hasBeenReset=true}}));Object.defineProperty(o,"lineAlign",s({},l,{get:function(){return m},set:function(e){var t=a(e);if(!t){throw new SyntaxError("An invalid or illegal string was specified.")}m=t;this.hasBeenReset=true}}));Object.defineProperty(o,"position",s({},l,{get:function(){return b},set:function(e){if(e<0||e>100){throw new Error("Position must be between 0 and 100.")}b=e;this.hasBeenReset=true}}));Object.defineProperty(o,"positionAlign",s({},l,{get:function(){return T},set:function(e){var t=a(e);if(!t){throw new SyntaxError("An invalid or illegal string was specified.")}T=t;this.hasBeenReset=true}}));Object.defineProperty(o,"size",s({},l,{get:function(){return w},set:function(e){if(e<0||e>100){throw new Error("Size must be between 0 and 100.")}w=e;this.hasBeenReset=true}}));Object.defineProperty(o,"align",s({},l,{get:function(){return E},set:function(e){var t=a(e);if(!t){throw new SyntaxError("An invalid or illegal string was specified.")}E=t;this.hasBeenReset=true}}));o.displayState=undefined;if(u){return o}}u.prototype.getCueAsHTML=function(){return WebVTT.convertCueToDOMTree(window,this.text)};e.VTTCue=e.VTTCue||u;t.VTTCue=u})(this,this.vttjs||{})},{}],103:[function(e,t,r){if(typeof t!=="undefined"&&t.exports){this.VTTRegion=e(104).VTTRegion}(function(e){e.VTTRegion.create=function(t){var r=new e.VTTRegion;for(var n in t){if(r.hasOwnProperty(n)){r[n]=t[n]}}return r};e.VTTRegion.fromJSON=function(e){return this.create(JSON.parse(e))}})(this)},{104:104}],104:[function(e,t,r){(function(e,t){var r={"":true,up:true};function n(e){if(typeof e!=="string"){return false}var t=r[e.toLowerCase()];return t?e.toLowerCase():false}function o(e){return typeof e==="number"&&(e>=0&&e<=100)}function i(){var e=100;var t=3;var r=0;var i=100;var a=0;var s=100;var u="";Object.defineProperties(this,{width:{enumerable:true,get:function(){return e},set:function(t){if(!o(t)){throw new Error("Width must be between 0 and 100.")}e=t}},lines:{enumerable:true,get:function(){return t},set:function(e){if(typeof e!=="number"){throw new TypeError("Lines must be set to a number.")}t=e}},regionAnchorY:{enumerable:true,get:function(){return i},set:function(e){if(!o(e)){throw new Error("RegionAnchorX must be between 0 and 100.")}i=e}},regionAnchorX:{enumerable:true,get:function(){return r},set:function(e){if(!o(e)){throw new Error("RegionAnchorY must be between 0 and 100.")}r=e}},viewportAnchorY:{enumerable:true,get:function(){return s},set:function(e){if(!o(e)){throw new Error("ViewportAnchorY must be between 0 and 100.")}s=e}},viewportAnchorX:{enumerable:true,get:function(){return a},set:function(e){if(!o(e)){throw new Error("ViewportAnchorX must be between 0 and 100.")}a=e}},scroll:{enumerable:true,get:function(){return u},set:function(e){var t=n(e);if(t===false){throw new SyntaxError("An invalid or illegal string was specified.")}u=t}}})}e.VTTRegion=e.VTTRegion||i;t.VTTRegion=i})(this,this.vttjs||{})},{}],105:[function(e,t,r){"use strict";var n=e(95);var o=e(106);var i=e(109);var a=e(110);t.exports=c;c.XMLHttpRequest=n.XMLHttpRequest||h;c.XDomainRequest="withCredentials"in new c.XMLHttpRequest?c.XMLHttpRequest:n.XDomainRequest;s(["get","put","post","patch","head","delete"],function(e){c[e==="delete"?"del":e]=function(t,r,n){r=l(t,r,n);r.method=e.toUpperCase();return f(r)}});function s(e,t){for(var r=0;r<e.length;r++){t(e[r])}}function u(e){for(var t in e){if(e.hasOwnProperty(t))return false}return true}function l(e,t,r){var n=e;if(o(t)){r=t;if(typeof e==="string"){n={uri:e}}}else{n=a(t,{uri:e})}n.callback=r;return n}function c(e,t,r){t=l(e,t,r);return f(t)}function f(e){if(typeof e.callback==="undefined"){throw new Error("callback argument missing")}var t=false;var r=function w(r,n,o){if(!t){t=true;e.callback(r,n,o)}};function n(){if(f.readyState===4){l()}}function o(){var e=undefined;if(f.response){e=f.response}else{e=f.responseText||p(f)}if(b){try{e=JSON.parse(e)}catch(t){}}return e}var a={body:undefined,headers:{},statusCode:0,method:y,url:v,rawRequest:f};function s(e){clearTimeout(T);if(!(e instanceof Error)){e=new Error(""+(e||"Unknown XMLHttpRequest Error"))}e.statusCode=0;return r(e,a)}function l(){if(d)return;var t;clearTimeout(T);if(e.useXDR&&f.status===undefined){t=200}else{t=f.status===1223?204:f.status}var n=a;var s=null;if(t!==0){n={body:o(),statusCode:t,method:y,headers:{},url:v,rawRequest:f};if(f.getAllResponseHeaders){n.headers=i(f.getAllResponseHeaders())}}else{s=new Error("Internal XMLHttpRequest Error")}return r(s,n,n.body)}var f=e.xhr||null;if(!f){if(e.cors||e.useXDR){f=new c.XDomainRequest}else{f=new c.XMLHttpRequest}}var h;var d;var v=f.url=e.uri||e.url;var y=f.method=e.method||"GET";var g=e.body||e.data||null;var _=f.headers=e.headers||{};var m=!!e.sync;var b=false;var T;if("json"in e){b=true;_["accept"]||_["Accept"]||(_["Accept"]="application/json");if(y!=="GET"&&y!=="HEAD"){_["content-type"]||_["Content-Type"]||(_["Content-Type"]="application/json");g=JSON.stringify(e.json)}}f.onreadystatechange=n;f.onload=l;f.onerror=s;f.onprogress=function(){};f.ontimeout=s;f.open(y,v,!m,e.username,e.password);if(!m){f.withCredentials=!!e.withCredentials}if(!m&&e.timeout>0){T=setTimeout(function(){d=true;f.abort("timeout");var e=new Error("XMLHttpRequest timeout");e.code="ETIMEDOUT";s(e)},e.timeout)}if(f.setRequestHeader){for(h in _){if(_.hasOwnProperty(h)){f.setRequestHeader(h,_[h])}}}else if(e.headers&&!u(e.headers)){throw new Error("Headers cannot be set on an XDomainRequest object")}if("responseType"in e){f.responseType=e.responseType}if("beforeSend"in e&&typeof e.beforeSend==="function"){e.beforeSend(f)}f.send(g);return f}function p(e){if(e.responseType==="document"){return e.responseXML}var t=e.status===204&&e.responseXML&&e.responseXML.documentElement.nodeName==="parsererror";if(e.responseType===""&&!t){return e.responseXML}return null}function h(){}},{106:106,109:109,110:110,95:95}],106:[function(e,t,r){t.exports=o;var n=Object.prototype.toString;function o(e){var t=n.call(e);return t==="[object Function]"||typeof e==="function"&&t!=="[object RegExp]"||typeof window!=="undefined"&&(e===window.setTimeout||e===window.alert||e===window.confirm||e===window.prompt)}},{}],107:[function(e,t,r){var n=e(106);t.exports=a;var o=Object.prototype.toString;var i=Object.prototype.hasOwnProperty;function a(e,t,r){if(!n(t)){throw new TypeError("iterator must be a function")}if(arguments.length<3){r=this}if(o.call(e)==="[object Array]")s(e,t,r);else if(typeof e==="string")u(e,t,r);else l(e,t,r)}function s(e,t,r){for(var n=0,o=e.length;n<o;n++){if(i.call(e,n)){t.call(r,e[n],n,e)}}}function u(e,t,r){for(var n=0,o=e.length;n<o;n++){t.call(r,e.charAt(n),n,e)}}function l(e,t,r){for(var n in e){if(i.call(e,n)){t.call(r,e[n],n,e)}}}},{106:106}],108:[function(e,t,r){r=t.exports=n;function n(e){return e.replace(/^\s*|\s*$/g,"")}r.left=function(e){return e.replace(/^\s*/,"")};r.right=function(e){return e.replace(/\s*$/,"")}},{}],109:[function(e,t,r){var n=e(108),o=e(107),i=function(e){return Object.prototype.toString.call(e)==="[object Array]"};t.exports=function(e){if(!e)return{};var t={};o(n(e).split("\n"),function(e){var r=e.indexOf(":"),o=n(e.slice(0,r)).toLowerCase(),a=n(e.slice(r+1));if(typeof t[o]==="undefined"){t[o]=a}else if(i(t[o])){t[o].push(a)}else{t[o]=[t[o],a]}});return t}},{107:107,108:108}],110:[function(e,t,r){t.exports=o;var n=Object.prototype.hasOwnProperty;function o(){var e={};for(var t=0;t<arguments.length;t++){var r=arguments[t];for(var o in r){if(n.call(r,o)){e[o]=r[o]}}}return e}},{}]},{},[93])(93)});
/* End */
;; /* /bitrix/components/bitrix/main.interface.buttons/templates/.default/script.min.js?151859616937794*/
; /* /bitrix/components/bitrix/main.interface.buttons/templates/.default/utils.min.js?1518596169575*/
; /* /bitrix/components/bitrix/crm.contact.menu/templates/.default/script.js?1518596183484*/
; /* /bitrix/components/bitrix/crm.interface.toolbar/templates/slider/script.min.js?151859618212485*/
; /* /bitrix/components/bitrix/crm.entity.details/templates/.default/script.min.js?151859618418291*/
; /* /bitrix/components/bitrix/crm.entity.editor/templates/.default/script.min.js?1518596183320522*/
; /* /bitrix/components/bitrix/crm.timeline/templates/.default/script.min.js?1518596184190275*/
; /* /bitrix/components/bitrix/player/js/fileman_player.min.js?15185961927529*/
; /* /bitrix/components/bitrix/player/videojs/video.min.js?1518596192269082*/

//# sourceMappingURL=page_f78464a88238d0d28ea1eb20c8d51a70.map.js