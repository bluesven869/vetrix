
; /* Start:"a:4:{s:4:"full";s:97:"/bitrix/components/bitrix/main.interface.buttons/templates/.default/script.min.js?151859616937794";s:6:"source";s:77:"/bitrix/components/bitrix/main.interface.buttons/templates/.default/script.js";s:3:"min";s:0:"";s:3:"map";s:0:"";}"*/
BX.namespace("BX.Main");if(typeof BX.Main.interfaceButtons==="undefined"){BX.Main.interfaceButtons=function(t,e){this.classItem="main-buttons-item";this.classItemSublink="main-buttons-item-sublink";this.classItemText="main-buttons-item-text";this.classItemCounter="main-buttons-item-counter";this.classItemIcon="main-buttons-item-icon";this.classItemMore="main-buttons-item-more";this.classOnDrag="main-buttons-drag";this.classDropzone="main-buttons-submenu-dropzone";this.classSeporator="main-buttons-submenu-separator";this.classHiddenLabel="main-buttons-hidden-label";this.classSubmenuItem="main-buttons-submenu-item";this.classItemDisabled="main-buttons-disabled";this.classItemOver="over";this.classItemActive="main-buttons-item-active";this.classSubmenu="main-buttons-submenu";this.classSecret="secret";this.classItemLocked="locked";this.submenuIdPrefix="main_buttons_popup_";this.submenuWindowIdPrefix="menu-popup-";this.classSettingMenuItem="main-buttons-submenu-setting";this.classEditState="main-buttons-edit";this.classEditItemButton="main-buttons-item-edit-button";this.classDragItemButton="main-buttons-item-drag-button";this.classSettingsApplyButton="main-buttons-submenu-settings-apply";this.classSettingsResetButton="main-buttons-submenu-settings-reset";this.classSetHome="main-buttons-set-home";this.classSetHide="main-buttons-set-hide";this.classManage="main-buttons-manage";this.classContainer="main-buttons";this.classSubmenuNoHiddenItem="main-buttons-submenu-item-no-hidden";this.classDefaultSubmenuItem="menu-popup-item";this.classInner="main-buttons-inner-container";this.listContainer=null;this.pinContainer=null;this.dragItem=null;this.overItem=null;this.moreButton=null;this.messages=null;this.licenseParams=null;this.isSubmenuShown=false;this.isSubmenuShownOnDragStart=false;this.isSettingsEnabled=true;this.containerId=e.containerId;this.tmp={};this.init(t,e);return{getItemById:BX.delegate(this.getItemById,this),getAllItems:BX.delegate(this.getAllItems,this),getHiddenItems:BX.delegate(this.getHiddenItems,this),getVisibleItems:BX.delegate(this.getVisibleItems,this),getDisabledItems:BX.delegate(this.getDisabledItems,this),getMoreButton:BX.delegate(this.getMoreButton,this),adjustMoreButtonPosition:BX.delegate(this.adjustMoreButtonPosition,this),showSubmenu:BX.delegate(this.showSubmenu,this),closeSubmenu:BX.delegate(this.closeSubmenu,this),refreshSubmenu:BX.delegate(this.refreshSubmenu,this),getCurrentSettings:BX.delegate(this.getCurrentSettings,this),saveSettings:BX.delegate(this.saveSettings,this),setCounterValueByItemId:BX.delegate(this.setCounterValueByItemId,this),getCounterValueByItemId:BX.delegate(this.getCounterValueByItemId,this),updateCounter:BX.delegate(this.updateCounter,this),getActive:BX.delegate(this.getActive,this),isEditEnabled:BX.delegate(this.isEditEnabled,this),isActiveInMoreMenu:BX.delegate(this.isActiveInMoreMenu,this),isSettingsEnabled:this.isSettingsEnabled,classes:{item:this.classItem,itemText:this.classItemText,itemCounter:this.classItemCounter,itemIcon:this.classItemIcon,itemDisabled:this.classItemDisabled,itemOver:this.classItemOver,itemActive:this.classItemActive,itemLocked:this.classItemLocked,submenu:this.classSubmenu,submenuItem:this.classSubmenuItem,containerOnDrag:this.classOnDrag,classSettingMenuItem:this.classSettingMenuItem},itemsContainer:this.listContainer,itemsContainerId:this.listContainer.id}};BX.Main.interfaceButtons.prototype={init:function(t,e){this.listContainer=BX(this.getId());if(!BX.type.isPlainObject(e)){throw"BX.MainButtons: params is not Object"}if(!("containerId"in e)||!BX.type.isNotEmptyString(e.containerId)){throw"BX.MainButtons: containerId not set in params"}if(!BX.type.isDomNode(this.listContainer)){throw"BX.MainButtons: #"+e.containerId+" is not dom node"}if("classes"in e&&BX.type.isPlainObject(e.classes)){this.setCustomClasses(e.classes)}if("messages"in e&&BX.type.isPlainObject(e.messages)){this.setMessages(e.messages)}if("licenseWindow"in e&&BX.type.isPlainObject(e.licenseWindow)){this.setLicenseWindowParams(e.licenseWindow)}if("disableSettings"in e&&e.disableSettings==="true"){this.isSettingsEnabled=false;this.visibleControlMoreButton()}this.moreButton=this.getMoreButton();if(this.isSettingsEnabled){this.dragAndDropInit()}this.adjustMoreButtonPosition();this.bindOnClickOnMoreButton();this.bindOnScrollWindow();this.setContainerHeight();BX.bind(this.getContainer(),"click",BX.delegate(this._onDocumentClick,this));BX.addCustomEvent("onPullEvent-main",BX.delegate(this._onPush,this));this.updateMoreButtonCounter();if(this.isActiveInMoreMenu()){this.activateItem(this.moreButton)}var s=this.getVisibleItems();var i=BX.type.isArray(s)&&s.length>0?s[0]:null;var n=BX.Buttons.Utils.getByTag(i,"a");if(!BX.type.isDomNode(n)){return}var a=n.getAttribute("href");if(a.charAt(0)==="?"){a=n.pathname+n.search}if(!this.lastHomeLink){this.lastHomeLink=a}this.bindOnResizeFrame()},_onDocumentClick:function(t){var e=this.getItem(t);var s,i,n,a,o,u;if(this.isDragButton(t.target)){t.preventDefault();t.stopPropagation()}if(BX.type.isDomNode(e)){if(this.isSettings(e)){this.enableEdit();BX.hide(this.getSettingsButton());BX.show(this.getSettingsApplyButton());return false}if(this.isApplySettingsButton(e)){t.preventDefault();t.stopPropagation();this.disableEdit();BX.show(this.getSettingsButton());BX.hide(this.getSettingsApplyButton());return false}if(this.isResetSettingsButton(e)){this.resetSettings();return false}if(this.isLocked(e)){t.preventDefault();this.showLicenseWindow();return false}if(this.isEditButton(t.target)){var r,h;t.preventDefault();t.stopPropagation();if(this.isSubmenuItem(e)){e=this.getItemAlias(e)}try{r=JSON.parse(BX.data(e,"item"))}catch(t){}h=this.getItemEditMenu();if(h&&h.popupWindow.isShown()&&this.lastEditNode===e){h.popupWindow.close()}else{this.showItemEditMenu(r,t.target)}this.lastEditNode=e;return false}if(this.isSetHide(e)){o=this.getVisibleItems();u=BX.type.isArray(o)?o.length:null;a=this.editItemData.ID.replace(this.listContainer.id+"_","");i=this.getItemById(a);n=this.getItemAlias(i);i=this.isVisibleItem(i)?i:n;if(this.isDisabled(n)){this.enableItem(n)}else if(!this.isDisabled(n)&&u>2){this.disableItem(n)}if(u===2){BX.onCustomEvent(window,"BX.Main.InterfaceButtons:onHideLastVisibleItem",[i,this])}this.refreshSubmenu();this.saveSettings();this.adjustMoreButtonPosition();if(this.isEditEnabled()){this.enableEdit();BX.hide(this.getSettingsButton());BX.show(this.getSettingsApplyButton())}this.editMenu.popupWindow.close();return false}if(this.isSetHome(e)){a=this.editItemData.ID.replace(this.listContainer.id+"_","");i=this.getItemById(a);n=this.getItemAlias(i);if(this.isDisabled(n)){this.enableItem(n)}this.listContainer.insertBefore(i,BX.firstChild(this.listContainer));this.adjustMoreButtonPosition();this.refreshSubmenu();this.saveSettings();if(this.isEditEnabled()){this.enableEdit();BX.hide(this.getSettingsButton());BX.show(this.getSettingsApplyButton())}this.editMenu.popupWindow.close();return false}if(!this.isSublink(t.target)){s=this.dataValue(e,"onclick");if(BX.type.isNotEmptyString(s)){t.preventDefault();this.execScript(s)}}}if(this.isEditEnabled()){this.getSubmenu().popupWindow.setAutoHide(false)}},isActiveInMoreMenu:function(){var t=this.getHiddenItems();var e=this.getDisabledItems();var s=t.concat(e);return s.some(function(t){var e;try{e=JSON.parse(BX.data(t,"item"))}catch(t){}return BX.type.isPlainObject(e)&&("IS_ACTIVE"in e&&e.IS_ACTIVE===true||e.IS_ACTIVE==="true"||e.IS_ACTIVE==="Y")},this)},_onPush:function(t,e){if(t==="user_counter"&&e&&BX.message("SITE_ID")in e){var s=e[BX.message("SITE_ID")];for(var i in s){if(s.hasOwnProperty(i)){this.updateCounter(i,s[i])}}}},bindOnScrollWindow:function(){BX.bind(window,"scroll",BX.delegate(this._onScroll,this))},getActive:function(){var t=this.getAllItems();var e,s;var i=null;if(BX.type.isArray(t)){t.forEach(function(t){try{e=JSON.parse(BX.data(t,"item"))}catch(t){e=null}if(BX.type.isPlainObject(e)&&"IS_ACTIVE"in e&&(e.IS_ACTIVE===true||e.IS_ACTIVE==="true"||e.IS_ACTIVE==="Y")){i=e}},this)}if(BX.type.isPlainObject(i)){s=BX(i.ID);if(BX.type.isDomNode(s)){i.NODE=s}else{i.NODE=null}}return i},isSetHome:function(t){return BX.hasClass(t,this.classSetHome)},isSetHide:function(t){return BX.hasClass(t,this.classSetHide)},getSettingsButton:function(){return BX.Buttons.Utils.getByClass(this.getSubmenuContainer(),this.classSettingMenuItem)},getSettingsApplyButton:function(){return BX.Buttons.Utils.getByClass(this.getSubmenuContainer(),this.classSettingsApplyButton)},isApplySettingsButton:function(t){return BX.hasClass(t,this.classSettingsApplyButton)},enableEdit:function(){var t=this.getSubmenu();if(t&&"popupWindow"in t){t.popupWindow.setAutoHide(false)}BX.addClass(this.listContainer,this.classEditState);BX.addClass(this.getSubmenuContainer(),this.classEditState);this.isEditEnabledState=true},disableEdit:function(){var t=this.getSubmenu();if(t&&"popupWindow"in t){t.popupWindow.setAutoHide(true)}BX.removeClass(this.listContainer,this.classEditState);BX.removeClass(this.getSubmenuContainer(),this.classEditState);this.isEditEnabledState=false},isEditEnabled:function(){return this.isEditEnabledState},showItemEditMenu:function(t,e){if(BX.type.isPlainObject(t)&&"ID"in t){var s=[this.listContainer.id,"_edit_item"].join("");var i=BX.PopupMenu.getMenuById(s);if(i){BX.PopupMenu.destroy(s)}i=this.createItemEditMenu(t,s,e);i.popupWindow.show()}},getContainer:function(){if(!BX.type.isDomNode(this.container)){this.container=BX(this.containerId).parentNode}return this.container},getItemEditMenu:function(){return BX.PopupMenu.getMenuById([this.listContainer.id,"_edit_item"].join(""))},createItemEditMenu:function(t,e,s){var i;var n=[{text:this.message("MIB_SET_HOME"),className:"main-buttons-set-home menu-popup-no-icon"}];var a=t.ID.replace(this.listContainer.id+"_","");var o=this.getItemById(a);if(this.isDisabled(o)){n.push({text:this.message("MIB_SET_SHOW"),className:"main-buttons-set-hide menu-popup-no-icon"})}else{n.push({text:this.message("MIB_SET_HIDE"),className:"main-buttons-set-hide menu-popup-no-icon"})}var u=BX.pos(s);var r={menuId:e,anchor:s,menuItems:n,settings:{autoHide:true,offsetTop:0,offsetLeft:u.width/2,zIndex:20,angle:{position:"top",offset:u.width/2}}};i=BX.PopupMenu.create(r.menuId,r.anchor,r.menuItems,r.settings);if(this.isVisibleItem(o)){t.NODE=o}else{t.NODE=this.getItemAlias(o)}this.editItemData=t;if("menuItems"in i&&BX.type.isArray(i.menuItems)){i.menuItems.forEach(function(t){BX.bind(t.layout.item,"click",BX.delegate(this._onDocumentClick,this))},this)}BX.onCustomEvent(window,"BX.Main.InterfaceButtons:onBeforeCreateEditMenu",[i,t,this]);this.editMenu=i;return i},setHome:function(){var t=this.getVisibleItems();var e=BX.type.isArray(t)&&t.length>0?t[0]:null;var s=BX.Buttons.Utils.getByTag(e,"a");if(!BX.type.isDomNode(s)){return}var i=s.getAttribute("href");if(i.charAt(0)==="?"){i=s.pathname+s.search}if(!this.lastHomeLink){this.lastHomeLink=i}if(this.lastHomeLink!==i){BX.userOptions.save("ui",this.listContainer.id,"firstPageLink",i);BX.onCustomEvent("BX.Main.InterfaceButtons:onFirstItemChange",[i,e])}this.lastHomeLink=i},isEditButton:function(t){return BX.hasClass(t,this.classEditItemButton)},isDragButton:function(t){return BX.hasClass(t,this.classDragItemButton)},isResetSettingsButton:function(t){return BX.hasClass(t,this.classSettingsResetButton)},getContainerHeight:function(){var t=this.getAllItems().map(function(t){var e=getComputedStyle(t);return BX.height(t)+parseInt(e.marginTop)+parseInt(e.marginBottom)});return Math.max.apply(Math,t)},setContainerHeight:function(){var t=this.getContainerHeight();BX.height(this.listContainer,t)},setLicenseWindowParams:function(t){this.licenseParams=t||{}},message:function(t){var e;try{e=this.messages[t]}catch(t){e=""}return e},setCustomClasses:function(t){if(!BX.type.isPlainObject(t)){return}this.classItem=t.item||this.classItem;this.classItemSublink=t.itemSublink||this.classItemSublink;this.classItemText=t.itemText||this.classItemText;this.classItemCounter=t.itemCounter||this.classItemCounter;this.classItemIcon=t.itemIcon||this.classItemIcon;this.classItemMore=t.itemMore||this.classItemMore;this.classItemOver=t.itemOver||this.classItemOver;this.classItemActive=t.itemActive||this.classItemActive;this.classItemDisabled=t.itemDisabled||this.classItemDisabled;this.classOnDrag=t.onDrag||this.classOnDrag;this.classDropzone=t.dropzone||this.classDropzone;this.classSeporator=t.separator||this.classSeporator;this.classSubmenuItem=t.submenuItem||this.classSubmenuItem;this.classSubmenu=t.submenu||this.classSubmenu;this.classSecret=t.secret||this.classSecret;this.classItemLocked=t.itemLocked||this.classItemLocked},setMessages:function(t){if(!BX.type.isPlainObject(t)){return}this.messages=t},makeFullItemId:function(t){if(!BX.type.isNotEmptyString(t)){return}return[this.listContainer.id,t.replace("-","_")].join("_")},getItemById:function(t){var e=null;var s;if(BX.type.isNotEmptyString(t)){s=this.makeFullItemId(t);e=BX.Buttons.Utils.getBySelector(this.listContainer,"#"+s)}return e},getItemCounterObject:function(t){var e=null;if(BX.type.isDomNode(t)){e=BX.Buttons.Utils.getByClass(t,this.classItemCounter)}return e},setCounterValue:function(t,e){var s=this.getItemCounterObject(t);if(BX.type.isDomNode(s)){s.innerText=e>99?"99+":e>0?e:"";t.dataset.counter=e}this.updateMoreButtonCounter()},updateCounter:function(t,e){if(t.indexOf("crm")===0&&e<0){return}var s,i,n;var a=null;var o=this.getAllItems();if(BX.type.isArray(o)){o.forEach(function(e){try{i=JSON.parse(BX.data(e,"item"))}catch(t){i={}}if(BX.type.isPlainObject(i)&&"COUNTER_ID"in i&&i.COUNTER_ID===t){a=e}},this)}s=this.getItemCounterObject(a);if(BX.type.isDomNode(s)){a=this.getItem(s);s.innerText=e>99?"99+":e>0?e:"";a.dataset.counter=e}n=this.getItemAlias(a);if(BX.type.isDomNode(n)){s=this.getItemCounterObject(n);if(BX.type.isDomNode(s)){s.innerText=e>99?"99+":e>0?e:"";n.dataset.counter=e}}this.updateMoreButtonCounter()},setCounterValueByItemId:function(t,e){var s=e!==null?parseFloat(e):null;var i,n;if(!BX.type.isNotEmptyString(t)){throw"Bad first arg. Need string as item id"}if(s!==null&&!BX.type.isNumber(s)){throw"Bad two arg. Need number counter value - Integer, Float or string with number"}i=this.getItemById(t);if(!BX.type.isDomNode(i)){console.info("Not found node with id #"+t);return}n=this.getItemAlias(i);this.setCounterValue(i,s);this.setCounterValue(n,s)},getCounterValueByItemId:function(t){var e,s;var i=NaN;if(!BX.type.isNotEmptyString(t)){throw"Bad first arg. Need string item id"}else{e=this.getItemById(t);i=this.dataValue(e,"counter");i=parseFloat(i);if(!BX.type.isNumber(i)){s=this.getItemCounterObject(e);i=parseFloat(s.innerText)}}return i},setMoreButtonCounter:function(t){var e=this.getItemCounterObject(this.moreButton);var s=t>99?"99+":t>0?t:"";s=parseInt(s);s=BX.type.isNumber(s)?s:"";e.innerText=s},bindOnClickOnMoreButton:function(){BX.bind(this.moreButton,"click",BX.delegate(this._onClickMoreButton,this))},bindOnResizeFrame:function(){window.frames["maininterfacebuttonstmpframe-"+this.getId()].onresize=BX.throttle(this._onResizeHandler,20,this)},getId:function(){return BX.Buttons.Utils.getByClass(this.getContainer(),this.classInner).id},getAllItems:function(){return BX.Buttons.Utils.getByClass(this.listContainer,this.classItem,true)},getVisibleItems:function(){var t=this.getAllItems();var e=this;var s=[];if(t&&t.length){s=t.filter(function(t){return e.isVisibleItem(t)&&!e.isDisabled(t)})}return s},getHiddenItems:function(){var t=this.getAllItems();var e=[];var s=this;if(t&&t.length){e=t.filter(function(t){return!s.isVisibleItem(t)&&!s.isDisabled(t)})}return e},getDisabledItems:function(){return this.getAllItems().filter(function(t){return this.isDisabled(t)},this)},getMoreButton:function(){var t=null;this.getAllItems().forEach(function(e){!t&&BX.hasClass(e,this.classItemMore)&&(t=e)},this);return t},getLastVisibleItem:function(){var t=this.getVisibleItems();var e=null;if(BX.type.isArray(t)&&t.length){e=t[t.length-1]}if(!BX.type.isDomNode(e)){e=null}return e},adjustMoreButtonPosition:function(){var t=this.getLastVisibleItem();var e=this.isMoreButton(t);if(!e){this.listContainer.insertBefore(this.moreButton,t)}this.updateMoreButtonCounter()},getSubmenuId:function(t){var e="";if(BX.type.isDomNode(this.listContainer)&&BX.type.isNotEmptyString(this.listContainer.id)){e=this.submenuIdPrefix+this.listContainer.id}if(t){e=this.submenuWindowIdPrefix+e}return e},getSubmenuItemText:function(t){var e,s,i;if(!BX.type.isDomNode(t)){return null}e=this.findChildrenByClassName(t,this.classItemText);s=this.findChildrenByClassName(t,this.classItemCounter);if(BX.type.isDomNode(s)&&BX.type.isDomNode(e)){s.dataset.counter=this.dataValue(t,"counter");i=e.outerHTML+s.outerHTML}else{e=this.dataValue(t,"text");s=this.dataValue(t,"counter");i=e}return i},getLockedClass:function(t){var e="";if(BX.type.isDomNode(t)&&this.isLocked(t)){e=this.classItemLocked}return e},getSubmenuItems:function(){var t=this.getAllItems();var e=this.getHiddenItems();var s=this.getDisabledItems();var i=[];var n,a;if(t.length){t.forEach(function(t){if(e.indexOf(t)===-1&&s.indexOf(t)===-1){i.push({text:this.getSubmenuItemText(t),href:this.dataValue(t,"url"),onclick:this.dataValue(t,"onclick"),title:t.getAttribute("title"),className:[this.classSubmenuItem,this.getIconClass(t),this.classSecret,this.getAliasLink(t),this.getLockedClass(t)].join(" ")})}},this)}if(e.length){e.forEach(function(t){try{n=JSON.parse(this.dataValue(t,"item"))}catch(t){n=null}a=[this.classSubmenuItem,this.getIconClass(t),this.getAliasLink(t),this.getLockedClass(t)];if(BX.type.isPlainObject(n)&&("IS_ACTIVE"in n&&n.IS_ACTIVE===true||n.IS_ACTIVE==="true"||n.IS_ACTIVE==="Y")){a.push(this.classItemActive)}i.push({text:this.getSubmenuItemText(t),href:this.dataValue(t,"url"),onclick:this.dataValue(t,"onclick"),title:t.getAttribute("title"),className:a.join(" ")})},this)}if(this.isSettingsEnabled){i.push({text:"<span>"+this.message("MIB_HIDDEN")+"</span>",className:[this.classSeporator,this.classSubmenuItem,this.classHiddenLabel].join(" ")});if(!s.length){i.push({text:"<span>"+this.message("MIB_NO_HIDDEN")+"</span>",className:[this.classSubmenuItem,this.classSubmenuNoHiddenItem].join(" ")})}if(s.length){s.forEach(function(t){try{n=JSON.parse(this.dataValue(t,"item"))}catch(t){n=null}a=[this.classSubmenuItem,this.classItemDisabled,this.getIconClass(t),this.getAliasLink(t),this.getLockedClass(t)];if(BX.type.isPlainObject(n)&&("IS_ACTIVE"in n&&n.IS_ACTIVE===true||n.IS_ACTIVE==="true"||n.IS_ACTIVE==="Y")){a.push(this.classItemActive)}i.push({text:this.getSubmenuItemText(t),href:this.dataValue(t,"url"),onclick:this.dataValue(t,"onclick"),title:t.getAttribute("title"),className:a.join(" ")})},this)}i.push({text:"<span>"+this.message("MIB_MANAGE")+"</span>",className:[this.classSeporator,this.classSubmenuItem,this.classHiddenLabel,this.classManage].join(" ")});i.push({text:this.message("MIB_SETTING_MENU_ITEM"),className:[this.classSettingMenuItem,this.classSubmenuItem].join(" ")});i.push({text:this.message("MIB_APPLY_SETTING_MENU_ITEM"),className:[this.classSettingsApplyButton,this.classSubmenuItem].join(" ")});i.push({text:this.message("MIB_RESET_SETTINGS"),className:[this.classSettingsResetButton,this.classSubmenuItem].join(" ")})}return i},getSubmenuArgs:function(){var t=this.getSubmenuId();var e=this.moreButton;var s=BX.pos(e);var i=this.getSubmenuItems();var n={autoHide:true,offsetLeft:s.width/2-80,angle:{position:"top",offset:100},zIndex:20,events:{onPopupClose:BX.delegate(this._onSubmenuClose,this)}};return[t,e,i,n]},visibleControlMoreButton:function(){var t=this.getHiddenItems();if(!t.length||t.length===1&&this.isMoreButton(t[0])){this.getMoreButton().style.display="none"}else{this.getMoreButton().style.display=""}},createSubmenu:function(){var t=BX.PopupMenu.create.apply(BX.PopupMenu,this.getSubmenuArgs());if(this.isSettingsEnabled){this.dragAndDropInitInSubmenu()}t.menuItems.forEach(function(t){BX.bind(t.layout.item,"click",BX.delegate(this._onDocumentClick,this))},this);return t},showSubmenu:function(){var t=this.getSubmenu();if(t!==null){t.popupWindow.show()}else{this.destroySubmenu();t=this.createSubmenu();t.popupWindow.show()}this.setSubmenuShown(true);this.activateItem(this.moreButton);if(this.isEditEnabled()){t.popupWindow.setAutoHide(false)}},closeSubmenu:function(){var t=this.getSubmenu();if(t===null){return}t.popupWindow.close();if(!this.isActiveInMoreMenu()){this.deactivateItem(this.moreButton)}this.setSubmenuShown(false)},getSubmenu:function(){return BX.PopupMenu.getMenuById(this.getSubmenuId())},destroySubmenu:function(){BX.PopupMenu.destroy(this.getSubmenuId())},refreshSubmenu:function(){var t=this.getSubmenu();var e;if(t===null){return}e=this.getSubmenuArgs();if(BX.type.isArray(e)){this.destroySubmenu();this.createSubmenu();this.showSubmenu()}},setSubmenuShown:function(t){this.isSubmenuShown=false;if(BX.type.isBoolean(t)){this.isSubmenuShown=t}},activateItem:function(t){if(!BX.type.isDomNode(t)){return}if(!BX.hasClass(t,this.classItemActive)){BX.addClass(t,this.classItemActive)}},deactivateItem:function(t){if(!BX.type.isDomNode(t)){return}if(BX.hasClass(t,this.classItemActive)){BX.removeClass(t,this.classItemActive)}},getCurrentSettings:function(){var t={};this.getAllItems().forEach(function(e,s){t[e.id]={sort:s,isDisabled:this.isDisabled(e)}},this);return t},saveSettings:function(){var t=this.getCurrentSettings();var e="settings";var s;if(!BX.type.isPlainObject(t)){return}if(BX.type.isDomNode(this.listContainer)){if("id"in this.listContainer){s=this.listContainer.id;t=JSON.stringify(t);BX.userOptions.save("ui",s,e,t);this.setHome()}}},resetSettings:function(){var t=null;var e=BX.PopupWindowManager.create(this.listContainer.id+"_reset_popup",null,{content:this.message("MIB_RESET_ALERT"),autoHide:false,overlay:true,closeByEsc:true,closeIcon:true,draggable:{restrict:true},titleBar:this.message("MIB_RESET_SETTINGS"),buttons:[t=new BX.PopupWindowButton({text:this.message("MIB_RESET_BUTTON"),className:"popup-window-button-create",events:{click:function(){if(BX.hasClass(t.buttonNode,"popup-window-button-wait")){return}BX.addClass(t.buttonNode,"popup-window-button-wait");this.handleResetSettings(function(s){if(s){BX.removeClass(t.buttonNode,"popup-window-button-wait");e.setContent(s)}else{var i="settings";BX.userOptions.save("ui",this.listContainer.id,i,JSON.stringify({}));BX.userOptions.save("ui",this.listContainer.id,"firstPageLink","");window.location.reload()}}.bind(this))}.bind(this)}}),new BX.PopupWindowButtonLink({text:this.message("MIB_CANCEL_BUTTON"),className:"popup-window-button-link-cancel",events:{click:function(){this.popupWindow.close()}}})]});e.show()},handleResetSettings:function(t){var e=[];BX.onCustomEvent("BX.Main.InterfaceButtons:onBeforeResetMenu",[e,this]);var s=new BX.Promise;var i=s;for(var n=0;n<e.length;n++){s=s.then(e[n])}s.then(function(e){t(null,e)},function(e){t(e,null)});i.fulfill()},moveButtonAlias:function(t){var e,s;if(!t||!this.dragItem){return}e=this.getItemAlias(this.dragItem);s=this.getItemAlias(t);if(this.isListItem(e)){if(!s){this.listContainer.appendChild(e)}else{this.listContainer.insertBefore(e,s)}}},moveButton:function(t){var e;if(!BX.type.isDomNode(t)||!BX.type.isDomNode(this.dragItem)){return}if(this.isListItem(t)){if(this.isDisabled(this.dragItem)){this.dragItem.dataset.disabled="false"}if(BX.type.isDomNode(t)){this.listContainer.insertBefore(this.dragItem,t)}else{this.listContainer.appendChild(this.dragItem)}}if(this.isSubmenuItem(t)){if(this.isDisabled(this.dragItem)&&!this.isDisabled(t)){this.enableItem(this.dragItem)}e=this.getSubmenuContainer();e.insertBefore(this.dragItem,t)}},getSubmenuContainer:function(){var t=this.getSubmenu();var e=null;if(t!==null){e=t.itemsContainer}return e},findNextSiblingByClass:function(t,e){var s=t;for(;!!t;t=t.nextElementSibling){if(e){if(BX.hasClass(t,e)&&t!==s){return t}}else{return null}}},findParentByClassName:function(t,e){for(;t&&t!==document;t=t.parentNode){if(e){if(BX.hasClass(t,e)){return t}}else{return null}}},findChildrenByClassName:function(t,e){var s=null;if(BX.type.isDomNode(t)&&BX.type.isNotEmptyString(e)){s=BX.Buttons.Utils.getByClass(t,e)}return s},dragAndDropInit:function(){this.getAllItems().forEach(function(t,e){if(!this.isSeparator(t)&&!this.isSettings(t)&&!this.isApplySettingsButton(t)&&!this.isResetSettingsButton(t)){t.setAttribute("draggable","true");t.setAttribute("tabindex","-1");t.dataset.link="item"+e;BX.bind(t,"dragstart",BX.delegate(this._onDragStart,this));BX.bind(t,"dragend",BX.delegate(this._onDragEnd,this));BX.bind(t,"dragenter",BX.delegate(this._onDragEnter,this));BX.bind(t,"dragover",BX.delegate(this._onDragOver,this));BX.bind(t,"dragleave",BX.delegate(this._onDragLeave,this));BX.bind(t,"drop",BX.delegate(this._onDrop,this))}BX.bind(t,"mouseover",BX.delegate(this._onMouse,this));BX.bind(t,"mouseout",BX.delegate(this._onMouse,this))},this)},dragAndDropInitInSubmenu:function(){var t=this.getSubmenu();var e=t.menuItems;e.forEach(function(t){if(!this.isSeparator(t.layout.item)&&!this.isSettings(t.layout.item)&&!this.isApplySettingsButton(t.layout.item)&&!this.isResetSettingsButton(t.layout.item)){t.layout.item.draggable=true;t.layout.item.dataset.sortable=true;BX.bind(t.layout.item,"dragstart",BX.delegate(this._onDragStart,this));BX.bind(t.layout.item,"dragenter",BX.delegate(this._onDragEnter,this));BX.bind(t.layout.item,"dragover",BX.delegate(this._onDragOver,this));BX.bind(t.layout.item,"dragleave",BX.delegate(this._onDragLeave,this));BX.bind(t.layout.item,"dragend",BX.delegate(this._onDragEnd,this));BX.bind(t.layout.item,"drop",BX.delegate(this._onDrop,this))}if(BX.hasClass(t.layout.item,this.classHiddenLabel)&&!BX.hasClass(t.layout.item,this.classManage)){BX.bind(t.layout.item,"dragover",BX.delegate(this._onDragOver,this))}},this)},getItem:function(t){if(!BX.type.isDomNode(t)){if(!t||!BX.type.isDomNode(t.target)){return null}}else{t={target:t}}var e=this.findParentByClassName(t.target,this.classItem);if(!BX.type.isDomNode(e)){e=this.findParentByClassName(t.target,this.classDefaultSubmenuItem)}return e},setOpacity:function(t){if(!BX.type.isDomNode(t)){return}BX.style(t,"opacity",".1")},unsetOpacity:function(t){if(!BX.type.isDomNode(t)){return}BX.style(t,"opacity","1")},setDragStyles:function(){BX.addClass(this.listContainer,this.classOnDrag);BX.addClass(BX(this.getSubmenuId(true)),this.classOnDrag);this.setOpacity(this.dragItem)},unsetDragStyles:function(){var t=this.getSubmenu();this.getAllItems().forEach(function(t){this.unsetOpacity(t);BX.removeClass(t,"over")},this);if(t&&"menuItems"in t&&BX.type.isArray(t.menuItems)&&t.menuItems.length){t.menuItems.forEach(function(t){this.unsetOpacity(t);BX.removeClass(t.layout.item,"over")},this)}BX.removeClass(this.listContainer,this.classOnDrag);BX.removeClass(BX(this.getSubmenuId(true)),this.classOnDrag)},getIconClass:function(t){var e="";if(BX.type.isDomNode(t)&&"dataset"in t&&"class"in t.dataset&&BX.type.isNotEmptyString(t.dataset.class)){e=t.dataset.class}return e},disableItem:function(t){var e=this.getItemAlias(t);if(t&&"dataset"in t){t.dataset.disabled="true";if(e){e.dataset.disabled="true"}}},enableItem:function(t){var e;if(!BX.type.isDomNode(t)){return}if(this.isSubmenuItem(t)){BX.removeClass(t,this.classItemDisabled);e=this.getItemAlias(t);if(BX.type.isDomNode(e)){e.dataset.disabled="false"}}},getAliasLink:function(t){return this.dataValue(t,"link")||""},getItemAlias:function(t){var e=null;if(!BX.type.isDomNode(t)){return e}var s=this.getAllItems();var i=this.isSubmenuItem(t);var n=this.isListItem(t);if(!i&&!n){return e}if(i){s.forEach(function(s){BX.hasClass(t,this.getAliasLink(s))&&(e=s)},this)}if(n){e=BX.Buttons.Utils.getByClass(document,this.getAliasLink(t))}return e},hideItem:function(t){!!t&&BX.addClass(t,this.classSecret)},showItem:function(t){!!t&&BX.removeClass(t,this.classSecret)},fakeDragItem:function(){var t=null;if(!BX.type.isDomNode(this.dragItem)||!BX.type.isDomNode(this.overItem)){return}if(this.isDragToSubmenu()){t=this.getItemAlias(this.dragItem);if(t!==this.dragItem){this.listContainer.appendChild(this.dragItem);this.dragItem=t;this.showItem(this.dragItem);this.adjustMoreButtonPosition();this.updateSubmenuItems();this.tmp.moved=false;this.tmp.movetToSubmenu=true;this.setOpacity(this.dragItem)}}if(this.isDragToList()&&!this.tmp.movetToSubmenu){t=this.getItemAlias(this.dragItem);if(t!==this.dragItem){this.hideItem(this.dragItem);this.dragItem=t;this.adjustMoreButtonPosition();this.updateSubmenuItems();this.setOpacity(this.dragItem)}}this.tmp.movetToSubmenu=false},updateSubmenuItems:function(){var t=this.getHiddenItems();var e=this.getDisabledItems();var s=this;var i=[];var n,a,o;n=this.getSubmenu();if(n===null){return}a=n.menuItems;if(!BX.type.isArray(a)||!a.length){return}i=e.concat(t);a.forEach(function(t){o=[].some.call(i,function(e){return BX.hasClass(t.layout.item,s.dataValue(e,"link"))||s.isDisabled(t.layout.item)||s.isSeparator(t.layout.item)||s.isDropzone(t.layout.item)});if(o||(s.isSettings(t.layout.item)||s.isApplySettingsButton(t.layout.item)||s.isResetSettingsButton(t.layout.item)||s.isNotHiddenItem(t.layout.item)||s.isSeparator(t.layout.item)||t.layout.item===s.dragItem)&&!s.isMoreButton(t.layout.item)){s.showItem(t.layout.item)}else{s.hideItem(t.layout.item)}})},isNotHiddenItem:function(t){return BX.hasClass(t,this.classSubmenuNoHiddenItem)},getNotHidden:function(){return BX.Buttons.Utils.getByClass(this.getSubmenuContainer(),this.classSubmenuNoHiddenItem)},setOverStyles:function(t){if(BX.type.isDomNode(t)&&!BX.hasClass(t,this.classItemOver)){BX.addClass(t,this.classItemOver)}},unsetOverStyles:function(t){if(BX.type.isDomNode(t)&&BX.hasClass(t,this.classItemOver)){BX.removeClass(t,this.classItemOver)}},dataValue:function(t,e){var s="";var i;if(BX.type.isDomNode(t)){i=BX.data(t,e);if(typeof i!=="undefined"){s=i}}return s},execScript:function(script){if(BX.type.isNotEmptyString(script)){eval(script)}},showLicenseWindow:function(){var t;if(!B24.licenseInfoPopup){return}t=B24.licenseInfoPopup;t.init({B24_LICENSE_BUTTON_TEXT:this.message("MIB_LICENSE_BUY_BUTTON"),B24_TRIAL_BUTTON_TEXT:this.message("MIB_LICENSE_TRIAL_BUTTON"),IS_FULL_DEMO_EXISTS:this.licenseParams.isFullDemoExists,HOST_NAME:this.licenseParams.hostname,AJAX_URL:this.licenseParams.ajaxUrl,LICENSE_ALL_PATH:this.licenseParams.licenseAllPath,LICENSE_DEMO_PATH:this.licenseParams.licenseDemoPath,FEATURE_GROUP_NAME:this.licenseParams.featureGroupName,AJAX_ACTIONS_URL:this.licenseParams.ajaxActionsUrl,B24_FEATURE_TRIAL_SUCCESS_TEXT:this.message("MIB_LICENSE_WINDOW_TRIAL_SUCCESS_TEXT")});t.show("main-buttons",this.message("MIB_LICENSE_WINDOW_HEADER_TEXT"),this.message("MIB_LICENSE_WINDOW_TEXT"))},_onDragStart:function(t){var e=this.getVisibleItems();var s=BX.type.isArray(e)?e.length:null;this.dragItem=this.getItem(t);if(!BX.type.isDomNode(this.dragItem)){return}if(s===2&&this.isListItem(this.dragItem)){t.preventDefault();BX.onCustomEvent(window,"BX.Main.InterfaceButtons:onHideLastVisibleItem",[this.dragItem,this]);return}if(this.isMoreButton(this.dragItem)||this.isSeparator(this.dragItem)||this.isNotHiddenItem(this.dragItem)){t.preventDefault();return}this.isSubmenuShownOnDragStart=!!this.isSubmenuShown;if(this.isListItem(this.dragItem)){this.showSubmenu()}this.setDragStyles();if(!this.isEditEnabled()){this.enableEdit()}},_onDragEnd:function(t){t.preventDefault();var e=this.getItem(t);var s,i;if(!BX.type.isDomNode(e)){return}this.unsetDragStyles();if(!this.isSubmenuShownOnDragStart){this.refreshSubmenu();if(!this.isEditEnabled()){this.closeSubmenu()}}else{this.refreshSubmenu()}s=BX.findNextSibling(this.dragItem,BX.delegate(function(t){return this.isVisibleItem(t)},this));i=BX.findPreviousSibling(this.dragItem,BX.delegate(function(t){return this.isVisibleItem(t)},this));if(BX.type.isDomNode(i)&&(BX.hasClass(i,this.classHiddenLabel)||this.isDisabled(i)&&this.isSubmenuItem(i))||(BX.type.isDomNode(s)&&BX.hasClass(s,this.classManage)||this.isDisabled(s)&&this.isSubmenuItem(s))){this.disableItem(this.dragItem);this.refreshSubmenu()}if(this.isEditEnabled()){this.enableEdit();BX.show(this.getSettingsApplyButton());BX.hide(this.getSettingsButton())}else{this.disableEdit();BX.hide(this.getSettingsApplyButton());BX.show(this.getSettingsButton())}this.updateMoreButtonCounter();this.saveSettings();this.dragItem=null;this.overItem=null;this.tmp.moved=false},updateMoreButtonCounter:function(){var t,e,s,i;t=this.getHiddenItems();i=this.getDisabledItems();t=t.concat(i);e=0;if(BX.type.isArray(t)){t.forEach(function(t){e+=parseInt(this.dataValue(t,"counter"))||0},this)}if(BX.type.isNumber(e)){this.setMoreButtonCounter(e)}},_onDragEnter:function(t){var e=this.getItem(t);if(BX.type.isDomNode(e)&&this.isNotHiddenItem(e)){this.setOverStyles(e)}},_onDragOver:function(t){t.preventDefault();var e=null;this.overItem=this.getItem(t);if(!BX.type.isDomNode(this.overItem)||!BX.type.isDomNode(this.dragItem)||this.overItem===this.dragItem||this.isNotHiddenItem(this.overItem)){return}this.fakeDragItem();if(this.isNext(t)&&this.isGoodPosition(t)&&!this.isMoreButton(this.overItem)){e=this.findNextSiblingByClass(this.overItem,this.classItem);if(this.isMoreButton(e)&&!this.tmp.moved){e=e.previousElementSibling;this.tmp.moved=true}if(!BX.type.isDomNode(e)){e=this.findNextSiblingByClass(this.overItem,this.classSubmenuItem)}if(BX.type.isDomNode(e)){this.moveButton(e);this.moveButtonAlias(e);this.adjustMoreButtonPosition();this.updateSubmenuItems()}}if(!this.isNext(t)&&this.isGoodPosition(t)&&!this.isMoreButton(this.overItem)||!this.isGoodPosition(t)&&this.isMoreButton(this.overItem)&&this.getVisibleItems().length===1){this.moveButton(this.overItem);this.moveButtonAlias(this.overItem);this.adjustMoreButtonPosition();this.updateSubmenuItems()}},_onDragLeave:function(t){var e=this.getItem(t);if(BX.type.isDomNode(e)){this.unsetOverStyles(t.target)}},_onDrop:function(t){var e=this.getItem(t);if(!BX.type.isDomNode(e)){return}if(this.isNotHiddenItem(e)||this.isDisabled(e)){this.disableItem(this.dragItem);this.adjustMoreButtonPosition()}this.unsetDragStyles();t.preventDefault()},getIndex:function(t,e){return[].indexOf.call(t||[],e)},_onSubmenuClose:function(){this.setSubmenuShown(false);if(this.isEditEnabled()){this.activateItem(this.moreButton)}else{if(!this.isActiveInMoreMenu()){this.deactivateItem(this.moreButton)}}},_onResizeHandler:function(){this.adjustMoreButtonPosition();this.updateSubmenuItems();if(!this.isSettingsEnabled){this.visibleControlMoreButton()}},_onClickMoreButton:function(t){t.preventDefault();this.showSubmenu()},_onMouse:function(t){var e=this.getItem(t);if(t.type==="mouseover"&&!BX.hasClass(e,this.classItemOver)){BX.addClass(e,this.classItemOver)}if(t.type==="mouseout"&&BX.hasClass(e,this.classItemOver)){BX.removeClass(e,this.classItemOver)}},getSettingsResetButton:function(){return BX.Buttons.Utils.getByClass(this.getSubmenuContainer(),this.classSettingsResetButton)},_onScroll:function(){if(BX.style(this.pinContainer,"position")==="fixed"){this.closeSubmenu()}},isDisabled:function(t){var e=false;if(BX.type.isDomNode(t)){e=this.dataValue(t,"disabled")==="true"||BX.hasClass(t,this.classItemDisabled)}return e},isSettings:function(t){var e=false;if(BX.type.isDomNode(t)){e=BX.hasClass(t,this.classSettingMenuItem)}return e},isLocked:function(t){var e=false;if(BX.type.isDomNode(t)){e=this.dataValue(t,"locked")==="true"||BX.hasClass(t,this.classItemLocked)}return e},isDropzone:function(t){return BX.hasClass(t,this.classDropzone)},isNext:function(t){var e=this.dragItem.getBoundingClientRect();var s=this.overItem.getBoundingClientRect();var i=getComputedStyle(this.dragItem);var n=parseInt(i.marginRight.replace("px",""));var a=null;if(this.isListItem(this.overItem)){a=t.clientX>s.left-n&&t.clientX>e.right}if(this.isSubmenuItem(this.overItem)){a=t.clientY>e.top}return a},isGoodPosition:function(t){var e=this.overItem;var s,i;if(!BX.type.isDomNode(e)){return false}s=e.getBoundingClientRect();if(this.isListItem(e)){i=this.isNext(t)&&t.clientX>=s.left+s.width/2||!this.isNext(t)&&t.clientX<=s.left+s.width/2}if(this.isSubmenuItem(e)){i=this.isNext(t)&&t.clientY>=s.top+s.height/2||!this.isNext(t)&&t.clientY<=s.top+s.height/2}return i},isSubmenuItem:function(t){return BX.hasClass(t,this.classSubmenuItem)},isVisibleItem:function(t){if(!BX.type.isDomNode(t)){return false}return t.offsetTop===0},isMoreButton:function(t){var e=false;if(BX.type.isDomNode(t)&&BX.hasClass(t,this.classItemMore)){e=true}return e},isListItem:function(t){var e=false;if(BX.type.isDomNode(t)&&BX.hasClass(t,this.classItem)){e=true}return e},isSublink:function(t){var e=false;if(BX.type.isDomNode(t)){e=BX.hasClass(t,this.classItemSublink)}return e},isSeparator:function(t){var e=false;if(BX.type.isDomNode(t)){e=BX.hasClass(t,this.classSeporator)}return e},isDragToSubmenu:function(){return!this.isSubmenuItem(this.dragItem)&&this.isSubmenuItem(this.overItem)},isDragToList:function(){return this.isSubmenuItem(this.dragItem)&&!this.isSubmenuItem(this.overItem)}}}if(typeof BX.Main.interfaceButtonsManager==="undefined"){BX.Main.interfaceButtonsManager={data:{},init:function(t){var e=null;if(!BX.type.isPlainObject(t)||!("containerId"in t)){throw"BX.Main.interfaceButtonsManager: containerId not set in params Object"}e=BX(t.containerId);if(BX.type.isDomNode(e)){this.data[t.containerId]=new BX.Main.interfaceButtons(e,t)}else{BX(BX.delegate(function(){e=BX(t.containerId);if(!BX.type.isDomNode(e)){throw"BX.Main.interfaceButtonsManager: container is not dom node"}this.data[t.containerId]=new BX.Main.interfaceButtons(e,t)},this))}},getById:function(t){var e=null;if(BX.type.isString(t)&&BX.type.isNotEmptyString(t)){try{e=this.data[t]}catch(t){}}return e},getObjects:function(){return this.data}}}
/* End */
;
; /* Start:"a:4:{s:4:"full";s:94:"/bitrix/components/bitrix/main.interface.buttons/templates/.default/utils.min.js?1518596169575";s:6:"source";s:76:"/bitrix/components/bitrix/main.interface.buttons/templates/.default/utils.js";s:3:"min";s:80:"/bitrix/components/bitrix/main.interface.buttons/templates/.default/utils.min.js";s:3:"map";s:80:"/bitrix/components/bitrix/main.interface.buttons/templates/.default/utils.map.js";}"*/
(function(){"use strict";BX.namespace("BX.Buttons");BX.Buttons.Utils={getByClass:function(e,t,l){var n=[];if(t){n=(e||document.body).getElementsByClassName(t);if(!l){n=n.length?n[0]:null}else{n=[].slice.call(n)}}return n},getByTag:function(e,t,l){var n=[];if(t){n=(e||document.body).getElementsByTagName(t);if(!l){n=n.length?n[0]:null}else{n=[].slice.call(n)}}return n},getBySelector:function(e,t,l){var n=[];if(t){if(!l){n=(e||document.body).querySelector(t)}else{n=(e||document.body).querySelectorAll(t);n=[].slice.call(n)}}return n}}})();
/* End */
;
; /* Start:"a:4:{s:4:"full";s:89:"/bitrix/components/bitrix/faceid.tracker/templates/.default/script.min.js?151859619223781";s:6:"source";s:69:"/bitrix/components/bitrix/faceid.tracker/templates/.default/script.js";s:3:"min";s:73:"/bitrix/components/bitrix/faceid.tracker/templates/.default/script.min.js";s:3:"map";s:73:"/bitrix/components/bitrix/faceid.tracker/templates/.default/script.map.js";}"*/
var domNode=BX.create("script",{attrs:{src:"/bitrix/js/main/webrtc/adapter.js",type:"text/javascript"}});document.head.insertBefore(domNode,document.head.firstChild);var jsDetectionInProgress=false;var Module,isModuleInitialized,isBxFaceIdInitialized;var faceTrackerSettings={socnet_enabled:true};if(typeof Module==="undefined"){Module={}}Module.onRuntimeInitialized=function(){isModuleInitialized=true;_BXFaceIdStart()};function BXFaceIdStart(e){for(var a in e){faceTrackerSettings[a]=e[a]}isBxFaceIdInitialized=true;_BXFaceIdStart()}function _BXFaceIdStart(){if(!isModuleInitialized||!isBxFaceIdInitialized){return}var e=false;var a=false;var t=null;var r=null;var s=null;var c=null;var n=BX.localStorage.get("faceid-default-camera");var d=null;var o={cameraRatio:0,screenRatio:window.screen.width/window.screen.height,cameraSmallWidth:340,cameraSmallHeight:0,cameraFullWidth:0,cameraFullHeight:0,snapshotWidth:640,snapshotHeight:0,trackingSmallRatio:0,trackingFullRatio:0,cameraWidth:0,cameraHeight:0,trackingRatio:0};var l=null;var f=null;var u=[];var m={};var h=new Module.WebPhotoMakerM;h.setStopAfterBestShot(true);h.setMovementThreshold(.03);h.setBestShotScoreThreshold(.05);h.setRotationThreshold(50);h.setMinFaceScaleFactor(.15);h.setMaxNumberOfFramesWithoutDetection(8);var v=o.snapshotWidth*o.snapshotWidth*4;var g=Module._malloc(v);var p=new Uint8ClampedArray(Module.HEAPU8.buffer,g,v);var k=[-1,-1,-1,-1,-1,-1];var B=["","","","","",""];function X(){if(!navigator.mediaDevices||!navigator.mediaDevices.enumerateDevices){b(BX.message("FACEID_TRACKER_CMP_JS_CAMERA_ERROR"));return}navigator.mediaDevices.enumerateDevices().then(function(e){var a=document.getElementById("faceid-cameralist");var t="faceid-tracker-sidebar-photo-settings-checked";e.forEach(function(e){if(e.kind=="videoinput"){if(n==null){n=e.deviceId;BX.localStorage.set("faceid-default-camera",n,3600*24*360)}var i="faceid-tracker-sidebar-photo-settings-inner-list-item";var r=e.label.replace(/\(\w{4}:\w{4}\)/g,"");if(!r.length){r=BX.message("FACEID_TRACKER_CMP_JS_CAMERA_DEFAULT")}if(e.deviceId==n){i+=" "+t}var s=BX.create("div",{text:r,attrs:{"class":i,"data-camera-id":e.deviceId}});a.appendChild(s);BX.bind(s,"click",function(){if(BX.hasClass(BX(this),t)){return}var e,i=BX.findChildren(a);for(e in i){BX.removeClass(i[e],t)}BX.addClass(BX(this),t);n=this.getAttribute("data-camera-id");BX.localStorage.set("faceid-default-camera",n,3600*24*360);_();BX.toggle(BX("faceid-settings-container"))})}});C()}).catch(function(e){console.log(e.name+": "+e.message);b(BX.message("FACEID_TRACKER_CMP_JS_CAMERA_ERROR"))})}if(window.FACEID_AGREEMENT){X()}BX.bind(BX("faceid-settings-button"),"click",function(){BX.toggle(BX("faceid-settings-container"))});function _(){navigator.getMedia=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia;navigator.getMedia({video:{deviceId:{exact:n}},audio:false},function(e){if(navigator.mozGetUserMedia){t.mozSrcObject=e}else{var a=window.URL||window.webkitURL;t.src=a.createObjectURL(e)}t.play()},function(e){console.log("An error occured! "+e);BX.localStorage.remove("faceid-default-camera");var a;if(e.toString().indexOf("DevicesNotFound")>=0){a=BX.message("FACEID_TRACKER_CMP_JS_CAMERA_NOT_FOUND")}else{a=BX.message("FACEID_TRACKER_CMP_JS_CAMERA_NO_SUPPORT")}b(a)})}function C(){t=document.getElementById("faceid-video");r=document.getElementById("faceid-canvas");c=document.getElementById("faceid-startbutton");_();l=document.getElementById("faceid-overlay-face-border");f=l.getContext("2d");t.addEventListener("canplay",function(e){if(!a){o.cameraRatio=t.videoWidth/t.videoHeight;o.cameraSmallHeight=t.videoHeight/(t.videoWidth/o.cameraSmallWidth);if(o.screenRatio>=o.cameraRatio){o.cameraFullHeight=window.screen.height;o.cameraFullWidth=t.videoWidth/(t.videoHeight/o.cameraFullHeight)}else{o.cameraFullWidth=window.screen.width;o.cameraFullHeight=t.videoHeight/(t.videoWidth/o.cameraFullWidth)}o.snapshotHeight=t.videoHeight/(t.videoWidth/o.snapshotWidth);o.trackingSmallRatio=o.cameraSmallWidth/o.snapshotWidth;o.trackingFullRatio=o.cameraFullWidth/o.snapshotWidth;o.cameraWidth=o.cameraSmallWidth;o.cameraHeight=o.cameraSmallHeight;o.trackingRatio=o.trackingSmallRatio;t.setAttribute("width",o.cameraWidth);t.setAttribute("height",o.cameraHeight);r.setAttribute("width",o.snapshotWidth);r.setAttribute("height",o.snapshotHeight);l.setAttribute("width",o.cameraWidth);l.setAttribute("height",o.cameraHeight);a=true;S()}},false);c.addEventListener("click",function(e){T();e.preventDefault()},false);if(window.FACEID_LAST_VISITORS){for(i in window.FACEID_LAST_VISITORS){y(window.FACEID_LAST_VISITORS[i],false)}}}function b(e){BX("faceid-camera-error").innerHTML=e;BX.show(BX("faceid-camera-error"))}function S(){requestAnimationFrame(S);if($("#faceid-auto-identify").prop("checked")==false){return}if(e){return}if(u.length){}e=true;var a=r.getContext("2d");a.drawImage(t,0,0,o.snapshotWidth,o.snapshotHeight);var i=r.toDataURL("image/jpeg",1);var s=new Image;s.onload=function(){var a=w(r,true);if(a.length>0){var t=[];for(var i in a){if(!m[a[i].frameId]&&h.getBestShotFrameNumber(a[i].frameId)>=0&&h.getCurrentFrameNumber()>=h.getBestShotFrameNumber(a[i].frameId)){t.push(a[i])}}if(t.length){x(t,s)}}e=false};s.onerror=function(){e=false};s.src=i;requestAnimationFrame(S)}function A(e){for(var a=0;a<k.length;a++){var t=0;for(var i=0;i<e.length;i++){if(e[i]!=k[a])t++;else break}if(t==e.length){k[a]=-1;B[a]=""}}for(var i=0;i<e.length;i++){var r=true;for(var a=0;a<k.length;a++){if(e[i]==k[a]){r=false;break}}if(r){for(var a=0;a<k.length;a++){if(k[a]==-1){k[a]=e[i];break}}}}}function R(e,a,t,i,r){e.save();e.strokeStyle="rgba("+i[0]+", "+i[1]+", "+i[2]+", "+i[3]+")";e.lineWidth=3;try{var s=a.x;var c=a.y;var n=a.x+a.width;var d=a.y+a.height;var o=t;var l=Math.PI/180;if(n-s-2*o<0){o=(n-s)/2}if(d-c-2*o<0){o=(d-c)/2}e.beginPath();e.moveTo(s+o,c);e.lineTo(n-o,c);e.arc(n-o,c+o,o,l*270,l*360,false);e.lineTo(n,d-o);e.arc(n-o,d-o,o,l*0,l*90,false);e.lineTo(s+o,d);e.arc(s+o,d-o,o,l*90,l*180,false);e.lineTo(s,c+o);e.arc(s+o,c+o,o,l*180,l*270,false);e.closePath();e.font="bold 11px opensans";e.fillStyle="#91ff4f";var f="";if(m[r]){f=m[r].name}e.fillText(f.toUpperCase(),s,c-5);e.stroke();e.restore()}catch(u){console.log("BAD VALUE OF DETECTION");console.log(u)}}function T(e){if(!e){var a=r.getContext("2d");a.drawImage(t,0,0,o.snapshotWidth,o.snapshotHeight);e=r.toDataURL("image/jpeg",1)}var i=new Image;i.onload=function(){var e=true;if(e){var a=w(r);x(a,i)}else{E(i.getAttribute("src"))}};i.src=e}function w(e,a){var i=[];var r=e.getContext("2d");r.drawImage(t,0,0,o.snapshotWidth,o.snapshotHeight);var s=e;var c=s.getContext("2d");var n=c.getImageData(0,0,o.snapshotWidth,o.snapshotHeight);p.set(n.data,0);h.submitRawImage(g,o.snapshotWidth,o.snapshotHeight);h.update();f.clearRect(0,0,l.width,l.height);var d=h.getIds();var m=JSON.parse(d);var v=m["ids"];A(v);if(v.length){for(var k=0;k<v.length;k++){var B=v[k];var X=h.getSmoothedFaceDetection(B);var _=h.faceDetectionIsPredicted(B);var C=[145,255,79,255];var b="";var S=h.isSlowMovement(B);if(!S)b="TOO FAST!!!";if(_)b="PREDICT";if(_||!S){C=[255,0,0,255]}var T=JSON.parse(JSON.stringify(X));T.x=X.x*o.trackingRatio;T.y=X.y*o.trackingRatio;T.width=X.width*o.trackingRatio;T.height=X.height*o.trackingRatio;R(f,T,10,C,B);if(u.indexOf(B)==-1){i.push({frameId:B,width:X.width,height:X.height,positionX:X.x,positionY:X.y})}}}if(!a){I()}return i}function I(){requestAnimationFrame(function(){requestAnimationFrame(function(){h.reset();f.clearRect(0,0,l.width,l.height)})})}function x(e,a){var t=false;if(e.length>0){for(i=0;i<e.length;i++){{var r=e[i];var s=document.createElement("canvas");s.setAttribute("width",100);s.setAttribute("height",100);var c=s.getContext("2d");var n=.6;var d=Math.max(0,r.positionX-r.width*n/2);var l=Math.max(0,r.positionY-r.height*n/2);var f=r.width+r.width*n;var u=r.height+r.height*n;if(d+f>o.snapshotWidth){d=o.snapshotWidth-f}if(l+u>o.snapshotHeight){l=o.snapshotHeight-u}var m=100;var h=100;var v=0;var g=0;c.drawImage(a,d,l,f,u,v,g,m,h);var p=s.toDataURL("image/jpeg");E(p,r.frameId);t=true}}}if(!t){E(a.src,false,true)}}function E(e,a,t){BX.addClass(BX("faceid-tracker-main-user-start-block"),"faceid-tracker-animate-hidden");var i=BX.create("div",{attrs:{"class":"faceid-tracker-main-user-item faceid-tracker-first-item"}});i.innerHTML='<div class="faceid-tracker-main-user-photo"> 					<div class="faceid-tracker-main-user-photo-platform"> 						<span class="faceid-tracker-main-user-photo-platform-item">CRM</span> 					</div> 					<div class="faceid-tracker-main-user-photo-item"> 						<img width="100" height="100"> 					</div> 					<div class="faceid-tracker-main-user-photo-count"> 						<span class="faceid-tracker-main-user-photo-count-item">58%</span> 						<div class="faceid-tracker-main-user-photo-count-info"> 							<div class="faceid-tracker-main-user-photo-count-info-desc"></div> 							<div class="faceid-tracker-main-user-photo-item"></div> 						</div> 					</div> 				</div> 				<div class="faceid-tracker-main-user-info"> 					<div class="faceid-tracker-user-loader"> 						<div class="faceid-tracker-user-loader-item"> 							<div class="faceid-tracker-loader"> 								<svg class="faceid-tracker-circular" viewBox="25 25 50 50"> 									<circle class="faceid-tracker-path" cx="50" cy="50" r="20" fill="none" stroke-width="1" stroke-miterlimit="10"/> 								</svg> 							</div> 						</div> 					</div> 				</div>';BX.prepend(i,BX("faceid-tracker-main-user-container"));var r=20;var s=BX.findChildren(BX("faceid-tracker-main-user-container"),{"class":"faceid-tracker-main-user-item"});if(s.length>r){d=s[s.length-2].getAttribute("data-last-visit-ts");var c=s[s.length-1];c.remove()}var n=BX.findChild(i,{"class":"faceid-tracker-main-user-photo-item"},true);var o=BX.findChild(n,{tag:"img"});o.setAttribute("src",e);if(t){BX.addClass(i,"faceid-tracker-user-warning");var l=BX.findChild(i,{"class":"faceid-tracker-main-user-info"},true);l.innerHTML='<div class="faceid-tracker-main-user-info-name"> 				<div class="faceid-tracker-main-user-info-name-warning">'+BX.message("FACEID_TRACKER_CMP_JS_FACE_NOT_FOUND")+"</div> 			</div>"}else{var f=a>=0?a:"faceid-ajax-unique-"+Math.random();M(f);BX.ajax({url:"/bitrix/components/bitrix/faceid.tracker/ajax.php",method:"POST",data:{action:"identify",image:e},dataType:"json",processData:false,start:true,onsuccess:function(t){F(f);var r=false;var s=BX.message("FACEID_TRACKER_CMP_JS_FACE_NOT_FOUND");if(t.length){var c=JSON.parse(t);if(c.visitor&&!N(c.visitor)){r=true;var n=c.visitor;n.image_src=n.shot_src;n.shot_src=e;var d=O(i,n);if(a>=0){m[a]={name:n.name}}if(d){H(n)}}else if(c.error&&c.error.msg){s=c.error.msg}if(c.status&&c.status.balance>=0){BX("faceid-credits-balance").innerText=c.status.balance}}if(!r){h.discardBestShot(a);BX.addClass(i,"faceid-tracker-user-warning");var o=BX.findChild(i,{"class":"faceid-tracker-main-user-info"},true);o.innerHTML='<div class="faceid-tracker-main-user-info-name"> 							<div class="faceid-tracker-main-user-info-name-warning">'+s+"</div> 						</div>"}},onfailure:function(){F(f);h.discardBestShot(a)}})}}function M(e){u.push(e)}function F(e){var a=u.indexOf(e);if(a>-1){u.splice(a,1)}}function y(e,a){BX.addClass(BX("faceid-tracker-main-user-start-block"),"faceid-tracker-animate-hidden");var t=BX.create("div",{attrs:{"class":"faceid-tracker-main-user-item faceid-tracker-first-item"}});var i=O(t,e);BX.prepend(t,BX("faceid-tracker-main-user-container"));if(e.last_visit_ts<d||d==null){d=e.last_visit_ts}if(i){H(e,a)}}function D(e,a){BX.addClass(BX("faceid-tracker-main-user-start-block"),"faceid-tracker-animate-hidden");var t=BX.create("div",{attrs:{"class":"faceid-tracker-main-user-item faceid-tracker-first-item"}});var i=O(t,e);if(BX("faceid-tracker-main-user-more")){BX("faceid-tracker-main-user-container").insertBefore(t,BX("faceid-tracker-main-user-more"))}else{BX.append(t,BX("faceid-tracker-main-user-container"))}if(e.last_visit_ts<d||d==null){d=e.last_visit_ts}if(i){H(e,a)}}function H(e,a){a=typeof a!=="undefined"?a:true;BX("faceid-stats-current-count").innerText=parseInt(BX("faceid-stats-current-count").innerText)+1;if(a){if(e.visits_count<=1){BX("faceid-stats-new-count").innerText=parseInt(BX("faceid-stats-new-count").innerText)+1}else{BX("faceid-stats-old-count").innerText=parseInt(BX("faceid-stats-old-count").innerText)+1}BX("faceid-stats-total-count").innerText=parseInt(BX("faceid-stats-total-count").innerText)+1;if(e.crm_url.length){BX("faceid-stats-crm-count").innerText=parseInt(BX("faceid-stats-crm-count").innerText)+1}}}function O(e,a){var t=true;var i=typeof a=="string"?JSON.parse(a):a;e.setAttribute("data-visitor-id",i.visitor_id);var r=BX.findChildren(BX("faceid-tracker-main-user-container"),{attr:{"data-visitor-id":i.visitor_id}});if(r){var s;for(s in r){if(r[s]!=e){r[s].remove();t=false}}}if(i.confidence>0){BX.addClass(e,"faceid-tracker-photo")}if(i.crm_url.length>0){BX.addClass(e,"faceid-tracker-platform")}if(i.vk_id.length>0){BX.addClass(e,"faceid-tracker-social-state")}e.setAttribute("data-last-visit-ts",i.last_visit_ts);var c='<div class="faceid-tracker-main-user-photo"> 						<div class="faceid-tracker-main-user-photo-platform"> 							<span class="faceid-tracker-main-user-photo-platform-item">CRM</span> 						</div> 						<div class="faceid-tracker-main-user-photo-item"> 							<img width="100" height="100"> 						</div> 						<div class="faceid-tracker-main-user-photo-count"> 							<span class="faceid-tracker-main-user-photo-count-item">'+i.confidence+'%</span> 							<div class="faceid-tracker-main-user-photo-count-info"> 								<div class="faceid-tracker-main-user-photo-count-info-desc">'+BX.message("FACEID_TRACKER_CMP_JS_FACE_ORIGINAL")+'</div> 								<div class="faceid-tracker-main-user-photo-item" style="background-image: url('+i.image_src+')"></div> 							</div> 						</div> 					</div> 					<div class="faceid-tracker-main-user-info"> 						<div class="faceid-tracker-main-user-info-description"> 							<span class="faceid-tracker-main-user-info-description-item">'+i.visit_info+'</span> 						</div> 						<div class="faceid-tracker-main-user-info-name">';if(i.crm_url.length)c+='<a href="'+i.crm_url+'" class="faceid-tracker-main-user-info-name-item" target="_blank">'+i.name+"</a>";else c+='<div class="faceid-tracker-main-user-info-name-item">'+i.name+"</div>";c+='						</div> 						<div class="faceid-tracker-main-user-info-control">';if(!i.crm_url.length)c+='							<div class="faceid-tracker-main-user-info-control-block'+(i.crm_url.length?" faceid-tracker-button-state":"")+'"> 								<div class="webform-small-button webform-small-button-blue faceid-tracker-main-user-info-control-button">'+BX.message("FACEID_TRACKER_CMP_JS_SAVE_CRM")+' 									<div class="faceid-tracker-user-loader"> 										<div class="faceid-tracker-user-loader-item"> 											<div class="faceid-tracker-loader"> 												<svg class="faceid-tracker-circular" viewBox="25 25 50 50"> 													<circle class="faceid-tracker-path" cx="50" cy="50" r="20" fill="none" stroke-width="1" stroke-miterlimit="10"/> 												</svg> 											</div> 										</div> 									</div> 								</div> 								<div class="webform-small-button webform-small-button-transparent faceid-tracker-main-user-info-control-button">'+BX.message("FACEID_TRACKER_CMP_JS_SAVE_CRM_DONE")+"</div> 							</div>";c+='							<div class="faceid-tracker-main-user-info-control-social"> 								<span class="faceid-tracker-main-user-info-control-social-name">'+BX.message("FACEID_TRACKER_CMP_JS_VK_LINK")+"</span>";if(i.vk_id.length)c+='									<a href="http://vk.com/'+BX.util.htmlspecialchars(i.vk_id)+'" class="faceid-tracker-main-user-info-control-social-item">'+"VK.com/"+BX.util.htmlspecialchars(i.vk_id)+"</a>";else if(faceTrackerSettings.socnet_enabled)c+='									<span class="faceid-tracker-main-user-info-control-social-item"><span>'+BX.message("FACEID_TRACKER_CMP_JS_VK_LINK_ACTION")+"</span></span>";c+="							</div> 						</div> 					</div>";e.innerHTML=c;var n=BX.findChild(e,{"class":"faceid-tracker-main-user-photo-item"},true);var d=BX.findChild(n,{tag:"img"});d.setAttribute("src",i.shot_src);if(!i.vk_id.length){var o=BX.clone(BX("faceid-tracker-profile-search-example"));o.id="";o.style.top=document.body.scrollTop+596+30+"px";var l=BX.findChild(e,{"class":"faceid-tracker-main-user-info-control-social-item"},true);var f=BX.findChild(o,{"class":"faceid-tracker-profile-search-header"},true);var u=0;var m=0;var h=function(e){var a=u-e.clientX;var t=m-e.clientY;o.style.left=parseInt(o.style.left)-a+"px";o.style.top=parseInt(o.style.top)-t+"px";u=e.clientX;m=e.clientY};var v=function(){BX.unbind(document,"mousemove",h);BX.unbind(document,"mouseup",v)};BX.bind(f,"mousedown",function(e){var a=BX.pos(o);o.style.left=a.left+"px";o.style.top=a.top+"px";u=e.clientX;m=e.clientY;o.style.transform="translate(0)";BX.bind(document,"mousemove",h);BX.bind(document,"mouseup",v)});document.body.appendChild(o);var g=BX.findChild(l,{tag:"span"});BX.bind(g,"click",function(){BX.show(o);if(o.getAttribute("data-in-progress")){return}o.setAttribute("data-in-progress","1");BX.ajax({url:"/bitrix/components/bitrix/faceid.tracker/ajax_vk.php",method:"POST",data:{action:"identify",image:i.shot_src,visitor_id:i.visitor_id},dataType:"json",processData:false,start:true,onsuccess:function(a){var t=JSON.parse(a);var r=t.items;if(t.status&&t.status.balance>=0){BX("faceid-credits-balance").innerText=t.status.balance}if(r.length){var s,c="";c=W(r[0],true);var n=BX.findChild(o,{"class":"faceid-tracker-profile-search-main"},true);n.innerHTML=c+n.innerHTML;c="";r.splice(0,1);for(s in r){c+=W(r[s])}n=BX.findChild(o,{"class":"faceid-tracker-profile-search-found-container"},true);n.innerHTML=c;var d=BX.findChild(o,{"class":"faceid-tracker-profile-search-found-more-count"},true);d.innerHTML=r.length+" "+BX.message("FACEID_TRACKER_CMP_JS_VK_FOUND_PEOPLE");var f=BX.findChild(o,{"class":"faceid-tracker-profile-search-loading"},true);BX.addClass(f,"faceid-tracker-animate-hidden");var u=BX.findChildren(o,{"class":"faceid-tracker-main-user-info-control-button"},true);for(s in u){BX.bind(u[s],"click",function(){var a=BX(this).parentNode.parentNode;var t=BX.findChild(a,{"class":"faceid-tracker-main-user-social-link-item"},true).innerText;var r=l.parentNode;l.remove();r.innerHTML+='<a href="http://'+t+'" class="faceid-tracker-main-user-info-control-social-item">'+t.replace("vk.com","VK.com")+"</a>";BX.addClass(e,"faceid-tracker-social-state");BX.hide(o);BX.ajax({url:"/bitrix/components/bitrix/faceid.tracker/ajax_vk.php",method:"POST",data:{action:"save",vk_id:t.replace("vk.com/",""),visitor_id:i.visitor_id},dataType:"json",processData:false,start:true,onsuccess:function(a){var t=JSON.parse(a);var r=BX.findChild(e,{"class":"faceid-tracker-main-user-info-name"},true);r.innerHTML='<a href="'+t.url+'" class="faceid-tracker-main-user-info-name-item">'+i.name+"</a>"}})})}}else if(t.error&&t.error.msg){var f=BX.findChild(o,{"class":"faceid-tracker-loader"},true);BX.hide(f);var m=BX.findChild(o,{"class":"faceid-tracker-profile-search-loading-desc"},true);BX.hide(m);var h=BX.findChild(o,{"class":"faceid-tracker-error"},true);h.innerHTML=t.error.msg;BX.show(h)}}})});var p=BX.findChild(o,{"class":"faceid-tracker-header-description-close-item"},true);BX.bind(p,"click",function(){BX.hide(o)})}var k=BX.findChild(e,{"class":"webform-small-button-blue"},true);BX.bind(k,"click",function(){var a=BX(this).parentNode;if(!BX.hasClass(a,"faceid-tracker-button-state")&&!BX.hasClass(a,"faceid-control-loader-state")){BX.addClass(a,"faceid-control-loader-state");BX.ajax({url:"/bitrix/components/bitrix/faceid.tracker/ajax_crm.php",method:"POST",data:{action:"addLead",lead_title:i.name,visitor_id:i.visitor_id},dataType:"json",processData:false,start:true,onsuccess:function(t){var r=JSON.parse(t);var s=BX.findChild(e,{"class":"faceid-tracker-main-user-info-name"},true);s.innerHTML='<a href="'+r.url+'" class="faceid-tracker-main-user-info-name-item" target="_blank">'+i.name+"</a>";BX.removeClass(a,".faceid-control-loader-state");BX.addClass(a,"faceid-tracker-button-state")}})}});return t}function W(e,a){var t='<div class="faceid-tracker-main-user-item faceid-tracker-profile-search-found faceid-tracker-photo'+(a?" faceid-tracker-found-user":"")+'"> 					<div class="faceid-tracker-main-user-photo"> 						<div class="faceid-tracker-main-user-photo-platform"> 							<span class="faceid-tracker-main-user-photo-platform-item">CRM</span> 						</div> 						<div class="faceid-tracker-main-user-photo-item" style="background-image: url('+BX.util.htmlspecialchars(e.photo)+')"></div> 						<div class="faceid-tracker-main-user-photo-count"> 							<span class="faceid-tracker-main-user-photo-count-item">'+Math.round(e.confidence*100)+'%</span> 						</div> 					</div> 					<div class="faceid-tracker-main-user-info"> 						<div class="faceid-tracker-main-user-info-name"> 							<div class="faceid-tracker-main-user-info-name-item">'+BX.util.htmlspecialchars(e.name)+'</div> 							<div class="faceid-tracker-main-user-date"> 								<span class="faceid-tracker-main-user-date-item">'+BX.util.htmlspecialchars(e.personal)+'</span> 							</div> 							<div class="faceid-tracker-main-user-social-link"> 								<a href="http://vk.com/'+BX.util.htmlspecialchars(e.id)+'" class="faceid-tracker-main-user-social-link-item">vk.com/'+BX.util.htmlspecialchars(e.id)+'</a> 							</div> 						</div> 						<div class="faceid-tracker-main-user-info-control"> 							<div class="webform-small-button webform-small-button-blue faceid-tracker-main-user-info-control-button '+(a?"":"faceid-tracker-search-button")+'">'+BX.message("FACEID_TRACKER_CMP_JS_VK_SELECT")+"</div> 						</div> 					</div> 				</div>";return t}BX.ready(function(){BX.bind(BX("faceid-tracker-main-user-more"),"click",function(){if(!d){return}BX.ajax({url:"/bitrix/components/bitrix/faceid.tracker/ajax_more.php",method:"POST",data:{last:d},dataType:"json",processData:false,start:true,onsuccess:function(e){var a,t=JSON.parse(e);if(t.items.length){for(a in t.items){D(t.items[a],false)}}if(t.more==0){BX("faceid-tracker-main-user-more").remove()}}})});BX.bind(BX("faceid-tracker-header-description-close"),"click",function(){BX.localStorage.set("faceid-description-read","1",3600*24*360);BX(this).parentNode.remove()});if(!BX.localStorage.get("faceid-description-read")){BX.show(BX("faceid-tracker-header-description-close").parentNode)}BX.bind(BX("faceid-auto-identify"),"change",function(){if(!BX(this).checked){I()}})});function N(e){if(e.hasOwnProperty("length"))return e.length==0;for(var a in e){if(e.hasOwnProperty(a))return false}return JSON.stringify(e)===JSON.stringify({})}BX.bind(BX("faceid-fullscreen-button"),"click",function(){var e=t;var a=BX.findParent(e,{"class":"faceid-tracker-wrapper"});var i=BX("faceid-video").parentNode;if(BX.getFullScreenElement()){BX.cancelFullScreen()}else{BX.requestFullScreen(i)}});BX.bind(document,"fullscreenchange",function(){var e=BX.findParent(t,{"class":"faceid-tracker-wrapper"});var a=BX("faceid-fullscreen-button");BX.toggleClass(e,"faceid-tracker-full-mode");BX.toggleClass(a,"faceid-tracker-sidebar-photo-full-mode");BX.toggleClass(a,"faceid-tracker-sidebar-photo-fullback-mode");if(!BX.getFullScreenElement()){o.cameraWidth=o.cameraSmallWidth;o.cameraHeight=o.cameraSmallHeight;o.trackingRatio=o.trackingSmallRatio}else{o.cameraWidth=o.cameraFullWidth;o.cameraHeight=o.cameraFullHeight;o.trackingRatio=o.trackingFullRatio}t.setAttribute("width",o.cameraWidth);t.setAttribute("height",o.cameraHeight);l.setAttribute("width",o.cameraWidth);l.setAttribute("height",o.cameraHeight)})}
/* End */
;; /* /bitrix/components/bitrix/main.interface.buttons/templates/.default/script.min.js?151859616937794*/
; /* /bitrix/components/bitrix/main.interface.buttons/templates/.default/utils.min.js?1518596169575*/
; /* /bitrix/components/bitrix/faceid.tracker/templates/.default/script.min.js?151859619223781*/

//# sourceMappingURL=page_eac068304bcbe0f28014e159b31c1fe8.map.js