; /* /bitrix/js/crm/kanban/grid.min.js?15185961849130*/
; /* /bitrix/js/crm/kanban/item.min.js?151859618410485*/
; /* /bitrix/js/crm/kanban/column.min.js?15185961842791*/

; /* Start:"a:4:{s:4:"full";s:48:"/bitrix/js/crm/kanban/grid.min.js?15185961849130";s:6:"source";s:29:"/bitrix/js/crm/kanban/grid.js";s:3:"min";s:0:"";s:3:"map";s:0:"";}"*/
(function(){"use strict";BX.namespace("BX.CRM.Kanban");BX.CRM.Kanban.Grid=function(t){BX.Kanban.Grid.apply(this,arguments);BX.addCustomEvent(this,"Kanban.DropZone:onBeforeItemCaptured",BX.delegate(this.onBeforeItemCaptured,this));BX.addCustomEvent(this,"Kanban.DropZone:onBeforeItemRestored",BX.delegate(this.onBeforeItemRestored,this));BX.addCustomEvent(this,"Kanban.Grid:onBeforeItemMoved",BX.delegate(this.onBeforeItemMoved,this));BX.addCustomEvent(this,"Kanban.Grid:onItemMoved",BX.delegate(this.onItemMoved,this));BX.addCustomEvent(this,"Kanban.Grid:onColumnAddedAsync",BX.delegate(this.onColumnAddedAsync,this));BX.addCustomEvent(this,"Kanban.Grid:onColumnUpdated",BX.delegate(this.onColumnUpdated,this));BX.addCustomEvent(this,"Kanban.Grid:onColumnMoved",BX.delegate(this.onColumnMoved,this));BX.addCustomEvent(this,"Kanban.Grid:onColumnRemovedAsync",BX.delegate(this.onColumnRemovedAsync,this));BX.addCustomEvent(this,"Kanban.Grid:onColumnLoadAsync",BX.delegate(this.onColumnLoadAsync,this));BX.addCustomEvent(this,"Kanban.Grid:onItemDragStart",BX.delegate(this.onItemDragStartHandler,this));BX.addCustomEvent("BX.Main.Filter:apply",BX.delegate(this.onApplyFilter,this));BX.addCustomEvent("BX.CrmEntityCounterPanel:applyFilter",BX.delegate(this.onApplyFilterCounter,this));BX.addCustomEvent("onPullEvent-crm",BX.proxy(this.onPullEventHandlerCrm,this));BX.addCustomEvent("onPullEvent-im",BX.proxy(this.onPullEventHandlerCrm,this));BX.addCustomEvent("onCrmActivityTodoChecked",BX.proxy(this.onCrmActivityTodoChecked,this));BX.addCustomEvent("SidePanel.Slider:onClose",BX.proxy(this.onSliderClose,this));setInterval(BX.proxy(this.loadNew,this),this.loadNewInterval*1e3)};BX.CRM.Kanban.Grid.prototype={__proto__:BX.Kanban.Grid.prototype,constructor:BX.CRM.Kanban.Grid,accessNotifyDialog:null,loadNewInterval:25,ajaxParams:{},getAjaxHandlerPath:function(){var t=this.getData();return BX.type.isNotEmptyString(t.ajaxHandlerPath)?t.ajaxHandlerPath:"/bitrix/components/bitrix/crm.kanban/ajax.php"},setAjaxParams:function(t){this.ajaxParams=t},ajax:function(t,e,a,i){var n=this.getData();var r=this.getAjaxHandlerPath();if(typeof i==="undefined"){i="json"}t.sessid=BX.bitrix_sessid();t.extra=n.params;t.entity_type=n.entityType;t.version=2;t.ajaxParams=this.ajaxParams;if(t.action!=="undefined"){r+=r.indexOf("?")===-1?"?":"&";r+="action="+t.action}BX.ajax({method:"POST",dataType:i,url:r,data:t,onsuccess:e,onfailure:a})},accessNotify:function(){if(typeof BX.Intranet!=="undefined"&&typeof BX.Intranet.NotifyDialog!=="undefined"){if(this.accessNotifyDialog===null){var t=this.getData();this.accessNotifyDialog=new BX.Intranet.NotifyDialog({listUserData:[],notificationHandlerUrl:this.getAjaxHandlerPath()+"?action=notifyAdmin&version=2&entity_type="+t.entityType,popupTexts:{sendButton:BX.message("CRM_KANBAN_NOTIFY_BUTTON"),title:BX.message("CRM_KANBAN_NOTIFY_TITLE"),header:BX.message("CRM_KANBAN_NOTIFY_HEADER"),description:BX.message("CRM_KANBAN_NOTIFY_TEXT")}})}this.accessNotifyDialog.setUsersForNotify(this.getData().admins);this.accessNotifyDialog.show()}},addStage:function(t){var e=new BX.Promise;var a=this.getPreviousColumnSibling(t);var i=a?a.getId():0;this.ajax({action:"modifyStage",columnName:t.getName(),columnColor:t.getColor(),afterColumnId:i},function(t){if(t&&!t.error){e.fulfill(t)}else if(t){BX.Kanban.Utils.showErrorDialog(t.error,t.fatal);e.reject(t.error)}}.bind(this),function(t){BX.Kanban.Utils.showErrorDialog("Error: "+t,true);e.reject("Error: "+t)}.bind(this));return e},removeStage:function(t){var e=new BX.Promise;this.ajax({action:"modifyStage",columnId:t.getId(),delete:1},function(t){if(t&&!t.error){e.fulfill()}else if(t){e.reject(t.error)}}.bind(this),function(t){BX.Kanban.Utils.showErrorDialog("Error: "+t,true);e.reject("Error: "+t)}.bind(this));return e},getColumnItems:function(t){var e=new BX.Promise;this.ajax({action:"page",page:t.getPagination().getPage()+1,column:t.getId()},function(t){if(t&&(BX.type.isArray(t)||BX.type.isArray(t.items))&&!t.error){e.fulfill(BX.type.isArray(t)?t:t.items)}else if(t){BX.Kanban.Utils.showErrorDialog(t.error,t.fatal);e.reject(t.error)}}.bind(this),function(t){BX.Kanban.Utils.showErrorDialog("Error: "+t,true);e.reject("Error: "+t)}.bind(this));return e},addItemTop:function(t){var e=this.getColumn(t.columnId);var a=e?e.getItems():[];if(a.length>0){t.targetId=a[0].getId()}e.incPrice(t.data.price);this.addItem(t)},loadNew:function(t){var e=this.getData();var a=typeof t!=="undefined"?t:0;this.ajax(a?{action:"get",entity_id:a}:{action:"get",min_entity_id:e.lastId},function(t){if(t&&t.items){if(t.items.length>0){for(var i=t.items.length-1;i>=0;i--){var n=t.items[i];var r=this.getItem(n.id);if(r){var o=r.getData();var s=r.getColumn();var d=this.getColumn(n.columnId);this.updateItem(n.id,n);s.decPrice(parseFloat(o.price));d.incPrice(parseFloat(n.data.price));s.renderSubTitle();d.renderSubTitle()}else{this.addItemTop(n)}if(!a){e.lastId=n.id;this.setData(e)}}}else if(a){var n=this.getItem(a);var l=n.getData();var u=n.getColumn();u.decPrice(l.price);this.removeItem(a)}}}.bind(this),function(t){}.bind(this))},onItemDragStart:function(t){this.setDragMode(BX.Kanban.DragMode.ITEM);var e=this.getData();var a=this.getItems();var i=t.getColumn().getData();var n=t.getColumnId();if(e.entityType==="LEAD"&&i.type==="WIN"){for(var r in a){var o=a[r].getColumnId();if(o===n){a[r].enableDropping()}}return}BX.Kanban.Grid.prototype.onItemDragStart.apply(this,arguments)},onItemDragStartHandler:function(t){t.setLastPosition()},onColumnLoadAsync:function(t){t.push(BX.delegate(this.getColumnItems,this))},onColumnRemovedAsync:function(t){t.push(BX.delegate(this.removeStage,this))},onColumnAddedAsync:function(t){t.push(BX.delegate(this.addStage,this))},onBeforeItemCaptured:function(t){BX.onCustomEvent("Crm.Kanban.Grid:onBeforeItemCapturedStart",[this,t]);if(t.isActionAllowed()){var e=t.getItem();var a=e.getColumn();var i=t.getDropZone();var n=parseFloat(e.getData().price);a.decPrice(n);this.onItemMoved(e,i,null,true)}},onBeforeItemRestored:function(t){var e=t.getItem();var a=e.getColumn();var i=parseFloat(e.getData().price);a.incPrice(i);this.onItemMoved(e,a)},onBeforeItemMoved:function(t){var e=t.getTargetColumn();var a=t.getItem();var i=a.getColumn();var n=parseFloat(a.getData().price);i.decPrice(n);e.incPrice(n)},onItemMoved:function(t,e,a,i){if(i!==true){var n={grid:this,item:t,targetColumn:e,beforeItem:a,skip:false};BX.onCustomEvent("Crm.Kanban.Grid:onItemMovedFinal",[n]);if(n.skip===true){return}}var r=0;var o=t.getId();var s=e?e.getId():0;if(e instanceof BX.Kanban.DropZone){r=0}else{var d=e.getPreviousItemSibling(t);if(d){r=d.getId()}}this.ajax({action:"status",entity_id:o,prev_entity_id:r,status:s},function(e){if(e&&!e.error){if(e.items&&e.items.length>0){this.updateItem(o,e.items[0])}else{t.setDataKey("columnId",s)}}else if(e){BX.Kanban.Utils.showErrorDialog(e.error,true)}}.bind(this),function(t){BX.Kanban.Utils.showErrorDialog("Error: "+t,true)}.bind(this))},onColumnUpdated:function(t){var e=t.getId();var a=t.getName();var i=t.getColor();this.ajax({action:"modifyStage",columnId:e,columnName:a,columnColor:i},function(t){if(t&&t.error){BX.Kanban.Utils.showErrorDialog(t.error,t.fatal)}}.bind(this),function(t){BX.Kanban.Utils.showErrorDialog("Error: "+t,true)}.bind(this))},onColumnMoved:function(t,e){var a=t.getId();var i=this.getPreviousColumnSibling(t);var n=i?i.getId():0;this.ajax({action:"modifyStage",columnId:a,afterColumnId:n},function(t){if(t&&t.error){BX.Kanban.Utils.showErrorDialog(t.error,true)}}.bind(this),function(t){BX.Kanban.Utils.showErrorDialog("Error: "+t,true)}.bind(this))},onApplyFilter:function(t,e,a,i,n){this.fadeOut();n.autoResolve=false;this.ajax({action:"get"},function(t){var e=this.getColumns();for(var a=0,n=e.length;a<n;a++){this.removeColumn(e[a])}this.removeItems();this.loadData(t);i.fulfill();this.fadeIn()}.bind(this),function(t){i.reject();this.fadeIn()}.bind(this))},onApplyFilterCounter:function(t,e){setTimeout(BX.delegate(function(){var t=this.getData();var a={ACTIVITY_COUNTER:e["counterTypeId"]};var i=BX.Main.filterManager.getById(t.gridId);var n=i.getApi();n.setFields(a);n.apply()},this),0);e["cancel"]=true},onPullEventHandlerCrm:function(t,e){var a=this.getData();if(t==="activity_add"&&e.COMPLETED!=="Y"&&e.OWNER_TYPE_NAME===a.entityType){var i=this.getItem(e.OWNER_ID);if(i){var n=i.getDataKey("activityProgress");n++;i.setDataKey("activityProgress",n);i.switchPlanner()}}if(t==="notify"){var r=e.originalTag.match(new RegExp("CRM\\|"+a.entityType+"_RESPONSIBLE\\|([\\d]+)"));if(r&&r[1]){this.loadNew(r[1])}if(a.entityType==="INVOICE"&&e.settingName==="crm|invoice_responsible_changed"){var r=e.originalTag.match(new RegExp("CRM\\|"+a.entityType+"\\|([\\d]+)"));if(r&&r[1]){this.loadNew(r[1])}}}},onCrmActivityTodoChecked:function(t,e,a){var i=this.getItem(e);if(i){var n=i.getDataKey("activityProgress");n--;i.setDataKey("activityProgress",n);i.switchPlanner()}},onSliderClose:function(t){var e=this.getData();var a=e.entityPath;var i=t.slider.getUrl();a=a.replace(/\#([^\#]+)\#/,"([\\d]+)");var n=i.match(new RegExp(a));if(n&&n[1]){this.loadNew(n[1])}}}})();
/* End */
;
; /* Start:"a:4:{s:4:"full";s:49:"/bitrix/js/crm/kanban/item.min.js?151859618410485";s:6:"source";s:29:"/bitrix/js/crm/kanban/item.js";s:3:"min";s:33:"/bitrix/js/crm/kanban/item.min.js";s:3:"map";s:33:"/bitrix/js/crm/kanban/item.map.js";}"*/
(function(){"use strict";BX.namespace("BX.CRM.Kanban");BX.CRM.Kanban.Item=function(t){BX.Kanban.Item.apply(this,arguments);this.container=null;this.timer=null;this.popupTooltip=null;this.plannerCurrent=null};BX.CRM.Kanban.Item.prototype={__proto__:BX.Kanban.Item.prototype,constructor:BX.CRM.Kanban.Item,lastPosition:{columnId:null,targetId:null},clipTitle:function(t){var e=t;var i=e.split(" ");var n="<span>"+i[i.length-1]+"</span>";i.splice(i.length-1);e=i.join(" ")+" "+n;return e},setDataKey:function(t,e){var i=this.getData();i[t]=e;this.setData(i)},getDataKey:function(t){var e=this.getData();return e[t]},switchClass:function(t,e,i){if(i){BX.addClass(t,e)}else{BX.removeClass(t,e)}},switchVisible:function(t,e){if(e){t.style.display=""}else{BX.hide(t)}},getLastPosition:function(){return this.lastPosition},setLastPosition:function(){var t=this.getColumn();var e=t.getNextItemSibling(this);this.lastPosition={columnId:t.getId(),targetId:e?e.getId():0}},render:function(){if(!this.container){this.createLayout()}var t=this.getData();var e=this.getColumn();var i=e.getColor();var n=BX.util.hex2rgb(i);var a="rgba("+n.r+","+n.g+","+n.b+","+".7)";BX.style(this.container,"border-left","3px solid "+a);this.link.innerHTML=this.clipTitle(t.name);this.link.setAttribute("href",t.link);if(this.totalPrice){this.totalPrice.innerHTML=t.price_formatted}this.date.textContent=t.date;if(t.contactId&&t.contactName){this.contactName.textContent=BX.util.htmlspecialcharsback(t.contactName);this.contactName.setAttribute("href",t.contactLink);this.switchVisible(this.contactName,true)}else{this.switchVisible(this.contactName,false)}if(this.planner){this.switchPlanner()}var s=["Phone","Email","Im"];for(var o=0,r=s.length;o<r;o++){var c=s[o];var l="crm-kanban-item-contact-"+c.toLowerCase()+"-disabled";BX.unbindAll(this["contact"+c]);if(t[c.toLowerCase()]){BX.bind(this["contact"+c],"click",BX.delegate(this.clickContact,this));this.switchClass(this["contact"+c],l,false)}else{BX.bind(this["contact"+c],"mouseover",BX.delegate(function(){var t=BX.data(BX.proxy_context,"type");this.showTooltip(BX.message("CRM_KANBAN_NO_"+t.toUpperCase()),BX.proxy_context)},this));BX.bind(this["contact"+c],"mouseout",BX.delegate(this.hideTooltip,this));this.switchClass(this["contact"+c],l,true)}}return this.container},createLayout:function(){var t=this.getGridData();this.container=BX.create("div",{props:{className:"crm-kanban-item"},events:{dblclick:function(){var t=this.getData();window.location.href=t.link}.bind(this),mouseenter:function(){this.addHoverClass(this.container)}.bind(this),mouseleave:function(){this.removeHoverClass(this.container)}.bind(this)}});this.link=BX.create("a",{props:{className:"crm-kanban-item-title"}});this.container.appendChild(this.link);if(t.entityType!=="LEAD"){this.totalPrice=BX.create("div",{props:{className:"crm-kanban-item-total-price"}});this.total=BX.create("div",{props:{className:"crm-kanban-item-total"},children:[this.totalPrice]});this.container.appendChild(this.total)}this.contactName=BX.create("a",{props:{className:"crm-kanban-item-contact"}});this.container.appendChild(this.contactName);this.date=BX.create("div",{props:{className:"crm-kanban-item-date"}});this.container.appendChild(this.date);if(t.showActivity){this.activityExist=BX.create("span",{props:{className:"crm-kanban-item-activity"},events:{click:BX.delegate(this.showCurrentPlan,this)}});this.activityEmpty=BX.create("span",{props:{className:"crm-kanban-item-activity-empty"},events:{mouseover:BX.delegate(function(){this.showTooltip(BX.message("CRM_KANBAN_ACTIVITY_LETSGO_"+t.entityType),BX.proxy_context)},this),mouseout:BX.delegate(this.hideTooltip,this)}});this.activityPlan=BX.create("span",{props:{className:"crm-kanban-item-plan"},text:BX.message("CRM_KANBAN_ACTIVITY_MY"),events:{click:BX.delegate(this.showPlannerMenu,this)}});this.planner=BX.create("span",{props:{className:"crm-kanban-item-planner"},children:[this.activityEmpty,this.activityExist,this.activityPlan]});this.container.appendChild(this.planner)}this.contactPhone=BX.create("span",{props:{className:"crm-kanban-item-contact-phone crm-kanban-item-contact-phone-disabled"},attrs:{"data-type":"phone"}});this.contactEmail=BX.create("span",{props:{className:"crm-kanban-item-contact-email crm-kanban-item-contact-email-disabled"},attrs:{"data-type":"email"}});this.contactIm=BX.create("span",{props:{className:"crm-kanban-item-contact-im crm-kanban-item-contact-im-disabled"},attrs:{"data-type":"im"}});this.contactBlock=BX.create("div",{props:{className:"crm-kanban-item-connect"},children:[this.contactPhone,this.contactEmail,this.contactIm]});this.container.appendChild(this.contactBlock);this.container.appendChild(this.createShadow())},getPreloader:function(){return'<div class="crm-kanban-preloader-wapper">\n								<div class="crm-kanban-preloader">\n									<svg class="crm-kanban-circular" viewBox="25 25 50 50">\n										<circle class="crm-kanban-path" cx="50" cy="50" r="20" fill="none" stroke-width="1" stroke-miterlimit="10"/>\n									</svg>\n								</div>\n						</div>'},loadCurrentPlan:function(){this.getGrid().ajax({action:"activities",entity_id:this.getId()},function(t){this.plannerCurrent.setContent(t);this.plannerCurrent.adjustPosition()}.bind(this),function(t){BX.Kanban.Utils.showErrorDialog("Error: "+t,true)}.bind(this),"html")},showCurrentPlan:function(){this.plannerCurrent=BX.PopupWindowManager.create("kanban_planner_current",BX.proxy_context,{closeIcon:false,autoHide:true,className:"crm-kanban-popup-plan",closeByEsc:true,contentColor:"white",angle:true,offsetLeft:15,overlay:{backgroundColor:"transparent",opacity:"0"},events:{onAfterPopupShow:BX.delegate(this.loadCurrentPlan,this),onPopupClose:function(){this.plannerCurrent.destroy();BX.removeClass(this.container,"crm-kanban-item-hover");BX.unbind(window,"scroll",BX.proxy(this.adjustPopup,this))}.bind(this)}});this.plannerCurrent.setContent(this.getPreloader());this.plannerCurrent.show();BX.addClass(this.container,"crm-kanban-item-hover");BX.bind(window,"scroll",BX.proxy(this.adjustPopup,this))},clickContact:function(){var t=BX.data(BX.proxy_context,"type");var e=this.getData();var i=e[t];if(typeof i==="undefined"){return}if(Array.isArray(i)&&i.length>1){var n=[];for(var a=0,s=i.length;a<s;a++){n.push({value:i[a]["value"],type:t,text:i[a]["value"]+" ("+i[a]["title"]+")",onclick:BX.proxy(this.clickContactItem,this)})}BX.PopupMenu.show("kanban_contact_menu_"+t+this.getId(),BX.proxy_context,n,{autoHide:true,zIndex:1200,offsetLeft:20,angle:true,closeByEsc:true,events:{onPopupClose:function(){BX.removeClass(this.container,"crm-kanban-item-hover");BX.unbind(window,"scroll",BX.proxy(this.adjustPopup,this))}.bind(this)}});BX.addClass(this.container,"crm-kanban-item-hover");BX.bind(window,"scroll",BX.proxy(this.adjustPopup,this))}else{if(!Array.isArray(i)){i=[i]}this.clickContactItem(0,{value:i[0]["value"],type:t})}},clickContactItem:function(t,e){var i=this.getData();if(e.type==="phone"&&typeof BXIM!=="undefined"){BXIM.phoneTo(e.value,{ENTITY_TYPE:i.contactType,ENTITY_ID:i.contactId})}else if(e.type==="im"&&typeof BXIM!=="undefined"){BXIM.openMessenger(e.value)}else if(e.type==="email"){var n=BX.CrmActivityEditor&&BX.CrmActivityEditor.items["kanban_activity_editor"];var a=top.BX.Bitrix24&&top.BX.Bitrix24.Slider;if(n&&BX.CrmActivityProvider&&a){var s=this.getGridData();BX.CrmActivityEditor.items["kanban_activity_editor"].addEmail({ownerType:s.entityType,ownerID:i.id,communications:[{type:"EMAIL",value:e.value,entityId:i.id,entityType:s.entityType,entityTitle:i.name}],communicationsLoaded:true})}else{top.location.href="mailto:"+e.value}}},selectPlannerMenu:function(t,e){var i=this.getGridData();if(e.type==="meeting"||e.type==="call"){(new BX.Crm.Activity.Planner).showEdit({TYPE_ID:BX.CrmActivityType[e.type],OWNER_TYPE:i.entityType,OWNER_ID:this.getId()})}else if(e.type==="task"){if(typeof window["taskIFramePopup"]!=="undefined"){var n={UF_CRM_TASK:[BX.CrmOwnerTypeAbbr.resolve(i.entityType)+"_"+this.getId()],TITLE:"CRM: ",TAGS:"crm"};window["taskIFramePopup"].add(n)}}else if(e.type==="visit"){var a=i.visitParams;a.OWNER_TYPE=i.entityType;a.OWNER_ID=this.getId();BX.CrmActivityVisit.create(a).showEdit()}BX.PopupMenu.getCurrentMenu().close()},getPlannerMenu:function(){return[{type:"call",text:BX.message("CRM_KANBAN_ACTIVITY_PLAN_CALL"),onclick:BX.delegate(this.selectPlannerMenu,this)},{type:"meeting",text:BX.message("CRM_KANBAN_ACTIVITY_PLAN_MEETING"),onclick:BX.delegate(this.selectPlannerMenu,this)},{type:"visit",text:BX.message("CRM_KANBAN_ACTIVITY_PLAN_VISIT"),onclick:BX.delegate(this.selectPlannerMenu,this)},{type:"task",text:BX.message("CRM_KANBAN_ACTIVITY_PLAN_TASK"),onclick:BX.delegate(this.selectPlannerMenu,this)}]},showPlannerMenu:function(){BX.PopupMenu.show("kanban_planner_menu_"+this.getId(),BX.proxy_context,this.getPlannerMenu(),{autoHide:true,offsetLeft:20,angle:true,overlay:{backgroundColor:"transparent",opacity:"0"},events:{onPopupClose:function(){BX.removeClass(this.container,"crm-kanban-item-hover");BX.unbind(window,"scroll",BX.proxy(this.adjustPopup,this))}.bind(this)}});BX.addClass(this.container,"crm-kanban-item-hover");BX.bind(window,"scroll",BX.proxy(this.adjustPopup,this))},switchPlanner:function(){var t=this.getData();var e=this.getColumn();var i=e.getData();if(t.activityProgress>0){this.switchVisible(this.activityExist,true);this.switchVisible(this.activityEmpty,false);this.activityExist.textContent=BX.message("CRM_KANBAN_ACTIVITY_PLAN")+": "+t.activityProgress}else{this.switchVisible(this.activityExist,false);this.switchVisible(this.activityEmpty,i.type!=="WIN");this.activityEmpty.textContent=BX.message("CRM_KANBAN_ACTIVITY_PLAN")}},showTooltip:function(t,e){this.popupTooltip=new BX.PopupWindow("kanban_tooltip",BX.proxy_context,{className:"crm-kanban-without-tooltip",offsetLeft:14,darkMode:true,closeByEsc:true,angle:true,autoHide:true,content:t});this.popupTooltip.show()},hideTooltip:function(){this.popupTooltip.destroy()},createShadow:function(){return BX.create("div",{props:{className:"crm-kanban-item-shadow"}})},addHoverClass:function(t){this.timer=setTimeout(function(){t.classList.add("crm-kanban-item-event")},400)},removeHoverClass:function(t){clearTimeout(this.timer);t.classList.remove("crm-kanban-item-event")},adjustPopup:function(){var t=BX.PopupWindowManager.getCurrentPopup();if(!t){var e=BX.PopupMenu.getCurrentMenu();t=e.getPopupWindow()}if(t){t.adjustPosition()}}}})();
/* End */
;
; /* Start:"a:4:{s:4:"full";s:50:"/bitrix/js/crm/kanban/column.min.js?15185961842791";s:6:"source";s:31:"/bitrix/js/crm/kanban/column.js";s:3:"min";s:0:"";s:3:"map";s:0:"";}"*/
(function(){BX.namespace("BX.CRM.Kanban");BX.CRM.Kanban.Column=function(t){BX.Kanban.Column.apply(this,arguments)};BX.CRM.Kanban.Column.prototype={__proto__:BX.Kanban.Column.prototype,constructor:BX.CRM.Kanban.Column,renderSubtitleTime:6,currencyFormat:function(t,e,i){var n="",a;if(typeof BX.Currency==="undefined"){return t}i=!!i;a=BX.Currency.getCurrencyFormat(e);if(!!a&&typeof a==="object"){a.CURRENT_DECIMALS=a.DECIMALS;a.HIDE_ZERO="Y";if(a.HIDE_ZERO==="Y"&&t==parseInt(t,10)){a.CURRENT_DECIMALS=0}n=BX.util.number_format(t,a.CURRENT_DECIMALS,a.DEC_POINT,a.THOUSANDS_SEP);if(i){n=a.FORMAT_STRING.replace(/(^|[^&])#/,"$1"+n)}}return n},decPrice:function(t){var e=this.getData();e.sum=parseFloat(e.sum)-t;this.setData(e)},incPrice:function(t){var e=this.getData();e.sum=parseFloat(e.sum)+t;this.setData(e)},getAddColumnButton:function(){var t=this.getData();if(t.type==="WIN"){this.layout.info.style.marginRight="0";return BX.create("div")}else{return BX.Kanban.Column.prototype.getAddColumnButton.apply(this,arguments)}},renderSubTitle:function(){var t=this.getData();if(typeof this.layout.subTitlePrice==="undefined"){var e=this.getGridData();if(e.entityType!=="LEAD"){this.layout.subTitlePriceText=BX.create("span",{attrs:{className:"crm-kanban-total-price-total"}});this.layout.subTitlePrice=BX.create("div",{attrs:{className:"crm-kanban-total-price"},children:[this.layout.subTitlePriceText]})}else{this.layout.subTitlePrice=null}}if(this.layout.subTitlePriceText){var e=this.getGridData();t.sum=parseFloat(t.sum);t.sum_old=t.sum_old?t.sum_old:t.sum_init;t.sum_init=t.sum;this.renderSubTitleAnimation(t.sum_old,t.sum,Math.abs(t.sum_old-t.sum)/20,this.layout.subTitlePriceText,function(i,n){i.innerHTML=this.currencyFormat(Math.round(n),e.currency,true);t.sum_old=t.sum}.bind(this));this.setData(t)}return this.layout.subTitlePrice},renderSubTitleAnimation:function(t,e,i,n,a){var r=+t;var u=parseFloat(e);var o=this.renderSubtitleTime;if(r<u){(function(){if(r<=u){setTimeout(arguments.callee,o);n.textContent=BX.util.number_format(r,0,","," ");r=r+i}else{if(typeof a==="function"){a(n,e)}}})()}else if(r>u){(function(){if(r>=u){setTimeout(arguments.callee,o);n.textContent=BX.util.number_format(r,0,","," ");r=r-i}else{if(typeof a==="function"){a(n,e)}}})()}else if(typeof a==="function"){a(n,e)}},handleAddColumnButtonClick:function(t){var e=this.getGridData();if(e.rights&&e.rights.canAddColumn){BX.Kanban.Column.prototype.handleAddColumnButtonClick.apply(this,arguments)}else if(typeof BX.Intranet!=="undefined"){this.getGrid().accessNotify()}},switchToEditMode:function(){var t=this.getGridData();if(t.rights&&t.rights.canAddColumn){BX.Kanban.Column.prototype.switchToEditMode.apply(this,arguments)}else if(typeof BX.Intranet!=="undefined"){this.getGrid().accessNotify()}}}})();
/* End */
;
//# sourceMappingURL=kernel_crm_kanban.map.js